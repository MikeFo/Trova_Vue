!function(){var e=["_profile","_relevantSkills"];function n(e){if(null!=e){var n=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],t=0;if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}}}throw new TypeError(r(e)+" is not iterable")}function t(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],-1===n.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach(function(n){p(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function c(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function o(t,r,a,o){var i=r&&r.prototype instanceof l?r:l,u=Object.create(i.prototype);return s(u,"_invoke",function(t,r,a){var o,i,s,l=0,u=a||[],d=!1,m={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,t){return o=n,i=0,s=e,m.n=t,c}};function f(t,r){for(i=t,s=r,n=0;!d&&l&&!a&&n<u.length;n++){var a,o=u[n],f=m.p,v=o[2];t>3?(a=v===r)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=f&&((a=t<2&&f<o[1])?(i=0,m.v=r,m.n=o[1]):f<v&&(a=t<3||o[0]>r||r>v)&&(o[4]=t,o[5]=r,m.n=v,i=0))}if(a||t>1)return c;throw d=!0,r}return function(a,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),i=u,s=v;(n=i<2?e:s)||!d;){o||(i?i<3?(i>1&&(m.n=-1),f(i,s)):m.n=s:m.v=s);try{if(l=2,o){if(i||(a="next"),n=o[a]){if(!(n=n.call(o,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=o.return)&&n.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((n=(d=m.n<0)?s:t.call(r,m))!==c)break}catch(n){o=e,i=1,s=n}finally{l=1}}return{value:n,done:d}}}(t,a,o),!0),u}var c={};function l(){}function u(){}function d(){}n=Object.getPrototypeOf;var m=[][r]?n(n([][r]())):(s(n={},r,function(){return this}),n),f=d.prototype=l.prototype=Object.create(m);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=d,s(f,"constructor",d),s(d,"constructor",u),u.displayName="GeneratorFunction",s(d,a,"GeneratorFunction"),s(f),s(f,a,"Generator"),s(f,r,function(){return this}),s(f,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m:v}})()}function s(e,n,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}s=function(e,n,t,r){function o(n,t){s(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(o("next",0),o("throw",1),o("return",2))},s(e,n,t,r)}function l(e,n,t,r,a,o,c){try{var i=e[o](c),s=i.value}catch(e){return void t(e)}i.done?n(s):Promise.resolve(s).then(r,a)}function u(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var o=e.apply(n,t);function c(e){l(o,r,a,c,i,"next",e)}function i(e){l(o,r,a,c,i,"throw",e)}c(void 0)})}}function d(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,a,o,c,i=[],s=!0,l=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;s=!1}else for(;!(s=(r=o.call(t)).done)&&(i.push(r.value),i.length!==n);s=!0);}catch(e){l=!0,a=e}finally{try{if(!s&&null!=t.return&&(c=t.return(),Object(c)!==c))return}finally{if(l)throw a}}return i}}(e,n)||f(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=f(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return c=e.done,e},e:function(e){i=!0,o=e},f:function(){try{c||null==t.return||t.return()}finally{if(i)throw o}}}}function f(e,n){if(e){if("string"==typeof e)return v(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?v(e,n):void 0}}function v(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function h(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function p(e,n,t){return(n=g(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function g(e){var n=function(e,n){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,n||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==r(n)?n:n+""}System.register(["./index-legacy-D3_iwoP0.js"],function(a,s){"use strict";var l,f,v,g,y,b,S,A,k,w,C;return{setters:[function(e){l=e._,f=e.x,v=e.y,g=e.z,y=e.A,b=e.B,S=e.C,A=e.T,k=e.D,w=e.E,C=e.e}],execute:function(){var I=function(){return a=function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"matchesCache",new Map),p(this,"conversationsCache",new Map),p(this,"profilesCache",new Map),p(this,"CACHE_TTL",3e5),p(this,"FIREBASE_CACHE_TTL",6e5),p(this,"pendingRequests",new Map)},I=[{key:"getMatchesCacheKey",value:function(e,n,t,r){return"matches_".concat(e,"_").concat(n||"all","_").concat(t||"all","_").concat(r||"all")}},{key:"getConversationsCacheKey",value:function(e){return"conversations_".concat(e)}},{key:"isCacheValid",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.CACHE_TTL;return Date.now()-e<n}},{key:"clearExpiredCache",value:function(){var e,n=m(this.matchesCache.entries());try{for(n.s();!(e=n.n()).done;){var t=d(e.value,2),r=t[0],a=t[1];this.isCacheValid(a.timestamp)||this.matchesCache.delete(r)}}catch(g){n.e(g)}finally{n.f()}var o,c=m(this.conversationsCache.entries());try{for(c.s();!(o=c.n()).done;){var i=d(o.value,2),s=i[0],l=i[1];this.isCacheValid(l.timestamp,this.FIREBASE_CACHE_TTL)||this.conversationsCache.delete(s)}}catch(g){c.e(g)}finally{c.f()}var u,f=m(this.profilesCache.entries());try{for(f.s();!(u=f.n()).done;){var v=d(u.value,2),h=v[0],p=v[1];this.isCacheValid(p.timestamp)||this.profilesCache.delete(h)}}catch(g){f.e(g)}finally{f.f()}}},{key:"getCachedProfiles",value:(en=u(i().m(function e(n){var t,r,a,o;return i().w(function(e){for(;;)switch(e.n){case 0:if(!(t=this.profilesCache.get(n))||!this.isCacheValid(t.timestamp)){e.n=1;break}return console.log("[AdminService] ‚úÖ Using cached profiles for community ".concat(n)),e.a(2,t.data);case 1:return e.n=2,l(function(){return s.import("./profile.service-legacy-D-F1sSvx.js")},void 0);case 2:return r=e.v,a=r.profileService,e.n=3,a.getProfilesForUserAndCommunity(n);case 3:return o=e.v,this.profilesCache.set(n,{data:o,timestamp:Date.now()}),e.a(2,o)}},e,this)})),function(e){return en.apply(this,arguments)})},{key:"isManager",value:(Xe=u(i().m(function e(n,t,r){var a,o;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!r||r.leaderId!==t){e.n=1;break}return e.a(2,!0);case 1:return e.p=1,e.n=2,f.get("/communities/".concat(n,"/managers/").concat(t,"/check"));case 2:return a=e.v,e.a(2,(null==a?void 0:a.isManager)||!1);case 3:if(e.p=3,o=e.v,!r||r.leaderId!==t){e.n=4;break}return e.a(2,!0);case 4:return console.error("Failed to check manager status:",o),e.a(2,!1)}},e,null,[[1,3]])})),function(e,n,t){return Xe.apply(this,arguments)})},{key:"isSuperAdmin",value:function(e){return(C.production?[4147,3113,4136,14453]:[3434,3296,3422,2920,2583,2935]).includes(e)}},{key:"getAllCommunitiesForSuperAdmin",value:(Ye=u(i().m(function e(n){var t,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f.get("/users/".concat(n,"/all-communities-manager-of"));case 1:return t=e.v,e.a(2,t||[]);case 2:return e.p=2,r=e.v,console.error("Failed to fetch all communities for super admin:",r),e.a(2,[])}},e,null,[[0,2]])})),function(e){return Ye.apply(this,arguments)})},{key:"getCommunityMembers",value:(Qe=u(i().m(function e(n){var t,r,a,o,c,u,d,m,v;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f.get("/communities/".concat(n,"/members"));case 1:return t=e.v,e.a(2,t||[]);case 2:if(e.p=2,404!==(null==(m=e.v)?void 0:m.status)&&404!==(null==m||null===(r=m.response)||void 0===r?void 0:r.status)){e.n=11;break}return e.p=3,e.n=4,this.getCachedProfiles(n);case 4:if(a=e.v,o=a.map(function(e){return e.userId||e.id}).filter(function(e){return"number"==typeof e&&e>0}),c=new Map,!(o.length>0)){e.n=9;break}return e.p=5,e.n=6,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bZ})},void 0);case 6:return u=e.v,d=u.userService,e.n=7,d.getUsersByIds(o);case 7:c=e.v,e.n=9;break;case 8:e.p=8,v=e.v,console.warn("[AdminService] Failed to fetch user emails:",v);case 9:return e.a(2,a.map(function(e){var n=e.userId||e.id,t=c.get(n);return{id:n,fname:e.fname,lname:e.lname,fullName:e.fullName||"".concat(e.fname," ").concat(e.lname),email:(null==t?void 0:t.email)||"",profilePicture:e.profilePicture,isManager:!1,enabled:!0,joinDate:void 0}}));case 10:return e.p=10,e.v,console.log("[AdminService] Members endpoint not found for community ".concat(n,", using empty array")),e.a(2,[]);case 11:return console.error("Failed to fetch community members:",m),e.a(2,[])}},e,this,[[5,8],[3,10],[0,2]])})),function(e){return Qe.apply(this,arguments)})},{key:"searchMembers",value:($e=u(i().m(function e(n,t){var r,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f.get("/communities/".concat(n,"/members/search?q=").concat(encodeURIComponent(t)));case 1:return r=e.v,e.a(2,r||[]);case 2:return e.p=2,a=e.v,console.error("Failed to search members:",a),e.a(2,[])}},e,null,[[0,2]])})),function(e,n){return $e.apply(this,arguments)})},{key:"toggleUserStatus",value:(Ke=u(i().m(function e(n,t){var r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f.put("/users/".concat(n,"/status"),{enabled:t});case 1:e.n=3;break;case 2:throw e.p=2,r=e.v,console.error("Failed to toggle user status:",r),r;case 3:return e.a(2)}},e,null,[[0,2]])})),function(e,n){return Ke.apply(this,arguments)})},{key:"toggleManager",value:(Je=u(i().m(function e(n,t,r){var a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!r){e.n=2;break}return e.n=1,f.post("/communities/".concat(n,"/managers"),{userId:t});case 1:e.n=3;break;case 2:return e.n=3,f.delete("/communities/".concat(n,"/managers/").concat(t));case 3:e.n=5;break;case 4:throw e.p=4,a=e.v,console.error("Failed to toggle manager:",a),a;case 5:return e.a(2)}},e,null,[[0,4]])})),function(e,n,t){return Je.apply(this,arguments)})},{key:"updateCommunityBio",value:(Ze=u(i().m(function e(n,t){var r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f.patch("/communities/".concat(n),{bio:t});case 1:return e.a(2,e.v);case 2:throw e.p=2,r=e.v,console.error("Failed to update community bio:",r),r;case 3:return e.a(2)}},e,null,[[0,2]])})),function(e,n){return Ze.apply(this,arguments)})},{key:"updateCommunityLogo",value:(He=u(i().m(function e(n,t){var r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f.patch("/communities/".concat(n),{logo:t});case 1:return e.a(2,e.v);case 2:throw e.p=2,r=e.v,console.error("Failed to update community logo:",r),r;case 3:return e.a(2)}},e,null,[[0,2]])})),function(e,n){return He.apply(this,arguments)})},{key:"sendMessage",value:(Ve=u(i().m(function e(n,t,r){var a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f.post("/communities/".concat(n,"/messages"),{userIds:t,message:r});case 1:e.n=3;break;case 2:throw e.p=2,a=e.v,console.error("Failed to send message:",a),a;case 3:return e.a(2)}},e,null,[[0,2]])})),function(e,n,t){return Ve.apply(this,arguments)})},{key:"uploadDriverData",value:(Ge=u(i().m(function e(n,t){var r,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(r=new FormData).append("file",t),e.n=1,f.post("/communities/".concat(n,"/data/drivers"),r);case 1:e.n=3;break;case 2:throw e.p=2,a=e.v,console.error("Failed to upload driver data:",a),a;case 3:return e.a(2)}},e,null,[[0,2]])})),function(e,n){return Ge.apply(this,arguments)})},{key:"uploadReportsToData",value:(We=u(i().m(function e(n,t){var r,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(r=new FormData).append("file",t),e.n=1,f.post("/communities/".concat(n,"/data/reports-to"),r);case 1:e.n=3;break;case 2:throw e.p=2,a=e.v,console.error("Failed to upload reports-to data:",a),a;case 3:return e.a(2)}},e,null,[[0,2]])})),function(e,n){return We.apply(this,arguments)})},{key:"uploadMappedPairings",value:(qe=u(i().m(function e(n,t){var r,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(r=new FormData).append("file",t),e.n=1,f.post("/communities/".concat(n,"/data/pairings"),r);case 1:e.n=3;break;case 2:throw e.p=2,a=e.v,console.error("Failed to upload mapped pairings:",a),a;case 3:return e.a(2)}},e,null,[[0,2]])})),function(e,n){return qe.apply(this,arguments)})},{key:"getAttributeChartData",value:(xe=u(i().m(function e(n,t){var r,a,o,c,s,l=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=!(l.length>2&&void 0!==l[2])||l[2],a=!(l.length>3&&void 0!==l[3])||l[3],e.p=1,o="/communities/".concat(n,"/attribute?type=").concat(t,"&consolidateResults=").concat(r,"&onlyActive=").concat(a),e.n=2,f.get(o);case 2:return c=e.v,e.a(2,c||[]);case 3:return e.p=3,s=e.v,console.error("Failed to fetch attribute data for ".concat(t,":"),s),e.a(2,[])}},e,null,[[1,3]])})),function(e,n){return xe.apply(this,arguments)})},{key:"getSkillsChartData",value:(Re=u(i().m(function e(n,t){var r,a,o,c,s,l=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=!(l.length>2&&void 0!==l[2])||l[2],a=!(l.length>3&&void 0!==l[3])||l[3],e.p=1,o="/communities/".concat(n,"/skills?type=").concat(t,"&consolidateResults=").concat(r,"&onlyActive=").concat(a),e.n=2,f.get(o);case 2:return c=e.v,e.a(2,c||[]);case 3:return e.p=3,s=e.v,console.error("Failed to fetch skills data for ".concat(t,":"),s),e.a(2,[])}},e,null,[[1,3]])})),function(e,n){return Re.apply(this,arguments)})},{key:"getBusinessTopicsChartData",value:(Be=u(i().m(function e(n){var t,r,a,o,c,s=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=!(s.length>1&&void 0!==s[1])||s[1],r=!(s.length>2&&void 0!==s[2])||s[2],e.p=1,a="/communities/".concat(n,"/businessTopics?consolidateResults=").concat(t,"&onlyActive=").concat(r),e.n=2,f.get(a);case 2:return o=e.v,e.a(2,o||[]);case 3:return e.p=3,c=e.v,console.error("Failed to fetch business topics data:",c),e.a(2,[])}},e,null,[[1,3]])})),function(e){return Be.apply(this,arguments)})},{key:"getCustomFieldsForCharts",value:(ze=u(i().m(function e(n){var t,r,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t="/communities/".concat(n,"/custom-fields-for-charts"),e.n=1,f.get(t);case 1:return r=e.v,e.a(2,r||[]);case 2:return e.p=2,a=e.v,console.error("Failed to fetch custom fields for charts:",a),e.a(2,[])}},e,null,[[0,2]])})),function(e){return ze.apply(this,arguments)})},{key:"getCustomFieldChartData",value:(Oe=u(i().m(function e(n,t){var r,a,o,c,s,l=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=!(l.length>2&&void 0!==l[2])||l[2],a=!(l.length>3&&void 0!==l[3])||l[3],e.p=1,o="/communities/".concat(n,"/custom-field-chart/").concat(t,"?consolidateResults=").concat(r,"&onlyActive=").concat(a),e.n=2,f.get(o);case 2:if(c=e.v,!Array.isArray(c)){e.n=3;break}return e.a(2,c);case 3:if(!c||!Array.isArray(c.results)){e.n=4;break}return e.a(2,c);case 4:if(!c||!Array.isArray(c.data)){e.n=5;break}return e.a(2,{results:c.data,fieldName:c.fieldName,customFieldName:c.customFieldName,fieldId:c.fieldId});case 5:return console.warn("[AdminService] Unexpected response format for custom field ".concat(t,":"),c),e.a(2,[]);case 6:e.n=8;break;case 7:return e.p=7,s=e.v,console.error("Failed to fetch custom field ".concat(t," data:"),s),e.a(2,[]);case 8:return e.a(2)}},e,null,[[1,7]])})),function(e,n){return Oe.apply(this,arguments)})},{key:"getUsersByAttribute",value:(Le=u(i().m(function e(n,t,r){var a,s,l,u,d,m,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=!(U.length>3&&void 0!==U[3])||U[3],s=U.length>4?U[4]:void 0,e.p=1,l="/communities/".concat(n,"/attribute/users?type=").concat(t,"&value=").concat(encodeURIComponent(r),"&onlyActive=").concat(a),"skill"===t&&s&&(l+="&skillType=".concat(s)),"business_topic"===t&&(l+="&full=true"),l+="&limit=200",e.n=2,f.get(l);case 2:if(u=e.v,m=null,Array.isArray(u)?d=u:u&&Array.isArray(u.data)?(d=u.data,m=u.pagination):(console.warn("[AdminService] Unexpected response format for ".concat(t,":").concat(r)),d=[]),d&&0!==d.length){e.n=3;break}return e.a(2,[]);case 3:if(!(m&&m.totalPages>1)){e.n=10;break}v=c(d),h=m.totalPages||1,p=m.currentPage||1,g=p+1;case 4:if(!(g<=h)){e.n=9;break}return e.p=5,y="/communities/".concat(n,"/attribute/users?type=").concat(t,"&value=").concat(encodeURIComponent(r),"&onlyActive=").concat(a,"&limit=200&page=").concat(g),"skill"===t&&s&&(y+="&skillType=".concat(s)),"business_topic"===t&&(y+="&full=true"),e.n=6,f.get(y);case 6:b=e.v,S=Array.isArray(b)?b:(null==b?void 0:b.data)||[],v.push.apply(v,c(S)),e.n=8;break;case 7:e.p=7,T=e.v,console.warn("[AdminService] Failed to load page ".concat(g," for ").concat(t,":").concat(r,":"),T);case 8:g++,e.n=4;break;case 9:d=v;case 10:return A=d.map(function(e){return o({id:e.id||e.userId,userId:e.userId||e.id,fname:e.fname||"",lname:e.lname||"",fullName:e.fullName||"".concat(e.fname||""," ").concat(e.lname||"").trim(),email:e.email||"",profilePicture:e.profilePicture,bio:e.bio,pronouns:e.pronouns,isManager:e.isManager,enabled:e.enabled,joinDate:e.joinDate},e)}),e.a(2,A);case 11:if(e.p=11,F=e.v,I=(null==F?void 0:F.status)||(null==F||null===(k=F.response)||void 0===k?void 0:k.status),_=(null==F?void 0:F.statusText)||(null==F||null===(w=F.response)||void 0===w?void 0:w.statusText),console.error("[AdminService] ‚ùå Error fetching users for ".concat(t,":").concat(r,":"),{status:I,statusText:_,message:null==F?void 0:F.message,response:null==F||null===(C=F.response)||void 0===C?void 0:C.data,fullError:F}),404!==I){e.n=12;break}return e.a(2,this.getUsersByAttributeFallback(n,t,r,a));case 12:if(400!==I){e.n=13;break}return console.warn("[AdminService] 400 Bad Request for ".concat(t,":").concat(r,", attempting fallback")),e.a(2,this.getUsersByAttributeFallback(n,t,r,a));case 13:if(500!==I){e.n=14;break}return console.error("[AdminService] 500 Internal Server Error - Backend SQL query failed for ".concat(t,":").concat(r),null==F||null===(M=F.response)||void 0===M?void 0:M.data),e.a(2,this.getUsersByAttributeFallback(n,t,r,a));case 14:return console.warn("[AdminService] Error ".concat(I," for ").concat(t,":").concat(r,", attempting fallback")),e.a(2,this.getUsersByAttributeFallback(n,t,r,a))}},e,this,[[5,7],[1,11]])})),function(e,n,t){return Le.apply(this,arguments)})},{key:"getUsersByAttributeFallback",value:(Ne=u(i().m(function e(n,t,r){var a,o,s,l,u,d,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P,j,N,L,O,z,B=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=!(B.length>3&&void 0!==B[3])||B[3],e.p=1,e.n=2,this.getCachedProfiles(n);case 2:if(o=e.v,s=(r||"").trim().toLowerCase(),l=function(e){return(e||"").trim().toLowerCase()===s},u=function(e){return(e||"").trim().toLowerCase().includes(s)},d=function(e){return e?(Array.isArray(e)?e:[e]).map(function(e){return e?"string"==typeof e?e:"number"==typeof e?String(e):"string"==typeof(null==e?void 0:e.name)?e.name:"string"==typeof(null==e?void 0:e.label)?e.label:"string"==typeof(null==e?void 0:e.primaryName)?e.primaryName:"string"==typeof(null==e?void 0:e.secondaryName)?e.secondaryName:"string"==typeof(null==e?void 0:e.value)?e.value:"":""}).map(function(e){return e.trim()}).filter(Boolean):[]},f=function(e){var n,r,a,o,i,s,l=e||{},u=l.data||l.profileData||l.profile||{};switch(t){case"interest":var f=[].concat(c(d(l.interests)),c(d(u.interests)),c(d(l.dataInterests)),c(d(u.dataInterests)),c(d(l.passions)),c(d(u.passions)),c(d(null===(n=l.profile)||void 0===n?void 0:n.interests)),c(d(null===(r=l.profileData)||void 0===r?void 0:r.interests)),c(d(null===(a=l.userProfile)||void 0===a?void 0:a.interests)));if(l.userThings&&Array.isArray(l.userThings)){var v,h=m(l.userThings);try{for(h.s();!(v=h.n()).done;){var p=v.value;if(Array.isArray(p)&&p.length>=2){var g=p[0];if("interest"===g||"interests"===g){var y=p[1];Array.isArray(y)?f.push.apply(f,c(d(y))):"string"==typeof y&&f.push(y.trim())}}}}catch(K){h.e(K)}finally{h.f()}}if(u.userThings&&Array.isArray(u.userThings)){var b,S=m(u.userThings);try{for(S.s();!(b=S.n()).done;){var A=b.value;if(Array.isArray(A)&&A.length>=2){var k=A[0];if("interest"===k||"interests"===k){var w=A[1];Array.isArray(w)?f.push.apply(f,c(d(w))):"string"==typeof w&&f.push(w.trim())}}}}catch(K){S.e(K)}finally{S.f()}}return f;case"activity":var C=[].concat(c(d(l.activities)),c(d(u.activities)),c(d(l.dataActivities)),c(d(u.dataActivities)),c(d(l.passions)),c(d(u.passions)),c(d(null===(o=l.profile)||void 0===o?void 0:o.activities)),c(d(null===(i=l.profileData)||void 0===i?void 0:i.activities)),c(d(null===(s=l.userProfile)||void 0===s?void 0:s.activities)));if(l.userThings&&Array.isArray(l.userThings)){var I,_=m(l.userThings);try{for(_.s();!(I=_.n()).done;){var M=I.value;if(Array.isArray(M)&&M.length>=2){var T=M[0];if("activity"===T||"activities"===T){var F=M[1];Array.isArray(F)?C.push.apply(C,c(d(F))):"string"==typeof F&&C.push(F.trim())}}}}catch(K){_.e(K)}finally{_.f()}}if(u.userThings&&Array.isArray(u.userThings)){var U,D=m(u.userThings);try{for(D.s();!(U=D.n()).done;){var E=U.value;if(Array.isArray(E)&&E.length>=2){var P=E[0];if("activity"===P||"activities"===P){var j=E[1];Array.isArray(j)?C.push.apply(C,c(d(j))):"string"==typeof j&&C.push(j.trim())}}}}catch(K){D.e(K)}finally{D.f()}}return C;case"intention":return[].concat(c(d(l.intentions)),c(d(u.intentions)),c(d(l.intention)),c(d(u.intention)));case"movie":return[].concat(c(d(l.movies)),c(d(u.movies)));case"music":return[].concat(c(d(l.music)),c(d(u.music)));case"occupation":return[].concat(c(d(l.occupation)),c(d(u.occupation)),c(d(l.jobTitle)),c(d(u.jobTitle)));case"organization":var N=[];return N.push.apply(N,c(d(l.organizations))),N.push.apply(N,c(d(u.organizations))),N.push.apply(N,c(d(l.currentEmployer))),N.push.apply(N,c(d(u.currentEmployer))),N.push.apply(N,c(d(l.pastEmployers))),N.push.apply(N,c(d(u.pastEmployers))),N;case"university":var L=[];return L.push.apply(L,c(d(l.university))),L.push.apply(L,c(d(u.university))),L.push.apply(L,c(d(l.school))),L.push.apply(L,c(d(u.school))),L.push.apply(L,c(d(l.education))),L.push.apply(L,c(d(u.education))),L;case"location":var O=[];return O.push.apply(O,c(d(l.currentLocationName))),O.push.apply(O,c(d(u.currentLocationName))),O.push.apply(O,c(d(l.locations))),O.push.apply(O,c(d(u.locations))),O;case"businessTopic":case"business_topic":case"businessTopics":var z=[].concat(c(d(l.businessTopics)),c(d(u.businessTopics)),c(d(l.business_topics)),c(d(u.business_topics)),c(d(l.topics)),c(d(u.topics)),c(d(l.businessTopicsList)),c(d(u.businessTopicsList)),c(d(l.businessTopic)),c(d(u.businessTopic)));if(l.userThings&&Array.isArray(l.userThings)){var B,R=m(l.userThings);try{for(R.s();!(B=R.n()).done;){var x=B.value;if(Array.isArray(x)&&x.length>=2){var q=x[0];if("businessTopic"===q||"business_topic"===q||"businessTopics"===q||"topic"===q){var W=x[1];Array.isArray(W)?z.push.apply(z,c(d(W))):"string"==typeof W&&z.push(W.trim())}}}}catch(K){R.e(K)}finally{R.f()}}if(u.userThings&&Array.isArray(u.userThings)){var G,V=m(u.userThings);try{for(V.s();!(G=V.n()).done;){var H=G.value;if(Array.isArray(H)&&H.length>=2){var Z=H[0];if("businessTopic"===Z||"business_topic"===Z||"businessTopics"===Z||"topic"===Z){var J=H[1];Array.isArray(J)?z.push.apply(z,c(d(J))):"string"==typeof J&&z.push(J.trim())}}}}catch(K){V.e(K)}finally{V.f()}}return z;default:return[]}},v=o.filter(function(e){if(a){var n=null==e?void 0:e.enabled,r=null==e?void 0:e.disabled;if(!1===n||!0===r)return!1}var o=f(e);if(!o||0===o.length)return!1;var c="location"===t;return o.some(function(e){return c?u(e):l(e)})}),0!==v.length){e.n=19;break}return e.p=3,e.n=4,this.getAttributeChartData(n,t,!1,a);case 4:h=e.v,g=(p=function(e){return(null==e?"":String(e)).trim().toLowerCase()})(r),y="location"===t,b=function(e){return(null==e?void 0:e.attribute)||(null==e?void 0:e.attributeName)||(null==e?void 0:e.attribute_name)||(null==e?void 0:e.label)||(null==e?void 0:e.valueName)||(null==e?void 0:e.value_name)||(null==e?void 0:e.skill)||(null==e?void 0:e.topic)||(null==e?void 0:e.name)||""},S=function(e){for(var n,t,r,a=0,o=[null==e?void 0:e.userId,null==e?void 0:e.user_id,null==e?void 0:e.memberId,null==e?void 0:e.member_id,null==e?void 0:e.profileId,null==e?void 0:e.profile_id,null==e?void 0:e.slackUserId,null==e?void 0:e.slack_user_id,null==e?void 0:e.id,null==e||null===(n=e.user)||void 0===n?void 0:n.id,null==e||null===(t=e.user)||void 0===t?void 0:t.userId,null==e||null===(r=e.user)||void 0===r?void 0:r.user_id];a<o.length;a++){var c=o[a],i="string"==typeof c?parseInt(c,10):c;if("number"==typeof i&&Number.isFinite(i)&&i>0)return i}return null},A=new Set,k=0,w=m(h),e.p=5,w.s();case 6:if((C=w.n()).done){e.n=10;break}if(I=C.value,_=p(b(I))){e.n=7;break}return e.a(3,9);case 7:if(y?_.includes(g):_===g){e.n=8;break}return e.a(3,9);case 8:k++,(M=S(I))?A.add(M):console.log('[AdminService] ‚ö†Ô∏è Matched row for "'.concat(r,'" but no user ID found:'),{label:b(I),normalizedLabel:_,keys:Object.keys(I),fullRow:I,stringified:JSON.stringify(I)});case 9:e.n=6;break;case 10:e.n=12;break;case 11:e.p=11,L=e.v,w.e(L);case 12:return e.p=12,w.f(),e.f(12);case 13:if(!(A.size>0)){e.n=16;break}T=new Map,F=m(o);try{for(F.s();!(U=F.n()).done;)E=U.value,"number"==typeof(P="string"==typeof(null==E?void 0:E.userId)?parseInt(E.userId,10):null!==(D=null==E?void 0:E.userId)&&void 0!==D?D:null==E?void 0:E.id)&&Number.isFinite(P)&&T.set(P,E)}catch(i){F.e(i)}finally{F.f()}if(j=Array.from(A).map(function(e){return T.get(e)}).filter(Boolean),console.log("[AdminService] Recovered ".concat(j.length," profiles from ").concat(A.size," user IDs")),!(j.length>0)){e.n=15;break}if(!((N=j.filter(function(e){return f(e).some(function(e){return y?u(e):l(e)})})).length>0)){e.n=14;break}return e.a(2,N.map(function(e){var n;return{id:e.userId||e.id,fname:e.fname,lname:e.lname,fullName:e.fullName||"".concat(e.fname||""," ").concat(e.lname||"").trim(),email:e.email||"",profilePicture:e.profilePicture,isManager:!1,enabled:null===(n=e.enabled)||void 0===n||n,joinDate:void 0}}));case 14:return console.warn("[AdminService] ‚ö†Ô∏è Verification filtered all users, returning unverified list"),e.a(2,j.map(function(e){var n;return{id:e.userId||e.id,fname:e.fname,lname:e.lname,fullName:e.fullName||"".concat(e.fname||""," ").concat(e.lname||"").trim(),email:e.email||"",profilePicture:e.profilePicture,isManager:!1,enabled:null===(n=e.enabled)||void 0===n||n,joinDate:void 0}}));case 15:e.n=17;break;case 16:console.warn("[AdminService] ‚ö†Ô∏è No user IDs found in unconsolidated data for ".concat(t,":").concat(r," (matched ").concat(k," rows but none had user IDs)"));case 17:e.n=19;break;case 18:e.p=18,O=e.v,console.warn("[AdminService] Attribute fallback recovery via unconsolidated endpoint failed for ".concat(t,":").concat(r),O);case 19:return e.a(2,v.map(function(e){return{id:e.userId||e.id,fname:e.fname,lname:e.lname,fullName:e.fullName||"".concat(e.fname||""," ").concat(e.lname||"").trim(),email:e.email||"",profilePicture:e.profilePicture,isManager:!1,enabled:!0,joinDate:void 0}}));case 20:return e.p=20,z=e.v,console.error("Error in fallback user filtering:",z),e.a(2,[])}},e,this,[[5,11,12,13],[3,18],[1,20]])})),function(e,n,t){return Ne.apply(this,arguments)})},{key:"getAttributeFieldName",value:function(e){return{interest:"interests",activity:"activities",intention:"intention",movie:"movies",music:"music",occupation:"occupation",organization:"organizations",university:"university",location:"locations"}[e]||null}},{key:"getUsersBySkill",value:(je=u(i().m(function e(n,t,r){var a,o,c,s,l,u,d,m,v,h,p,g,y=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:a=!(y.length>3&&void 0!==y[3])||y[3],o=["/communities/".concat(n,"/skills/users?type=").concat(t,"&value=").concat(encodeURIComponent(r),"&onlyActive=").concat(a),"/communities/".concat(n,"/skills/").concat(encodeURIComponent(r),"/users?onlyActive=").concat(a),"/communities/".concat(n,"/users/skills?skill=").concat(encodeURIComponent(r),"&onlyActive=").concat(a),"/communities/".concat(n,"/attribute/users?type=skill&value=").concat(encodeURIComponent(r),"&onlyActive=").concat(a),"/communities/".concat(n,"/attribute/users?type=general&value=").concat(encodeURIComponent(r),"&onlyActive=").concat(a)],c=0,s=o;case 1:if(!(c<s.length)){e.n=8;break}return l=s[c],e.p=2,e.n=3,f.get(l);case 3:if(!((u=e.v)&&Array.isArray(u)&&u.length>0)){e.n=4;break}return e.a(2,u);case 4:e.n=7;break;case 5:if(e.p=5,404!==((null==(p=e.v)?void 0:p.status)||(null==p||null===(d=p.response)||void 0===d?void 0:d.status))){e.n=6;break}return e.a(3,7);case 6:console.warn("[AdminService] Error fetching users for skill ".concat(t,":").concat(r," from ").concat(l,":"),p);case 7:c++,e.n=1;break;case 8:return console.log("[AdminService] ‚ö†Ô∏è All skill endpoints failed, trying attribute endpoint for skill ".concat(t,":").concat(r)),e.p=9,e.n=10,this.getUsersByAttribute(n,"skill",r,a,t||"general");case 10:if(!((m=e.v)&&m.length>0)){e.n=11;break}return console.log("[AdminService] ‚úÖ Attribute endpoint found ".concat(m.length,' users with skill "').concat(r,'" (type: ').concat(t||"general",")")),e.a(2,m);case 11:e.n=13;break;case 12:e.p=12,g=e.v,400===(h=(null==g?void 0:g.status)||(null==g||null===(v=g.response)||void 0===v?void 0:v.status))?console.log("[AdminService] Attribute endpoint returned 400 - skill type might not be fully supported yet"):console.log("[AdminService] Attribute endpoint also failed (".concat(h,"), trying profile fallback"));case 13:return e.a(2,this.getUsersBySkillFallback(n,t,r,a))}},e,this,[[9,12],[2,5]])})),function(e,n,t){return je.apply(this,arguments)})},{key:"getAllIndividualSkills",value:(Pe=u(i().m(function e(n){var t,r,a;return i().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getCachedProfiles(n);case 1:return t=e.v,r=new Map,t.forEach(function(e){var n=e.dataSkills||e.skills||e.userSkills,t=[];Array.isArray(n)?t=n.map(function(e){return"string"==typeof e?e:(null==e?void 0:e.name)||(null==e?void 0:e.skill)||(null==e?void 0:e.value)||""}).filter(Boolean):"string"==typeof n&&(t=n.split(",").map(function(e){return e.trim()}).filter(Boolean)),t.forEach(function(e){e&&r.set(e,(r.get(e)||0)+1)})}),a=Array.from(r.entries()).map(function(e){var n=d(e,2);return{name:n[0],value:n[1]}}).sort(function(e,n){return n.value-e.value}),console.log("[AdminService] ‚úÖ Extracted ".concat(a.length," individual skills from profiles")),e.a(2,a)}},e,this)})),function(e){return Pe.apply(this,arguments)})},{key:"getAllUsersWithSkills",value:(Ee=u(i().m(function e(n){var t,r,a,o=arguments;return i().w(function(e){for(;;)switch(e.n){case 0:return t=!(o.length>1&&void 0!==o[1])||o[1],e.n=1,this.getCachedProfiles(n);case 1:return r=e.v,a=r.map(function(e){var n=e.dataSkills||e.skills||e.userSkills,t=[];return Array.isArray(n)?t=n.map(function(e){return"string"==typeof e?e:(null==e?void 0:e.name)||(null==e?void 0:e.skill)||(null==e?void 0:e.value)||""}):"string"==typeof n&&(t=n.split(",").map(function(e){return e.trim()}).filter(Boolean)),{id:e.userId||e.id,fname:e.fname,lname:e.lname,fullName:e.fullName||"".concat(e.fname," ").concat(e.lname),email:"",profilePicture:e.profilePicture,isManager:!1,enabled:!0,joinDate:void 0,jobTitle:e.jobTitle,currentEmployer:e.currentEmployer,skills:t,skillsDisplay:t.length>0?t.join(", "):"No skills listed"}}).filter(function(e){return!t||!1!==e.enabled}),console.log("[AdminService] ‚úÖ Found ".concat(a.length,' users with skills for "Other" category')),e.a(2,a)}},e,this)})),function(e){return Ee.apply(this,arguments)})},{key:"getUsersBySkillFallback",value:(De=u(i().m(function e(n,t,a){var o,s,l,u,d,m,f,v,h,p,g,y,b,S,A,k,w,C,I=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return o=!(I.length>3&&void 0!==I[3])||I[3],e.p=1,e.p=2,e.n=3,this.getSkillsChartData(n,t||"all",!1,o);case 3:if(s=e.v,console.log("[AdminService] Fallback: Got ".concat(s.length," unconsolidated skill entries")),l=s.filter(function(e){var n=e.name||e.skill||e.value;return"string"==typeof n?n.toLowerCase().includes(a.toLowerCase()):(null==n?void 0:n.toLowerCase())===a.toLowerCase()}),console.log("[AdminService] Found ".concat(l.length,' entries matching skill "').concat(a,'"')),!(l.length>0)){e.n=8;break}if(u=[],l.forEach(function(e){for(var n=0,t=[e.userId,e.user_id,e.memberId,e.member_id,e.profileId,e.profile_id,e.slackUserId,e.slack_user_id,e.id];n<t.length;n++){var r=t[n],a="string"==typeof r?parseInt(r,10):r;if("number"==typeof a&&Number.isFinite(a)&&a>0){u.push(a);break}}e.name&&"string"==typeof e.name&&e.name.split("|").forEach(function(e){var n=e.match(/userId[:\s]*(\d+)/i)||e.match(/user[:\s]*(\d+)/i);if(n&&n[1]){var t=parseInt(n[1],10);isNaN(t)||u.push(t)}var r=parseInt(e.trim(),10);!isNaN(r)&&r>0&&r<1e6&&u.push(r)})}),d=c(new Set(u)),console.log("[AdminService] Extracted ".concat(d.length," unique user IDs from unconsolidated data:"),d),!(d.length>0)){e.n=8;break}return e.p=4,e.n=5,this.getCommunityMembers(n);case 5:if(m=e.v,f=m.filter(function(e){return d.includes(e.id)}),!o){e.n=6;break}return v=f.filter(function(e){return!1!==e.enabled}),console.log("[AdminService] ‚úÖ Found ".concat(v.length,' active members with skill "').concat(a,'"')),e.a(2,v);case 6:return console.log("[AdminService] ‚úÖ Found ".concat(f.length,' members with skill "').concat(a,'"')),e.a(2,f);case 7:e.p=7,A=e.v,console.warn("[AdminService] Failed to fetch community members:",A);case 8:e.n=10;break;case 9:e.p=9,k=e.v,console.log("[AdminService] Unconsolidated skills approach failed:",k);case 10:return e.p=10,e.n=11,this.getCommunityMembers(n);case 11:if(h=e.v,console.log("[AdminService] Fallback: Checking ".concat(h.length,' community members for skill "').concat(a,'"')),!((p=h.filter(function(e){var n,t=e.skills||e.skill||e.userSkills||e.dataSkills||(null===(n=e.attributes)||void 0===n?void 0:n.skills);return!!t&&(Array.isArray(t)?t.some(function(e){var n="string"==typeof e?e:(null==e?void 0:e.name)||(null==e?void 0:e.skill)||(null==e?void 0:e.value);return(null==n?void 0:n.toLowerCase())===a.toLowerCase()}):"string"==typeof t&&t.toLowerCase().includes(a.toLowerCase()))})).length>0)){e.n=13;break}if(console.log("[AdminService] ‚úÖ Found ".concat(p.length,' members with skill "').concat(a,'" from community members')),!o){e.n=12;break}return e.a(2,p.filter(function(e){return!1!==e.enabled}));case 12:return e.a(2,p);case 13:e.n=15;break;case 14:e.p=14,w=e.v,console.log("[AdminService] Community members approach failed:",w);case 15:return e.n=16,this.getCachedProfiles(n);case 16:return g=e.v,b=(y=function(e){return(null==e?"":String(e)).trim().toLowerCase()})(a),console.log("[AdminService] Fallback: Filtering ".concat(g.length,' profiles for skill "').concat(a,'" (type: ').concat(t,")")),(S=g.map(function(e){return{id:e.userId||e.id,fname:e.fname,lname:e.lname,fullName:e.fullName||"".concat(e.fname," ").concat(e.lname),email:"",profilePicture:e.profilePicture,isManager:!1,enabled:!0,joinDate:void 0,jobTitle:e.jobTitle,currentEmployer:e.currentEmployer,_profile:e}}).filter(function(e){var n=e._profile,o=n.skills||n.dataSkills||n.userSkills;if(!o)for(var c=0,i=Object.keys(n);c<i.length;c++){var s=i[c];if(s.toLowerCase().includes("skill")){var l=n[s];if(l){o=l;break}}}return!!o&&(Array.isArray(o)?o.some(function(e){var n="string"==typeof e?e:(null==e?void 0:e.name)||(null==e?void 0:e.skill)||(null==e?void 0:e.value)||(null==e?void 0:e.skillName),a=y(n);if(t&&"general"!==t){var o="object"!==r(e)||(null==e?void 0:e.type)===t||(null==e?void 0:e.skillType)===t||(null==e?void 0:e.can_be_mentor)||(null==e?void 0:e.wants_to_be_mentee);return a===b&&(o||"general"===t)}return a===b}):"object"!==r(o)||Array.isArray(o)?"string"==typeof o&&o.split(",").map(function(e){return e.trim()}).some(function(e){return e.toLowerCase()===a.toLowerCase()}):Object.keys(o).some(function(e){var n=o[e],t="string"==typeof n?n:(null==n?void 0:n.name)||(null==n?void 0:n.skill)||(null==n?void 0:n.value)||(null==n?void 0:n.skillName)||e;return(null==t?void 0:t.toLowerCase())===a.toLowerCase()}))})).forEach(function(e){delete e._profile}),console.log("[AdminService] ‚úÖ Fallback: Found ".concat(S.length,' users with skill "').concat(a,'"')),e.a(2,S);case 17:return e.p=17,C=e.v,console.error("[AdminService] Error in fallback skill filtering:",C),e.a(2,[])}},e,this,[[10,14],[4,7],[2,9],[1,17]])})),function(e,n,t){return De.apply(this,arguments)})},{key:"getUsersByBusinessTopic",value:(Ue=u(i().m(function e(n,t){var r,a,o,c,s,l,u,d,m,v,h,p,g,y=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=!(y.length>2&&void 0!==y[2])||y[2],e.p=1,e.n=2,this.getUsersByAttribute(n,"business_topic",t,r);case 2:if(!((a=e.v)&&a.length>0)){e.n=3;break}return console.log("[AdminService] ‚úÖ Attribute endpoint found ".concat(a.length,' users for business topic "').concat(t,'"')),e.a(2,a);case 3:console.log('[AdminService] ‚ö†Ô∏è Attribute endpoint returned 0 users for business topic "'.concat(t,'"'));case 4:e.n=6;break;case 5:e.p=5,p=e.v,500===(c=(null==p?void 0:p.status)||(null==p||null===(o=p.response)||void 0===o?void 0:o.status))?(console.error('[AdminService] ‚ùå Attribute endpoint still returning 500 for business_topic "'.concat(t,'"')),console.error("[AdminService] Backend fix may not be deployed yet, or there may be another issue.")):console.error('[AdminService] ‚ùå Attribute endpoint failed for business_topic "'.concat(t,'":'),{status:c,message:null==p?void 0:p.message,response:null==p||null===(s=p.response)||void 0===s?void 0:s.data});case 6:l=["/communities/".concat(n,"/businessTopics/users?value=").concat(encodeURIComponent(t),"&onlyActive=").concat(r),"/communities/".concat(n,"/businessTopics/").concat(encodeURIComponent(t),"/users?onlyActive=").concat(r),"/communities/".concat(n,"/users/businessTopics?topic=").concat(encodeURIComponent(t),"&onlyActive=").concat(r)],u=0,d=l;case 7:if(!(u<d.length)){e.n=14;break}return m=d[u],e.p=8,e.n=9,f.get(m);case 9:if(!((v=e.v)&&Array.isArray(v)&&v.length>0)){e.n=10;break}return console.log("[AdminService] ‚úÖ Found ".concat(v.length,' users with business topic "').concat(t,'" from alternative endpoint')),e.a(2,v);case 10:e.n=13;break;case 11:if(e.p=11,404!==((null==(g=e.v)?void 0:g.status)||(null==g||null===(h=g.response)||void 0===h?void 0:h.status))){e.n=12;break}return e.a(3,13);case 12:console.warn("[AdminService] Error fetching users for business topic ".concat(t," from ").concat(m,":"),g);case 13:u++,e.n=7;break;case 14:return e.a(2,this.getUsersByBusinessTopicFallback(n,t,r))}},e,this,[[8,11],[1,5]])})),function(e,n){return Ue.apply(this,arguments)})},{key:"getUsersByBusinessTopicFallback",value:(Fe=u(i().m(function e(n,t){var r,a,o,c,s,l,u,d,v,h,p,g,y,b,S,A,k=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=!(k.length>2&&void 0!==k[2])||k[2],e.p=1,e.n=2,this.getCachedProfiles(n);case 2:if(a=e.v,c=(o=function(e){return(null==e?"":String(e)).trim().toLowerCase()})(t),console.log("[AdminService] üîç Business topic fallback: Checking ".concat(a.length,' profiles for "').concat(t,'"')),(s=a.map(function(e){var n;return{id:e.userId||e.id,fname:e.fname,lname:e.lname,fullName:e.fullName||"".concat(e.fname||""," ").concat(e.lname||"").trim(),email:e.email||"",profilePicture:e.profilePicture,isManager:!1,enabled:null===(n=e.enabled)||void 0===n||n,joinDate:void 0,_profile:e}}).filter(function(e){if(r&&!1===e.enabled)return!1;var n=e._profile||{},t=n.data||n.profileData||n.profile||{},a=n.businessTopics||t.businessTopics||n.business_topics||t.business_topics||n.topics||t.topics||n.businessTopicsList||t.businessTopicsList||n.businessTopic||t.businessTopic||n.business_topic||t.business_topic,i=n.userThings||t.userThings;if(i&&Array.isArray(i)){var s,l=m(i);try{for(l.s();!(s=l.n()).done;){var u=s.value;if(Array.isArray(u)&&u.length>=2){var d=u[0];if("businessTopic"===d||"business_topic"===d||"businessTopics"===d||"topic"===d){var f=u[1];if(Array.isArray(f)){if(f.some(function(e){var n="string"==typeof e?e:(null==e?void 0:e.name)||(null==e?void 0:e.topic)||(null==e?void 0:e.value)||(null==e?void 0:e.label)||"";return o(n)===c}))return!0}else if("string"==typeof f&&o(f)===c)return!0}}}}catch(v){l.e(v)}finally{l.f()}}return!!a&&(Array.isArray(a)?a.some(function(e){var n="string"==typeof e?e:(null==e?void 0:e.name)||(null==e?void 0:e.topic)||(null==e?void 0:e.value)||(null==e?void 0:e.label);return o(n)===c}):"string"==typeof a&&a.split(",").map(function(e){return o(e)}).includes(c))})).forEach(function(e){delete e._profile}),console.log("[AdminService] ‚úÖ Business topic fallback: Found ".concat(s.length,' users with topic "').concat(t,'"')),0!==s.length){e.n=18;break}return e.p=3,console.log('[AdminService] Trying attribute endpoint for business topic "'.concat(t,'"...')),e.n=4,this.getUsersByAttribute(n,"business_topic",t,r);case 4:if(!((l=e.v)&&l.length>0)){e.n=5;break}return console.log("[AdminService] ‚úÖ Attribute endpoint found ".concat(l.length,' users for business topic "').concat(t,'"')),e.a(2,l);case 5:console.log('[AdminService] ‚ö†Ô∏è Attribute endpoint returned 0 users for business topic "'.concat(t,'"'));case 6:e.n=8;break;case 7:e.p=7,y=e.v,v=(null==y?void 0:y.status)||(null==y||null===(u=y.response)||void 0===u?void 0:u.status),console.error('[AdminService] ‚ùå Attribute endpoint failed for business_topic "'.concat(t,'":'),{status:v,message:null==y?void 0:y.message,response:null==y||null===(d=y.response)||void 0===d?void 0:d.data});case 8:return e.p=8,console.log("[AdminService] Trying to get business topic users via community members endpoint..."),h="/communities/".concat(n,"/members?onlyActive=").concat(r),e.p=9,e.n=10,f.get(h);case 10:p=e.v,console.log("[AdminService] Got ".concat((null==p?void 0:p.length)||0," members, but business topics aren't in member data")),e.n=12;break;case 11:e.p=11,e.v,console.log("[AdminService] Members endpoint not available or failed");case 12:e.n=14;break;case 13:e.p=13,b=e.v,console.warn("[AdminService] Member query approach failed:",b);case 14:return e.p=14,console.log('[AdminService] Profile-based filtering found 0 users for business topic "'.concat(t,'", trying unconsolidated endpoint recovery...')),e.n=15,this.getBusinessTopicsChartData(n,!1,r);case 15:g=e.v,console.log("[AdminService] Got ".concat(g.length," rows from unconsolidated business topics endpoint")),g.length>0&&console.log("[AdminService] üîç First 3 rows from unconsolidated business topics:",g.slice(0,3).map(function(e,n){return{index:n,fullRow:e,keys:Object.keys(e),name:null==e?void 0:e.name,label:null==e?void 0:e.label,value:null==e?void 0:e.value,count:null==e?void 0:e.count}})),console.log("[AdminService] ‚ö†Ô∏è Unconsolidated endpoint returns aggregated data without user IDs. Need backend endpoint fix."),e.n=17;break;case 16:e.p=16,S=e.v,console.warn("[AdminService] Business topic unconsolidated endpoint recovery failed:",S);case 17:console.error('[AdminService] ‚ùå Cannot retrieve users for business topic "'.concat(t,'" - backend endpoint returns 500 error and unconsolidated data is aggregated without user IDs.')),console.error('[AdminService] The backend SQL query is failing: "could not identify an equality operator for type json"'),console.error("[AdminService] This indicates data_business_topic.name is a JSON field and needs proper JSON query syntax.");case 18:return e.a(2,s);case 19:return e.p=19,A=e.v,console.error("Error in fallback business topic filtering:",A),e.a(2,[])}},e,this,[[14,16],[9,11],[8,13],[3,7],[1,19]])})),function(e,n){return Fe.apply(this,arguments)})},{key:"getUsersByCustomField",value:(Te=u(i().m(function e(n,t,r){var a,s,l,u,d,m,v,h,p,g,y,b,S,A,k,w,C,I,_=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=!(_.length>3&&void 0!==_[3])||_[3],e.p=1,s="/communities/".concat(n,"/attribute/users?type=custom&customFieldId=").concat(t,"&value=").concat(encodeURIComponent(r),"&onlyActive=").concat(a,"&limit=200"),e.n=2,f.get(s);case 2:if(l=e.v,d=null,Array.isArray(l)?u=l:l&&Array.isArray(l.data)?(u=l.data,d=l.pagination):(console.warn("[AdminService] Unexpected response format for custom field ".concat(t,":").concat(r)),u=[]),u&&0!==u.length){e.n=3;break}return e.a(2,[]);case 3:if(!(d&&d.totalPages>1)){e.n=10;break}m=c(u),v=d.totalPages||1,h=d.currentPage||1,p=h+1;case 4:if(!(p<=v)){e.n=9;break}return e.p=5,g="/communities/".concat(n,"/attribute/users?type=custom&customFieldId=").concat(t,"&value=").concat(encodeURIComponent(r),"&onlyActive=").concat(a,"&limit=200&page=").concat(p),e.n=6,f.get(g);case 6:y=e.v,b=Array.isArray(y)?y:(null==y?void 0:y.data)||[],m.push.apply(m,c(b)),e.n=8;break;case 7:e.p=7,C=e.v,console.warn("[AdminService] Failed to load page ".concat(p," for custom field ").concat(t,":").concat(r,":"),C);case 8:p++,e.n=4;break;case 9:u=m;case 10:return S=u.map(function(e){return o({id:e.id||e.userId,userId:e.userId||e.id,fname:e.fname||"",lname:e.lname||"",fullName:e.fullName||"".concat(e.fname||""," ").concat(e.lname||"").trim(),email:e.email||"",profilePicture:e.profilePicture,bio:e.bio,pronouns:e.pronouns,isManager:e.isManager,enabled:e.enabled,joinDate:e.joinDate},e)}),e.a(2,S);case 11:if(e.p=11,I=e.v,404!==(w=(null==I?void 0:I.status)||(null==I||null===(A=I.response)||void 0===A?void 0:A.status))){e.n=12;break}return e.a(2,[]);case 12:return console.error("[AdminService] Error fetching users for custom field ".concat(t,":").concat(r,":"),{status:w,message:null==I?void 0:I.message,response:null==I||null===(k=I.response)||void 0===k?void 0:k.data}),e.a(2,[])}},e,null,[[5,7],[1,11]])})),function(e,n,t){return Te.apply(this,arguments)})},{key:"verifyConsolidatedData",value:function(e,n){if(e&&0!==e.length){var t=e.filter(function(e){var n=e.name||"";return!!n.includes("|")||!!(n.includes(":")&&n.split(":").length>2)});t.length>0?(console.warn("[AdminService] ‚ö†Ô∏è Potential issue: ".concat(n," data appears to contain per-user responses instead of consolidated data."),"Found ".concat(t.length," items with suspicious patterns:"),t.slice(0,3)),console.warn('[AdminService] Expected format: [{ name: "ChatGPT", value: 5 }] (cumulative count)',"Found format: Items with pipe-separated or user-specific values")):e.filter(function(e){return 1===e.value}).length===e.length&&e.length>1?console.warn("[AdminService] ‚ö†Ô∏è Potential issue: All ".concat(n," data items have value=1."),"This might indicate per-user data instead of consolidated counts."):console.log("[AdminService] ‚úì ".concat(n," data appears to be properly consolidated."),"Total items: ".concat(e.length,", Total count: ").concat(e.reduce(function(e,n){return e+n.value},0)))}}},{key:"getUserStats",value:(Me=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a="/communities/".concat(n,"/stats/users"),t&&r&&(a+="?startDate=".concat(t,"&endDate=").concat(r)),e.n=1,f.get(a);case 1:return o=e.v,e.a(2,o);case 2:if(e.p=2,404!==(null==(s=e.v)?void 0:s.status)&&404!==(null==s||null===(c=s.response)||void 0===c?void 0:c.status)){e.n=3;break}return console.log("[AdminService] Stats endpoint not found for community ".concat(n)),e.a(2,null);case 3:return console.error("Failed to fetch user stats:",s),e.a(2,null)}},e,null,[[0,2]])})),function(e,n,t){return Me.apply(this,arguments)})},{key:"getEngagementStats",value:(_e=u(i().m(function e(n,t,r){var a,o,c,s,l,u,m,v;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=f.get("/communities/".concat(n,"/stats/engagement").concat(t&&r?"?startDate=".concat(t,"&endDate=").concat(r):"")).catch(function(e){var n;if(404===(null==e?void 0:e.status)||404===(null==e||null===(n=e.response)||void 0===n?void 0:n.status))return null;throw e}),o=this.calculateEngagementStatsFromData(n,t,r),e.p=1,e.n=2,Promise.allSettled([a,o]);case 2:if(c=e.v,s=d(c,2),l=s[0],u=s[1],"fulfilled"!==l.status||!l.value){e.n=3;break}return e.a(2,l.value);case 3:if("fulfilled"!==u.status||!u.value){e.n=4;break}return e.a(2,u.value);case 4:return e.a(2,null);case 5:return e.p=5,m=e.v,console.error("[AdminService] Error getting engagement stats:",m),e.p=6,e.n=7,this.calculateEngagementStatsFromData(n,t,r);case 7:return e.a(2,e.v);case 8:return e.p=8,v=e.v,console.error("[AdminService] Error calculating stats:",v),e.a(2,null)}},e,this,[[6,8],[1,5]])})),function(e,n,t){return _e.apply(this,arguments)})},{key:"calculateEngagementStatsFromData",value:(Ie=u(i().m(function e(n,t,r){var a,o,c,s,l,u,m,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P,j,N,L,O,z,B,R,x,q,W,G,V,H,Z,J,K,$,Q,Y,X,ee,ne,te,re,ae,oe,ce,ie,se,le,ue,de,me,fe,ve;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a=t?new Date(t):null,o=r?new Date(r):null,e.n=1,Promise.allSettled([this.getProfilesForCommunity(n),this.getEventsForCommunity(n),this.getGroupsForCommunity(n),this.getMatchesForCommunity(n,t,r)]);case 1:if(c=e.v,s=d(c,4),l=s[0],u=s[1],m=s[2],"rejected"===(v=s[3]).status&&console.error("[AdminService] Matches fetch failed:",v.reason),h={totalUsers:0,activeUsers:0,newUsersThisMonth:0,profilesCreated:0,connectionsMade:0,trovaChatsStarted:0,totalMessagesSent:0,eventsCreated:0,eventsAttended:0,groupsCreated:0,groupsJoined:0,dailyActiveUsers:0,weeklyActiveUsers:0,profileCompletionRate:0,matchResponseRate:0},"fulfilled"===l.status?(p=l.value||[],console.log("[AdminService] Fetched ".concat(p.length," profiles for community ").concat(n)),h.profilesCreated=p.length,h.totalUsers=p.length,console.log("[AdminService] Calculated ".concat(p.length," profiles for community ").concat(n," (date filtering not available - ProfilesInit has no createdAt field)")),g=0,p.forEach(function(e){var n=e.bio&&"string"==typeof e.bio&&e.bio.trim().length>0,t=e.interests&&Array.isArray(e.interests)&&e.interests.length>0,r=e.locations&&Array.isArray(e.locations)&&e.locations.length>0||e.currentLocationName&&e.currentLocationName.trim().length>0;(n||t||r)&&g++}),h.profileCompletionRate=p.length>0?g/p.length*100:0,h.profileCompletionCompleted=g,h.profileCompletionTotal=p.length,console.log("[AdminService] Profile completion: ".concat(g,"/").concat(p.length," (").concat(h.profileCompletionRate.toFixed(1),"%)"))):(y="rejected"===l.status?l.reason:"unknown",console.warn("[AdminService] Profiles fetch failed:",y),"rejected"===l.status&&console.error("[AdminService] Profiles error details:",y)),"fulfilled"===u.status&&(b=u.value||[],S=0,A=0,b.forEach(function(e,n){if(a||o){var t=e.startDateTimeUTC||e.startDate;if(t){var r=new Date(t);isNaN(r.getTime())?n<3&&console.error('[AdminService] üìÖ Event "'.concat(e.name,'" has invalid date: ').concat(t)):(!a||r>=a)&&(!o||r<=o)?(S++,void 0!==e.attendeeCount&&null!==e.attendeeCount?A+=e.attendeeCount:e.attendees&&Array.isArray(e.attendees)&&(A+=e.attendees.length)):n<3&&console.error('[AdminService] üìÖ Event "'.concat(e.name,'" excluded: date ').concat(r.toISOString()," not in range ").concat(null==a?void 0:a.toISOString()," to ").concat(null==o?void 0:o.toISOString()))}else n<3&&console.error('[AdminService] üìÖ Event "'.concat(e.name,'" has no date field (startDate/startDateTimeUTC)')),S++,void 0!==e.attendeeCount&&null!==e.attendeeCount?A+=e.attendeeCount:e.attendees&&Array.isArray(e.attendees)&&(A+=e.attendees.length)}else S++,void 0!==e.attendeeCount&&null!==e.attendeeCount?A+=e.attendeeCount:e.attendees&&Array.isArray(e.attendees)&&(A+=e.attendees.length)}),h.eventsCreated=S,h.eventsAttended=A),"fulfilled"===m.status?(k=m.value||[],w=0,C=0,I=new Set,k.forEach(function(e,n){if(a||o)if(e.createdAt){var t=new Date(e.createdAt);isNaN(t.getTime())?n<3&&console.error('[AdminService] üë• Group "'.concat(e.name,'" has invalid createdAt: ').concat(e.createdAt)):(!a||t>=a)&&(!o||t<=o)?(w++,void 0!==e.memberCount&&null!==e.memberCount?C+=e.memberCount:e.users&&Array.isArray(e.users)&&(C+=e.users.length,e.users.forEach(function(e){e.id&&I.add(e.id)}))):n<3&&console.error('[AdminService] üë• Group "'.concat(e.name,'" excluded: date ').concat(t.toISOString()," not in range ").concat(null==a?void 0:a.toISOString()," to ").concat(null==o?void 0:o.toISOString()))}else n<3&&console.error('[AdminService] üë• Group "'.concat(e.name,'" has no createdAt field')),w++,void 0!==e.memberCount&&null!==e.memberCount?C+=e.memberCount:e.users&&Array.isArray(e.users)&&(C+=e.users.length,e.users.forEach(function(e){e.id&&I.add(e.id)}));else w++,void 0!==e.memberCount&&null!==e.memberCount?C+=e.memberCount:e.users&&Array.isArray(e.users)&&(C+=e.users.length,e.users.forEach(function(e){e.id&&I.add(e.id)}))}),h.groupsCreated=w,h.groupsJoined=I.size>0?I.size:C):"rejected"===m.status&&console.warn("[AdminService] Groups fetch failed:",m.reason),"fulfilled"!==v.status){e.n=10;break}return 0===(_=v.value||[]).length&&console.warn("[AdminService] No matches returned from endpoint"),M=_,_.length>0&&(void 0!==(T=_[0]).communityId||void 0!==T.community_id?(F=void 0!==T.communityId?"communityId":"community_id",M=_.filter(function(e){return(e.communityId||e.community_id)===n}),console.log("[AdminService] Filtered by ".concat(F,": ").concat(M.length," matches for community ").concat(n))):(console.log("[AdminService] Matches already filtered by endpoint middleware, using all matches"),M=_)),U=0,D=!1,e.p=2,console.log("[AdminService] üîó Fetching connections count from backend endpoint..."),E=[],t&&E.push("startDate=".concat(encodeURIComponent(t))),r&&E.push("endDate=".concat(encodeURIComponent(r))),P=E.length?"?".concat(E.join("&")):"",j="/communities/".concat(n,"/connections-count").concat(P),e.n=3,f.get(j);case 3:(N=e.v)&&"number"==typeof N.connectionsMade&&(0===N.connectionsMade&&M&&M.length>0?console.warn("[AdminService] ‚ö†Ô∏è Backend returned 0 connections but we have ".concat(M.length," matches - using client-side calculation")):(U=N.connectionsMade,D=!0,console.log("[AdminService] ‚úÖ Connections count from backend: ".concat(U)))),e.n=5;break;case 4:e.p=4,404===(null==(le=e.v)?void 0:le.status)||404===(null==le||null===(L=le.response)||void 0===L?void 0:L.status)?console.log("[AdminService] Connections count endpoint not found, using client-side calculation"):console.warn("[AdminService] Failed to fetch connections count from backend, using client-side calculation:",le);case 5:return D||(O=new Map,M.forEach(function(e){var n=e.groupId||e.group_id||(e.matchIndicesId&&0!==e.matchIndicesId?e.matchIndicesId:null);if(null!=n){var t=String(n);O.has(t)||O.set(t,new Set);var r=O.get(t);void 0!==e.userId&&null!==e.userId&&r.add(e.userId),void 0!==e.matchedUserId&&null!==e.matchedUserId&&r.add(e.matchedUserId)}}),z=new Set,O.forEach(function(e,n){var t=Array.from(e).sort(function(e,n){return e-n}).join(",");z.add(t)}),0===(B=z.size)&&(R=new Set,M.forEach(function(e){if(void 0!==e.userId&&void 0!==e.matchedUserId){var n=[e.userId,e.matchedUserId].sort().join("-");R.add(n)}}),B=R.size),console.log("[AdminService] Found ".concat(B," unique connections (unique sets of people) from ").concat(M.length," match records")),console.log("[AdminService] Note: ".concat(M.length," total match records = ").concat(M.length," intros, but only ").concat(B," unique connections (unique sets of people)")),x=B,q=0,W=0,a||o?(G=M.filter(function(e){var n=e.createdAt||e.created_at;if(n){var t=new Date(n);if(isNaN(t.getTime()))return W++,!1;var r=(!a||t>=a)&&(!o||t<=o);return r||q++,r}return W++,!1}),console.error("[AdminService] üîó After date filter: ".concat(G.length," matches in range, ").concat(q," excluded, ").concat(W," with no/invalid date")),V=new Map,G.forEach(function(e){var n=e.groupId||e.group_id||(e.matchIndicesId&&0!==e.matchIndicesId?e.matchIndicesId:null);if(null!=n){var t=String(n);V.has(t)||V.set(t,new Set);var r=V.get(t);void 0!==e.userId&&null!==e.userId&&r.add(e.userId),void 0!==e.matchedUserId&&null!==e.matchedUserId&&r.add(e.matchedUserId)}}),H=new Set,V.forEach(function(e){var n=Array.from(e).sort(function(e,n){return e-n}).join(",");H.add(n)}),x=H.size>0?H.size:0,console.error("[AdminService] üîó After date filter: ".concat(x," unique connections"))):console.error("[AdminService] üîó No date filter applied - using all ".concat(M.length," matches")),U=x,console.error("[AdminService] üîó Final (client-side): ".concat(U," unique connections (from ").concat(M.length," match records, ").concat(q," excluded by date, ").concat(W," with no date)"))),h.connectionsMade=U,e.p=6,e.n=7,this.calculateMatchResponseRate(n,M,t,r);case 7:Z=e.v,h.matchResponseRate=Z,e.n=9;break;case 8:e.p=8,ue=e.v,console.warn("[AdminService] Could not calculate match response rate:",ue),h.matchResponseRate=0;case 9:e.n=11;break;case 10:"rejected"===v.status&&(console.error("[AdminService] Matches fetch failed:",v.reason),h.connectionsMade=0);case 11:return e.p=11,e.n=12,this.getMessageStats(n,t,r);case 12:(J=e.v)&&(h.totalMessagesSent=J.totalMessagesSent),e.n=14;break;case 13:e.p=13,de=e.v,console.error("[AdminService] Error calculating message stats:",de);case 14:return e.p=14,e.n=15,this.getActiveUserStats(n,t,r);case 15:(K=e.v)&&(h.dailyActiveUsers=K.dailyActiveUsers,h.weeklyActiveUsers=K.weeklyActiveUsers),e.n=17;break;case 16:e.p=16,me=e.v,console.error("[AdminService] Error calculating active user stats:",me);case 17:return e.p=17,e.n=18,this.calculateMatchEngagementStats(n,t,r);case 18:($=e.v)?Object.assign(h,$):(console.error("[AdminService] ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è calculateMatchEngagementStats returned null/undefined - initializing to 0"),h.channelPairingMatches=null!==(Q=h.channelPairingMatches)&&void 0!==Q?Q:0,h.channelPairingEngagements=null!==(Y=h.channelPairingEngagements)&&void 0!==Y?Y:0,h.mentorMenteeMatches=null!==(X=h.mentorMenteeMatches)&&void 0!==X?X:0,h.mentorMenteeUniquePairs=null!==(ee=h.mentorMenteeUniquePairs)&&void 0!==ee?ee:0,h.trovaMagicMatches=null!==(ne=h.trovaMagicMatches)&&void 0!==ne?ne:0,h.trovaMagicEngagements=null!==(te=h.trovaMagicEngagements)&&void 0!==te?te:0),e.n=20;break;case 19:e.p=19,fe=e.v,console.error("[AdminService] Could not calculate match engagement stats:",fe),h.channelPairingMatches=null!==(re=h.channelPairingMatches)&&void 0!==re?re:0,h.channelPairingEngagements=null!==(ae=h.channelPairingEngagements)&&void 0!==ae?ae:0,h.mentorMenteeMatches=null!==(oe=h.mentorMenteeMatches)&&void 0!==oe?oe:0,h.mentorMenteeUniquePairs=null!==(ce=h.mentorMenteeUniquePairs)&&void 0!==ce?ce:0,h.trovaMagicMatches=null!==(ie=h.trovaMagicMatches)&&void 0!==ie?ie:0,h.trovaMagicEngagements=null!==(se=h.trovaMagicEngagements)&&void 0!==se?se:0;case 20:return e.a(2,h);case 21:return e.p=21,ve=e.v,console.error("[AdminService] Error calculating engagement stats:",ve),e.a(2,null)}},e,this,[[17,19],[14,16],[11,13],[6,8],[2,4],[0,21]])})),function(e,n,t){return Ie.apply(this,arguments)})},{key:"getProfilesForCommunity",value:(Ce=u(i().m(function e(n){var t,r,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,l(function(){return s.import("./profile.service-legacy-D-F1sSvx.js")},void 0);case 1:return t=e.v,r=t.profileService,e.n=2,r.getProfilesForUserAndCommunity(n);case 2:return e.a(2,e.v);case 3:return e.p=3,a=e.v,console.warn("[AdminService] Could not fetch profiles:",a),e.a(2,[])}},e,null,[[0,3]])})),function(e){return Ce.apply(this,arguments)})},{key:"getEventsForCommunity",value:(we=u(i().m(function e(n){var t,r,a,o,c,u,d;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,l(function(){return s.import("./event.service-legacy-CMLG_2ZP.js")},void 0);case 1:return r=e.v,a=r.eventService,e.n=2,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bW})},void 0);case 2:if(o=e.v,c=o.useAuthStore,u=c(),null===(t=u.user)||void 0===t||!t.id){e.n=4;break}return e.n=3,a.getEvents(n,u.user.id);case 3:return e.a(2,e.v);case 4:return e.a(2,[]);case 5:return e.p=5,d=e.v,console.warn("[AdminService] Could not fetch events:",d),e.a(2,[])}},e,null,[[0,5]])})),function(e){return we.apply(this,arguments)})},{key:"getGroupsForCommunity",value:(ke=u(i().m(function e(n){var t,r,a,o,c,u,d;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,l(function(){return s.import("./group.service-legacy-CiCW_xct.js")},void 0);case 1:return r=e.v,a=r.groupService,e.n=2,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bW})},void 0);case 2:if(o=e.v,c=o.useAuthStore,u=c(),null===(t=u.user)||void 0===t||!t.id){e.n=4;break}return e.n=3,a.getGroups(n,u.user.id);case 3:return e.a(2,e.v);case 4:return e.a(2,[]);case 5:return e.p=5,d=e.v,console.warn("[AdminService] Could not fetch groups:",d),e.a(2,[])}},e,null,[[0,5]])})),function(e){return ke.apply(this,arguments)})},{key:"getMatchesForCommunity",value:(Ae=u(i().m(function e(n,t,r,a){var o,c,s,l,u;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.clearExpiredCache(),o=this.getMatchesCacheKey(n,t,r,a),!(c=this.matchesCache.get(o))||!this.isCacheValid(c.timestamp)){e.n=1;break}return console.log("[AdminService] ‚úÖ Using cached matches for ".concat(o," (").concat(c.data.length," matches)")),e.a(2,c.data);case 1:if(!(s=this.pendingRequests.get(o))){e.n=2;break}return console.log("[AdminService] ‚è≥ Reusing pending request for ".concat(o)),e.a(2,s);case 2:return console.log("[AdminService] üîç Fetching matches for community ".concat(n),{startDate:t,endDate:r,type:a}),l=this.fetchMatchesForCommunity(n,t,r,a,o),this.pendingRequests.set(o,l),e.p=3,e.n=4,l;case 4:return u=e.v,e.a(2,u);case 5:return e.p=5,this.pendingRequests.delete(o),e.f(5);case 6:return e.a(2)}},e,this,[[3,,5,6]])})),function(e,n,t,r){return Ae.apply(this,arguments)})},{key:"fetchMatchesForCommunity",value:(Se=u(i().m(function e(n,t,r,a,o){var c,s,l,u,d,m,v,h,p,g,y,b,S,A,k;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:c=new URLSearchParams,t&&c.append("startDate",t),r&&c.append("endDate",r),a&&c.append("type",a),s=c.toString(),l="/communities/".concat(n,"/matches").concat(s?"?".concat(s):""),u=[{url:l,name:"/communities/".concat(n,"/matches").concat(s?"?".concat(s):"")},{url:"/matches?communityId=".concat(n),name:"/matches?communityId=".concat(n)},{url:"/matches",name:"/matches (middleware - user's session community)",useHeader:!0}],d=0,m=u;case 1:if(!(d<m.length)){e.n=9;break}return v=m[d],e.p=2,console.log("[AdminService] üì° Trying GET ".concat(v.name,"...")),h=v.useHeader?{headers:{"X-Community-Id":String(n)}}:void 0,e.n=3,f.get(v.url,h);case 3:if(p=e.v,console.log("[AdminService] ‚úÖ Fetched ".concat((null==p?void 0:p.length)||0," matches from ").concat(v.name)),!(p&&p.length>0)){e.n=4;break}return g=p,void 0===p[0].communityId&&void 0===p[0].community_id||(g=g.filter(function(e){return(e.communityId||e.community_id)===n})).length!==p.length&&console.log("[AdminService] ‚ö†Ô∏è Endpoint returned ".concat(p.length," matches, but only ").concat(g.length," are for community ").concat(n)),o&&this.matchesCache.set(o,{data:g,timestamp:Date.now()}),e.a(2,g);case 4:if(!p||0!==p.length){e.n=5;break}if(console.log("[AdminService] ‚ö†Ô∏è ".concat(v.name," returned empty array (0 matches)")),o&&this.matchesCache.set(o,{data:[],timestamp:Date.now()}),"/matches"===v.url){e.n=5;break}return e.a(3,8);case 5:return y=p||[],o&&this.matchesCache.set(o,{data:y,timestamp:Date.now()}),e.a(2,y);case 6:if(e.p=6,k=e.v,404!==(null===(b=k.response)||void 0===b?void 0:b.status)){e.n=7;break}return console.log("[AdminService] ‚ö†Ô∏è ".concat(v.name," returned 404, trying next endpoint...")),e.a(3,8);case 7:return console.warn("[AdminService] ‚ö†Ô∏è ".concat(v.name," failed:"),(null===(S=k.response)||void 0===S?void 0:S.status)||k.message),e.a(3,8);case 8:d++,e.n=1;break;case 9:return console.warn("[AdminService] ‚ùå All match endpoints failed or returned 0 matches"),A=[],o&&this.matchesCache.set(o,{data:A,timestamp:Date.now()}),e.a(2,A)}},e,this,[[2,6]])})),function(e,n,t,r,a){return Se.apply(this,arguments)})},{key:"getUserActionsStats",value:(be=u(i().m(function e(n,t,a){var o,c,s,l,u,d,m,v,h,p,g,y,b,S,A,k,w,C,I,_;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:o=t&&a?"startDate=".concat(t,"&endDate=").concat(a):"",c=o?"?".concat(o):"",s=o?"&".concat(o):"",l=["/communities/".concat(n,"/slack-user-stats").concat(c),"/communities/".concat(n,"/stats/user-actions").concat(c),"/communities/".concat(n,"/user-actions").concat(c),"/communities/".concat(n,"/stats/userActions").concat(c),"/console/user-actions?communityId=".concat(n).concat(s),"/console/stats/user-actions?communityId=".concat(n).concat(s),"/console/stats/userActions?communityId=".concat(n).concat(s),"/console/communities/".concat(n,"/user-actions").concat(c),"/console/communities/".concat(n,"/stats/user-actions").concat(c),"/stats/user-actions?communityId=".concat(n).concat(s),"/api/console/user-actions?communityId=".concat(n).concat(s)],u=0,d=l;case 1:if(!(u<d.length)){e.n=13;break}return m=d[u],e.p=2,e.n=3,f.get(m);case 3:if(!((v=e.v)&&v.rows&&Array.isArray(v.rows))){e.n=5;break}if(console.log("[AdminService] üìä Processing slack-user-stats format with ".concat(v.rows.length," rows")),console.log("[AdminService] üìä Response structure:",{hasRows:!!v.rows,rowCount:null===(h=v.rows)||void 0===h?void 0:h.length,hasColumns:!!v.columns,totalUserCount:v.totalUserCount,sampleRow:null===(p=v.rows)||void 0===p?void 0:p[0]}),!(g=this.aggregateSlackUserStats(v))){e.n=4;break}return console.log("[AdminService] ‚úÖ User actions stats aggregated from slack-user-stats (using backend introsLedToConvos):",g),e.a(2,g);case 4:console.warn("[AdminService] ‚ö†Ô∏è aggregateSlackUserStats returned null, continuing to next endpoint");case 5:if(!v||"object"!==r(v)||v.rows){e.n=10;break}if(!((y=v)&&Object.keys(y).length>0)){e.n=10;break}if(void 0!==y.introsLedToConvos&&null!==y.introsLedToConvos){e.n=7;break}return console.log("[AdminService] Backend didn't provide introsLedToConvos, calculating from matches..."),e.n=6,this.calculateIntrosLedToConvos(n,t,a);case 6:b=e.v,y.introsLedToConvos=b,e.n=8;break;case 7:console.log("[AdminService] Using introsLedToConvos from backend: ".concat(y.introsLedToConvos));case 8:if(!(Object.values(y).some(function(e){return"number"==typeof e&&e>0})||Object.keys(y).length>0)){e.n=9;break}return console.log("[AdminService] ‚úÖ User actions stats fetched from: ".concat(m),y),e.a(2,y);case 9:console.log("[AdminService] ‚ö†Ô∏è Endpoint ".concat(m," returned empty stats, trying next..."));case 10:e.n=12;break;case 11:e.p=11,_=e.v,404===(A=(null==_?void 0:_.status)||(null==_||null===(S=_.response)||void 0===S?void 0:S.status))||console.warn("[AdminService] Error fetching user actions from ".concat(m,":"),{status:A,message:null==_?void 0:_.message,response:null==_||null===(k=_.response)||void 0===k?void 0:k.data});case 12:u++,e.n=1;break;case 13:return e.n=14,this.calculateUserActionsStats(n,t,a);case 14:if(!(w=e.v)){e.n=17;break}if(void 0!==w.introsLedToConvos&&null!==w.introsLedToConvos){e.n=16;break}return e.n=15,this.calculateIntrosLedToConvos(n,t,a);case 15:C=e.v,w.introsLedToConvos=C;case 16:return e.a(2,w);case 17:return e.n=18,this.calculateIntrosLedToConvos(n,t,a);case 18:return I=e.v,e.a(2,{openedTrova:0,generalActions:0,spotlightsCreated:0,recWallsGiven:0,recWallsReceived:0,introsLedToConvos:I})}},e,this,[[2,11]])})),function(e,n,t){return be.apply(this,arguments)})},{key:"calculateIntrosLedToConvos",value:(ye=u(i().m(function e(n,t,r){var a,o,c,s,l,u,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P,j;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a=0,e.p=1,e.n=2,this.getMagicIntrosByDate(n,t,r);case 2:o=e.v,c=o.filter(function(e){return e.totalPairings<=1e3}),a=c.reduce(function(e,n){return e+n.engagedPairings},0),e.n=4;break;case 3:e.p=3,D=e.v,console.warn("[AdminService] Could not fetch Trova Magic engaged count:",D);case 4:return s=0,e.p=5,e.n=6,this.getMatchesForCommunity(n,t,r,"channel_pairing");case 6:if(!((l=e.v)&&l.length>0)){e.n=8;break}u=new Set,f=m(l);try{for(f.s();!(v=f.n()).done;)h=v.value,null!=(p=h.groupId||h.group_id||(h.matchIndicesId&&0!==h.matchIndicesId?h.matchIndicesId:null))&&u.add(p)}catch(i){f.e(i)}finally{f.f()}if(!(u.size>0)){e.n=8;break}return e.n=7,this.countEngagedMatchesByGroup(n,l,u);case 7:s=e.v;case 8:e.n=10;break;case 9:e.p=9,E=e.v,console.warn("[AdminService] Could not calculate Channel Pairing engaged count:",E);case 10:return g=0,y=0,e.p=11,e.n=12,this.getMatchesForCommunity(n,t,r,"mentor-mentee");case 12:if(!((b=e.v)&&b.length>0)){e.n=14;break}return S=new Set,A=new Map,e.n=13,this.getConversationPairs(n);case 13:k=e.v,w=m(b);try{for(w.s();!(C=w.n()).done;)I=C.value,_=I.userId||I.user_id,M=I.matchedUserId||I.matched_user_id,_&&M&&(T=[_,M].sort(function(e,n){return e-n}).join("-"),S.has(T)||(S.add(T),F=k.has(T),A.set(T,{userId:_,matchedUserId:M,isEngaged:F}),F&&g++))}catch(i){w.e(i)}finally{w.f()}y=S.size,console.log("[AdminService] üéì Mentor/Mentee breakdown:"),console.log("[AdminService]   - Total match records: ".concat(b.length)),console.log("[AdminService]   - Unique pairs: ".concat(y)),console.log("[AdminService]   - Engaged pairs: ".concat(g)),y>0&&y<10&&console.log("[AdminService]   - Pair details:",Array.from(A.entries()).map(function(e){var n=d(e,2),t=(n[0],n[1]);return"".concat(t.userId,"-").concat(t.matchedUserId," (engaged: ").concat(t.isEngaged,")")}));case 14:e.n=16;break;case 15:e.p=15,P=e.v,console.warn("[AdminService] Could not calculate Mentor/Mentee engaged count:",P);case 16:return U=a+s+g,console.log("[AdminService] üí¨ Intros Led To Convos breakdown (unique pairs/groups):"),console.log("[AdminService]   - Trova Magic: ".concat(a," engaged unique pairs")),console.log("[AdminService]   - Channel Pairing: ".concat(s," engaged unique groups")),console.log("[AdminService]   - Mentor/Mentee: ".concat(g," engaged unique pairs (out of ").concat(y," total unique pairs)")),console.log("[AdminService]   - TOTAL: ".concat(U," (sum of engaged unique pairs/groups)")),e.a(2,U);case 17:return e.p=17,j=e.v,console.warn("[AdminService] Could not calculate Intros Led To Convos:",j),e.a(2,0)}},e,this,[[11,15],[5,9],[1,3],[0,17]])})),function(e,n,t){return ye.apply(this,arguments)})},{key:"aggregateSlackUserStats",value:function(e){var n=this;if(!e.rows||!Array.isArray(e.rows))return console.warn("[AdminService] ‚ö†Ô∏è aggregateSlackUserStats: response.rows is missing or not an array, returning zeros"),{openedTrova:0,generalActions:0,spotlightsCreated:0,recWallsGiven:0,recWallsReceived:0,introsLedToConvos:0,trovaMagicEngagements:0,channelPairingOnDemand:0,channelPairingCadence:0};if(0===e.rows.length)return console.log("[AdminService] üìä aggregateSlackUserStats: No rows found, returning zeros"),{openedTrova:0,generalActions:0,spotlightsCreated:0,recWallsGiven:0,recWallsReceived:0,introsLedToConvos:0,trovaMagicEngagements:0,channelPairingOnDemand:0,channelPairingCadence:0};var t={},r=e.rows,a=0,o=0,c=0,i=0,s=0,l=0,u=0,d=0,m=0;return r.forEach(function(e){var t=n.getNumericValue(e,["homepageViews","openedTrova","opened_trova","Opened Trova"]);a+=t,o+=n.getNumericValue(e,["profileActions","generalActions","general_actions","General Actions"]),c+=n.getNumericValue(e,["spotlightsCreated","spotlights_created","Spotlights Created"]),i+=n.getNumericValue(e,["recWallsGiven","rec_walls_given","Rec Walls Given"]),s+=n.getNumericValue(e,["recWallsReceived","rec_walls_received","Rec Walls Received"]),l+=n.getNumericValue(e,["introsLedToConvos","intros_led_to_convos","Intros Led To Convos"]),u+=n.getNumericValue(e,["introsAttributedToTrovaMagic","intros_attributed_to_trova_magic","Trova Magic"]),d+=n.getNumericValue(e,["introsAttributedToChannelPairingOnDemand","intros_attributed_to_channel_pairing_on_demand","Channel Pairing On Demand"]),m+=n.getNumericValue(e,["introsAttributedToChannelPairingCadence","intros_attributed_to_channel_pairing_cadence","Channel Pairing Cadence"])}),t.openedTrova=a,t.generalActions=o,t.spotlightsCreated=c,t.recWallsGiven=i,t.recWallsReceived=s,t.introsLedToConvos=l,t.trovaMagicEngagements=u,t.channelPairingOnDemand=d,t.channelPairingCadence=m,void 0!==t.openedTrova&&null!==t.openedTrova||(t.openedTrova=0),console.log("[AdminService] üìä Aggregated stats from ".concat(r.length," rows:"),{openedTrova:a,generalActions:o,spotlightsCreated:c,recWallsGiven:i,recWallsReceived:s,introsLedToConvos:l,trovaMagicEngagements:u,channelPairingOnDemand:d,channelPairingCadence:m}),r.length,t}},{key:"getNumericValue",value:function(e,n){var t,r=m(n);try{for(r.s();!(t=r.n()).done;){var a=e[t.value];if("number"==typeof a)return a;if("string"==typeof a){var o=parseFloat(a);if(!isNaN(o))return o}}}catch(c){r.e(c)}finally{r.f()}return 0}},{key:"calculateUserActionsStats",value:(ge=u(i().m(function e(n,t,r){var a,o,c,s,l,u,d,m,v,h,p,g,y,b,S,A,k,w,C,I;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,console.log("[AdminService] üìä Calculating user actions stats for community ".concat(n)),a={},o=t&&r?"startDate=".concat(t,"&endDate=").concat(r):"",c=o?"?".concat(o):"",s=o?"&".concat(o):"",l=["/communities/".concat(n,"/user-events").concat(c),"/communities/".concat(n,"/events/user").concat(c),"/user-events?communityId=".concat(n).concat(s),"/console/user-events?communityId=".concat(n).concat(s),"/console/communities/".concat(n,"/user-events").concat(c),"/console/events/user?communityId=".concat(n).concat(s),"/api/user-events?communityId=".concat(n).concat(s),"/events/user?communityId=".concat(n).concat(s)],u=[],d=0,m=l;case 1:if(!(d<m.length)){e.n=7;break}return v=m[d],e.p=2,e.n=3,f.get(v);case 3:if(!(h=e.v)||!Array.isArray(h)){e.n=4;break}return u=h,console.log("[AdminService] ‚úÖ Found ".concat(u.length," user events from ").concat(v)),e.a(3,7);case 4:e.n=6;break;case 5:e.p=5,404!==(null==(C=e.v)?void 0:C.status)&&404!==(null==C||null===(p=C.response)||void 0===p?void 0:p.status)&&console.warn("[AdminService] Error fetching user events from ".concat(v,":"),C);case 6:d++,e.n=1;break;case 7:return u.length>0?(g=t?new Date(t):null,y=r?new Date(r):null,b=0,S=0,A=0,k=0,w=0,u.forEach(function(e){if(g||y){var n=e.createdAt||e.timestamp||e.date;if(n){var t=new Date(n);if(g&&t<g||y&&t>y)return}}var r=e.type||e.eventType||e.action,a=e.name||e.eventName||"";"opened_trova"===r||a.toLowerCase().includes("opened trova")||a.toLowerCase().includes("open trova")?S++:"spotlight"===r||"spotlight_created"===r||a.toLowerCase().includes("spotlight")?A++:"rec_wall"===r||"rec_wall_given"===r||a.toLowerCase().includes("rec wall given")?k++:"rec_wall_received"===r||a.toLowerCase().includes("rec wall received")?w++:b++}),a.generalActions=b,a.openedTrova=S,a.spotlightsCreated=A,a.recWallsGiven=k,a.recWallsReceived=w,console.log("[AdminService] üìä User actions calculated:",{generalActions:b,openedTrova:S,spotlightsCreated:A,recWallsGiven:k,recWallsReceived:w})):(a.generalActions=0,a.openedTrova=0,a.spotlightsCreated=0,a.recWallsGiven=0,a.recWallsReceived=0,console.warn("[AdminService] No user events found, returning zeros")),e.a(2,a);case 8:return e.p=8,I=e.v,console.error("[AdminService] Error calculating user actions stats:",I),e.a(2,{generalActions:0,openedTrova:0,spotlightsCreated:0,recWallsGiven:0,recWallsReceived:0})}},e,null,[[2,5],[0,8]])})),function(e,n,t){return ge.apply(this,arguments)})},{key:"calculateUniqueIntroductionsPerUser",value:(pe=u(i().m(function e(n,t,r){var a,o,c,s,l,u,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P,j,N,L,O,z,B,R,x;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:a=new Map,e.p=1,o=["trova_magic","channel_pairing","mentor-mentee"],c=new Map,s=0,l=o;case 2:if(!(s<l.length)){e.n=7;break}return u=l[s],e.p=3,e.n=4,this.getMatchesForCommunity(n,t,r,u);case 4:if((f=e.v)&&f.length>0)if("channel_pairing"===u){v=m(f);try{for(v.s();!(h=v.n()).done;)p=h.value,g=p.userId||p.user_id,y=p.matchedUserId||p.matched_user_id,(b=p.groupId||p.group_id||(p.matchIndicesId&&0!==p.matchIndicesId?p.matchIndicesId:null))&&(c.has(b)||c.set(b,new Set),g&&c.get(b).add(g),y&&c.get(b).add(y))}catch(i){v.e(i)}finally{v.f()}}else{S=m(f);try{for(S.s();!(A=S.n()).done;)k=A.value,w=k.userId||k.user_id,C=k.matchedUserId||k.matched_user_id,w&&C&&(a.has(w)||a.set(w,new Set),a.get(w).add(C))}catch(i){S.e(i)}finally{S.f()}}e.n=6;break;case 5:e.p=5,R=e.v,console.warn("[AdminService] Error fetching ".concat(u," matches for unique introductions:"),R);case 6:s++,e.n=2;break;case 7:I=m(c.entries());try{for(I.s();!(_=I.n()).done;)for((M=d(_.value,2))[0],T=M[1],F=Array.from(T),U=0;U<F.length;U++)for(D=F[U],a.has(D)||a.set(D,new Set),E=0;E<F.length;E++)U!==E&&a.get(D).add(F[E])}catch(i){I.e(i)}finally{I.f()}P=new Map,j=m(a.entries());try{for(j.s();!(N=j.n()).done;)L=d(N.value,2),O=L[0],z=L[1],P.set(O,z.size)}catch(i){j.e(i)}finally{j.f()}return console.log("[AdminService] ‚úÖ Calculated unique introductions for ".concat(P.size," users")),P.size>0&&(B=Array.from(P.entries()).slice(0,5),console.log("[AdminService] Sample unique intro counts:",B)),e.a(2,P);case 8:return e.p=8,x=e.v,console.error("[AdminService] Error calculating unique introductions per user:",x),e.a(2,new Map)}},e,this,[[3,5],[1,8]])})),function(e,n,t){return pe.apply(this,arguments)})},{key:"getSlackUserStats",value:(he=u(i().m(function e(n,t,r){var a,c,s,l,u,d,m,v,h,p,g,y;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=[],t&&a.push("startDate=".concat(encodeURIComponent(t))),r&&a.push("endDate=".concat(encodeURIComponent(r))),c=a.length?"?".concat(a.join("&")):"",s="/communities/".concat(n,"/slack-user-stats").concat(c),e.p=1,console.log("[AdminService] Fetching slack-user-stats: ".concat(s)),e.n=2,f.get(s);case 2:if(!(l=e.v)||!Array.isArray(l.rows)){e.n=4;break}return console.log("[AdminService] Calculating unique introductions per user..."),e.n=3,this.calculateUniqueIntroductionsPerUser(n,t,r);case 3:return d=e.v,m=l.rows.map(function(e){var n=e.userId||e.user_id||e.id,t=n&&d.get(n)||0;return o(o({},e),{},{introsLedToConvos:t})}),e.a(2,{rows:m,columns:l.columns||[],totalUserCount:l.totalUserCount||(null===(u=l.rows)||void 0===u?void 0:u.length)||0});case 4:e.n=11;break;case 5:return e.p=5,g=e.v,console.error("[AdminService] Failed to fetch slack-user-stats:",g),e.p=6,console.log("[AdminService] Attempting fallback: fetching user actions stats..."),e.n=7,this.getUserActionsStats(n,t,r);case 7:if(!((h=e.v)&&h.openedTrova&&h.openedTrova>0)){e.n=8;break}return console.log("[AdminService] Fallback found openedTrova stats, but no per-user data available"),e.a(2,{rows:[],columns:[],totalUserCount:0,error:"Backend server error. User statistics are available, but per-user details cannot be loaded. Please try again later."});case 8:e.n=10;break;case 9:e.p=9,y=e.v,console.error("[AdminService] Fallback also failed:",y);case 10:return p=500===(null==g||null===(v=g.response)||void 0===v?void 0:v.status)?"Backend server error. Please try again later.":(null==g?void 0:g.message)||"Failed to fetch user statistics.",e.a(2,{rows:[],columns:[],totalUserCount:0,error:p});case 11:return e.a(2,{rows:[],columns:[],totalUserCount:0})}},e,this,[[6,9],[1,5]])})),function(e,n,t){return he.apply(this,arguments)})},{key:"getSkillsStats",value:(ve=u(i().m(function e(n){var t,r,a,o,c,s,l,u,d,m,v,h;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:t=["/communities/".concat(n,"/stats/skills"),"/communities/".concat(n,"/skills/stats"),"/console/stats/skills?communityId=".concat(n),"/console/skills/stats?communityId=".concat(n),"/console/communities/".concat(n,"/stats/skills"),"/stats/skills?communityId=".concat(n),"/api/console/stats/skills?communityId=".concat(n)],r=0,a=t;case 1:if(!(r<a.length)){e.n=10;break}return o=a[r],e.p=2,console.log("[AdminService] üéì Trying skills stats endpoint: ".concat(o)),e.n=3,f.get(o);case 3:if(!((c=e.v)&&Object.keys(c).length>0)){e.n=7;break}if(!(Object.values(c).some(function(e){return"number"==typeof e&&e>0})||Object.keys(c).length>0)){e.n=6;break}if(console.log("[AdminService] ‚úÖ Skills stats fetched from: ".concat(o),c),void 0!==c.usersCanMentor&&void 0!==c.usersWantMentor){e.n=5;break}return e.n=4,this.getMentorMenteeStats(n);case 4:(s=e.v)&&(void 0!==s.usersCanMentor&&(c.usersCanMentor=s.usersCanMentor),void 0!==s.usersWantMentor&&(c.usersWantMentor=s.usersWantMentor));case 5:return e.a(2,c);case 6:console.log("[AdminService] ‚ö†Ô∏è Endpoint ".concat(o," returned empty stats, trying next..."));case 7:e.n=9;break;case 8:e.p=8,h=e.v,404===(u=(null==h?void 0:h.status)||(null==h||null===(l=h.response)||void 0===l?void 0:l.status))||console.warn("[AdminService] Error fetching skills from ".concat(o,":"),{status:u,message:null==h?void 0:h.message,response:null==h||null===(d=h.response)||void 0===d?void 0:d.data});case 9:r++,e.n=1;break;case 10:return console.log("[AdminService] All skills endpoints failed, trying client-side calculation"),e.n=11,this.calculateSkillsStats(n);case 11:return m=e.v,e.n=12,this.getMentorMenteeStats(n);case 12:return(v=e.v)&&m&&(void 0!==v.usersCanMentor&&(m.usersCanMentor=v.usersCanMentor),void 0!==v.usersWantMentor&&(m.usersWantMentor=v.usersWantMentor)),e.a(2,m)}},e,this,[[2,8]])})),function(e){return ve.apply(this,arguments)})},{key:"getWeeklyIntroductionsStats",value:(fe=u(i().m(function e(n){var t,a,o,c,s,l,u,d,m,v,h;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t="/communities/".concat(n,"/stats/weekly-introductions"),console.log("[AdminService] üìß Fetching weekly introductions stats: ".concat(t)),e.n=1,f.get(t);case 1:if(!(a=e.v)||"object"!==r(a)){e.n=2;break}return s=null!==(o=a.usersIntroducedLast12Mo)&&void 0!==o?o:0,l=null!==(c=a.usersIntroducedThisYear)&&void 0!==c?c:0,console.log("[AdminService] ‚úÖ Weekly introductions stats fetched for community ".concat(n,":"),{usersIntroducedLast12Mo:s,usersIntroducedThisYear:l}),e.a(2,{userOnboardingIntros:s});case 2:return console.warn("[AdminService] Weekly introductions stats endpoint returned invalid response for community ".concat(n)),e.a(2,null);case 3:return e.p=3,h=e.v,404===(d=(null==h?void 0:h.status)||(null==h||null===(u=h.response)||void 0===u?void 0:u.status))?console.log("[AdminService] Weekly introductions stats endpoint not found for community ".concat(n," (404)")):500===d?console.warn("[AdminService] Weekly introductions stats endpoint returned 500 error for community ".concat(n,":"),(null==h||null===(m=h.response)||void 0===m?void 0:m.data)||(null==h?void 0:h.message)):console.warn("[AdminService] Failed to fetch weekly introductions stats for community ".concat(n," (status: ").concat(d,"):"),(null==h||null===(v=h.response)||void 0===v?void 0:v.data)||(null==h?void 0:h.message)||h),e.a(2,null)}},e,null,[[0,3]])})),function(e){return fe.apply(this,arguments)})},{key:"getConversationsStarted",value:(me=u(i().m(function e(n,t,a){var o,c,s,l,u,d,m,v,h,p;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,o="/communities/".concat(n,"/stats/conversations-started"),c=new URLSearchParams,t&&c.set("startDate",t),a&&c.set("endDate",a),(s=c.toString())&&(o+="?".concat(s)),console.log("[AdminService] üí¨ Fetching conversations started: ".concat(o)),e.n=1,f.get(o);case 1:if(!(l=e.v)||"object"!==r(l)){e.n=2;break}return console.log("[AdminService] ‚úÖ Conversations started fetched:",{totalConversations:l.totalConversations,totalMessages:l.totalMessages,conversationsCount:(null===(u=l.conversations)||void 0===u?void 0:u.length)||0}),e.a(2,l);case 2:return e.a(2,null);case 3:return e.p=3,p=e.v,404===(m=(null==p?void 0:p.status)||(null==p||null===(d=p.response)||void 0===d?void 0:d.status))?console.log("[AdminService] Conversations started endpoint not found for community ".concat(n," (404)")):500===m?console.warn("[AdminService] Conversations started endpoint returned 500 error for community ".concat(n,":"),(null==p||null===(v=p.response)||void 0===v?void 0:v.data)||(null==p?void 0:p.message)):console.warn("[AdminService] Failed to fetch conversations started for community ".concat(n," (status: ").concat(m,"):"),(null==p||null===(h=p.response)||void 0===h?void 0:h.data)||(null==p?void 0:p.message)||p),e.a(2,null)}},e,null,[[0,3]])})),function(e,n,t){return me.apply(this,arguments)})},{key:"getWeeklyIntroductionsUsers",value:(de=u(i().m(function e(n,t,r){var a,o,c,s,l,u,d,m,v,h,p;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t&&r){e.n=1;break}return console.warn("[AdminService] startDate and endDate are required for weekly introductions users"),e.a(2,null);case 1:return(a=new URLSearchParams).set("startDate",t),a.set("endDate",r),o=a.toString(),c="/communities/".concat(n,"/stats/weekly-introductions/users?").concat(o),console.log("[AdminService] üìß Fetching weekly introductions users: ".concat(c)),e.n=2,f.get(c);case 2:if(s=e.v,l=Array.isArray(s)?s:null==s?void 0:s.rows,Array.isArray(l)){e.n=3;break}return console.warn("[AdminService] Weekly introductions users endpoint returned unexpected format or no rows for community ".concat(n)),e.a(2,[]);case 3:return u=l.map(function(e){var n,t,r,a,o,c,i,s,l,u,d,m,f,v,h=null!==(n=null!==(t=e.userId)&&void 0!==t?t:e.user_id)&&void 0!==n?n:e.id,p=null!==(r=null!==(a=null!==(o=e.fname)&&void 0!==o?o:e.firstName)&&void 0!==a?a:e.first_name)&&void 0!==r?r:"",g=null!==(c=null!==(i=null!==(s=e.lname)&&void 0!==s?s:e.lastName)&&void 0!==i?i:e.last_name)&&void 0!==c?c:"";return{id:h,name:null!==(l=null!==(u=e.name)&&void 0!==u?u:"".concat(p," ").concat(g).trim())&&void 0!==l?l:"Unknown User",email:e.email,profilePicture:null!==(d=e.profilePicture)&&void 0!==d?d:e.profile_picture,introMessageSentAt:null!==(m=null!==(f=null!==(v=e.introMessageSentAt)&&void 0!==v?v:e.intro_message_sent_at)&&void 0!==f?f:e.mostRecentIntroMessageSentAt)&&void 0!==m?m:e.most_recent_intro_message_sent_at}}).filter(function(e){return"number"==typeof e.id&&!!e.name}),console.log("[AdminService] ‚úÖ Fetched ".concat(u.length," weekly introductions users")),e.a(2,u);case 4:return e.p=4,p=e.v,400===(m=(null==p?void 0:p.status)||(null==p||null===(d=p.response)||void 0===d?void 0:d.status))?console.warn("[AdminService] Weekly introductions users endpoint returned 400 (Bad Request) for community ".concat(n,":"),(null==p||null===(v=p.response)||void 0===v||null===(v=v.data)||void 0===v?void 0:v.error)||(null==p?void 0:p.message)):404===m?console.log("[AdminService] Weekly introductions users endpoint not found for community ".concat(n)):console.warn("[AdminService] Failed to fetch weekly introductions users for community ".concat(n," (status: ").concat(m,"):"),(null==p||null===(h=p.response)||void 0===h?void 0:h.data)||(null==p?void 0:p.message)||p),e.a(2,null)}},e,null,[[0,4]])})),function(e,n,t){return de.apply(this,arguments)})},{key:"getSelfIntroducedStats",value:(ue=u(i().m(function e(n,t,a){var o,c,s,l,u,d,m,v,h,p,g,y;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,o=new URLSearchParams,t&&o.set("startDate",t),a&&o.set("endDate",a),c=o.toString(),s="/communities/".concat(n,"/stats/self-introduced").concat(c?"?".concat(c):""),console.log("[AdminService] üì∏ Fetching self-introduced stats: ".concat(s)),e.n=1,f.get(s);case 1:if(l=e.v,console.log("[AdminService] üì∏ Self-introduced stats response:",l),u=0,"number"==typeof l?u=l:l&&"object"===r(l)&&(u=null!==(d=null!==(m=null!==(v=null!==(h=l.total)&&void 0!==h?h:l.count)&&void 0!==v?v:l.selfIntroduced)&&void 0!==m?m:l.data)&&void 0!==d?d:0),console.log("[AdminService] üì∏ Parsed self-introduced count: ".concat(u)),null==u){e.n=2;break}return e.a(2,{selfIntroduced:u});case 2:return console.warn("[AdminService] Self-introduced stats endpoint returned invalid response for community ".concat(n)),e.a(2,null);case 3:return e.p=3,y=e.v,404===(g=(null==y?void 0:y.status)||(null==y||null===(p=y.response)||void 0===p?void 0:p.status))?console.log("[AdminService] Self-introduced stats endpoint not found for community ".concat(n," (404)")):500===g?console.warn("[AdminService] Self-introduced stats endpoint returned 500 for community ".concat(n)):console.warn("[AdminService] Failed to fetch self-introduced stats for community ".concat(n,":"),(null==y?void 0:y.message)||y),e.a(2,null)}},e,null,[[0,3]])})),function(e,n,t){return ue.apply(this,arguments)})},{key:"getSelfIntroducedUsers",value:(le=u(i().m(function e(n,t,r,a,o){var c,s,l,u,d,m,v,h,p,g,y,b,S;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t&&r){e.n=1;break}return console.warn("[AdminService] startDate and endDate are required for self-introduced users"),e.a(2,null);case 1:return(l=new URLSearchParams).set("startDate",t),l.set("endDate",r),void 0!==a&&l.set("page",String(a)),void 0!==o&&l.set("limit",String(o)),u=l.toString(),d="/communities/".concat(n,"/stats/self-introduced/users?").concat(u),console.log("[AdminService] üì∏ Fetching self-introduced users: ".concat(d)),e.n=2,f.get(d);case 2:if(m=e.v,v=Array.isArray(m)?m:null!==(c=null!==(s=null==m?void 0:m.rows)&&void 0!==s?s:null==m?void 0:m.data)&&void 0!==c?c:null==m?void 0:m.users,Array.isArray(v)){e.n=3;break}return console.warn("[AdminService] Self-introduced users endpoint returned unexpected format or no rows for community ".concat(n)),e.a(2,[]);case 3:return h=v.map(function(e){var n,t,r,a,o,c,i,s,l,u,d,m,f,v,h,p,g=null!==(n=null!==(t=e.userId)&&void 0!==t?t:e.user_id)&&void 0!==n?n:e.id,y=null!==(r=null!==(a=null!==(o=e.fname)&&void 0!==o?o:e.firstName)&&void 0!==a?a:e.first_name)&&void 0!==r?r:"",b=null!==(c=null!==(i=null!==(s=e.lname)&&void 0!==s?s:e.lastName)&&void 0!==i?i:e.last_name)&&void 0!==c?c:"";return{id:g,name:null!==(l=null!==(u=e.name)&&void 0!==u?u:"".concat(y," ").concat(b).trim())&&void 0!==l?l:"Unknown User",email:e.email,profilePicture:null!==(d=e.profilePicture)&&void 0!==d?d:e.profile_picture,introducedAt:null!==(m=null!==(f=null!==(v=e.introducedAt)&&void 0!==v?v:e.introduced_at)&&void 0!==f?f:e.createdAt)&&void 0!==m?m:e.created_at,channelName:null!==(h=e.channelName)&&void 0!==h?h:e.channel_name,channelId:null!==(p=e.channelId)&&void 0!==p?p:e.channel_id}}).filter(function(e){return"number"==typeof e.id&&!!e.name}),console.log("[AdminService] ‚úÖ Fetched ".concat(h.length," self-introduced users")),e.a(2,h);case 4:return e.p=4,S=e.v,400===(g=(null==S?void 0:S.status)||(null==S||null===(p=S.response)||void 0===p?void 0:p.status))?console.warn("[AdminService] Self-introduced users endpoint returned 400 (Bad Request) for community ".concat(n,":"),(null==S||null===(y=S.response)||void 0===y||null===(y=y.data)||void 0===y?void 0:y.error)||(null==S?void 0:S.message)):404===g?console.log("[AdminService] Self-introduced users endpoint not found for community ".concat(n)):console.warn("[AdminService] Failed to fetch self-introduced users for community ".concat(n," (status: ").concat(g,"):"),(null==S||null===(b=S.response)||void 0===b?void 0:b.data)||(null==S?void 0:S.message)||S),e.a(2,null)}},e,null,[[0,4]])})),function(e,n,t,r,a){return le.apply(this,arguments)})},{key:"getMentorMenteeStats",value:(se=u(i().m(function e(n){var t,a,o,c,s,l,u,d,m,v,h,p,g,y,b,S,A,k;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:t=["/communities/".concat(n,"/stats/mentor-mentee"),"/communities/".concat(n,"/stats/mentors"),"/communities/".concat(n,"/mentor-mentee/stats"),"/console/stats/mentor-mentee?communityId=".concat(n),"/console/stats/mentors?communityId=".concat(n),"/console/communities/".concat(n,"/stats/mentor-mentee"),"/console/communities/".concat(n,"/stats/mentors"),"/stats/mentor-mentee?communityId=".concat(n),"/api/console/stats/mentor-mentee?communityId=".concat(n)],a=0,o=t;case 1:if(!(a<o.length)){e.n=7;break}return c=o[a],e.p=2,console.log("[AdminService] üéì Trying mentor/mentee stats endpoint: ".concat(c)),e.n=3,f.get(c);case 3:if(!(s=e.v)||"object"!==r(s)){e.n=4;break}if(l=null!==(d=null!==(m=null!==(v=null!==(h=s.usersCanMentor)&&void 0!==h?h:s.canMentor)&&void 0!==v?v:s.mentorCount)&&void 0!==m?m:s.mentors)&&void 0!==d?d:0,u=null!==(p=null!==(g=null!==(y=null!==(b=s.usersWantMentor)&&void 0!==b?b:s.wantMentor)&&void 0!==y?y:s.menteeCount)&&void 0!==g?g:s.mentees)&&void 0!==p?p:0,"number"!=typeof l&&"number"!=typeof u){e.n=4;break}return console.log("[AdminService] ‚úÖ Mentor/mentee stats fetched from: ".concat(c),{usersCanMentor:l,usersWantMentor:u}),e.a(2,{usersCanMentor:l,usersWantMentor:u});case 4:e.n=6;break;case 5:e.p=5,k=e.v,404===(A=(null==k?void 0:k.status)||(null==k||null===(S=k.response)||void 0===S?void 0:S.status))||console.warn("[AdminService] Error fetching mentor/mentee stats from ".concat(c,":"),{status:A,message:null==k?void 0:k.message});case 6:a++,e.n=1;break;case 7:return console.log("[AdminService] ‚ö†Ô∏è All mentor/mentee stats endpoints failed, trying profile fallback"),e.a(2,this.getMentorMenteeStatsFallback(n))}},e,this,[[2,5]])})),function(e){return se.apply(this,arguments)})},{key:"getMentorMenteeStatsFallback",value:(ie=u(i().m(function e(n){var t,a,o,c,s,l,u,d,f,v,h;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.getCachedProfiles(n);case 1:return t=e.v,a=new Set,o=new Set,e.p=2,console.log("[AdminService] Trying to fetch unconsolidated skills data for mentor/mentee stats"),e.n=3,this.getSkillsChartData(n,"all",!1,!0);case 3:if(!((c=e.v)&&c.length>0)){e.n=4;break}if(s=c[0],console.log("[AdminService] Sample unconsolidated skill entry for stats:",s),c.forEach(function(e){var n=e.userId||e.user_id||e.id;if(n){var t=e.can_be_mentor||e.canBeMentor||e.canMentor,r=e.wants_to_be_mentee||e.wantsToBeMentee||e.wantMentor||e.wantsMentor;!0!==t&&1!==t&&"true"!==t&&"1"!==t||a.add(n),!0!==r&&1!==r&&"true"!==r&&"1"!==r||o.add(n)}}),!(a.size>0||o.size>0)){e.n=4;break}return console.log("[AdminService] ‚úÖ Found ".concat(a.size," mentors and ").concat(o.size," mentees from skills data")),e.a(2,{usersCanMentor:a.size,usersWantMentor:o.size});case 4:e.n=6;break;case 5:e.p=5,v=e.v,console.log("[AdminService] Could not fetch unconsolidated skills data for stats:",v);case 6:return l=["canMentor","can_mentor","dataCanMentor","data_can_mentor","is_active_mentor","isActiveMentor","isMentor","mentor","canMentorFlag","mentorFlag","isMentorActive"],u=["wantMentor","want_mentor","dataWantMentor","data_want_mentor","is_active_mentee","isActiveMentee","isMentee","mentee","wantsMentor","wantMentorFlag","menteeFlag","isMenteeActive","wants_mentor"],d=0,f=0,t.forEach(function(e){var n=e,t=(e.userId||e.id,n.skills||n.dataSkills||n.userSkills),a=!1,o=!1;if(t){var c=[];Array.isArray(t)?c=t:"object"===r(t)&&(c=Object.values(t));var i,s=m(c);try{for(s.s();!(i=s.n()).done;){var v=i.value;if("object"===r(v)&&null!==v){var h=v.can_be_mentor||v.canBeMentor||v.canMentor;!0!==h&&1!==h&&"true"!==h&&"1"!==h||(a=!0);var p=v.wants_to_be_mentee||v.wantsToBeMentee||v.wantMentor||v.wantsMentor;!0!==p&&1!==p&&"true"!==p&&"1"!==p||(o=!0)}}}catch(F){s.e(F)}finally{s.f()}}var g=a;if(!g)for(var y=0,b=l;y<b.length;y++){var S=b[y],A=n[S];if(null==A&&(n.data&&"object"===r(n.data)&&(A=n.data[S]),null==A&&n.career&&"object"===r(n.career)&&(A=n.career[S]),null==A&&n.userCareer&&"object"===r(n.userCareer)&&(A=n.userCareer[S])),null!=A){if("boolean"==typeof A&&!0===A){g=!0;break}if("number"==typeof A&&(1===A||A>0)){g=!0;break}if("string"==typeof A){var k=A.toLowerCase();if("true"===k||"1"===k||"yes"===k){g=!0;break}}}}g&&d++;var w=o;if(!w)for(var C=0,I=u;C<I.length;C++){var _=I[C],M=n[_];if(null==M&&(n.data&&"object"===r(n.data)&&(M=n.data[_]),null==M&&n.career&&"object"===r(n.career)&&(M=n.career[_]),null==M&&n.userCareer&&"object"===r(n.userCareer)&&(M=n.userCareer[_])),null!=M){if("boolean"==typeof M&&!0===M){w=!0;break}if("number"==typeof M&&(1===M||M>0)){w=!0;break}if("string"==typeof M){var T=M.toLowerCase();if("true"===T||"1"===T||"yes"===T){w=!0;break}}}}w&&f++}),console.log("[AdminService] ‚úÖ Fallback: Calculated mentor/mentee stats from profiles:",{usersCanMentor:d,usersWantMentor:f}),e.a(2,{usersCanMentor:d,usersWantMentor:f});case 7:return e.p=7,h=e.v,console.error("[AdminService] Error in mentor/mentee stats fallback:",h),e.a(2,null)}},e,this,[[2,5],[0,7]])})),function(e){return ie.apply(this,arguments)})},{key:"getMentorMenteeUsers",value:(ce=u(i().m(function e(n,t){var r,a,o,c,s,l,u,d;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:r=["/communities/".concat(n,"/mentors/").concat("can"===t?"mentors":"mentees"),"/communities/".concat(n,"/mentor-mentee/").concat("can"===t?"mentors":"mentees"),"/communities/".concat(n,"/users/mentor-mentee?type=").concat(t),"/console/communities/".concat(n,"/mentors/").concat("can"===t?"mentors":"mentees")],a=0,o=r;case 1:if(!(a<o.length)){e.n=7;break}return c=o[a],e.p=2,console.log("[AdminService] üéì Trying mentor/mentee users endpoint: ".concat(c)),e.n=3,f.get(c);case 3:if(!(s=e.v)||!Array.isArray(s)){e.n=4;break}return console.log("[AdminService] ‚úÖ Found ".concat(s.length," ").concat("can"===t?"mentors":"mentees")),e.a(2,s);case 4:e.n=6;break;case 5:e.p=5,d=e.v,404===(u=(null==d?void 0:d.status)||(null==d||null===(l=d.response)||void 0===l?void 0:l.status))||console.warn("[AdminService] Error fetching mentor/mentee users from ".concat(c,":"),{status:u,message:null==d?void 0:d.message});case 6:a++,e.n=1;break;case 7:return console.log("[AdminService] ‚ö†Ô∏è All mentor/mentee endpoints failed, trying profile fallback for ".concat("can"===t?"mentors":"mentees")),e.a(2,this.getMentorMenteeUsersFallback(n,t))}},e,this,[[2,5]])})),function(e,n){return ce.apply(this,arguments)})},{key:"getMentorMenteeUsersFallback",value:(oe=u(i().m(function n(a,o){var c,s,l,u,d,f,v,h,p,g;return i().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,this.getCachedProfiles(a);case 1:return c=n.v,s=new Map,n.p=2,console.log("[AdminService] Trying to fetch unconsolidated skills data for mentor/mentee flags"),n.n=3,this.getSkillsChartData(a,"all",!1,!0);case 3:(l=n.v)&&l.length>0&&(u=l[0],console.log("[AdminService] Sample unconsolidated skill entry:",u),l.forEach(function(e){var n=e.userId||e.user_id||e.id;if(n){var t=e.can_be_mentor||e.canBeMentor||e.canMentor,r=e.wants_to_be_mentee||e.wantsToBeMentee||e.wantMentor||e.wantsMentor;if(void 0!==t||void 0!==r){var a=s.get(n)||{canMentor:!1,wantMentor:!1};!0!==t&&1!==t&&"true"!==t&&"1"!==t||(a.canMentor=!0),!0!==r&&1!==r&&"true"!==r&&"1"!==r||(a.wantMentor=!0),s.set(n,a)}}}),s.size>0&&console.log("[AdminService] ‚úÖ Found ".concat(s.size," users with mentor/mentee flags from skills data"))),n.n=5;break;case 4:n.p=4,p=n.v,console.log("[AdminService] Could not fetch unconsolidated skills data:",p);case 5:return d="can"===o?"canMentor":"wantMentor",f="can"===o?["canMentor","can_mentor","dataCanMentor","data_can_mentor","is_active_mentor","isActiveMentor","isMentor","mentor","canMentorFlag","mentorFlag","isMentorActive"]:["wantMentor","want_mentor","dataWantMentor","data_want_mentor","is_active_mentee","isActiveMentee","isMentee","mentee","wantsMentor","wantMentorFlag","menteeFlag","isMenteeActive","wants_mentor"],console.log("[AdminService] Fallback: Filtering ".concat(c.length," profiles for ").concat(d)),c.length>0&&(v=c[0],console.log("[AdminService] üîç Sample profile structure for mentor/mentee detection:",{userId:v.userId||v.id,hasSkills:!!v.skills,hasDataSkills:!!v.dataSkills,hasUserSkills:!!v.userSkills,skillsType:r(v.skills),dataSkillsType:r(v.dataSkills),skillsValue:v.skills,dataSkillsValue:v.dataSkills,allKeys:Object.keys(v),hasData:!!v.data,hasCareer:!!v.career,hasUserCareer:!!v.userCareer}),Array.isArray(v.dataSkills)&&v.dataSkills.length>0&&console.log("[AdminService] üîç Sample dataSkills entry:",v.dataSkills[0],"(type: ".concat(r(v.dataSkills[0]),")"))),h=c.map(function(e){var n=e,t=e.userId||e.id,a=[],c=n.skills||n.dataSkills||n.userSkills;if(c){var i=[];Array.isArray(c)?i=c:"object"===r(c)&&(i=Object.values(c));var s,l=m(i);try{for(l.s();!(s=l.n()).done;){var u=s.value;if("object"===r(u)&&null!==u){var d=u.name||u.skill||u.value||"";if("can"===o){var f=u.can_be_mentor||u.canBeMentor||u.canMentor;!0!==f&&1!==f&&"true"!==f&&"1"!==f||d&&a.push(d)}if("want"===o){var v=u.wants_to_be_mentee||u.wantsToBeMentee||u.wantMentor||u.wantsMentor;!0!==v&&1!==v&&"true"!==v&&"1"!==v||d&&a.push(d)}}else"string"==typeof u&&u.trim()}}catch(h){l.e(h)}finally{l.f()}}return{id:t,fname:e.fname,lname:e.lname,fullName:e.fullName||"".concat(e.fname," ").concat(e.lname),email:"",profilePicture:e.profilePicture,isManager:!1,enabled:!0,joinDate:void 0,jobTitle:e.jobTitle,currentEmployer:e.currentEmployer,mentorSkills:"can"===o?a:void 0,menteeSkills:"want"===o?a:void 0,_profile:e,_relevantSkills:a}}).filter(function(e){var n=e._profile;if(!n)return!1;if(e._relevantSkills||(e._relevantSkills=[]),e._relevantSkills.length>0)return console.log("[AdminService] Found ".concat(e._relevantSkills.length," skill(s) with ").concat("can"===o?"can_be_mentor":"wants_to_be_mentee","=true for user ").concat(e.id,":"),e._relevantSkills),!0;var t=n,a=s.get(e.id);if(a){if("can"===o&&a.canMentor)return console.log("[AdminService] Found can_be_mentor=true from skills data for user ".concat(e.id)),!0;if("want"===o&&a.wantMentor)return console.log("[AdminService] Found wants_to_be_mentee=true from skills data for user ".concat(e.id)),!0}var c=t.skills||t.dataSkills||t.userSkills;if(c){var i=[];Array.isArray(c)?i=c:"object"===r(c)&&(i=Object.values(c));var l,u=m(i);try{for(u.s();!(l=u.n()).done;){var d=l.value;if("object"===r(d)&&null!==d){var v=d.name||d.skill||d.value||"";if("can"===o){var h=d.can_be_mentor||d.canBeMentor||d.canMentor;!0!==h&&1!==h&&"true"!==h&&"1"!==h||(v&&!e._relevantSkills.includes(v)&&e._relevantSkills.push(v),console.log("[AdminService] Found can_be_mentor=true in skills for user ".concat(e.id).concat(v?" (skill: ".concat(v,")"):"")))}if("want"===o){var p=d.wants_to_be_mentee||d.wantsToBeMentee||d.wantMentor||d.wantsMentor;!0!==p&&1!==p&&"true"!==p&&"1"!==p||(v&&!e._relevantSkills.includes(v)&&e._relevantSkills.push(v),console.log("[AdminService] Found wants_to_be_mentee=true in skills for user ".concat(e.id).concat(v?" (skill: ".concat(v,")"):"")))}}}}catch(_){u.e(_)}finally{u.f()}if(e._relevantSkills.length>0)return!0}for(var g=!1,y=0,b=f;y<b.length;y++){var S=b[y],A=t[S];if(null==A&&(t.data&&"object"===r(t.data)&&(A=t.data[S]),null==A&&t.career&&"object"===r(t.career)&&(A=t.career[S]),null==A&&t.userCareer&&"object"===r(t.userCareer)&&(A=t.userCareer[S])),null!=A){var k=!1;if("boolean"==typeof A)k=!0===A;else if("number"==typeof A)k=1===A||A>0;else if("string"==typeof A){var w=A.toLowerCase();k="true"===w||"1"===w||"yes"===w}if(k){if(g=!0,0===e._relevantSkills.length){var C=t.skills||t.dataSkills||t.userSkills;if(C){var I=[];Array.isArray(C)?I=C:"object"===r(C)&&(I=Object.values(C)),I.forEach(function(n){if("object"===r(n)&&null!==n){var t=n.name||n.skill||n.value||"";t&&!e._relevantSkills.includes(t)&&e._relevantSkills.push(t)}else"string"==typeof n&&n.trim()&&(e._relevantSkills.includes(n)||e._relevantSkills.push(n))})}}break}}}return!!g}).map(function(n){n._profile;var r=n._relevantSkills,a=void 0===r?[]:r,c=t(n,e);return"can"===o?c.mentorSkills=a:c.menteeSkills=a,c}),console.log("[AdminService] ‚úÖ Fallback: Found ".concat(h.length," ").concat("can"===o?"mentors":"mentees"," from profiles")),n.a(2,h);case 6:return n.p=6,g=n.v,console.error("[AdminService] Error in mentor/mentee fallback:",g),n.a(2,[])}},n,this,[[2,4],[0,6]])})),function(e,n){return oe.apply(this,arguments)})},{key:"calculateSkillsStats",value:(ae=u(i().m(function e(n){var t,a,o,c,s,l,u,d,m;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("[AdminService] üéì Calculating skills stats for community ".concat(n)),t={totalSkills:0,usersWithSkills:0},e.p=1,e.n=2,this.getSkillsChartData(n,"all",!0,!0);case 2:return a=e.v,o=new Set,c=new Set,a.forEach(function(e){o.add(e.name),e.value&&e.value}),t.totalSkills=o.size,e.p=3,e.n=4,this.getCachedProfiles(n);case 4:s=e.v,console.log("[AdminService] üéì Processing ".concat(s.length," profiles for skills calculation")),s.forEach(function(e){var n=e.userId||e.id||e.user_id;if(n){var t=e.skills||e.dataSkills||e.userSkills;t&&(Array.isArray(t)&&t.length>0||"object"===r(t)&&Object.keys(t).length>0||"string"==typeof t&&t.trim().length>0)&&c.add(n)}}),t.usersWithSkills=c.size,console.log("[AdminService] üéì Skills stats from profiles:",{usersWithSkills:t.usersWithSkills}),e.n=6;break;case 5:e.p=5,u=e.v,console.warn("[AdminService] Could not get profile data for skills calculation:",u),(l=a.filter(function(e){return e.value&&e.value>0})).length>0&&(t.usersWithSkills=Math.max(o.size,l.length));case 6:console.log("[AdminService] üéì Skills stats calculated:",t),e.n=8;break;case 7:e.p=7,d=e.v,console.warn("[AdminService] Could not calculate skills stats:",d);case 8:return e.a(2,t);case 9:return e.p=9,m=e.v,console.error("[AdminService] Error calculating skills stats:",m),e.a(2,{totalSkills:0,usersWithSkills:0})}},e,this,[[3,5],[1,7],[0,9]])})),function(e){return ae.apply(this,arguments)})},{key:"getMatchEngagementStats",value:(re=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a="/communities/".concat(n,"/stats/match-engagement"),t&&r&&(a+="?startDate=".concat(t,"&endDate=").concat(r)),e.n=1,f.get(a);case 1:return o=e.v,e.a(2,o);case 2:if(e.p=2,404!==(null==(s=e.v)?void 0:s.status)&&404!==(null==s||null===(c=s.response)||void 0===c?void 0:c.status)){e.n=3;break}return e.a(2,this.calculateMatchEngagementStats(n,t,r));case 3:return console.warn("[AdminService] Error fetching match engagement stats:",s),e.a(2,null)}},e,this,[[0,2]])})),function(e,n,t){return re.apply(this,arguments)})},{key:"calculateMatchEngagementStats",value:(te=u(i().m(function e(n,t,r){var a,o,c,s,l,u,d,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P,j,N,L;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a={trovaMagicMatches:0,trovaMagicSessions:0,channelPairingMatches:0,channelPairingSessions:0,mentorMenteeMatches:0,allMatchesEngaged:0,matchEngagementRate:0},o=0,c=0,s=0,e.p=1,e.n=2,this.getMagicIntrosByDate(n,t,r);case 2:return l=e.v,u=l.filter(function(e){return e.totalPairings<=1e3}),o=u.reduce(function(e,n){return e+n.totalPairings},0),c=u.reduce(function(e,n){return e+n.engagedPairings},0),e.n=3,this.getMatchesForCommunity(n,t,r,"trova_magic");case 3:d=e.v,s=(null==d?void 0:d.length)||0,console.log("[AdminService] üîó Trova Magic: ".concat(s," sessions ‚Üí ").concat(o," unique pairs, ").concat(c," engaged (").concat(u.length," valid dates, ").concat(l.length-u.length," dates excluded)")),e.n=5;break;case 4:e.p=4,P=e.v,console.warn("[AdminService] Could not fetch Trova Magic from daily breakdown:",P);case 5:return a.trovaMagicMatches=o,a.trovaMagicSessions=s,a.trovaMagicEngagements=c,e.n=6,this.getMatchesForCommunity(n,t,r,"channel_pairing");case 6:if(f=e.v,v=new Set,h=new Map,f&&f.length>0){p=m(f);try{for(p.s();!(g=p.n()).done;)y=g.value,null!=(b=y.groupId||y.group_id||(y.matchIndicesId&&0!==y.matchIndicesId?y.matchIndicesId:null))&&(v.has(b)||(v.add(b),h.set(b,y)))}catch(i){p.e(i)}finally{p.f()}}if(a.channelPairingMatches=v.size,a.channelPairingSessions=(null==f?void 0:f.length)||0,S=0,!(v.size>0)){e.n=10;break}return e.p=7,e.n=8,this.countEngagedMatchesByGroup(n,f,v);case 8:S=e.v,e.n=10;break;case 9:e.p=9,j=e.v,console.warn("[AdminService] Could not calculate channel pairing engagement:",j);case 10:return a.channelPairingEngagements=S,A=0,k=0,e.p=11,console.log("[AdminService] üéì Fetching mentor/mentee matches for stats calculation",{startDate:t,endDate:r}),e.n=12,this.getMentorMenteeUsersWithMatches(n,t,r);case 12:return w=e.v,A=w.reduce(function(e,n){return e+n.matchCount},0),e.n=13,this.getMatchesForCommunity(n,t,r,"mentor-mentee");case 13:if((C=e.v)&&C.length>0){I=new Set,_=m(C);try{for(_.s();!(M=_.n()).done;)T=M.value,F=T.userId||T.user_id,U=T.matchedUserId||T.matched_user_id,F&&U&&(D=[F,U].sort(function(e,n){return e-n}).join("-"),I.add(D))}catch(i){_.e(i)}finally{_.f()}k=I.size}console.log("[AdminService] üéì Mentor/Mentee: ".concat(A," sessions, ").concat(k," unique pairs (from ").concat(w.length," users)")),e.n=15;break;case 14:e.p=14,N=e.v,console.error("[AdminService] Error fetching Mentor/Mentee matches:",N);case 15:return a.mentorMenteeMatches=A,a.mentorMenteeUniquePairs=k,a.mentorMenteeEngagements=0,(E=a.trovaMagicMatches+a.channelPairingMatches+a.mentorMenteeMatches)>0&&(a.allMatchesEngaged=c+S,a.matchEngagementRate=a.allMatchesEngaged/E*100),console.log("[AdminService] üîó Match engagement: ".concat(a.trovaMagicMatches," Trova Magic (").concat(a.trovaMagicEngagements," engaged), ").concat(a.channelPairingMatches," Channel Pairing (").concat(S," engaged), ").concat(a.mentorMenteeMatches," Mentor/Mentee (matches only, no engagement tracking), ").concat(a.allMatchesEngaged,"/").concat(E," total engaged")),e.a(2,a);case 16:return e.p=16,L=e.v,console.warn("[AdminService] Error calculating match engagement stats:",L),e.a(2,null)}},e,this,[[11,14],[7,9],[1,4],[0,16]])})),function(e,n,t){return te.apply(this,arguments)})},{key:"getChannelPairingStats",value:(ne=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a="/communities/".concat(n,"/stats/channel-pairing"),t&&r&&(a+="?startDate=".concat(t,"&endDate=").concat(r)),e.n=1,f.get(a);case 1:return o=e.v,e.a(2,o);case 2:if(e.p=2,404!==(null==(s=e.v)?void 0:s.status)&&404!==(null==s||null===(c=s.response)||void 0===c?void 0:c.status)){e.n=3;break}return e.a(2,this.calculateChannelPairingStats(n,t,r));case 3:return console.warn("[AdminService] Error fetching channel pairing stats:",s),e.a(2,null)}},e,this,[[0,2]])})),function(e,n,t){return ne.apply(this,arguments)})},{key:"calculateChannelPairingStats",value:(ee=u(i().m(function e(n,t,r){var a,o,c,s,l,u,d;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a={channelPairingGroups:0,channelPairingUsers:0,channelPairingOnDemand:0,channelPairingCadence:0},e.n=1,this.getMatchesForCommunity(n,t,r,"channel_pairing");case 1:return(o=e.v)&&o.length>0&&(c=new Set,s=new Set,o.forEach(function(e){var n=e.groupId||e.group_id;n&&c.add(n),e.userId&&s.add(e.userId),e.matchedUserId&&s.add(e.matchedUserId)}),a.channelPairingGroups=c.size,a.channelPairingUsers=s.size,l=0,u=0,o.forEach(function(e){var n=e.isOnDemand||e.onDemand||"on_demand"===e.triggerType||"manual"===e.triggerType,t=e.isCadence||e.cadence||"cadence"===e.triggerType||"scheduled"===e.triggerType||e.scheduled;n?l++:t?u++:e.triggeredAt||e.manualTrigger?l++:(e.scheduledAt||e.nextRun,u++)}),a.channelPairingOnDemand=l,a.channelPairingCadence=u),e.a(2,a);case 2:return e.p=2,d=e.v,console.warn("[AdminService] Error calculating channel pairing stats:",d),e.a(2,null)}},e,this,[[0,2]])})),function(e,n,t){return ee.apply(this,arguments)})},{key:"getMessageStats",value:(X=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a="/communities/".concat(n,"/stats/messages"),t&&r&&(a+="?startDate=".concat(t,"&endDate=").concat(r)),e.n=1,f.get(a);case 1:return o=e.v,e.a(2,o);case 2:if(e.p=2,404!==(null==(s=e.v)?void 0:s.status)&&404!==(null==s||null===(c=s.response)||void 0===c?void 0:c.status)){e.n=3;break}return e.a(2,this.calculateMessageStats(n,t,r));case 3:return console.error("Failed to fetch message stats:",s),e.a(2,null)}},e,this,[[0,2]])})),function(e,n,t){return X.apply(this,arguments)})},{key:"getConversationsForCommunity",value:(Y=u(i().m(function e(n){var t,r,a,o,c,s,l,u;return i().w(function(e){for(;;)switch(e.n){case 0:if(t=this.getConversationsCacheKey(n),!(r=this.conversationsCache.get(t))||!this.isCacheValid(r.timestamp,this.FIREBASE_CACHE_TTL)){e.n=1;break}return console.log("[AdminService] ‚úÖ Using cached conversations for community ".concat(n)),e.a(2,r.data);case 1:if(a=v(),o=a.firestore){e.n=2;break}return e.a(2,new Set);case 2:return c=g(o,"messages"),s=y(c,b("communityId","==",n)),e.n=3,S(s);case 3:return l=e.v,u=new Set,l.forEach(function(e){u.add(e.id)}),this.conversationsCache.set(t,{data:u,timestamp:Date.now()}),e.a(2,u)}},e,this)})),function(e){return Y.apply(this,arguments)})},{key:"calculateMessageStats",value:(Q=u(i().m(function e(n,t,r){var a,o,c,s,l,d,m,f,h,p,k,w,C;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,a=v(),o=a.firestore){e.n=1;break}return console.warn("[AdminService] Firestore not initialized, cannot query messages"),e.a(2,{totalMessagesSent:0});case 1:return console.log("[AdminService] üì® Starting message stats calculation for community ".concat(n)),e.n=2,this.getConversationsForCommunity(n);case 2:if(0!==(c=e.v).size){e.n=3;break}return console.log("[AdminService] üì® No conversations found for community ".concat(n)),e.a(2,{totalMessagesSent:0});case 3:s=t?A.fromDate(new Date(t)):null,l=r?A.fromDate(new Date(r)):null,d=0,m=10,f=Array.from(c),console.log("[AdminService] üì® Querying messages from ".concat(f.length," conversations (all types: MPIM, breakout groups, directory, magic intros) in batches of ").concat(m)),h=0;case 4:if(!(h<f.length)){e.n=7;break}return p=f.slice(h,h+m),k=p.map(function(){var e=u(i().m(function e(n){var t,r,a,c;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=g(o,"messages/".concat(n,"/conv")),r=s&&l?y(t,b("timestamp",">=",s),b("timestamp","<=",l)):y(t),e.n=1,S(r);case 1:return a=e.v,e.a(2,a.size);case 2:return e.p=2,c=e.v,console.debug("[AdminService] Could not query messages subcollection for ".concat(n,":"),c),e.a(2,0)}},e,null,[[0,2]])}));return function(n){return e.apply(this,arguments)}}()),e.n=5,Promise.all(k);case 5:w=e.v,d+=w.reduce(function(e,n){return e+n},0),f.length>50&&(h+m)%50==0&&console.log("[AdminService] üì® Processed ".concat(Math.min(h+m,f.length),"/").concat(f.length," conversations"));case 6:h+=m,e.n=4;break;case 7:return console.log("[AdminService] üì® Calculated ".concat(d," total messages sent for community ").concat(n," (includes all conversation types)")),e.a(2,{totalMessagesSent:d});case 8:return e.p=8,C=e.v,console.error("[AdminService] Error calculating message stats:",C),e.a(2,{totalMessagesSent:0})}},e,this,[[0,8]])})),function(e,n,t){return Q.apply(this,arguments)})},{key:"getMessagesFromMatches",value:($=u(i().m(function e(n,t,r){var a,o,c,s,l,d,m,f,h,p,C,I,_,M,T,F,U,D,E,P;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,a=v(),o=a.firestore){e.n=1;break}return console.warn("[AdminService] Firestore not initialized, cannot query messages"),e.a(2,{totalMessagesSent:0});case 1:return console.log("[AdminService] üì® Getting messages from match-based conversations for community ".concat(n)),e.n=2,this.getMatchesForCommunity(n,t,r);case 2:if((c=e.v)&&0!==c.length){e.n=3;break}return console.log("[AdminService] üì® No matches found, returning 0 messages"),e.a(2,{totalMessagesSent:0});case 3:return s=new Set,c.forEach(function(e){var n=e.userId||e.user_id,t=e.matchedUserId||e.matched_user_id;if(n&&t){var r=[n,t].sort(function(e,n){return e-n}).join("-");s.add(r)}}),console.log("[AdminService] üì® Found ".concat(s.size," unique user pairs from ").concat(c.length," matches")),e.n=4,this.getConversationsForCommunity(n);case 4:if(0!==(l=e.v).size){e.n=5;break}return console.log("[AdminService] üì® No conversations found"),e.a(2,{totalMessagesSent:0});case 5:d=new Set,m=10,f=Array.from(l),h=0;case 6:if(!(h<f.length)){e.n=9;break}return p=f.slice(h,h+m),C=p.map(function(){var e=u(i().m(function e(n){var t,r,a,c,l,u,d;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,k(w(o,"messages/".concat(n)));case 1:if(!(t=e.v).exists()){e.n=6;break}if(!(r=t.data()).users||!Array.isArray(r.users)){e.n=6;break}a=r.users.filter(function(e){return"number"==typeof e}),c=0;case 2:if(!(c<a.length)){e.n=6;break}l=c+1;case 3:if(!(l<a.length)){e.n=5;break}if(u=[a[c],a[l]].sort(function(e,n){return e-n}).join("-"),!s.has(u)){e.n=4;break}return e.a(2,n);case 4:l++,e.n=3;break;case 5:c++,e.n=2;break;case 6:return e.a(2,null);case 7:return e.p=7,d=e.v,console.debug("[AdminService] Error checking conversation ".concat(n,":"),d),e.a(2,null)}},e,null,[[0,7]])}));return function(n){return e.apply(this,arguments)}}()),e.n=7,Promise.all(C);case 7:e.v.forEach(function(e){e&&d.add(e)});case 8:h+=m,e.n=6;break;case 9:console.log("[AdminService] üì® Found ".concat(d.size," conversations from ").concat(l.size," total that match user pairs from matches")),I=t?A.fromDate(new Date(t)):null,_=r?A.fromDate(new Date(r)):null,M=0,T=Array.from(d),F=0;case 10:if(!(F<T.length)){e.n=13;break}return U=T.slice(F,F+m),D=U.map(function(){var e=u(i().m(function e(n){var t,r,a,c;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=g(o,"messages/".concat(n,"/conv")),r=I&&_?y(t,b("timestamp",">=",I),b("timestamp","<=",_)):y(t),e.n=1,S(r);case 1:return a=e.v,e.a(2,a.size);case 2:return e.p=2,c=e.v,console.debug("[AdminService] Could not query messages subcollection for ".concat(n,":"),c),e.a(2,0)}},e,null,[[0,2]])}));return function(n){return e.apply(this,arguments)}}()),e.n=11,Promise.all(D);case 11:E=e.v,M+=E.reduce(function(e,n){return e+n},0);case 12:F+=m,e.n=10;break;case 13:return console.log("[AdminService] üì® Calculated ".concat(M," unique messages from match-based conversations (from ").concat(d.size," conversations)")),e.a(2,{totalMessagesSent:M});case 14:return e.p=14,P=e.v,console.error("[AdminService] Error getting messages from matches:",P),e.a(2,{totalMessagesSent:0})}},e,this,[[0,14]])})),function(e,n,t){return $.apply(this,arguments)})},{key:"getEventStats",value:(K=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a="/communities/".concat(n,"/stats/events"),t&&r&&(a+="?startDate=".concat(t,"&endDate=").concat(r)),e.n=1,f.get(a);case 1:return o=e.v,e.a(2,o);case 2:if(e.p=2,404!==(null==(s=e.v)?void 0:s.status)&&404!==(null==s||null===(c=s.response)||void 0===c?void 0:c.status)){e.n=3;break}return console.log("[AdminService] Event stats endpoint not found for community ".concat(n)),e.a(2,null);case 3:return console.error("Failed to fetch event stats:",s),e.a(2,null)}},e,null,[[0,2]])})),function(e,n,t){return K.apply(this,arguments)})},{key:"getGroupStats",value:(J=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a="/communities/".concat(n,"/stats/groups"),t&&r&&(a+="?startDate=".concat(t,"&endDate=").concat(r)),e.n=1,f.get(a);case 1:return o=e.v,e.a(2,o);case 2:if(e.p=2,404!==(null==(s=e.v)?void 0:s.status)&&404!==(null==s||null===(c=s.response)||void 0===c?void 0:c.status)){e.n=3;break}return console.log("[AdminService] Group stats endpoint not found for community ".concat(n)),e.a(2,null);case 3:return console.error("Failed to fetch group stats:",s),e.a(2,null)}},e,null,[[0,2]])})),function(e,n,t){return J.apply(this,arguments)})},{key:"getActiveUserStats",value:(Z=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a="/communities/".concat(n,"/stats/active-users"),t&&r&&(a+="?startDate=".concat(t,"&endDate=").concat(r)),e.n=1,f.get(a);case 1:return o=e.v,e.a(2,o);case 2:if(e.p=2,404!==(null==(s=e.v)?void 0:s.status)&&404!==(null==s||null===(c=s.response)||void 0===c?void 0:c.status)){e.n=3;break}return e.a(2,this.calculateActiveUserStats(n,t,r));case 3:return console.error("Failed to fetch active user stats:",s),e.a(2,null)}},e,this,[[0,2]])})),function(e,n,t){return Z.apply(this,arguments)})},{key:"calculateActiveUserStats",value:(H=u(i().m(function e(n,t,r){var a,o,c,s,l,d,m,f,h,p,g,y,b,S,A,C,I,_,M,T,F,U;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("[AdminService] üë• Starting active user stats calculation for community ".concat(n)),a=new Set,o=new Set,c=r?new Date(r):new Date,(s=new Date(c)).setUTCDate(s.getUTCDate()-1),s.setUTCHours(0,0,0,0),(l=new Date(c)).setUTCDate(l.getUTCDate()-7),l.setUTCHours(0,0,0,0),console.log("[AdminService] üë• Date ranges: daily (>= ".concat(s.toISOString(),"), weekly (>= ").concat(l.toISOString(),")")),e.p=1,e.n=2,this.getMatchesForCommunity(n);case 2:d=e.v,console.log("[AdminService] üë• Found ".concat(d.length," matches for active user calculation")),d.forEach(function(e){var n=e.createdAt||e.created_at;if(n){var t=new Date(n);t>=s&&(e.userId&&a.add(e.userId),e.matchedUserId&&a.add(e.matchedUserId)),t>=l&&(e.userId&&o.add(e.userId),e.matchedUserId&&o.add(e.matchedUserId))}}),console.log("[AdminService] üë• After matches: ".concat(a.size," daily, ").concat(o.size," weekly")),e.n=4;break;case 3:e.p=3,_=e.v,console.warn("[AdminService] Could not get matches for active users:",_);case 4:return e.p=4,e.n=5,this.getEventsForCommunity(n);case 5:m=e.v,console.log("[AdminService] üë• Found ".concat(m.length," events for active user calculation")),m.forEach(function(e){if(e.userId||e.createdBy){var n=e.userId||e.createdBy,t=e.startDate||e.startDateTimeUTC;if(t){var r=new Date(t);r>=s&&a.add(n),r>=l&&o.add(n)}}e.attendees&&Array.isArray(e.attendees)&&e.attendees.forEach(function(n){var t=n.id||n.userId||n;if("number"==typeof t){var r=e.startDate||e.startDateTimeUTC;if(r){var c=new Date(r);c>=s&&a.add(t),c>=l&&o.add(t)}}})}),console.log("[AdminService] üë• After events: ".concat(a.size," daily, ").concat(o.size," weekly")),e.n=7;break;case 6:e.p=6,M=e.v,console.warn("[AdminService] Could not get events for active users:",M);case 7:return e.p=7,e.n=8,this.getGroupsForCommunity(n);case 8:f=e.v,console.log("[AdminService] üë• Found ".concat(f.length," groups for active user calculation")),f.forEach(function(e){e.users&&Array.isArray(e.users)&&e.users.forEach(function(n){var t=n.id||n.userId||n;if("number"==typeof t){var r=e.updatedAt||e.createdAt;if(r){var c=new Date(r);c>=s&&a.add(t),c>=l&&o.add(t)}}})}),console.log("[AdminService] üë• After groups: ".concat(a.size," daily, ").concat(o.size," weekly")),e.n=10;break;case 9:e.p=9,T=e.v,console.warn("[AdminService] Could not get groups for active users:",T);case 10:if(e.p=10,h=v(),!(p=h.firestore)){e.n=14;break}return e.n=11,this.getConversationsForCommunity(n);case 11:g=e.v,console.log("[AdminService] üë• Found ".concat(g.size," conversations for active user calculation")),y=10,b=Array.from(g),S=0;case 12:if(!(S<b.length)){e.n=14;break}return A=b.slice(S,S+y),C=A.map(function(){var e=u(i().m(function e(n){var t,r,c,u,d,m,f;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,k(w(p,"messages/".concat(n)));case 1:(t=e.v).exists()&&(r=t.data()).users&&Array.isArray(r.users)&&(c=r.updatedAt||r.timestamp)&&(u=c.toMillis?new Date(c.toMillis()):new Date(1e3*c.seconds),d=u>=s,m=u>=l,r.users.forEach(function(e){d&&a.add(e),m&&o.add(e)})),e.n=3;break;case 2:e.p=2,f=e.v,console.debug("[AdminService] Error fetching conversation ".concat(n,":"),f);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(n){return e.apply(this,arguments)}}()),e.n=13,Promise.all(C);case 13:S+=y,e.n=12;break;case 14:console.log("[AdminService] üë• After messages: ".concat(a.size," daily, ").concat(o.size," weekly")),e.n=16;break;case 15:e.p=15,F=e.v,console.warn("[AdminService] Could not get messages for active users:",F);case 16:return I={dailyActiveUsers:a.size,weeklyActiveUsers:o.size},console.log("[AdminService] üë• Final active users: ".concat(a.size," daily, ").concat(o.size," weekly")),e.a(2,I);case 17:return e.p=17,U=e.v,console.error("[AdminService] Error calculating active user stats:",U),e.a(2,{dailyActiveUsers:0,weeklyActiveUsers:0})}},e,this,[[10,15],[7,9],[4,6],[1,3],[0,17]])})),function(e,n,t){return H.apply(this,arguments)})},{key:"getProfileCompletionStats",value:(V=u(i().m(function e(n){var t,r,a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,f.get("/communities/".concat(n,"/stats/profile-completion"));case 1:return t=e.v,e.a(2,t);case 2:if(e.p=2,404!==(null==(a=e.v)?void 0:a.status)&&404!==(null==a||null===(r=a.response)||void 0===r?void 0:r.status)){e.n=3;break}return console.log("[AdminService] Profile completion stats endpoint not found for community ".concat(n)),e.a(2,null);case 3:return console.error("Failed to fetch profile completion stats:",a),e.a(2,null)}},e,null,[[0,2]])})),function(e){return V.apply(this,arguments)})},{key:"getMatchResponseStats",value:(G=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a="/communities/".concat(n,"/stats/match-response"),t&&r&&(a+="?startDate=".concat(t,"&endDate=").concat(r)),e.n=1,f.get(a);case 1:return o=e.v,e.a(2,o);case 2:if(e.p=2,404!==(null==(s=e.v)?void 0:s.status)&&404!==(null==s||null===(c=s.response)||void 0===c?void 0:c.status)){e.n=3;break}return console.log("[AdminService] Match response stats endpoint not found for community ".concat(n)),e.a(2,null);case 3:return console.error("Failed to fetch match response stats:",s),e.a(2,null)}},e,null,[[0,2]])})),function(e,n,t){return G.apply(this,arguments)})},{key:"calculateMatchResponseRate",value:(W=u(i().m(function e(n,t,r,a){var o,c,s,l;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t&&0!==t.length){e.n=1;break}return e.a(2,0);case 1:return e.n=2,this.getConversationPairs(n);case 2:return o=e.v,c=0,t.forEach(function(e){var n=e.userId,t=e.matchedUserId;if(n&&t){var r=[n,t].sort(function(e,n){return e-n}).join("-");o.has(r)&&c++}}),s=t.length>0?c/t.length*100:0,console.log("[AdminService] Match response rate: ".concat(s.toFixed(1),"% (").concat(c,"/").concat(t.length," matches led to conversations)")),e.a(2,s);case 3:return e.p=3,l=e.v,console.error("[AdminService] Error calculating match response rate:",l),e.a(2,0)}},e,this,[[0,3]])})),function(e,n,t,r){return W.apply(this,arguments)})},{key:"getConversationPairs",value:(q=u(i().m(function e(n){var t,r,a,o,c,s,l,d,m,f,h;return i().w(function(e){for(;;)switch(e.n){case 0:if(t="conversationPairs_".concat(n),!(r=this.conversationsCache.get(t))||!this.isCacheValid(r.timestamp,this.FIREBASE_CACHE_TTL)){e.n=1;break}return console.log("[AdminService] ‚úÖ Using cached conversation pairs for community ".concat(n)),e.a(2,r.data);case 1:if(a=v(),o=a.firestore){e.n=2;break}return e.a(2,new Set);case 2:return e.n=3,this.getConversationsForCommunity(n);case 3:if(0!==(c=e.v).size){e.n=4;break}return e.a(2,new Set);case 4:s=new Set,l=10,d=Array.from(c),m=0;case 5:if(!(m<d.length)){e.n=7;break}return f=d.slice(m,m+l),h=f.map(function(){var e=u(i().m(function e(n){var t,r,a,c,l,u,d;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,k(w(o,"messages/".concat(n)));case 1:if((t=e.v).exists()&&(r=t.data()).users&&Array.isArray(r.users)&&r.users.length>=2)for(a=r.users.filter(function(e){return"number"==typeof e}),c=0;c<a.length;c++)for(l=c+1;l<a.length;l++)u=[a[c],a[l]].sort(function(e,n){return e-n}).join("-"),s.add(u);e.n=3;break;case 2:e.p=2,d=e.v,console.debug("[AdminService] Error fetching conversation ".concat(n,":"),d);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(n){return e.apply(this,arguments)}}()),e.n=6,Promise.all(h);case 6:m+=l,e.n=5;break;case 7:return this.conversationsCache.set(t,{data:s,timestamp:Date.now()}),e.a(2,s)}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"countEngagedMatches",value:(x=u(i().m(function e(n,t){var r,a,o;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t&&0!==t.length){e.n=1;break}return e.a(2,0);case 1:return e.n=2,this.getConversationPairs(n);case 2:return r=e.v,a=0,t.forEach(function(e){var n=e.userId,t=e.matchedUserId;if(n&&t){var o=[n,t].sort(function(e,n){return e-n}).join("-");r.has(o)&&a++}}),e.a(2,a);case 3:return e.p=3,o=e.v,console.warn("[AdminService] Error counting engaged matches:",o),e.a(2,0)}},e,this,[[0,3]])})),function(e,n){return x.apply(this,arguments)})},{key:"countEngagedMatchesByGroup",value:(R=u(i().m(function e(n,t,r){var a,o,c,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t&&0!==t.length&&0!==r.size){e.n=1;break}return e.a(2,0);case 1:return e.n=2,this.getConversationPairs(n);case 2:return a=e.v,o=new Map,t.forEach(function(e){var n=e.groupId||e.group_id||(e.matchIndicesId&&0!==e.matchIndicesId?e.matchIndicesId:null);if(n&&r.has(n)){var t=e.userId||e.user_id,a=e.matchedUserId||e.matched_user_id;if(t&&a){o.has(n)||o.set(n,new Set);var c=[t,a].sort(function(e,n){return e-n}).join("-");o.get(n).add(c)}}}),c=0,o.forEach(function(e,n){Array.from(e).some(function(e){return a.has(e)})&&c++}),e.a(2,c);case 3:return e.p=3,s=e.v,console.warn("[AdminService] Error counting engaged matches by group:",s),e.a(2,0)}},e,this,[[0,3]])})),function(e,n,t){return R.apply(this,arguments)})},{key:"getTrovaChatsCount",value:(B=u(i().m(function e(t,r,a){var o,c,s,l,d,f,h,p,C,I,_;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,o=v(),c=o.firestore){e.n=1;break}return console.warn("[AdminService] Firestore not initialized, cannot query Trova chats"),e.a(2,0);case 1:return console.log("[AdminService] üí¨ Starting Trova chats calculation for community ".concat(t)),s=r?A.fromDate(new Date(r)):null,l=a?A.fromDate(new Date(a)):null,e.n=2,this.getConversationsForCommunity(t);case 2:if(0!==(d=e.v).size){e.n=3;break}return console.log("[AdminService] üí¨ No conversations found for community ".concat(t)),e.a(2,0);case 3:f=new Set,h=Array.from(d),p=10,console.log("[AdminService] üí¨ Checking ".concat(h.length," conversations for Trova messages in batches of ").concat(p)),C=i().m(function e(){var n,t;return i().w(function(e){for(;;)switch(e.n){case 0:return n=h.slice(I,I+p),t=n.map(function(){var e=u(i().m(function e(n){var t,r,a,o,u,d,f,v,h,p,A,C,I,_,M,T,F,U,D,E,P,j;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,k(w(c,"messages/".concat(n)));case 1:if((t=e.v).exists()){e.n=2;break}return e.a(2,!1);case 2:if(r=t.data(),a=(r.lastMessage||"").toLowerCase(),o=(r.messageTitle||"").toLowerCase(),!a.includes("trova")&&!o.includes("trova")){e.n=5;break}if(!s&&!l){e.n=4;break}if(!(u=r.createdAt)){e.n=3;break}if(d=u.toMillis?u.toMillis():1e3*u.seconds,f=s?s.toMillis():0,v=l?l.toMillis():Date.now(),!(d>=f&&d<=v)){e.n=3;break}return e.a(2,!0);case 3:e.n=5;break;case 4:return e.a(2,!0);case 5:return e.p=5,h=g(c,"messages/".concat(n,"/conv")),p=s&&l?y(h,b("timestamp",">=",s),b("timestamp","<=",l)):y(h),e.n=6,S(p);case 6:A=e.v,C=m(A.docs),e.p=7,C.s();case 8:if((I=C.n()).done){e.n=13;break}if(_=I.value,!((M=_.data()).message||"").toLowerCase().includes("trova")){e.n=12;break}if(!s||!l){e.n=9;break}return e.a(2,!0);case 9:if(!(T=M.timestamp||M.createdAt)){e.n=11;break}if(F=T.toMillis?T.toMillis():1e3*T.seconds,U=s?s.toMillis():0,D=l?l.toMillis():Date.now(),!(F>=U&&F<=D)){e.n=10;break}return e.a(2,!0);case 10:e.n=12;break;case 11:return e.a(2,!0);case 12:e.n=8;break;case 13:e.n=15;break;case 14:e.p=14,E=e.v,C.e(E);case 15:return e.p=15,C.f(),e.f(15);case 16:e.n=18;break;case 17:e.p=17,P=e.v,console.debug("[AdminService] Could not query subcollection for ".concat(n,":"),P);case 18:return e.a(2,!1);case 19:return e.p=19,j=e.v,console.debug("[AdminService] Error checking conversation ".concat(n,":"),j),e.a(2,!1)}},e,null,[[7,14,15,16],[5,17],[0,19]])}));return function(n){return e.apply(this,arguments)}}()),e.n=1,Promise.all(t);case 1:e.v.forEach(function(e,t){e&&f.add(n[t])}),h.length>50&&(I+p)%50==0&&console.log("[AdminService] üí¨ Processed ".concat(Math.min(I+p,h.length),"/").concat(h.length," conversations"));case 2:return e.a(2)}},e)}),I=0;case 4:if(!(I<h.length)){e.n=6;break}return e.d(n(C()),5);case 5:I+=p,e.n=4;break;case 6:return console.log("[AdminService] üí¨ Found ".concat(f.size," Trova-initiated chats for community ").concat(t)),e.a(2,f.size);case 7:return e.p=7,_=e.v,console.error("[AdminService] Error querying Trova chats from Firebase:",_),e.a(2,0)}},e,this,[[0,7]])})),function(e,n,t){return B.apply(this,arguments)})},{key:"getTrovaChats",value:(z=u(i().m(function e(n,t,r){var a,o;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.getTrovaChatsCount(n,t,r);case 1:return a=e.v,e.a(2,{trovaChatsStarted:a});case 2:return e.p=2,o=e.v,console.error("Failed to fetch Trova chats:",o),e.a(2,null)}},e,this,[[0,2]])})),function(e,n,t){return z.apply(this,arguments)})},{key:"exportData",value:(O=u(i().m(function e(n,t,r,a){var o,c,u,d,m,f,v,h,p,g,y,b;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,c="/communities/".concat(n,"/export/").concat(t),r&&a&&(c+="?startDate=".concat(r,"&endDate=").concat(a)),e.n=1,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bV})},void 0);case 1:return u=e.v.default,e.n=2,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bT})},void 0);case 2:return d=e.v,m=d.environment,e.n=3,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bU})},void 0);case 3:if(f=e.v,v=f.useFirebase,h=v(),p={},null===(o=h.auth)||void 0===o||!o.currentUser){e.n=5;break}return e.n=4,h.auth.currentUser.getIdToken();case 4:g=e.v,p.Authorization="Bearer ".concat(g);case 5:return e.n=6,u.get("".concat(m.apiUrl).concat(c),{headers:p,responseType:"blob",withCredentials:!0});case 6:return y=e.v,e.a(2,y.data);case 7:throw e.p=7,b=e.v,console.error("Failed to export data:",b),b;case 8:return e.a(2)}},e,null,[[0,7]])})),function(e,n,t,r){return O.apply(this,arguments)})},{key:"downloadCSV",value:function(e,n){var t=window.URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)}},{key:"getMagicIntrosByDate",value:(L=u(i().m(function e(n,t,r){var a,o,c,s,l,u,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P,j,N,L;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("[AdminService] ‚ú® Fetching magic intros by date for community ".concat(n)),e.n=1,this.getMatchesForCommunity(n,t,r,"trova_magic");case 1:if((a=e.v)&&0!==a.length){e.n=2;break}return e.a(2,[]);case 2:return o=t?new Date(t):null,c=r?new Date(r):null,s=new Map,l=0,u=0,a.forEach(function(e){var n=e.createdAt||e.created_at;if(n){var t;if(t="string"==typeof n?new Date(n):n.toDate?n.toDate():n.seconds?new Date(1e3*n.seconds):new Date(n),isNaN(t.getTime()))return l++,void console.warn("[AdminService] Invalid date for match ".concat(e.id,":"),n);if(o&&t<o)u++;else if(c&&t>c)u++;else{var r=t.toISOString().split("T")[0];if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return l++,void console.warn("[AdminService] Invalid date string format for match ".concat(e.id,":"),r);s.has(r)||s.set(r,[]),s.get(r).push(e)}}else l++}),(l>0||u>0)&&console.log("[AdminService] ‚ú® Filtered ".concat(a.length," matches: ").concat(l," invalid dates, ").concat(u," out of range")),e.n=3,this.getConversationPairs(n);case 3:f=e.v,v=[],h=m(s.entries()),e.p=4,h.s();case 5:if((p=h.n()).done){e.n=15;break}g=d(p.value,2),y=g[0],b=g[1],S=new Date(y),A=S.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),k=new Set,w=new Map,C=m(b),e.p=6,C.s();case 7:if((I=C.n()).done){e.n=10;break}if(_=I.value,M=_.userId||_.user_id,T=_.matchedUserId||_.matched_user_id,M&&T){e.n=8;break}return e.a(3,9);case 8:F=[M,T].sort(function(e,n){return e-n}).join("-"),k.has(F)||(k.add(F),U=f.has(F),w.set(F,U));case 9:e.n=7;break;case 10:e.n=12;break;case 11:e.p=11,j=e.v,C.e(j);case 12:return e.p=12,C.f(),e.f(12);case 13:D=Array.from(w.values()).filter(function(e){return e}).length,E=k.size>0?D/k.size*100:0,console.log("[AdminService] Date ".concat(y,": ").concat(k.size," unique pairs, ").concat(D," engaged (from ").concat(b.length," matches)")),v.push({date:y,dateDisplay:A,totalPairings:k.size,engagedPairings:D,engagementRate:Math.round(10*E)/10});case 14:e.n=5;break;case 15:e.n=17;break;case 16:e.p=16,N=e.v,h.e(N);case 17:return e.p=17,h.f(),e.f(17);case 18:return v.sort(function(e,n){return n.date.localeCompare(e.date)}),(P=v.filter(function(e){return e.totalPairings>1e3})).length>0&&console.warn("[AdminService] ‚ö†Ô∏è Found ".concat(P.length," dates with >1000 pairings (possible data issue):"),P.map(function(e){return"".concat(e.date,": ").concat(e.totalPairings)})),console.log("[AdminService] ‚ú® Found ".concat(v.length," magic intro dates, total pairings: ").concat(v.reduce(function(e,n){return e+n.totalPairings},0))),e.a(2,v);case 19:return e.p=19,L=e.v,console.error("[AdminService] Error fetching magic intros by date:",L),e.a(2,[])}},e,this,[[6,11,12,13],[4,16,17,18],[0,19]])})),function(e,n,t){return L.apply(this,arguments)})},{key:"getMagicIntroPairings",value:(N=u(i().m(function e(n,t,r,a){var c,u,d,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("[AdminService] ‚ú® Fetching pairings for magic intro date ".concat(t)),e.n=1,this.getMatchesForCommunity(n,r,a,"trova_magic");case 1:if((c=e.v)&&0!==c.length){e.n=2;break}return e.a(2,[]);case 2:return u=c.filter(function(e){var n=e.createdAt||e.created_at;return!!n&&("string"==typeof n?new Date(n):n.toDate?n.toDate():n.seconds?new Date(1e3*n.seconds):new Date(n)).toISOString().split("T")[0]===(t.includes("T")?t.split("T")[0]:t)}),e.n=3,this.getConversationPairs(n);case 3:d=e.v,f=new Map,console.log("[AdminService] Processing ".concat(u.length," matches for date ").concat(t)),v=m(u),e.p=4,v.s();case 5:if((h=v.n()).done){e.n=8;break}if(p=h.value,g=p.userId||p.user_id,y=p.matchedUserId||p.matched_user_id,g&&y){e.n=6;break}return console.log("[AdminService] Skipping match ".concat(p.id," - missing userId or matchedUserId")),e.a(3,7);case 6:b=[g,y].sort(function(e,n){return e-n}).join("-"),f.has(b)?console.log("[AdminService] Skipping duplicate pair ".concat(b," (users ").concat(g," and ").concat(y,")")):(S=p.groupId||p.group_id||(p.matchIndicesId&&0!==p.matchIndicesId?p.matchIndicesId:null),A=d.has(b),f.set(b,o(o({},p),{},{id:"pair-".concat(b),groupId:S,userId:g,matchedUserId:y,isEngaged:A})));case 7:e.n=5;break;case 8:e.n=10;break;case 9:e.p=9,T=e.v,v.e(T);case 10:return e.p=10,v.f(),e.f(10);case 11:return k=Array.from(f.values()),console.log("[AdminService] Deduplicated to ".concat(k.length," unique pairings from ").concat(u.length," matches")),w=new Set,k.forEach(function(e){e.userId&&w.add(e.userId),e.matchedUserId&&w.add(e.matchedUserId)}),e.n=12,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bZ})},void 0);case 12:return C=e.v,I=C.userService,e.n=13,I.getUsersByIds(Array.from(w));case 13:return _=e.v,M=k.map(function(e){var n=_.get(e.userId),t=_.get(e.matchedUserId);return o(o({},e),{},{user:n?{id:n.id,fname:n.fname,lname:n.lname,fullName:n.fullName||"".concat(n.fname," ").concat(n.lname),profilePicture:n.profilePicture}:null,matchedUser:t?{id:t.id,fname:t.fname,lname:t.lname,fullName:t.fullName||"".concat(t.fname," ").concat(t.lname),profilePicture:t.profilePicture}:null})}),console.log("[AdminService] ‚ú® Found ".concat(M.length," unique pairings for date ").concat(t," (deduplicated from ").concat(u.length," matches)")),e.a(2,M);case 14:return e.p=14,F=e.v,console.error("[AdminService] Error fetching magic intro pairings:",F),e.a(2,[])}},e,this,[[4,9,10,11],[0,14]])})),function(e,n,t,r){return N.apply(this,arguments)})},{key:"getChannelPairingsByDate",value:(j=u(i().m(function e(t,r,a){var o,c,s,l,u,f,v,h,p,g,y,b,S,A;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("[AdminService] üîó Fetching channel pairings by date for community ".concat(t)),e.n=1,this.getMatchesForCommunity(t,r,a,"channel_pairing");case 1:if((o=e.v)&&0!==o.length){e.n=2;break}return e.a(2,[]);case 2:return c=r?new Date(r):null,s=a?new Date(a):null,l=new Map,u=0,f=0,o.forEach(function(e){var n=e.createdAt||e.created_at;if(n){var t;if(t="string"==typeof n?new Date(n):n.toDate?n.toDate():n.seconds?new Date(1e3*n.seconds):new Date(n),isNaN(t.getTime()))return u++,void console.warn("[AdminService] Invalid date for channel pairing match ".concat(e.id,":"),n);if(c&&t<c)f++;else if(s&&t>s)f++;else{var r=t.toISOString().split("T")[0];if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return u++,void console.warn("[AdminService] Invalid date string format for channel pairing match ".concat(e.id,":"),r);l.has(r)||l.set(r,[]),l.get(r).push(e)}}else u++}),(u>0||f>0)&&console.log("[AdminService] üîó Filtered ".concat(o.length," channel pairing matches: ").concat(u," invalid dates, ").concat(f," out of range")),e.n=3,this.getConversationPairs(t);case 3:v=e.v,h=[],p=m(l.entries()),e.p=4,y=i().m(function e(){var n,r,a,o,c,s,l,u,f,p,y,b,S,A,k,w,C,I,_,M,T;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:n=d(g.value,2),r=n[0],a=n[1],o=new Date(r),c=o.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),s=new Set,a.forEach(function(e){var n,t,r=e.channelName||e.channel_name||e.slackChannelName||e.slack_channel_name||(null===(n=e.channel)||void 0===n?void 0:n.name)||(null===(t=e.slackChannel)||void 0===t?void 0:t.name)||null;r&&s.add(r)}),l=1===s.size?Array.from(s)[0]:null,u=new Set,f=new Map,p=0,y=a.filter(function(e){var n=e.communityId||e.community_id;return!n||n===t||(p++,!1)}),p>0&&console.warn("[AdminService] ‚ö†Ô∏è Filtered out ".concat(p," channel pairing matches with wrong communityId (expected ").concat(t,") for date ").concat(r)),console.log("[AdminService] After community filter for ".concat(r,": ").concat(y.length," matches (from ").concat(a.length," total)")),b=m(y),e.p=1,b.s();case 2:if((S=b.n()).done){e.n=5;break}if(A=S.value,k=A.userId||A.user_id,w=A.matchedUserId||A.matched_user_id,k&&w){e.n=3;break}return e.a(3,4);case 3:C=[k,w].sort(function(e,n){return e-n}).join("-"),u.has(C)||(u.add(C),I=v.has(C),f.set(C,I));case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,T=e.v,b.e(T);case 7:return e.p=7,b.f(),e.f(7);case 8:_=Array.from(f.values()).filter(function(e){return e}).length,M=u.size>0?_/u.size*100:0,h.push({date:r,dateDisplay:c,channelName:l,totalPairings:u.size,engagedPairings:_,engagementRate:Math.round(10*M)/10});case 9:return e.a(2)}},e,null,[[1,6,7,8]])}),p.s();case 5:if((g=p.n()).done){e.n=7;break}return e.d(n(y()),6);case 6:e.n=5;break;case 7:e.n=9;break;case 8:e.p=8,S=e.v,p.e(S);case 9:return e.p=9,p.f(),e.f(9);case 10:return h.sort(function(e,n){return n.date.localeCompare(e.date)}),(b=h.filter(function(e){return e.totalPairings>1e3})).length>0&&console.warn("[AdminService] ‚ö†Ô∏è Found ".concat(b.length," channel pairing dates with >1000 pairings (possible data issue):"),b.map(function(e){return"".concat(e.date,": ").concat(e.totalPairings)})),console.log("[AdminService] üîó Found ".concat(h.length," channel pairing dates, total pairings: ").concat(h.reduce(function(e,n){return e+n.totalPairings},0))),e.a(2,h);case 11:return e.p=11,A=e.v,console.error("[AdminService] Error fetching channel pairings by date:",A),e.a(2,[])}},e,this,[[4,8,9,10],[0,11]])})),function(e,n,t){return j.apply(this,arguments)})},{key:"getChannelPairingPairings",value:(P=u(i().m(function e(n,t,r,a){var c,u,d,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P,j;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("[AdminService] üîó Fetching pairings for channel pairing date ".concat(t)),e.n=1,this.getMatchesForCommunity(n,r,a,"channel_pairing");case 1:if((c=e.v)&&0!==c.length){e.n=2;break}return e.a(2,[]);case 2:return u=c.filter(function(e){var n=e.createdAt||e.created_at;return!!n&&("string"==typeof n?new Date(n):n.toDate?n.toDate():n.seconds?new Date(1e3*n.seconds):new Date(n)).toISOString().split("T")[0]===(t.includes("T")?t.split("T")[0]:t)}),e.n=3,this.getConversationPairs(n);case 3:d=e.v,f=new Map,console.log("[AdminService] Processing ".concat(u.length," channel pairing matches for date ").concat(t)),u.length>0&&console.log("[AdminService] Sample channel pairing match:",{id:u[0].id,userId:u[0].userId,user_id:u[0].user_id,matchedUserId:u[0].matchedUserId,matched_user_id:u[0].matched_user_id,communityId:u[0].communityId,community_id:u[0].community_id,type:u[0].type,matchType:u[0].matchType,fullMatch:u[0]}),v=0,h=u.filter(function(e){var t=e.communityId||e.community_id;return!t||t===n||(v++,!1)}),v>0&&console.warn("[AdminService] ‚ö†Ô∏è Filtered out ".concat(v," channel pairing matches with wrong communityId (expected ").concat(n,")")),console.log("[AdminService] After community filter: ".concat(h.length," matches (from ").concat(u.length," total)")),u.length>0&&console.log("[AdminService] üîç Sample channel pairing match structure:",{keys:Object.keys(u[0]),sampleMatch:u[0],hasChannelName:!!u[0].channelName,hasChannel_name:!!u[0].channel_name,hasSlackChannelName:!!u[0].slackChannelName,hasSlack_channel_name:!!u[0].slack_channel_name,hasChannel:!!u[0].channel,hasSlackChannel:!!u[0].slackChannel,hasSlack_channel_id:!!u[0].slack_channel_id,hasSlackChannelId:!!u[0].slackChannelId,groupId:u[0].groupId||u[0].group_id}),p=m(h),e.p=4,p.s();case 5:if((g=p.n()).done){e.n=8;break}if(y=g.value,b=y.userId||y.user_id,S=y.matchedUserId||y.matched_user_id,b&&S){e.n=6;break}return console.log("[AdminService] Skipping channel pairing match ".concat(y.id," - missing userId or matchedUserId")),e.a(3,7);case 6:A=[b,S].sort(function(e,n){return e-n}).join("-"),f.has(A)?console.log("[AdminService] Skipping duplicate channel pairing pair ".concat(A," (users ").concat(b," and ").concat(S,")")):(C=y.groupId||y.group_id||(y.matchIndicesId&&0!==y.matchIndicesId?y.matchIndicesId:null),I=y.channelName||y.channel_name||y.slackChannelName||y.slack_channel_name||(null===(k=y.channel)||void 0===k?void 0:k.name)||(null===(w=y.slackChannel)||void 0===w?void 0:w.name)||null,_=d.has(A),f.set(A,o(o({},y),{},{id:"pair-".concat(A),groupId:C,userId:b,matchedUserId:S,isEngaged:_,channelName:I})));case 7:e.n=5;break;case 8:e.n=10;break;case 9:e.p=9,P=e.v,p.e(P);case 10:return e.p=10,p.f(),e.f(10);case 11:return M=Array.from(f.values()),console.log("[AdminService] Deduplicated to ".concat(M.length," unique channel pairing pairings from ").concat(u.length," matches")),M.length>0&&console.log("[AdminService] üîç Sample pairing structure for channel name extraction:",{keys:Object.keys(M[0]),samplePairing:M[0],hasChannelName:!!M[0].channelName,hasChannel_name:!!M[0].channel_name,hasSlackChannelName:!!M[0].slackChannelName,hasSlack_channel_name:!!M[0].slack_channel_name,hasChannel:!!M[0].channel,hasSlackChannel:!!M[0].slackChannel,hasSlack_channel_id:!!M[0].slack_channel_id,hasSlackChannelId:!!M[0].slackChannelId,groupId:M[0].groupId||M[0].group_id}),T=new Set,M.forEach(function(e){e.userId&&T.add(e.userId),e.matchedUserId&&T.add(e.matchedUserId)}),e.n=12,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bZ})},void 0);case 12:return F=e.v,U=F.userService,e.n=13,U.getUsersByIds(Array.from(T));case 13:return D=e.v,E=M.map(function(e){var n,t,r=D.get(e.userId),a=D.get(e.matchedUserId),c=e.channelName||e.channel_name||e.slackChannelName||e.slack_channel_name||(null===(n=e.channel)||void 0===n?void 0:n.name)||(null===(t=e.slackChannel)||void 0===t?void 0:t.name)||null;return o(o({},e),{},{channelName:c,user:r?{id:r.id,fname:r.fname,lname:r.lname,fullName:r.fullName||"".concat(r.fname," ").concat(r.lname),profilePicture:r.profilePicture}:null,matchedUser:a?{id:a.id,fname:a.fname,lname:a.lname,fullName:a.fullName||"".concat(a.fname," ").concat(a.lname),profilePicture:a.profilePicture}:null})}),console.log("[AdminService] üîó Found ".concat(E.length," unique channel pairing pairings for date ").concat(t," (deduplicated from ").concat(u.length," matches)")),e.a(2,E);case 14:return e.p=14,j=e.v,console.error("[AdminService] Error fetching channel pairing pairings:",j),e.a(2,[])}},e,this,[[4,9,10,11],[0,14]])})),function(e,n,t,r){return P.apply(this,arguments)})},{key:"getMentorMenteeMatchesByDate",value:(E=u(i().m(function e(t,r,a){var o,c,s,l,u,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,console.log("[AdminService] üéì Fetching mentor/mentee matches by date for community ".concat(t),{startDate:r,endDate:a}),o=["mentor-mentee","mentor_mentee","mentor-match","mentor_mentee_match"],c=[],s=!1,l=new Set,u=0,f=o;case 1:if(!(u<f.length)){e.n=5;break}return v=f[u],console.log("[AdminService] üéì Trying type: ".concat(v)),e.n=2,this.getMatchesForCommunity(t,r,a,v);case 2:if(!((h=e.v)&&h.length>0)){e.n=3;break}return console.log("[AdminService] ‚úÖ Found ".concat(h.length," matches with type: ").concat(v)),c=h,e.a(3,5);case 3:console.log("[AdminService] ‚ö†Ô∏è No matches found with type: ".concat(v));case 4:u++,e.n=1;break;case 5:if(c&&0!==c.length){e.n=8;break}return console.log("[AdminService] üéì No matches found with type filter, trying fallback: fetch all matches and filter client-side"),e.n=6,this.getMatchesForCommunity(t,r,a);case 6:return p=e.v,console.log("[AdminService] üéì Also fetching all-time matches (no date restrictions) to check for mentor/mentee matches outside date range"),e.n=7,this.getMatchesForCommunity(t);case 7:g=e.v,y=new Map,p&&p.forEach(function(e){return y.set(e.id,e)}),g&&g.forEach(function(e){return y.set(e.id,e)}),p=Array.from(y.values()),console.log("[AdminService] üéì Combined ".concat(p.length," total matches (").concat(p.length-((null==g?void 0:g.length)||0)," from date range, ").concat((null==g?void 0:g.length)||0," from all-time)")),p&&p.length>0&&(console.log("[AdminService] üéì Fetched ".concat(p.length," total matches, filtering for mentor/mentee types...")),b=new Set,S=new Set,p.forEach(function(e){e.type&&l.add(e.type),e.matchType&&b.add(e.matchType),(e.sub_type||e.subType)&&S.add(e.sub_type||e.subType)}),console.log("[AdminService] üéì DEBUG: Found unique type values:",Array.from(l)),console.log("[AdminService] üéì DEBUG: Found unique matchType values:",Array.from(b)),console.log("[AdminService] üéì DEBUG: Found unique sub_type values:",Array.from(S)),A=Array.from(l).some(function(e){var n=e.toLowerCase();return n.includes("mentor")||n.includes("mentee")}),Array.from(l).length>0&&!A&&(s=!0,console.warn("[AdminService] ‚ö†Ô∏è No mentor/mentee types found in response. Found types: ".concat(Array.from(l).join(", "))),console.warn("[AdminService] ‚ö†Ô∏è This might indicate: (1) No mentor/mentee matches in date range, (2) Backend filtering issue, or (3) Type mismatch")),c=p.filter(function(e){var n=e.type||e.matchType,t=e.sub_type||e.subType;if(n){var r=n.toLowerCase();if(r.includes("mentor")||r.includes("mentee"))return!0}if(t){var a=t.toLowerCase();if(a.includes("mentor")||a.includes("mentee"))return!0}return!1}),console.log("[AdminService] üéì Filtered to ".concat(c.length," mentor/mentee matches from ").concat(p.length," total matches")),c.length>0?console.log("[AdminService] üéì DEBUG: Sample mentor/mentee match:",c[0]):console.log("[AdminService] üéì DEBUG: No mentor/mentee matches found. Sample matches:",p.slice(0,3).map(function(e){return{id:e.id,type:e.type,matchType:e.matchType,sub_type:e.sub_type||e.subType,userId:e.userId,matchedUserId:e.matchedUserId}})));case 8:if(c&&0!==c.length){e.n=9;break}return console.warn("[AdminService] ‚ö†Ô∏è No mentor/mentee matches found. Tried type variations: ".concat(o.join(", ")," and client-side filtering")),!s&&l.size>0&&(s=!Array.from(l).some(function(e){return e.toLowerCase().includes("mentor")||e.toLowerCase().includes("mentee")})),e.a(2,{matches:[],hasBackendIssue:s});case 9:return console.log("[AdminService] üéì Processing ".concat(c.length," mentor/mentee matches")),k=r?new Date(r):null,w=a?new Date(a):null,C=new Map,I=0,_=0,c.forEach(function(e){var n=e.createdAt||e.created_at;if(n){var t;if(t="string"==typeof n?new Date(n):n.toDate?n.toDate():n.seconds?new Date(1e3*n.seconds):new Date(n),isNaN(t.getTime()))return I++,void console.warn("[AdminService] Invalid date for mentor/mentee match ".concat(e.id,":"),n);if(k&&t<k)_++;else if(w&&t>w)_++;else{var r=t.toISOString().split("T")[0];if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return I++,void console.warn("[AdminService] Invalid date string format for mentor/mentee match ".concat(e.id,":"),r);C.has(r)||C.set(r,[]),C.get(r).push(e)}}else I++}),(I>0||_>0)&&console.log("[AdminService] üéì Filtered ".concat(c.length," mentor/mentee matches: ").concat(I," invalid dates, ").concat(_," out of range")),e.n=10,this.getConversationPairs(t);case 10:M=e.v,T=[],F=m(C.entries()),e.p=11,D=i().m(function e(){var n,r,a,o,c,s,l,u,f,v,h,p,g,y,b,S,A,k,w;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:n=d(U.value,2),r=n[0],a=n[1],o=new Date(r),c=o.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),s=new Set,l=new Map,u=0,f=a.filter(function(e){var n=e.communityId||e.community_id;return!n||n===t||(u++,!1)}),u>0&&console.warn("[AdminService] ‚ö†Ô∏è Filtered out ".concat(u," mentor/mentee matches with wrong communityId (expected ").concat(t,") for date ").concat(r)),console.log("[AdminService] After community filter for ".concat(r,": ").concat(f.length," matches (from ").concat(a.length," total)")),v=m(f),e.p=1,v.s();case 2:if((h=v.n()).done){e.n=5;break}if(p=h.value,g=p.userId||p.user_id,y=p.matchedUserId||p.matched_user_id,g&&y){e.n=3;break}return e.a(3,4);case 3:b=[g,y].sort(function(e,n){return e-n}).join("-"),s.has(b)||(s.add(b),S=M.has(b),l.set(b,S));case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,w=e.v,v.e(w);case 7:return e.p=7,v.f(),e.f(7);case 8:A=Array.from(l.values()).filter(function(e){return e}).length,k=s.size>0?A/s.size*100:0,console.log("[AdminService] Mentor/Mentee Date ".concat(r,": ").concat(s.size," unique pairs, ").concat(A," engaged (from ").concat(a.length," matches)")),T.push({date:r,dateDisplay:c,totalPairings:s.size,engagedPairings:A,engagementRate:Math.round(10*k)/10});case 9:return e.a(2)}},e,null,[[1,6,7,8]])}),F.s();case 12:if((U=F.n()).done){e.n=14;break}return e.d(n(D()),13);case 13:e.n=12;break;case 14:e.n=16;break;case 15:e.p=15,E=e.v,F.e(E);case 16:return e.p=16,F.f(),e.f(16);case 17:return T.sort(function(e,n){return n.date.localeCompare(e.date)}),console.log("[AdminService] üéì Found ".concat(T.length," mentor/mentee match dates, total pairings: ").concat(T.reduce(function(e,n){return e+n.totalPairings},0))),e.a(2,{matches:T,hasBackendIssue:s});case 18:return e.p=18,P=e.v,console.error("[AdminService] Error fetching mentor/mentee matches by date:",P),e.a(2,{matches:[],hasBackendIssue:!1})}},e,this,[[11,15,16,17],[0,18]])})),function(e,n,t){return E.apply(this,arguments)})},{key:"getMentorMenteeUsersWithMatches",value:(D=u(i().m(function e(n,t,r){var a,o,c,u,m,f,v,h,p,g,y,b,S,A;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,console.log("[AdminService] üéì Fetching users with mentor/mentee matches for community ".concat(n)),a=[],o=0,c=["mentor-mentee","mentor_mentee","mentor-match","mentor_mentee_match"];case 1:if(!(o<c.length)){e.n=4;break}return u=c[o],e.n=2,this.getMatchesForCommunity(n,t,r,u);case 2:if(!((m=e.v)&&m.length>0)){e.n=3;break}return console.log("[AdminService] ‚úÖ Found ".concat(m.length," matches with type: ").concat(u)),a=m,e.a(3,4);case 3:o++,e.n=1;break;case 4:if(a&&0!==a.length){e.n=6;break}return e.n=5,this.getMatchesForCommunity(n,t,r);case 5:(f=e.v)&&f.length>0&&(a=f.filter(function(e){var n=e.type||e.matchType,t=e.sub_type||e.subType;if(n){var r=n.toLowerCase();if(r.includes("mentor")||r.includes("mentee"))return!0}if(t){var a=t.toLowerCase();if(a.includes("mentor")||a.includes("mentee"))return!0}return!1}));case 6:if(a&&0!==a.length){e.n=7;break}return console.warn("[AdminService] ‚ö†Ô∏è No mentor/mentee matches found"),e.a(2,[]);case 7:return v=a.filter(function(e){return e.communityId===n}),h=new Map,v.forEach(function(e){var n=e.userId||e.user_id;n&&h.set(n,(h.get(n)||0)+1)}),p=Array.from(h.keys()),e.n=8,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bZ})},void 0);case 8:return g=e.v,y=g.userService,e.n=9,y.getUsersByIds(p);case 9:return b=e.v,S=Array.from(h.entries()).map(function(e){var n=d(e,2),t=n[0],r=n[1],a=b.get(t);return{userId:t,userName:a&&(a.fullName||"".concat(a.fname||""," ").concat(a.lname||"").trim())||"User ".concat(t),matchCount:r}}).sort(function(e,n){return n.matchCount-e.matchCount}),console.log("[AdminService] üéì Found ".concat(S.length," users with mentor/mentee matches")),e.a(2,S);case 10:return e.p=10,A=e.v,console.error("[AdminService] Error fetching users with mentor/mentee matches:",A),e.a(2,[])}},e,this,[[0,10]])})),function(e,n,t){return D.apply(this,arguments)})},{key:"getMentorMenteeMatchesForUser",value:(U=u(i().m(function e(n,t,r,a){var o,u,d,m,f,v,h,p,g,y,b,S,A;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,console.log("[AdminService] üéì Fetching mentor/mentee matches for user ".concat(t)),o=[],u=0,d=["mentor-mentee","mentor_mentee","mentor-match","mentor_mentee_match"];case 1:if(!(u<d.length)){e.n=4;break}return m=d[u],e.n=2,this.getMatchesForCommunity(n,r,a,m);case 2:if(!((f=e.v)&&f.length>0)){e.n=3;break}return o=f,e.a(3,4);case 3:u++,e.n=1;break;case 4:if(o&&0!==o.length){e.n=6;break}return e.n=5,this.getMatchesForCommunity(n,r,a);case 5:(v=e.v)&&v.length>0&&(o=v.filter(function(e){var n=e.type||e.matchType,t=e.sub_type||e.subType;if(n){var r=n.toLowerCase();if(r.includes("mentor")||r.includes("mentee"))return!0}if(t){var a=t.toLowerCase();if(a.includes("mentor")||a.includes("mentee"))return!0}return!1}));case 6:if(o&&0!==o.length){e.n=7;break}return e.a(2,[]);case 7:return h=o.filter(function(e){var r=e.userId||e.user_id,a=e.matchedUserId||e.matched_user_id||e.otherUserId||e.other_user_id;return r===t&&a&&e.communityId===n}),p=c(new Set(h.map(function(e){return e.matchedUserId||e.matched_user_id||e.otherUserId||e.other_user_id}).filter(Boolean))),e.n=8,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bZ})},void 0);case 8:return g=e.v,y=g.userService,e.n=9,y.getUsersByIds(p);case 9:return b=e.v,S=h.map(function(e){var n=e.matchedUserId||e.matched_user_id||e.otherUserId||e.other_user_id,t=b.get(n),r=t&&(t.fullName||"".concat(t.fname||""," ").concat(t.lname||"").trim())||"User ".concat(n),a=e.sub_type||e.subType||"",o=a.toLowerCase(),c=o.includes("mentor-did-not-request")||o.includes("mentor-that-requested"),i=!c;return{id:e.id,matchedUserId:n,matchedUserName:r,createdAt:e.createdAt||e.created_at,subType:a,userWasMentor:c,userWasMentee:i}}).sort(function(e,n){return new Date(n.createdAt).getTime()-new Date(e.createdAt).getTime()}),console.log("[AdminService] üéì Found ".concat(S.length," mentor/mentee matches for user ").concat(t)),e.a(2,S);case 10:return e.p=10,A=e.v,console.error("[AdminService] Error fetching mentor/mentee matches for user:",A),e.a(2,[])}},e,this,[[0,10]])})),function(e,n,t,r){return U.apply(this,arguments)})},{key:"getUsersWithConnections",value:(F=u(i().m(function e(n,t,r){var a,o,c,u,m,f,v,h,p,g,y,b,S,A;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("[AdminService] üîó Fetching users with connections for community ".concat(n)),e.n=1,this.getMatchesForCommunity(n,t,r);case 1:if((a=e.v)&&0!==a.length){e.n=2;break}return console.warn("[AdminService] ‚ö†Ô∏è No matches found"),e.a(2,[]);case 2:return o=a.filter(function(e){var t=e.userId||e.user_id,r=e.matchedUserId||e.matched_user_id||e.otherUserId||e.other_user_id,a=(e.type||e.matchType||"").toLowerCase();return!a.includes("mentor")&&!a.includes("mentee")&&t&&r&&e.communityId===n}),c=new Map,u=new Map,m=[],o.forEach(function(e){var n=e.groupId||e.group_id||(e.matchIndicesId&&0!==e.matchIndicesId?e.matchIndicesId:null);if(null!=n){var t=String(n);u.has(t)||u.set(t,[]),u.get(t).push(e)}else m.push(e)}),u.forEach(function(e){var n=new Set;e.forEach(function(e){var t=e.userId||e.user_id,r=e.matchedUserId||e.matched_user_id||e.otherUserId||e.other_user_id;t&&n.add(t),r&&n.add(r)});var t=Array.from(n);t.forEach(function(e){c.has(e)||c.set(e,new Set),t.forEach(function(n){e!==n&&c.get(e).add(n)})})}),m.forEach(function(e){var n=e.userId||e.user_id,t=e.matchedUserId||e.matched_user_id||e.otherUserId||e.other_user_id;n&&t&&(c.has(n)||c.set(n,new Set),c.get(n).add(t),c.has(t)||c.set(t,new Set),c.get(t).add(n))}),f=Array.from(c.keys()),e.n=3,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bZ})},void 0);case 3:v=e.v,h=v.userService,p=50,g=new Map,y=0;case 4:if(!(y<f.length)){e.n=7;break}return b=f.slice(y,y+p),e.n=5,h.getUsersByIds(b);case 5:e.v.forEach(function(e,n){g.set(n,e)});case 6:y+=p,e.n=4;break;case 7:return S=Array.from(c.entries()).map(function(e){var n=d(e,2),t=n[0],r=n[1],a=g.get(t);return{userId:t,userName:a&&(a.fullName||"".concat(a.fname||""," ").concat(a.lname||"").trim())||"User ".concat(t),connectionCount:r.size}}).filter(function(e){return e.connectionCount>0}).sort(function(e,n){return n.connectionCount-e.connectionCount}),console.log("[AdminService] üîó Found ".concat(S.length," users with connections")),e.a(2,S);case 8:return e.p=8,A=e.v,console.error("[AdminService] Error fetching users with connections:",A),e.a(2,[])}},e,this,[[0,8]])})),function(e,n,t){return F.apply(this,arguments)})},{key:"getConnectionsForUser",value:(T=u(i().m(function e(n,t,r,a){var o,c,u,m,f,v,h,p,g,y,b,S;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("[AdminService] üîó Fetching connections for user ".concat(t)),e.n=1,this.getMatchesForCommunity(n,r,a);case 1:if((o=e.v)&&0!==o.length){e.n=2;break}return e.a(2,[]);case 2:return c=o.filter(function(e){var r=e.userId||e.user_id,a=e.matchedUserId||e.matched_user_id||e.otherUserId||e.other_user_id,o=(e.type||e.matchType||"").toLowerCase();return!o.includes("mentor")&&!o.includes("mentee")&&(r===t||a===t)&&r&&a&&e.communityId===n}),u=new Map,c.forEach(function(e){var n=e.userId||e.user_id,r=e.matchedUserId||e.matched_user_id||e.otherUserId||e.other_user_id,a=n===t?r:n;if(a&&a!==t)if(u.has(a)){var o=u.get(a),c=new Date(o.createdAt||o.created_at||0);new Date(e.createdAt||e.created_at||0)<c&&u.set(a,e)}else u.set(a,e)}),m=Array.from(u.keys()),e.n=3,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bZ})},void 0);case 3:f=e.v,v=f.userService,h=50,p=new Map,g=0;case 4:if(!(g<m.length)){e.n=7;break}return y=m.slice(g,g+h),e.n=5,v.getUsersByIds(y);case 5:e.v.forEach(function(e,n){p.set(n,e)});case 6:g+=h,e.n=4;break;case 7:return b=Array.from(u.entries()).map(function(e){var n=d(e,2),r=n[0],a=n[1],o=p.get(r),c=o&&(o.fullName||"".concat(o.fname||""," ").concat(o.lname||"").trim())||"User ".concat(r);return{id:a.id||"connection-".concat(t,"-").concat(r),connectedUserId:r,connectedUserName:c,createdAt:a.createdAt||a.created_at||"",matchType:a.type||a.matchType}}).sort(function(e,n){var t=new Date(e.createdAt).getTime();return new Date(n.createdAt).getTime()-t}),console.log("[AdminService] üîó Found ".concat(b.length," connections for user ").concat(t)),e.a(2,b);case 8:return e.p=8,S=e.v,console.error("[AdminService] Error fetching connections for user:",S),e.a(2,[])}},e,this,[[0,8]])})),function(e,n,t,r){return T.apply(this,arguments)})},{key:"getMentorMenteeMatchPairings",value:(M=u(i().m(function e(n,t,r,a){var c,u,d,f,v,h,p,g,y,b,S,A,k,w,C,I,_,M,T,F,U,D,E,P,j,N;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,console.log("[AdminService] üéì Fetching pairings for mentor/mentee match date ".concat(t)),c=[],u=0,d=["mentor-mentee","mentor_mentee","mentor-match","mentor_mentee_match"];case 1:if(!(u<d.length)){e.n=4;break}return f=d[u],e.n=2,this.getMatchesForCommunity(n,r,a,f);case 2:if(!((v=e.v)&&v.length>0)){e.n=3;break}return console.log("[AdminService] ‚úÖ Found ".concat(v.length," matches with type: ").concat(f)),c=v,e.a(3,4);case 3:u++,e.n=1;break;case 4:if(c&&0!==c.length){e.n=6;break}return console.log("[AdminService] üéì No matches found with type filter, trying fallback: fetch all matches and filter client-side"),e.n=5,this.getMatchesForCommunity(n,r,a);case 5:(h=e.v)&&h.length>0&&(c=h.filter(function(e){var n=e.type||e.matchType,t=e.sub_type||e.subType;if(n){var r=n.toLowerCase();if(r.includes("mentor")||r.includes("mentee"))return!0}if(t){var a=t.toLowerCase();if(a.includes("mentor")||a.includes("mentee"))return!0}return!1}),console.log("[AdminService] üéì Filtered to ".concat(c.length," mentor/mentee matches from ").concat(h.length," total matches")));case 6:if(c&&0!==c.length){e.n=7;break}return console.warn("[AdminService] ‚ö†Ô∏è No mentor/mentee matches found with any type variation or client-side filtering"),e.a(2,[]);case 7:return p=c.filter(function(e){var n=e.createdAt||e.created_at;return!!n&&("string"==typeof n?new Date(n):n.toDate?n.toDate():n.seconds?new Date(1e3*n.seconds):new Date(n)).toISOString().split("T")[0]===(t.includes("T")?t.split("T")[0]:t)}),e.n=8,this.getConversationPairs(n);case 8:g=e.v,y=new Map,console.log("[AdminService] Processing ".concat(p.length," mentor/mentee matches for date ").concat(t)),b=0,S=p.filter(function(e){var t=e.communityId||e.community_id;return!t||t===n||(b++,!1)}),b>0&&console.warn("[AdminService] ‚ö†Ô∏è Filtered out ".concat(b," mentor/mentee matches with wrong communityId (expected ").concat(n,")")),console.log("[AdminService] After community filter: ".concat(S.length," matches (from ").concat(p.length," total)")),A=m(S),e.p=9,A.s();case 10:if((k=A.n()).done){e.n=13;break}if(w=k.value,C=w.userId||w.user_id,I=w.matchedUserId||w.matched_user_id,C&&I){e.n=11;break}return e.a(3,12);case 11:_=[C,I].sort(function(e,n){return e-n}).join("-"),y.has(_)||(M=g.has(_),y.set(_,o(o({},w),{},{id:"pair-".concat(_),userId:C,matchedUserId:I,isEngaged:M})));case 12:e.n=10;break;case 13:e.n=15;break;case 14:e.p=14,j=e.v,A.e(j);case 15:return e.p=15,A.f(),e.f(15);case 16:return T=Array.from(y.values()),console.log("[AdminService] Deduplicated to ".concat(T.length," unique mentor/mentee pairings from ").concat(p.length," matches")),F=new Set,T.forEach(function(e){e.userId&&F.add(e.userId),e.matchedUserId&&F.add(e.matchedUserId)}),e.n=17,l(function(){return s.import("./index-legacy-D3_iwoP0.js").then(function(e){return e.bZ})},void 0);case 17:return U=e.v,D=U.userService,e.n=18,D.getUsersByIds(Array.from(F));case 18:return E=e.v,P=T.map(function(e){var n=E.get(e.userId),t=E.get(e.matchedUserId);return o(o({},e),{},{user:n?{id:n.id,fname:n.fname,lname:n.lname,fullName:n.fullName||"".concat(n.fname," ").concat(n.lname),profilePicture:n.profilePicture}:null,matchedUser:t?{id:t.id,fname:t.fname,lname:t.lname,fullName:t.fullName||"".concat(t.fname," ").concat(t.lname),profilePicture:t.profilePicture}:null})}),console.log("[AdminService] üéì Found ".concat(P.length," unique mentor/mentee pairings for date ").concat(t," (deduplicated from ").concat(p.length," matches)")),e.a(2,P);case 19:return e.p=19,N=e.v,console.error("[AdminService] Error fetching mentor/mentee match pairings:",N),e.a(2,[])}},e,this,[[9,14,15,16],[0,19]])})),function(e,n,t,r){return M.apply(this,arguments)})}],I&&h(a.prototype,I),_&&h(a,_),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,I,_,M,T,F,U,D,E,P,j,N,L,O,z,B,R,x,q,W,G,V,H,Z,J,K,$,Q,Y,X,ee,ne,te,re,ae,oe,ce,ie,se,le,ue,de,me,fe,ve,he,pe,ge,ye,be,Se,Ae,ke,we,Ce,Ie,_e,Me,Te,Fe,Ue,De,Ee,Pe,je,Ne,Le,Oe,ze,Be,Re,xe,qe,We,Ge,Ve,He,Ze,Je,Ke,$e,Qe,Ye,Xe,en}();a("AdminService",I);a("adminService",new I)}}})}();
