!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,n,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function c(e,r,o,i){var c=r&&r.prototype instanceof l?r:l,u=Object.create(c.prototype);return a(u,"_invoke",function(e,a,r){var o,i,c,l=0,u=r||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,a){return o=e,i=0,c=t,p.n=a,s}};function f(e,a){for(i=e,c=a,n=0;!d&&l&&!r&&n<u.length;n++){var r,o=u[n],f=p.p,v=o[2];e>3?(r=v===a)&&(c=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=e<2&&f<o[1])?(i=0,p.v=a,p.n=o[1]):f<v&&(r=e<3||o[0]>a||a>v)&&(o[4]=e,o[5]=a,p.n=v,i=0))}if(r||e>1)return s;throw d=!0,a}return function(r,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),i=u,c=v;(n=i<2?t:c)||!d;){o||(i?i<3?(i>1&&(p.n=-1),f(i,c)):p.n=c:p.v=c);try{if(l=2,o){if(i||(r="next"),n=o[r]){if(!(n=n.call(o,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,i<2&&(i=0)}else 1===i&&(n=o.return)&&n.call(o),i<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),i=1);o=t}else if((n=(d=p.n<0)?c:e.call(a,p))!==s)break}catch(n){o=t,i=1,c=n}finally{l=1}}return{value:n,done:d}}}(e,o,i),!0),u}var s={};function l(){}function u(){}function d(){}n=Object.getPrototypeOf;var p=[][o]?n(n([][o]())):(a(n={},o,function(){return this}),n),f=d.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=d,a(f,"constructor",d),a(d,"constructor",u),u.displayName="GeneratorFunction",a(d,i,"GeneratorFunction"),a(f),a(f,i,"Generator"),a(f,o,function(){return this}),a(f,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:v}})()}function a(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}a=function(e,t,n,r){function i(t,n){a(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},a(e,t,n,r)}function t(e,a,t,n,r,o,i){try{var c=e[o](i),s=c.value}catch(e){return void t(e)}c.done?a(s):Promise.resolve(s).then(n,r)}function n(e){return function(){var a=this,n=arguments;return new Promise(function(r,o){var i=e.apply(a,n);function c(e){t(i,r,o,c,s,"next",e)}function s(e){t(i,r,o,c,s,"throw",e)}c(void 0)})}}function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,a){if(e){if("string"==typeof e)return o(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,a):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=Array(a);t<a;t++)n[t]=e[t];return n}System.register(["./ChatThread-legacy-CXmiF0B3.js","./index-legacy-D3_iwoP0.js","./profile.service-legacy-D-F1sSvx.js"],function(a,t){"use strict";var o,i,c,s,l,u,d,p,f,v,m,b,g,x,h,y,w,k,C,j,S,_,z,L,M,T,O,I,N,P,U,A,F,G,E,R,D,V;return{setters:[function(e){o=e.u,i=e.C},function(e){c=e.F,s=e.a1,l=e.r,u=e.a2,d=e.G,p=e.a3,f=e.o,v=e.a4,m=e.I,b=e.J,g=e.L,x=e.M,h=e.N,y=e.Y,w=e.O,k=e.a5,C=e.Z,j=e.a6,S=e.a7,_=e.a8,z=e.a9,L=e.aa,M=e.ab,T=e.Q,O=e.R,I=e.ac,N=e.ad,P=e.ae,U=e.X,A=e.W,F=e.af,G=e.ag,E=e.ah,R=e.ai,D=e.a0},function(e){V=e.profileService}],execute:function(){var t=document.createElement("style");t.textContent='.messages-content[data-v-3ebae4c1]{--background: #f8fafc;--padding-top: 56px}.conversations-container[data-v-3ebae4c1]{padding:32px 16px 16px;max-width:100%;margin:0 auto;height:100%}@media (min-width: 768px){.conversations-container[data-v-3ebae4c1]{max-width:800px;padding:24px}.header-title[data-v-3ebae4c1]{font-size:28px}}@media (min-width: 1024px){.conversations-container[data-v-3ebae4c1]{max-width:900px;padding:32px}}.search-container[data-v-3ebae4c1]{margin-bottom:16px}.conversations-search[data-v-3ebae4c1]{--background: #ffffff;--border-radius: 12px;--box-shadow: 0 2px 8px rgba(0, 0, 0, .04);--placeholder-color: #94a3b8;--icon-color: #64748b;padding:0}.loading-container[data-v-3ebae4c1]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:64px 16px;color:#64748b}.empty-state[data-v-3ebae4c1]{text-align:center;padding:64px 16px;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh}.empty-icon[data-v-3ebae4c1]{width:100px;height:100px;margin:0 auto 32px;background:linear-gradient(135deg,rgba(45,122,78,.1),rgba(29,185,138,.1));border-radius:24px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(45,122,78,.1)}.empty-icon ion-icon[data-v-3ebae4c1]{font-size:48px;color:var(--color-primary)}.empty-title[data-v-3ebae4c1]{font-size:24px;font-weight:700;color:#1a1a1a;margin:0 0 12px}.empty-description[data-v-3ebae4c1]{font-size:16px;color:#64748b;margin:0 0 32px;line-height:1.6;max-width:400px}.member-list[data-v-3ebae4c1]{margin-top:24px;text-align:left;width:100%}.member-list-header[data-v-3ebae4c1]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;color:#334155;font-weight:600}.member-count[data-v-3ebae4c1],.loading-inline[data-v-3ebae4c1]{color:#94a3b8;font-size:13px}.members-list[data-v-3ebae4c1]{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.04)}.member-email[data-v-3ebae4c1]{color:#94a3b8}.active-chat-wrapper[data-v-3ebae4c1]{padding:32px 12px 12px}.empty-action-button[data-v-3ebae4c1]{--border-color: var(--color-primary);--color: var(--color-primary);--border-radius: 12px;--padding-start: 32px;--padding-end: 32px;height:48px;font-weight:600;text-transform:none;font-size:15px;transition:all .2s ease}.empty-action-button[data-v-3ebae4c1]:hover{--background: var(--color-primary);--color: white;transform:translateY(-2px);box-shadow:0 4px 12px rgba(45,122,78,.3)}@media (min-width: 768px){.empty-state[data-v-3ebae4c1]{padding:96px 32px;min-height:70vh}.empty-icon[data-v-3ebae4c1]{width:120px;height:120px;margin-bottom:40px}.empty-icon ion-icon[data-v-3ebae4c1]{font-size:56px}.empty-title[data-v-3ebae4c1]{font-size:28px}.empty-description[data-v-3ebae4c1]{font-size:18px;max-width:500px}}.conversations-list[data-v-3ebae4c1]{display:flex;flex-direction:column;gap:8px}.conversation-item[data-v-3ebae4c1]{background:#fff;border-radius:16px;padding:16px;display:flex;align-items:center;gap:16px;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 8px rgba(0,0,0,.04);border:2px solid transparent;position:relative}.conversation-item[data-v-3ebae4c1]:after{content:"";position:absolute;left:0;top:0;bottom:0;width:4px;background:var(--color-primary);border-radius:0 4px 4px 0;opacity:0;transition:opacity .2s ease}.conversation-item[data-v-3ebae4c1]:hover{box-shadow:0 4px 12px rgba(0,0,0,.08);transform:translateY(-2px)}.conversation-item[data-v-3ebae4c1]:hover:after{opacity:1}@media (min-width: 768px){.conversation-item[data-v-3ebae4c1]{padding:20px;gap:20px}}.conversation-item.active[data-v-3ebae4c1]{border-color:var(--color-primary);background:rgba(45,122,78,.02)}.conversation-item.unread[data-v-3ebae4c1]{background:rgba(45,122,78,.04)}.conversation-avatar[data-v-3ebae4c1]{position:relative;flex-shrink:0}.avatar-image[data-v-3ebae4c1]{width:56px;height:56px;border-radius:14px;object-fit:cover;border:2px solid #ffffff;box-shadow:0 2px 8px rgba(0,0,0,.1)}.avatar-placeholder[data-v-3ebae4c1]{width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,var(--color-primary) 0%,var(--color-secondary) 100%);display:flex;align-items:center;justify-content:center;color:#fff}.avatar-placeholder ion-icon[data-v-3ebae4c1]{font-size:28px}.multi-user-badge[data-v-3ebae4c1]{position:absolute;bottom:-4px;right:-4px;background:var(--color-primary);color:#fff;font-size:10px;font-weight:700;padding:2px 6px;border-radius:8px;border:2px solid #ffffff}.online-indicator[data-v-3ebae4c1]{position:absolute;bottom:2px;right:2px;width:14px;height:14px;background:#10b981;border:2px solid #ffffff;border-radius:50%}.conversation-content[data-v-3ebae4c1]{flex:1;min-width:0}.conversation-header[data-v-3ebae4c1]{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.conversation-name[data-v-3ebae4c1]{font-size:16px;font-weight:600;color:#1a1a1a;margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.conversation-time[data-v-3ebae4c1]{font-size:12px;color:#94a3b8;font-weight:500;flex-shrink:0;margin-left:8px}.conversation-preview[data-v-3ebae4c1]{display:flex;justify-content:space-between;align-items:center;gap:8px}.last-message[data-v-3ebae4c1]{font-size:14px;color:#64748b;margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}.unread-badge[data-v-3ebae4c1]{font-size:11px;min-width:20px;height:20px;border-radius:10px;flex-shrink:0}.conversation-item.unread .last-message[data-v-3ebae4c1]{color:#1a1a1a;font-weight:500}\n',document.head.appendChild(t);var W={key:0,class:"conversations-container"},Y={class:"search-container"},q={key:0,class:"loading-container"},B={key:1,class:"empty-state"},J={class:"empty-icon"},Q={class:"member-list"},X={class:"member-list-header"},Z={key:0,class:"loading-inline"},$={key:1,class:"member-count"},H={key:0,class:"loading-container inline"},K={key:1,class:"empty-members"},ee=["src","alt"],ae={class:"member-email"},te={key:2,class:"conversations-list"},ne=["onClick"],re={class:"conversation-avatar"},oe=["src","alt"],ie={key:1,class:"avatar-placeholder"},ce={key:2,class:"multi-user-badge"},se={key:3,class:"online-indicator"},le={class:"conversation-content"},ue={class:"conversation-header"},de={class:"conversation-name"},pe={key:0,class:"slack-badge"},fe={class:"conversation-time"},ve={class:"conversation-preview"},me={class:"last-message"},be={key:1,class:"active-chat-wrapper"},ge=c({__name:"MessagesPage",setup:function(a){var t=o(),c=s(),D=p(),ge=l(""),xe=l(null);l(!1);var he=l([]),ye=l(!1),we=u(function(){return t.conversationsList}),ke=u(function(){return t.isLoading});u(function(){return t.unreadCount});var Ce=u(function(){return c.currentCommunityId}),je=u(function(){var e=t.conversationsList;if(!ge.value.trim())return e;var a=ge.value.toLowerCase();return e.filter(function(e){var t=(e.messageTitle||"").toLowerCase(),n=(e.lastMessage||"").toLowerCase();return t.includes(a)||n.includes(a)})}),Se=u(function(){var e=r(he.value);if(e.sort(function(e,a){var t=(e.fullName||"".concat(e.fname||""," ").concat(e.lname||"")||e.email||"").toLowerCase(),n=(a.fullName||"".concat(a.fname||""," ").concat(a.lname||"")||a.email||"").toLowerCase();return t.localeCompare(n)}),!ge.value.trim())return e;var a=ge.value.toLowerCase();return e.filter(function(e){var t=(e.fullName||"".concat(e.fname||""," ").concat(e.lname||"")||"").toLowerCase(),n=(e.email||"").toLowerCase();return t.includes(a)||n.includes(a)})});function _e(){return(_e=n(e().m(function a(n){return e().w(function(e){for(;;)switch(e.n){case 0:if(Ce.value){e.n=1;break}return console.warn("No community selected"),e.a(2);case 1:return e.n=2,t.startConversationWithUser(Number(n.id),Ce.value);case 2:xe.value=t.activeConversation;case 3:return e.a(2)}},a)}))).apply(this,arguments)}function ze(e){return e.lastMessage?e.lastMessage.replace(/<[^>]*>/g,"").substring(0,50):e.messages&&e.messages.length>0&&(null===(a=e.messages[e.messages.length-1].message)||void 0===a?void 0:a.replace(/<[^>]*>/g,"").substring(0,50))||"No messages";var a}function Le(e){if(!e)return"";var a=e.toDate(),t=(new Date).getTime()-a.getTime(),n=Math.floor(t/6e4),r=Math.floor(t/36e5),o=Math.floor(t/864e5);return n<1?"Just now":n<60?"".concat(n,"m"):r<24?"".concat(r,"h"):o<7?"".concat(o,"d"):a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Me(e){return e.isRead?0:1}function Te(e){return e.isMultiUser&&e.users?Math.max(0,e.users.length-1):0}function Oe(){return Ie.apply(this,arguments)}function Ie(){return(Ie=n(e().m(function a(){var t;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(Ce.value){e.n=1;break}return e.a(2);case 1:return ye.value=!0,e.p=2,e.n=3,V.getProfilesForUserAndCommunity(Ce.value);case 3:he.value=e.v,e.n=5;break;case 4:e.p=4,t=e.v,console.error("Failed to load members",t),he.value=[];case 5:return e.p=5,ye.value=!1,e.f(5);case 6:return e.a(2)}},a,null,[[2,4,5,6]])}))).apply(this,arguments)}return d(n(e().m(function a(){var n,r;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,t.loadConversations();case 1:return t.subscribeToConversations(),e.n=2,Oe();case 2:if(!(n=D.query.userId?Number(D.query.userId):null)||!Ce.value){e.n=6;break}return e.p=3,e.n=4,t.startConversationWithUser(n,Ce.value);case 4:xe.value=t.activeConversation,e.n=6;break;case 5:e.p=5,r=e.v,console.error("Failed to start conversation from route param",r);case 6:return e.a(2)}},a,null,[[3,5]])}))),f(function(){t.cleanup()}),v(function(){return t.activeConversation},function(e){xe.value=e}),v(function(){return Ce.value},function(){var a=n(e().m(function a(t,n){return e().w(function(e){for(;;)switch(e.n){case 0:if(!t||t===n){e.n=1;break}return e.n=1,Oe();case 1:return e.a(2)}},a)}));return function(e,t){return a.apply(this,arguments)}}()),function(e,a){return O(),m(g(x),null,{default:b(function(){return[h(g(T),{fullscreen:!0,class:"messages-content"},{default:b(function(){return[xe.value?(O(),y("div",be,[h(i,{conversation:xe.value,onBack:a[1]||(a[1]=function(e){return xe.value=null})},null,8,["conversation"])])):(O(),y("div",W,[w("div",Y,[h(g(k),{modelValue:ge.value,"onUpdate:modelValue":a[0]||(a[0]=function(e){return ge.value=e}),placeholder:"Search conversations...",class:"conversations-search",debounce:300},null,8,["modelValue"])]),ke.value&&0===we.value.length?(O(),y("div",q,[h(g(C)),a[2]||(a[2]=w("p",null,"Loading conversations...",-1))])):0===g(je).length?(O(),y("div",B,[w("div",J,[h(g(j),{icon:g(S)},null,8,["icon"])]),a[6]||(a[6]=w("h3",{class:"empty-title"},"Start a new conversation",-1)),a[7]||(a[7]=w("p",{class:"empty-description"}," Choose anyone in your community to begin messaging. ",-1)),w("div",Q,[w("div",X,[a[3]||(a[3]=w("span",null,"All members (alphabetical)",-1)),ye.value?(O(),y("span",Z,"Loading...")):(O(),y("span",$,_(Se.value.length)+" people",1))]),ye.value?(O(),y("div",H,[h(g(C))])):0===Se.value.length?(O(),y("div",K,r(a[4]||(a[4]=[w("p",null,"No matching people.",-1)])))):(O(),m(g(z),{key:2,class:"members-list"},{default:b(function(){return[(O(!0),y(L,null,M(Se.value,function(e){return O(),m(g(I),{key:e.id,button:"",onClick:function(a){return function(e){return _e.apply(this,arguments)}(e)}},{default:b(function(){return[h(g(N),{slot:"start"},{default:b(function(){return[w("img",{src:e.profilePicture||e.profilePictureThumbnail||"https://placehold.co/64x64?text=User",alt:e.fullName||e.email},null,8,ee)]}),_:2},1024),h(g(P),null,{default:b(function(){return[w("h3",null,_(e.fullName||e.fname+" "+e.lname||e.email),1),w("p",ae,_(e.email),1)]}),_:2},1024),h(g(U),{slot:"end",size:"small",fill:"outline"},{default:b(function(){return r(a[5]||(a[5]=[A("Message",-1)]))}),_:1})]}),_:2},1032,["onClick"])}),128))]}),_:1}))])])):(O(),y("div",te,[(O(!0),y(L,null,M(g(je),function(e){var a;return O(),y("div",{key:e.conversationId,class:F(["conversation-item",{unread:!e.isRead,active:(null===(a=xe.value)||void 0===a?void 0:a.conversationId)===e.conversationId}]),onClick:function(a){return function(e){xe.value=e,t.setActiveConversation(e.conversationId)}(e)}},[w("div",re,[!e.isMultiUser&&e.messagesPicture?(O(),y("img",{key:0,src:e.messagesPicture,alt:e.messageTitle,class:"avatar-image"},null,8,oe)):(O(),y("div",ie,[h(g(j),{icon:g(E)},null,8,["icon"])])),e.isMultiUser?(O(),y("div",ce," +"+_(Te(e)),1)):G("",!0),e.isOnline&&!e.isMultiUser?(O(),y("div",se)):G("",!0)]),w("div",le,[w("div",ue,[w("h3",de,[A(_(e.messageTitle||"Unknown"),1),e.isSlackBacked?(O(),y("span",pe,"Slack")):G("",!0)]),w("span",fe,_(Le(e.updatedAt||e.timestamp)),1)]),w("div",ve,[w("p",me,_(ze(e)),1),e.isRead?G("",!0):(O(),m(g(R),{key:0,color:"primary",class:"unread-badge"},{default:b(function(){return[A(_(Me(e)),1)]}),_:2},1024))])])],10,ne)}),128))]))]))]}),_:1})]}),_:1})}}});a("default",D(ge,[["__scopeId","data-v-3ebae4c1"]]))}}})}();
