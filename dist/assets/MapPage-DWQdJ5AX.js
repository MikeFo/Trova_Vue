import{F as Rt,v as $t,a1 as Zt,r as O,a2 as we,a4 as De,G as Ut,a_ as Bt,o as zt,I as Fe,J as de,L as q,M as Dt,a3 as Ft,a$ as ye,$ as jt,_ as Vt,b0 as Gt,H as Wt,N as j,O as b,Y as B,ag as te,a5 as Ht,a8 as X,X as je,W as Me,ab as Ve,aa as Ge,a6 as Ee,aN as We,Z as Kt,Q as Jt,R,af as Xt,ap as He,b1 as Qt,aE as Yt,a0 as er}from"./index-CkJ7yJ3n.js";import{profileService as tr}from"./profile.service-CDoO2DLV.js";import{u as rr}from"./useGooglePlaces-CgJ8nW3r.js";var sr=Object.getOwnPropertyNames,nr=Object.getOwnPropertySymbols,or=Object.prototype.hasOwnProperty;function Ke(s,e){return function(r,n,a){return s(r,n,a)&&e(r,n,a)}}function he(s){return function(t,r,n){if(!t||!r||typeof t!="object"||typeof r!="object")return s(t,r,n);var a=n.cache,l=a.get(t),h=a.get(r);if(l&&h)return l===r&&h===t;a.set(t,r),a.set(r,t);var i=s(t,r,n);return a.delete(t),a.delete(r),i}}function ar(s){return s!=null?s[Symbol.toStringTag]:void 0}function Je(s){return sr(s).concat(nr(s))}var ir=Object.hasOwn||function(s,e){return or.call(s,e)};function Y(s,e){return s===e||!s&&!e&&s!==s&&e!==e}var lr="__v",ur="__o",cr="_owner",Xe=Object.getOwnPropertyDescriptor,Qe=Object.keys;function dr(s,e,t){var r=s.length;if(e.length!==r)return!1;for(;r-- >0;)if(!t.equals(s[r],e[r],r,r,s,e,t))return!1;return!0}function hr(s,e){return Y(s.getTime(),e.getTime())}function fr(s,e){return s.name===e.name&&s.message===e.message&&s.cause===e.cause&&s.stack===e.stack}function mr(s,e){return s===e}function Ye(s,e,t){var r=s.size;if(r!==e.size)return!1;if(!r)return!0;for(var n=new Array(r),a=s.entries(),l,h,i=0;(l=a.next())&&!l.done;){for(var w=e.entries(),v=!1,p=0;(h=w.next())&&!h.done;){if(n[p]){p++;continue}var P=l.value,C=h.value;if(t.equals(P[0],C[0],i,p,s,e,t)&&t.equals(P[1],C[1],P[0],C[0],s,e,t)){v=n[p]=!0;break}p++}if(!v)return!1;i++}return!0}var gr=Y;function pr(s,e,t){var r=Qe(s),n=r.length;if(Qe(e).length!==n)return!1;for(;n-- >0;)if(!lt(s,e,t,r[n]))return!1;return!0}function re(s,e,t){var r=Je(s),n=r.length;if(Je(e).length!==n)return!1;for(var a,l,h;n-- >0;)if(a=r[n],!lt(s,e,t,a)||(l=Xe(s,a),h=Xe(e,a),(l||h)&&(!l||!h||l.configurable!==h.configurable||l.enumerable!==h.enumerable||l.writable!==h.writable)))return!1;return!0}function vr(s,e){return Y(s.valueOf(),e.valueOf())}function wr(s,e){return s.source===e.source&&s.flags===e.flags}function et(s,e,t){var r=s.size;if(r!==e.size)return!1;if(!r)return!0;for(var n=new Array(r),a=s.values(),l,h;(l=a.next())&&!l.done;){for(var i=e.values(),w=!1,v=0;(h=i.next())&&!h.done;){if(!n[v]&&t.equals(l.value,h.value,l.value,h.value,s,e,t)){w=n[v]=!0;break}v++}if(!w)return!1}return!0}function yr(s,e){var t=s.length;if(e.length!==t)return!1;for(;t-- >0;)if(s[t]!==e[t])return!1;return!0}function Mr(s,e){return s.hostname===e.hostname&&s.pathname===e.pathname&&s.protocol===e.protocol&&s.port===e.port&&s.hash===e.hash&&s.username===e.username&&s.password===e.password}function lt(s,e,t,r){return(r===cr||r===ur||r===lr)&&(s.$$typeof||e.$$typeof)?!0:ir(e,r)&&t.equals(s[r],e[r],r,r,s,e,t)}var Er="[object Arguments]",Cr="[object Boolean]",Pr="[object Date]",xr="[object Error]",Lr="[object Map]",kr="[object Number]",Ir="[object Object]",_r="[object RegExp]",Sr="[object Set]",Ar="[object String]",br="[object URL]",Tr=Array.isArray,tt=typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView:null,rt=Object.assign,Or=Object.prototype.toString.call.bind(Object.prototype.toString);function Nr(s){var e=s.areArraysEqual,t=s.areDatesEqual,r=s.areErrorsEqual,n=s.areFunctionsEqual,a=s.areMapsEqual,l=s.areNumbersEqual,h=s.areObjectsEqual,i=s.arePrimitiveWrappersEqual,w=s.areRegExpsEqual,v=s.areSetsEqual,p=s.areTypedArraysEqual,P=s.areUrlsEqual,C=s.unknownTagComparators;return function(m,M,x){if(m===M)return!0;if(m==null||M==null)return!1;var L=typeof m;if(L!==typeof M)return!1;if(L!=="object")return L==="number"?l(m,M,x):L==="function"?n(m,M,x):!1;var _=m.constructor;if(_!==M.constructor)return!1;if(_===Object)return h(m,M,x);if(Tr(m))return e(m,M,x);if(tt!=null&&tt(m))return p(m,M,x);if(_===Date)return t(m,M,x);if(_===RegExp)return w(m,M,x);if(_===Map)return a(m,M,x);if(_===Set)return v(m,M,x);var S=Or(m);if(S===Pr)return t(m,M,x);if(S===_r)return w(m,M,x);if(S===Lr)return a(m,M,x);if(S===Sr)return v(m,M,x);if(S===Ir)return typeof m.then!="function"&&typeof M.then!="function"&&h(m,M,x);if(S===br)return P(m,M,x);if(S===xr)return r(m,M,x);if(S===Er)return h(m,M,x);if(S===Cr||S===kr||S===Ar)return i(m,M,x);if(C){var N=C[S];if(!N){var z=ar(m);z&&(N=C[z])}if(N)return N(m,M,x)}return!1}}function qr(s){var e=s.circular,t=s.createCustomConfig,r=s.strict,n={areArraysEqual:r?re:dr,areDatesEqual:hr,areErrorsEqual:fr,areFunctionsEqual:mr,areMapsEqual:r?Ke(Ye,re):Ye,areNumbersEqual:gr,areObjectsEqual:r?re:pr,arePrimitiveWrappersEqual:vr,areRegExpsEqual:wr,areSetsEqual:r?Ke(et,re):et,areTypedArraysEqual:r?re:yr,areUrlsEqual:Mr,unknownTagComparators:void 0};if(t&&(n=rt({},n,t(n))),e){var a=he(n.areArraysEqual),l=he(n.areMapsEqual),h=he(n.areObjectsEqual),i=he(n.areSetsEqual);n=rt({},n,{areArraysEqual:a,areMapsEqual:l,areObjectsEqual:h,areSetsEqual:i})}return n}function Rr(s){return function(e,t,r,n,a,l,h){return s(e,t,h)}}function $r(s){var e=s.circular,t=s.comparator,r=s.createState,n=s.equals,a=s.strict;if(r)return function(i,w){var v=r(),p=v.cache,P=p===void 0?e?new WeakMap:void 0:p,C=v.meta;return t(i,w,{cache:P,equals:n,meta:C,strict:a})};if(e)return function(i,w){return t(i,w,{cache:new WeakMap,equals:n,meta:void 0,strict:a})};var l={cache:void 0,equals:n,meta:void 0,strict:a};return function(i,w){return t(i,w,l)}}var oe=J();J({strict:!0});J({circular:!0});J({circular:!0,strict:!0});J({createInternalComparator:function(){return Y}});J({strict:!0,createInternalComparator:function(){return Y}});J({circular:!0,createInternalComparator:function(){return Y}});J({circular:!0,createInternalComparator:function(){return Y},strict:!0});function J(s){s===void 0&&(s={});var e=s.circular,t=e===void 0?!1:e,r=s.createInternalComparator,n=s.createState,a=s.strict,l=a===void 0?!1:a,h=qr(s),i=Nr(h),w=r?r(i):Rr(i);return $r({circular:t,comparator:i,createState:n,equals:w,strict:l})}const st=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Ce=1,se=8;class Ie{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(t!==219)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(n!==Ce)throw new Error("Got v".concat(n," data when expected v").concat(Ce,"."));const a=st[r&15];if(!a)throw new Error("Unrecognized array type.");const[l]=new Uint16Array(e,2,1),[h]=new Uint32Array(e,4,1);return new Ie(h,l,a,e)}constructor(e,t=64,r=Float64Array,n){if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const a=st.indexOf(this.ArrayType),l=e*2*this.ArrayType.BYTES_PER_ELEMENT,h=e*this.IndexArrayType.BYTES_PER_ELEMENT,i=(8-h%8)%8;if(a<0)throw new Error("Unexpected typed array class: ".concat(r,"."));n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,se,e),this.coords=new this.ArrayType(this.data,se+h+i,e*2),this._pos=e*2,this._finished=!0):(this.data=new ArrayBuffer(se+l+h+i),this.ids=new this.IndexArrayType(this.data,se,e),this.coords=new this.ArrayType(this.data,se+h+i,e*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(Ce<<4)+a]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return Le(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:l,nodeSize:h}=this,i=[0,a.length-1,0],w=[];for(;i.length;){const v=i.pop()||0,p=i.pop()||0,P=i.pop()||0;if(p-P<=h){for(let M=P;M<=p;M++){const x=l[2*M],L=l[2*M+1];x>=e&&x<=r&&L>=t&&L<=n&&w.push(a[M])}continue}const C=P+p>>1,k=l[2*C],m=l[2*C+1];k>=e&&k<=r&&m>=t&&m<=n&&w.push(a[C]),(v===0?e<=k:t<=m)&&(i.push(P),i.push(C-1),i.push(1-v)),(v===0?r>=k:n>=m)&&(i.push(C+1),i.push(p),i.push(1-v))}return w}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:a,nodeSize:l}=this,h=[0,n.length-1,0],i=[],w=r*r;for(;h.length;){const v=h.pop()||0,p=h.pop()||0,P=h.pop()||0;if(p-P<=l){for(let M=P;M<=p;M++)nt(a[2*M],a[2*M+1],e,t)<=w&&i.push(n[M]);continue}const C=P+p>>1,k=a[2*C],m=a[2*C+1];nt(k,m,e,t)<=w&&i.push(n[C]),(v===0?e-r<=k:t-r<=m)&&(h.push(P),h.push(C-1),h.push(1-v)),(v===0?e+r>=k:t+r>=m)&&(h.push(C+1),h.push(p),h.push(1-v))}return i}}function Le(s,e,t,r,n,a){if(n-r<=t)return;const l=r+n>>1;ut(s,e,l,r,n,a),Le(s,e,t,r,l-1,1-a),Le(s,e,t,l+1,n,1-a)}function ut(s,e,t,r,n,a){for(;n>r;){if(n-r>600){const w=n-r+1,v=t-r+1,p=Math.log(w),P=.5*Math.exp(2*p/3),C=.5*Math.sqrt(p*P*(w-P)/w)*(v-w/2<0?-1:1),k=Math.max(r,Math.floor(t-v*P/w+C)),m=Math.min(n,Math.floor(t+(w-v)*P/w+C));ut(s,e,t,k,m,a)}const l=e[2*t+a];let h=r,i=n;for(ne(s,e,r,t),e[2*n+a]>l&&ne(s,e,r,n);h<i;){for(ne(s,e,h,i),h++,i--;e[2*h+a]<l;)h++;for(;e[2*i+a]>l;)i--}e[2*r+a]===l?ne(s,e,r,i):(i++,ne(s,e,i,n)),i<=t&&(r=i+1),t<=i&&(n=i-1)}}function ne(s,e,t,r){Pe(s,t,r),Pe(e,2*t,2*r),Pe(e,2*t+1,2*r+1)}function Pe(s,e,t){const r=s[e];s[e]=s[t],s[t]=r}function nt(s,e,t,r){const n=s-t,a=e-r;return n*n+a*a}const Zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:s=>s},ot=Math.fround||(s=>e=>(s[0]=+e,s[0]))(new Float32Array(1)),Q=2,W=3,xe=4,G=5,ct=6;class dt{constructor(e){this.options=Object.assign(Object.create(Zr),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:r,maxZoom:n}=this.options;t&&console.time("total time");const a="prepare ".concat(e.length," points");t&&console.time(a),this.points=e;const l=[];for(let i=0;i<e.length;i++){const w=e[i];if(!w.geometry)continue;const[v,p]=w.geometry.coordinates,P=ot(fe(v)),C=ot(me(p));l.push(P,C,1/0,i,-1,1),this.options.reduce&&l.push(0)}let h=this.trees[n+1]=this._createTree(l);t&&console.timeEnd(a);for(let i=n;i>=r;i--){const w=+Date.now();h=this.trees[i]=this._createTree(this._cluster(h,i)),t&&console.log("z%d: %d clusters in %dms",i,h.numItems,+Date.now()-w)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let a=e[2]===180?180:((e[2]+180)%360+360)%360-180;const l=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,a=180;else if(r>a){const p=this.getClusters([r,n,180,l],t),P=this.getClusters([-180,n,a,l],t);return p.concat(P)}const h=this.trees[this._limitZoom(t)],i=h.range(fe(r),me(l),fe(a),me(n)),w=h.data,v=[];for(const p of i){const P=this.stride*p;v.push(w[P+G]>1?at(w,P,this.clusterProps):this.points[w[P+W]])}return v}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",a=this.trees[r];if(!a)throw new Error(n);const l=a.data;if(t*this.stride>=l.length)throw new Error(n);const h=this.options.radius/(this.options.extent*Math.pow(2,r-1)),i=l[t*this.stride],w=l[t*this.stride+1],v=a.within(i,w,h),p=[];for(const P of v){const C=P*this.stride;l[C+xe]===e&&p.push(l[C+G]>1?at(l,C,this.clusterProps):this.points[l[C+W]])}if(p.length===0)throw new Error(n);return p}getLeaves(e,t,r){t=t||10,r=r||0;const n=[];return this._appendLeaves(n,e,t,r,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],a=Math.pow(2,e),{extent:l,radius:h}=this.options,i=h/l,w=(r-i)/a,v=(r+1+i)/a,p={features:[]};return this._addTileFeatures(n.range((t-i)/a,w,(t+1+i)/a,v),n.data,t,r,a,p),t===0&&this._addTileFeatures(n.range(1-i/a,w,1,v),n.data,a,r,a,p),t===a-1&&this._addTileFeatures(n.range(0,w,i/a,v),n.data,-1,r,a,p),p.features.length?p:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,r.length!==1)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,a){const l=this.getChildren(t);for(const h of l){const i=h.properties;if(i&&i.cluster?a+i.point_count<=n?a+=i.point_count:a=this._appendLeaves(e,i.cluster_id,r,n,a):a<n?a++:e.push(h),e.length===r)break}return a}_createTree(e){const t=new Ie(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let r=0;r<e.length;r+=this.stride)t.add(e[r],e[r+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,r,n,a,l){for(const h of e){const i=h*this.stride,w=t[i+G]>1;let v,p,P;if(w)v=ht(t,i,this.clusterProps),p=t[i],P=t[i+1];else{const m=this.points[t[i+W]];v=m.properties;const[M,x]=m.geometry.coordinates;p=fe(M),P=me(x)}const C={type:1,geometry:[[Math.round(this.options.extent*(p*a-r)),Math.round(this.options.extent*(P*a-n))]],tags:v};let k;w||this.options.generateId?k=t[i+W]:k=this.points[t[i+W]].id,k!==void 0&&(C.id=k),l.features.push(C)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:r,extent:n,reduce:a,minPoints:l}=this.options,h=r/(n*Math.pow(2,t)),i=e.data,w=[],v=this.stride;for(let p=0;p<i.length;p+=v){if(i[p+Q]<=t)continue;i[p+Q]=t;const P=i[p],C=i[p+1],k=e.within(i[p],i[p+1],h),m=i[p+G];let M=m;for(const x of k){const L=x*v;i[L+Q]>t&&(M+=i[L+G])}if(M>m&&M>=l){let x=P*m,L=C*m,_,S=-1;const N=((p/v|0)<<5)+(t+1)+this.points.length;for(const z of k){const F=z*v;if(i[F+Q]<=t)continue;i[F+Q]=t;const ie=i[F+G];x+=i[F]*ie,L+=i[F+1]*ie,i[F+xe]=N,a&&(_||(_=this._map(i,p,!0),S=this.clusterProps.length,this.clusterProps.push(_)),a(_,this._map(i,F)))}i[p+xe]=N,w.push(x/M,L/M,1/0,N,-1,M),a&&w.push(S)}else{for(let x=0;x<v;x++)w.push(i[p+x]);if(M>1)for(const x of k){const L=x*v;if(!(i[L+Q]<=t)){i[L+Q]=t;for(let _=0;_<v;_++)w.push(i[L+_])}}}}return w}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+G]>1){const l=this.clusterProps[e[t+ct]];return r?Object.assign({},l):l}const n=this.points[e[t+W]].properties,a=this.options.map(n);return r&&a===n?Object.assign({},a):a}}function at(s,e,t){return{type:"Feature",id:s[e+W],properties:ht(s,e,t),geometry:{type:"Point",coordinates:[Ur(s[e]),Br(s[e+1])]}}}function ht(s,e,t){const r=s[e+G],n=r>=1e4?"".concat(Math.round(r/1e3),"k"):r>=1e3?"".concat(Math.round(r/100)/10,"k"):r,a=s[e+ct],l=a===-1?{}:Object.assign({},t[a]);return Object.assign(l,{cluster:!0,cluster_id:s[e+W],point_count:r,point_count_abbreviated:n})}function fe(s){return s/360+.5}function me(s){const e=Math.sin(s*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Ur(s){return(s-.5)*360}function Br(s){const e=(180-s*360)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function ae(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t}class A{static isAdvancedMarkerAvailable(e){return google.maps.marker&&e.getMapCapabilities().isAdvancedMarkersAvailable===!0}static isAdvancedMarker(e){return google.maps.marker&&e instanceof google.maps.marker.AdvancedMarkerElement}static setMap(e,t){this.isAdvancedMarker(e)?e.map=t:e.setMap(t)}static getPosition(e){if(this.isAdvancedMarker(e)){if(e.position){if(e.position instanceof google.maps.LatLng)return e.position;if(Number.isFinite(e.position.lat)&&Number.isFinite(e.position.lng))return new google.maps.LatLng(e.position.lat,e.position.lng)}return new google.maps.LatLng(null)}return e.getPosition()}static getVisible(e){return this.isAdvancedMarker(e)?!0:e.getVisible()}}class K{constructor({markers:e,position:t}){this.markers=[],e&&(this.markers=e),t&&(t instanceof google.maps.LatLng?this._position=t:this._position=new google.maps.LatLng(t))}get bounds(){if(this.markers.length===0&&!this._position)return;const e=new google.maps.LatLngBounds(this._position,this._position);for(const t of this.markers)e.extend(A.getPosition(t));return e}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(e=>A.getVisible(e)).length}push(e){this.markers.push(e)}delete(){this.marker&&(A.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}}function $(s,e="assertion failed"){if(s==null)throw Error(e)}const _e=(s,e,t,r)=>{const n=s.getBounds();$(n);const a=ge(n,e,r);return t.filter(l=>a.contains(A.getPosition(l)))},ge=(s,e,t)=>{const{northEast:r,southWest:n}=zr(s,e),a=gt({northEast:r,southWest:n},t);return pt(a,e)},ft=(s,e,t)=>{const r=ge(s,e,t),n=r.getNorthEast(),a=r.getSouthWest();return[a.lng(),a.lat(),n.lng(),n.lat()]},mt=(s,e)=>{const r=(e.lat-s.lat)*Math.PI/180,n=(e.lng-s.lng)*Math.PI/180,a=Math.sin(r/2),l=Math.sin(n/2),h=a*a+Math.cos(s.lat*Math.PI/180)*Math.cos(e.lat*Math.PI/180)*l*l;return 6371*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))},zr=(s,e)=>{const t=e.fromLatLngToDivPixel(s.getNorthEast()),r=e.fromLatLngToDivPixel(s.getSouthWest());return $(t),$(r),{northEast:t,southWest:r}},gt=({northEast:s,southWest:e},t)=>(s.x+=t,s.y-=t,e.x-=t,e.y+=t,{northEast:s,southWest:e}),pt=({northEast:s,southWest:e},t)=>{const r=t.fromDivPixelToLatLng(e),n=t.fromDivPixelToLatLng(s);return new google.maps.LatLngBounds(r,n)};class pe{constructor({maxZoom:e=16}){this.maxZoom=e}noop({markers:e}){return vt(e)}}class Se extends pe{constructor(e){var{viewportPadding:t=60}=e,r=ae(e,["viewportPadding"]);super(r),this.viewportPadding=60,this.viewportPadding=t}calculate({markers:e,map:t,mapCanvasProjection:r}){const n=t.getZoom();return $(n),n>=this.maxZoom?{clusters:this.noop({markers:e}),changed:!1}:{clusters:this.cluster({markers:_e(t,r,e,this.viewportPadding),map:t,mapCanvasProjection:r})}}}const vt=s=>s.map(t=>new K({position:A.getPosition(t),markers:[t]}));class Dr extends Se{constructor(e){var{maxDistance:t=4e4,gridSize:r=40}=e,n=ae(e,["maxDistance","gridSize"]);super(n),this.clusters=[],this.state={zoom:-1},this.maxDistance=t,this.gridSize=r}calculate({markers:e,map:t,mapCanvasProjection:r}){const n=t.getZoom();$(n);const a={zoom:n};let l=!1;return this.state.zoom>=this.maxZoom&&a.zoom>=this.maxZoom||(l=!oe(this.state,a)),this.state=a,n>=this.maxZoom?{clusters:this.noop({markers:e}),changed:l}:{clusters:this.cluster({markers:_e(t,r,e,this.viewportPadding),map:t,mapCanvasProjection:r})}}cluster({markers:e,map:t,mapCanvasProjection:r}){return this.clusters=[],e.forEach(n=>{this.addToClosestCluster(n,t,r)}),this.clusters}addToClosestCluster(e,t,r){let n=this.maxDistance,a=null;for(let l=0;l<this.clusters.length;l++){const h=this.clusters[l];$(h.bounds);const i=mt(h.bounds.getCenter().toJSON(),A.getPosition(e).toJSON());i<n&&(n=i,a=h)}if(a)if($(a.bounds),ge(a.bounds,r,this.gridSize).contains(A.getPosition(e)))a.push(e);else{const l=new K({markers:[e]});this.clusters.push(l)}else{const l=new K({markers:[e]});this.clusters.push(l)}}}class Fr extends pe{constructor(e){var t=ae(e,[]);super(t)}calculate({markers:e,map:t,mapCanvasProjection:r}){return{clusters:this.cluster({markers:e,map:t,mapCanvasProjection:r}),changed:!1}}cluster(e){return this.noop(e)}}class wt extends pe{constructor(e){var{maxZoom:t,radius:r=60}=e,n=ae(e,["maxZoom","radius"]);super({maxZoom:t}),this.markers=[],this.clusters=[],this.state={zoom:-1},this.superCluster=new dt(Object.assign({maxZoom:this.maxZoom,radius:r},n))}calculate(e){let t=!1,r=e.map.getZoom();$(r),r=Math.round(r);const n={zoom:r};if(!oe(e.markers,this.markers)){t=!0,this.markers=[...e.markers];const a=this.markers.map(l=>{const h=A.getPosition(l);return{type:"Feature",geometry:{type:"Point",coordinates:[h.lng(),h.lat()]},properties:{marker:l}}});this.superCluster.load(a)}return t||(this.state.zoom<=this.maxZoom||n.zoom<=this.maxZoom)&&(t=!oe(this.state,n)),this.state=n,e.markers.length===0?(this.clusters=[],{clusters:this.clusters,changed:t}):(t&&(this.clusters=this.cluster(e)),{clusters:this.clusters,changed:t})}cluster({map:e}){const t=e.getZoom();return $(t),this.superCluster.getClusters([-180,-90,180,90],Math.round(t)).map(r=>this.transformCluster(r))}transformCluster({geometry:{coordinates:[e,t]},properties:r}){if(r.cluster)return new K({markers:this.superCluster.getLeaves(r.cluster_id,1/0).map(a=>a.properties.marker),position:{lat:t,lng:e}});const n=r.marker;return new K({markers:[n],position:A.getPosition(n)})}}class jr extends Se{constructor(e){var{maxZoom:t,radius:r=60,viewportPadding:n=60}=e,a=ae(e,["maxZoom","radius","viewportPadding"]);super({maxZoom:t,viewportPadding:n}),this.markers=[],this.clusters=[],this.superCluster=new dt(Object.assign({maxZoom:this.maxZoom,radius:r},a)),this.state={zoom:-1,view:[0,0,0,0]}}calculate(e){const t=this.getViewportState(e);let r=!oe(this.state,t);if(!oe(e.markers,this.markers)){r=!0,this.markers=[...e.markers];const n=this.markers.map(a=>{const l=A.getPosition(a);return{type:"Feature",geometry:{type:"Point",coordinates:[l.lng(),l.lat()]},properties:{marker:a}}});this.superCluster.load(n)}return r&&(this.clusters=this.cluster(e),this.state=t),{clusters:this.clusters,changed:r}}cluster(e){const t=this.getViewportState(e);return this.superCluster.getClusters(t.view,t.zoom).map(r=>this.transformCluster(r))}transformCluster({geometry:{coordinates:[e,t]},properties:r}){if(r.cluster)return new K({markers:this.superCluster.getLeaves(r.cluster_id,1/0).map(a=>a.properties.marker),position:{lat:t,lng:e}});const n=r.marker;return new K({markers:[n],position:A.getPosition(n)})}getViewportState(e){const t=e.map.getZoom(),r=e.map.getBounds();return $(t),$(r),{zoom:Math.round(t),view:ft(r,e.mapCanvasProjection,this.viewportPadding)}}}class yt{constructor(e,t){this.markers={sum:e.length};const r=t.map(a=>a.count),n=r.reduce((a,l)=>a+l,0);this.clusters={count:t.length,markers:{mean:n/t.length,sum:n,min:Math.min(...r),max:Math.max(...r)}}}}class Mt{render({count:e,position:t},r,n){const a=e>Math.max(10,r.clusters.markers.mean)?"#ff0000":"#0000ff",l='<svg fill="'.concat(a,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">\n<circle cx="120" cy="120" opacity=".6" r="70" />\n<circle cx="120" cy="120" opacity=".3" r="90" />\n<circle cx="120" cy="120" opacity=".2" r="110" />\n<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">').concat(e,"</text>\n</svg>"),h="Cluster of ".concat(e," markers"),i=Number(google.maps.Marker.MAX_ZINDEX)+e;if(A.isAdvancedMarkerAvailable(n)){const p=new DOMParser().parseFromString(l,"image/svg+xml").documentElement;p.setAttribute("transform","translate(0 25)");const P={map:n,position:t,zIndex:i,title:h,content:p};return new google.maps.marker.AdvancedMarkerElement(P)}const w={position:t,zIndex:i,title:h,icon:{url:"data:image/svg+xml;base64,".concat(btoa(l)),anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(w)}}function Vr(s,e){for(let t in e.prototype)s.prototype[t]=e.prototype[t]}class Ae{constructor(){Vr(Ae,google.maps.OverlayView)}}var H;(function(s){s.CLUSTERING_BEGIN="clusteringbegin",s.CLUSTERING_END="clusteringend",s.CLUSTER_CLICK="click",s.GMP_CLICK="gmp-click"})(H||(H={}));const Et=(s,e,t)=>{e.bounds&&t.fitBounds(e.bounds)};class ke extends Ae{constructor({map:e,markers:t=[],algorithmOptions:r={},algorithm:n=new wt(r),renderer:a=new Mt,onClusterClick:l=Et}){super(),this.map=null,this.idleListener=null,this.markers=[...t],this.clusters=[],this.algorithm=n,this.renderer=a,this.onClusterClick=l,e&&this.setMap(e)}addMarker(e,t){this.markers.includes(e)||(this.markers.push(e),t||this.render())}addMarkers(e,t){e.forEach(r=>{this.addMarker(r,!0)}),t||this.render()}removeMarker(e,t){const r=this.markers.indexOf(e);return r===-1?!1:(A.setMap(e,null),this.markers.splice(r,1),t||this.render(),!0)}removeMarkers(e,t){let r=!1;return e.forEach(n=>{r=this.removeMarker(n,!0)||r}),r&&!t&&this.render(),r}clearMarkers(e){this.markers.length=0,e||this.render()}render(){const e=this.getMap();if(e instanceof google.maps.Map&&e.getProjection()){google.maps.event.trigger(this,H.CLUSTERING_BEGIN,this);const{clusters:t,changed:r}=this.algorithm.calculate({markers:this.markers,map:e,mapCanvasProjection:this.getProjection()});if(r||r==null){const n=new Set;for(const l of t)l.markers.length==1&&n.add(l.markers[0]);const a=[];for(const l of this.clusters)l.marker!=null&&(l.markers.length==1?n.has(l.marker)||A.setMap(l.marker,null):a.push(l.marker));this.clusters=t,this.renderClusters(),requestAnimationFrame(()=>a.forEach(l=>A.setMap(l,null)))}google.maps.event.trigger(this,H.CLUSTERING_END,this)}}onAdd(){const e=this.getMap();$(e),this.idleListener=e.addListener("idle",this.render.bind(this)),this.render()}onRemove(){this.idleListener&&google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(e=>A.setMap(e,null)),this.clusters.forEach(e=>e.delete()),this.clusters=[]}renderClusters(){const e=new yt(this.markers,this.clusters),t=this.getMap();this.clusters.forEach(r=>{if(r.markers.length===1)r.marker=r.markers[0];else if(r.marker=this.renderer.render(r,e,t),r.markers.forEach(n=>A.setMap(n,null)),this.onClusterClick){const n=A.isAdvancedMarker(r.marker)?H.GMP_CLICK:H.CLUSTER_CLICK;r.marker.addListener(n,a=>{google.maps.event.trigger(this,H.CLUSTER_CLICK,r),this.onClusterClick(a,r,t)})}A.setMap(r.marker,t)})}}const Gr=Object.freeze(Object.defineProperty({__proto__:null,AbstractAlgorithm:pe,AbstractViewportAlgorithm:Se,Cluster:K,ClusterStats:yt,DefaultRenderer:Mt,GridAlgorithm:Dr,MarkerClusterer:ke,get MarkerClustererEvents(){return H},MarkerUtils:A,NoopAlgorithm:Fr,SuperClusterAlgorithm:wt,SuperClusterViewportAlgorithm:jr,defaultOnClusterClickHandler:Et,distanceBetweenPoints:mt,extendBoundsToPaddedViewport:ge,extendPixelBounds:gt,filterMarkersToPaddedViewport:_e,getPaddedViewport:ft,noop:vt,pixelBoundsToLatLngBounds:pt},Symbol.toStringTag,{value:"Module"})),Wr={class:"map-layout"},Hr={class:"map-section"},Kr={class:"user-panel"},Jr={class:"panel-header"},Xr={class:"search-wrapper"},Qr={class:"results-count"},Yr=["onClick"],es={class:"user-avatar"},ts=["src","alt"],rs={key:1,class:"avatar-placeholder"},ss={class:"user-info"},ns={class:"user-name"},os={key:0,class:"user-location"},as={key:1,class:"user-bio"},is={key:2,class:"user-interests"},ls={key:0,class:"empty-state"},us={key:0,class:"loading-overlay"},it=2,cs=60,V=13,ds=Rt({__name:"MapPage",setup(s){const e=Wt(),t=Ft(),r=$t(),n=Zt(),{loadGoogleMapsScript:a}=rr(),l=O(null),h=O(null),i=O(!1),w=O(""),v=O([]),p=O([]),P=O(null),C=O(null),k=O(!1),m=O(null),M=O([]),x=O(null),L=O(null),_=new Map,S=new Map,N=new Map,z=O(new Set);function F(d=[]){const u=new Set;d.forEach(o=>{const c=(o==null?void 0:o.markers)||[];if(c.length>=it)c.forEach(f=>{f.setVisible(!1),u.add(f)});else if(c.length===1){const f=c[0];f.setVisible(!0),u.add(f)}}),M.value.forEach(o=>{u.has(o)||o.setVisible(!0)})}function ie(){var u,o;if(!L.value)return;const d=c=>{var g,y;const f=(c==null?void 0:c.clusters)||((y=(g=L.value)==null?void 0:g.getClusters)==null?void 0:y.call(g))||[];F(f)};(o=(u=L.value).addListener)==null||o.call(u,"clusteringend",d),L.value.getClusters&&d({clusters:L.value.getClusters()})}function be(){const d=document.createElement("canvas"),u=40;d.width=u,d.height=u;const o=d.getContext("2d");return o?(o.beginPath(),o.arc(u/2,u/2,u/2,0,Math.PI*2),o.fillStyle="#2d7a4e",o.fill(),o.fillStyle="#ffffff",o.beginPath(),o.arc(u/2,u/2-4,6,0,Math.PI*2),o.fill(),o.beginPath(),o.arc(u/2,u/2+6,8,0,Math.PI*2),o.fill(),d.toDataURL("image/png")):"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMyZDdhNGUiLz48L3N2Zz4="}function Ct(d){const u=new Map,o=new Map;return d.forEach(c=>{if(!c.currentLat||!c.currentLong)return;const f="".concat(c.currentLat.toFixed(5),"_").concat(c.currentLong.toFixed(5)),g=u.get(f)||[];g.push(c),u.set(f,g)}),u.forEach(c=>{const f=c.length;if(f===1){const y=c[0];o.set(y.userId||y.id,{lat:y.currentLat,lng:y.currentLong});return}const g=Math.min(360+(f-1)*60,840);c.forEach((y,E)=>{const T=2*Math.PI*E/f,I=y.currentLat,U=y.currentLong,D=g/111320*Math.sin(T),ee=g/(111320*Math.cos(I*Math.PI/180))*Math.cos(T);o.set(y.userId||y.id,{lat:I+D,lng:U+ee})})}),o}function Te(d){return new Promise((u,o)=>{const c=new Image;c.crossOrigin="anonymous";const f=setTimeout(()=>{o(new Error("Image load timeout"))},5e3);c.onload=()=>{clearTimeout(f);try{const g=document.createElement("canvas"),y=40;g.width=y,g.height=y;const E=g.getContext("2d");if(!E){o(new Error("Could not get canvas context"));return}E.beginPath(),E.arc(y/2,y/2,y/2,0,Math.PI*2),E.closePath(),E.clip(),E.drawImage(c,0,0,y,y),u(g.toDataURL("image/png"))}catch(g){o(g)}},c.onerror=()=>{clearTimeout(f),o(new Error("Failed to load image for canvas"))},c.src=d})}function Oe(d){return new Promise((u,o)=>{const c=new Image,f=setTimeout(()=>{o(new Error("Image load timeout"))},5e3);c.onload=()=>{clearTimeout(f);try{const g=document.createElement("canvas"),y=40;g.width=y,g.height=y;const E=g.getContext("2d");if(!E){o(new Error("Could not get canvas context"));return}E.beginPath(),E.arc(y/2,y/2,y/2,0,Math.PI*2),E.closePath(),E.clip(),E.drawImage(c,0,0,y,y),u(g.toDataURL("image/png"))}catch(g){o(g)}},c.onerror=()=>{clearTimeout(f),o(new Error("Failed to load image"))},c.src=d})}function Ne(){return{render:d=>{const u=d.markers||[];let o=u.length;if(m.value){const U=m.value.getBounds();U&&(o=u.filter(D=>{const ee=D.getPosition();return ee?U.contains(ee):!1}).length)}const c=o>0?o:d.count,f=Math.min(50+Math.sqrt(c)*2,70),g=f/2,y=document.createElement("canvas");y.width=f,y.height=f;const E=y.getContext("2d");if(!E)return new window.google.maps.Marker({position:d.position,label:{text:String(c),color:"white"}});E.beginPath(),E.arc(g,g,g-1,0,Math.PI*2),E.fillStyle="#2d7a4e",E.fill(),E.fillStyle="#ffffff",E.font="bold ".concat(Math.min(13+Math.floor(c/20),16),"px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"),E.textAlign="center",E.textBaseline="middle",E.fillText(String(c),g,g);const T=y.toDataURL(),I=new window.google.maps.Marker({position:d.position,icon:{url:T,scaledSize:new window.google.maps.Size(f,f),anchor:new window.google.maps.Point(g,g)},zIndex:Number(window.google.maps.Marker.MAX_ZINDEX)+c});return I.addListener("click",()=>{Pt(u)}),I}}}function Pt(d){if(!m.value||!d||d.length===0)return;const u=new window.google.maps.LatLngBounds;d.forEach(U=>{const D=U.getPosition();D&&u.extend(D)});const o=u.getCenter();let c=0;d.forEach(U=>{const D=U.getPosition();if(D){const ee=xt(o.lat(),o.lng(),D.lat(),D.lng());c=Math.max(c,ee)}});const y=Math.max(.5,Math.min(c*1.5,1)),E=y/69,T=y/(69*Math.cos(o.lat()*Math.PI/180)),I=new window.google.maps.LatLngBounds;I.extend(new window.google.maps.LatLng(o.lat()+E,o.lng()+T)),I.extend(new window.google.maps.LatLng(o.lat()-E,o.lng()-T)),m.value.fitBounds(I,{padding:80}),setTimeout(()=>{if(m.value){const U=m.value.getZoom();U&&U>V&&m.value.setZoom(V)}},100)}function xt(d,u,o,c){const g=(o-d)*Math.PI/180,y=(c-u)*Math.PI/180,E=Math.sin(g/2)*Math.sin(g/2)+Math.cos(d*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(y/2)*Math.sin(y/2);return 3959*(2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E)))}async function Lt(d,u,o){if(!m.value||!x.value)return;const c=S.get(o)||d,f=Z.value.find(y=>(y.userId||y.id)===o)||u;await Ue(c,f);const g='\n    <div style="padding: 8px; min-width: 200px;">\n      <h3 style="margin: 0 0 4px 0; font-size: 16px; font-weight: 600;">\n        '.concat(f.fullName||"".concat(f.fname," ").concat(f.lname),"\n      </h3>\n      ").concat(f.bio?'<p style="margin: 0; font-size: 14px; color: #666;">'.concat(f.bio,"</p>"):"","\n      ").concat(f.currentLocationName?'<p style="margin: 4px 0 0 0; font-size: 12px; color: #999;">\n        üìç '.concat(f.currentLocationName,"\n      </p>"):"","\n    </div>\n  ");x.value.setContent(g),Ze(c),x.value.open(m.value,c),C.value=o,$e(o)}function qe(){const d={lat:37.7749,lng:-122.4194};if(!v.value||v.value.length===0)return d;let u=0,o=0,c=0;for(const f of v.value)!f.currentLat||!f.currentLong||(o+=f.currentLat,c+=f.currentLong,u++);return u===0?d:{lat:o/u,lng:c/u}}const Z=we(()=>{let d=v.value;if(w.value.trim()){const u=w.value.toLowerCase();d=d.filter(o=>{var E,T,I;const c="".concat(o.fname," ").concat(o.lname).toLowerCase(),f=((E=o.bio)==null?void 0:E.toLowerCase())||"",g=((T=o.interests)==null?void 0:T.join(" ").toLowerCase())||"",y=((I=o.currentLocationName)==null?void 0:I.toLowerCase())||"";return c.includes(u)||f.includes(u)||g.includes(u)||y.includes(u)})}return C.value!==null?d=[...d].sort((u,o)=>{const c=u.userId||u.id,f=o.userId||o.id;if(c===C.value)return-1;if(f===C.value)return 1;const g=(u.fullName||"".concat(u.fname," ").concat(u.lname)).toLowerCase(),y=(o.fullName||"".concat(o.fname," ").concat(o.lname)).toLowerCase();return g.localeCompare(y)}):d=[...d].sort((u,o)=>{const c=(u.fullName||"".concat(u.fname," ").concat(u.lname)).toLowerCase(),f=(o.fullName||"".concat(o.fname," ").concat(o.lname)).toLowerCase();return c.localeCompare(f)}),d}),kt=we(()=>Z.value.filter(u=>{const o=u.userId||u.id;return z.value.has(o)}).sort((u,o)=>{const c=(u.fullName||"".concat(u.fname," ").concat(u.lname)).toLowerCase(),f=(o.fullName||"".concat(o.fname," ").concat(o.lname)).toLowerCase();return c.localeCompare(f)})),It=we(()=>kt.value.length);function Re(d){const u=d.userId||d.id;return p.value.includes(u)}function _t(d){const u=d.userId||d.id,o=p.value.indexOf(u);o>-1?p.value.splice(o,1):p.value.push(u)}function St(d,u){d&&d instanceof HTMLElement?N.set(u,d):d&&"$el"in d&&d.$el instanceof HTMLElement&&N.set(u,d.$el)}function $e(d){P.value=d;const u=N.get(d);u&&h.value&&(h.value.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{u.scrollIntoView({behavior:"smooth",block:"center"})},150))}function Ze(d){var o,c,f,g;const u=(g=(f=(c=(o=window==null?void 0:window.google)==null?void 0:o.maps)==null?void 0:c.Marker)==null?void 0:f.MAX_ZINDEX)!=null?g:1e5;d.setZIndex(u+50)}async function Ue(d,u){let o;if(u.profilePicture)try{o=await Oe(u.profilePicture)}catch(c){try{o=await Te(u.profilePicture)}catch(f){o=u.profilePicture}}else o=be();d.setIcon({url:o,scaledSize:new google.maps.Size(40,40),anchor:new google.maps.Point(20,20)})}async function At(d){const u=d.userId||d.id;if(!d.currentLat||!d.currentLong||!m.value)return;C.value=u,$e(u);const o=S.get(u);if(o){const c=Z.value.find(g=>(g.userId||g.id)===u)||d;await Ue(o,c),Ze(o);const f=o.getPosition();if(f&&(k.value=!0,m.value.setCenter(f),m.value.setZoom(V),setTimeout(()=>{k.value=!1},500),x.value)){const g='\n          <div style="padding: 8px; min-width: 200px;">\n            <h3 style="margin: 0 0 4px 0; font-size: 16px; font-weight: 600;">\n              '.concat(c.fullName||"".concat(c.fname," ").concat(c.lname),"\n            </h3>\n            ").concat(c.bio?'<p style="margin: 0; font-size: 14px; color: #666;">'.concat(c.bio,"</p>"):"","\n            ").concat(c.currentLocationName?'<p style="margin: 4px 0 0 0; font-size: 12px; color: #999;">\n              üìç '.concat(c.currentLocationName,"\n            </p>"):"","\n          </div>\n        ");x.value.setContent(g),x.value.open(m.value,o)}}}function bt(){p.value.length===1?e.push("/tabs/messages?userId=".concat(p.value[0])):console.log("Group message not yet implemented for:",p.value)}let le=!1,ue=!1;async function Tt(){if(ue)return!1;const u=t.query.communityId;if(u){const o=Number(u);if(!isNaN(o)){const c=n.getCommunityById(o);if(c)return n.setCurrentCommunity(c),console.log("[MapPage] Set community from URL: ".concat(o," (").concat(c.name,")")),ue=!0,!0;if(console.log("[MapPage] Community ".concat(o," from URL not in store yet, will set after communities load")),!le){if(le=!0,n.communities.length>0){const g=n.getCommunityById(o);if(g)return n.setCurrentCommunity(g),console.log("[MapPage] Set community from URL (communities already loaded): ".concat(o," (").concat(g.name,")")),ue=!0,le=!1,!0}const f=De(()=>n.communities,g=>{if(g.length>0){const y=n.getCommunityById(o);y&&(n.setCurrentCommunity(y),console.log("[MapPage] Set community from URL after load: ".concat(o," (").concat(y.name,")")),ue=!0,f(),le=!1)}},{immediate:!0})}return!1}}return!1}async function Be(){await(await Gt.create({header:"Session Expired",message:"For security purposes, your session has expired after 60 seconds. Would you like to sign in to continue, or go back to Slack to create a new session?",buttons:[{text:"Go Back to Slack",role:"cancel",handler:()=>{window.history.back()}},{text:"Sign In",handler:()=>{e.push("/login")}}]})).present()}async function ze(){var d,u,o,c;i.value=!0;try{const f=n.currentCommunityId;if(!f){v.value=[];return}const g=t.query.s||"";let y;const E=r.isAuthenticated&&((d=r.user)==null?void 0:d.id);if(g&&!E){if(ye.isSessionExpired()){await Be(),v.value=[];return}ye.isSecretIdValidated(g)?(console.log("[MapPage] SecretId already validated for this session, not sending in request"),y=void 0):y=g}else E&&(console.log("[MapPage] User is fully authenticated, not sending secretId"),y=void 0);const T=await tr.getProfilesForUserAndCommunity(f,y);v.value=T.filter(I=>I.currentLat!==void 0&&I.currentLat!==null&&I.currentLong!==void 0&&I.currentLong!==null&&!isNaN(I.currentLat)&&!isNaN(I.currentLong)),await ve()}catch(f){console.error("[MapPage] Error loading profiles:",f);const g=f.message||((o=(u=f.response)==null?void 0:u.data)==null?void 0:o.message)||"";((f.status||((c=f.response)==null?void 0:c.status))===401||g.toLowerCase().includes("expired")||g.toLowerCase().includes("invalid")||g.toLowerCase().includes("secret"))&&ye.isSlackLinkUser()?await Be():await(await jt.create({message:g||"Failed to load map data. Please try again.",duration:4e3,color:"danger"})).present(),v.value=[]}finally{i.value=!1}}function ce(){if(!m.value){z.value.clear(),C.value=null;return}const d=m.value.getBounds();if(!d){z.value.clear(),C.value=null;return}k.value||(C.value=null,P.value=null);const u=new Set;M.value.forEach(o=>{const c=o.getPosition();if(c&&d.contains(c)){const f=_.get(o);f&&u.add(f)}}),Z.value.forEach(o=>{if(o.currentLat&&o.currentLong){const c=new window.google.maps.LatLng(o.currentLat,o.currentLong);if(d.contains(c)){const f=o.userId||o.id;u.add(f)}}}),z.value=u,console.log("[MapPage] Updated visible users: ".concat(u.size," users in view (").concat(M.value.length," total markers, ").concat(Z.value.length," total profiles)"))}async function Ot(){var d;if(l.value)try{if(await a(),!((d=window.google)!=null&&d.maps))throw new Error("Google Maps not loaded");const u=v.value.length>0?qe():{lat:39.8283,lng:-98.5795};m.value=new google.maps.Map(l.value,{center:u,zoom:v.value.length>0?10:4,maxZoom:V,mapTypeControl:!0,streetViewControl:!1,fullscreenControl:!0,zoomControl:!0}),x.value=new google.maps.InfoWindow,m.value.addListener("bounds_changed",()=>{ce()}),m.value.addListener("idle",()=>{ce()}),await ve(),ce()}catch(u){console.error("[MapPage] Error initializing map:",u)}}async function ve(){if(!m.value)return;L.value&&(L.value.clearMarkers(),L.value=null),M.value.forEach(o=>o.setMap(null)),M.value=[],_.clear(),S.clear();const d=[],u=Ct(Z.value);console.log("[MapPage] Processing ".concat(Z.value.length," filtered profiles"));for(const o of Z.value){if(!o.currentLat||!o.currentLong)continue;const c=u.get(o.userId||o.id),f=c!=null?c:{lat:o.currentLat,lng:o.currentLong};let g;if(o.profilePicture)try{g=await Oe(o.profilePicture)}catch(T){try{g=await Te(o.profilePicture)}catch(I){console.log("[MapPage] Canvas failed for ".concat(o.fname," ").concat(o.lname,", using direct URL")),g=o.profilePicture}}else g=be();const y=o.userId||o.id,E=new google.maps.Marker({position:f,title:o.fullName||"".concat(o.fname," ").concat(o.lname),icon:{url:g,scaledSize:new google.maps.Size(40,40),anchor:new google.maps.Point(20,20)},optimized:!1});_.set(E,y),S.set(y,E),E.addListener("click",()=>{Lt(E,o,y)}),d.push(E),M.value.push(E)}if(d.length>0&&m.value){console.log("[MapPage] Creating ".concat(d.length," markers"));try{const{SuperClusterAlgorithm:c}=await Vt(()=>Promise.resolve().then(()=>Gr),void 0);L.value=new ke({map:m.value,markers:d,algorithm:new c({radius:cs,minPoints:it,maxZoom:V}),renderer:Ne()})}catch(c){console.warn("[MapPage] Could not load SuperClusterAlgorithm, using default:",c),L.value=new ke({map:m.value,markers:d,renderer:Ne()})}ie();const o=new window.google.maps.LatLngBounds;if(d.forEach(c=>{const f=c.getPosition();f&&o.extend(f)}),d.length>1)m.value.fitBounds(o,{padding:50}),setTimeout(()=>{m.value&&m.value.getZoom()&&m.value.getZoom()>V&&m.value.setZoom(V)},150);else if(d.length===1){const c=d[0].getPosition();c&&(m.value.setCenter(c),m.value.setZoom(Math.min(12,V)))}setTimeout(()=>{ce()},500)}else{if(console.log("[MapPage] No markers to display"),v.value.length>0){const o=qe();m.value.setCenter(o),m.value.setZoom(10)}z.value.clear()}}async function Nt(){await ve()}function qt(d){e.push("/tabs/profile/".concat(d))}return De(()=>n.currentCommunityId,d=>{d&&ze()}),Ut(async()=>{await Bt(),await Tt(),await Ot(),await ze()}),zt(()=>{L.value&&(L.value.clearMarkers(),L.value=null),M.value.forEach(d=>d.setMap(null)),M.value=[],_.clear(),N.clear()}),(d,u)=>(R(),Fe(q(Dt),null,{default:de(()=>[j(q(Jt),{fullscreen:!0,class:"map-content"},{default:de(()=>[b("div",Wr,[b("div",Hr,[u[3]||(u[3]=b("h1",{class:"map-title"},"Community Map",-1)),b("div",{ref_key:"mapContainer",ref:l,class:"map-container"},null,512)]),b("div",Kr,[b("div",Jr,[u[4]||(u[4]=b("h2",{class:"panel-title"},"Community Members",-1)),b("div",Xr,[j(q(Ht),{modelValue:w.value,"onUpdate:modelValue":u[0]||(u[0]=o=>w.value=o),placeholder:"Name, interest, hobby, sports team, etc",class:"panel-search",debounce:300,onIonInput:Nt},null,8,["modelValue"])]),b("div",Qr,X(Z.value.length)+" Results | "+X(It.value)+" In View ",1),p.value.length>0?(R(),Fe(q(je),{key:0,fill:"solid",color:"primary",class:"message-button",onClick:bt},{default:de(()=>[Me(" Message ("+X(p.value.length)+") ",1)]),_:1})):te("",!0)]),b("div",{ref_key:"userListRef",ref:h,class:"user-list"},[(R(!0),B(Ge,null,Ve(Z.value,o=>(R(),B("div",{key:o.userId||o.id,ref_for:!0,ref:c=>St(c,o.userId||o.id),class:Xt(["user-card",{"user-card-selected":Re(o),"user-card-highlighted":P.value===(o.userId||o.id)}]),onClick:c=>At(o)},[b("div",{class:"user-checkbox",onClick:u[1]||(u[1]=He(()=>{},["stop"]))},[j(q(Qt),{checked:Re(o),onIonChange:c=>_t(o)},null,8,["checked","onIonChange"])]),b("div",es,[o.profilePicture?(R(),B("img",{key:0,src:o.profilePicture,alt:o.fullName||"".concat(o.fname," ").concat(o.lname),class:"avatar-image"},null,8,ts)):(R(),B("div",rs,[j(q(Ee),{icon:q(We)},null,8,["icon"])]))]),b("div",ss,[b("h3",ns,X(o.fullName||"".concat(o.fname," ").concat(o.lname)),1),o.currentLocationName?(R(),B("p",os,[j(q(Ee),{icon:q(Yt)},null,8,["icon"]),Me(" "+X(o.currentLocationName),1)])):te("",!0),o.bio?(R(),B("p",as,X(o.bio),1)):te("",!0),o.interests&&o.interests.length>0?(R(),B("div",is,[(R(!0),B(Ge,null,Ve(o.interests.slice(0,5),(c,f)=>(R(),B("span",{key:f,class:"interest-badge"},X(c),1))),128))])):te("",!0)]),b("div",{class:"user-actions",onClick:u[2]||(u[2]=He(()=>{},["stop"]))},[j(q(je),{fill:"outline",size:"small",class:"view-profile-btn",onClick:c=>qt(o.userId||o.id)},{default:de(()=>[...u[5]||(u[5]=[Me(" View Profile ",-1)])]),_:1},8,["onClick"])])],10,Yr))),128)),Z.value.length===0?(R(),B("div",ls,[j(q(Ee),{icon:q(We),class:"empty-icon"},null,8,["icon"]),u[6]||(u[6]=b("p",null,"No members found",-1))])):te("",!0)],512)])]),i.value?(R(),B("div",us,[j(q(Kt)),u[7]||(u[7]=b("p",null,"Loading map...",-1))])):te("",!0)]),_:1})]),_:1}))}}),gs=er(ds,[["__scopeId","data-v-93de8e1a"]]);export{gs as default};
