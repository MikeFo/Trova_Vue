const __vite__fileDeps=["assets/profile.service-CDoO2DLV.js","assets/index-CkJ7yJ3n.js","assets/index-BoVDCu-3.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{F as Ze,r as y,a2 as K,G as Lt,Y as l,O as t,N as n,L as e,X as ue,J as i,W as L,a6 as D,bv as wt,a5 as xe,ac as Re,ae as Oe,bw as Ct,bx as Ae,Z as Pe,by as Cs,aa as Ie,ab as De,H as zt,$ as Ne,R as a,a8 as u,bl as Xt,I as de,ap as Gt,bz as Is,aF as _s,bA as $s,bB as Ss,a0 as Xe,bC as Ds,ag as Y,bD as Qt,an as Ge,bE as qt,a4 as Ve,az as Bt,bj as Ms,bi as Us,bF as Ts,bG as Ns,aA as Zt,bH as Je,am as je,ak as Be,al as We,aq as Ue,ar as kt,Q as qe,b1 as fs,af as dt,aU as Ps,aP as ws,bI as ps,bJ as gs,a7 as as,bK as Ls,aW as ys,bL as es,bM as ct,bN as ts,bO as ss,bP as bt,_ as ns,aB as It,bb as $t,bQ as ft,a9 as Qe,bR as bs,bS as vt,aX as At,ad as ks,v as As,a1 as Os,a3 as Es,a$ as Fs,M as Vs,aK as xs,b3 as Rs,b4 as Wt}from"./index-CkJ7yJ3n.js";import{adminService as w}from"./admin.service-OAfFE2CG.js";import{profileService as hs}from"./profile.service-CDoO2DLV.js";const js={class:"user-management-section"},Bs={class:"section-header"},Ws={class:"filters-section"},qs={class:"filter-controls"},zs={class:"users-table-container"},Ys={key:0,class:"loading-state"},Js={key:1,class:"empty-state"},Hs={key:2,class:"users-table"},Ks=["onClick"],Gs={class:"col-name"},Qs={class:"user-info"},Zs=["src","alt"],Xs={key:1,class:"user-avatar-placeholder"},en={class:"col-email"},tn={class:"col-join-date"},sn={class:"col-status"},nn={class:"col-role"},an={key:1,class:"role-text"},ln=Ze({__name:"UserManagementSection",props:{communityId:{}},emits:["refresh"],setup(Me,{emit:P}){const k=Me,ve=P,Z=zt(),o=y(!1),S=y([]),x=y(""),j=y("name"),U=y("all"),E=K(()=>{let h=[...S.value];if(x.value.trim()){const v=x.value.toLowerCase();h=h.filter(M=>M.fullName.toLowerCase().includes(v)||M.email.toLowerCase().includes(v))}return U.value==="managers"?h=h.filter(v=>v.isManager):U.value==="enabled"?h=h.filter(v=>v.enabled!==!1):U.value==="disabled"&&(h=h.filter(v=>v.enabled===!1)),h.sort((v,M)=>{if(j.value==="name")return v.fullName.localeCompare(M.fullName);if(j.value==="email")return v.email.localeCompare(M.email);if(j.value==="joinDate"){const fe=new Date(v.joinDate||0).getTime();return new Date(M.joinDate||0).getTime()-fe}return 0}),h});async function B(){if(k.communityId){o.value=!0;try{const h=await w.getCommunityMembers(k.communityId);S.value=h,h.length}catch(h){console.error("Error loading members:",h),S.value=[]}finally{o.value=!1}}}function X(){}function G(){}function z(h){const v=h.split(" ");return v.length>=2?(v[0][0]+v[v.length-1][0]).toUpperCase():h.substring(0,2).toUpperCase()}function H(h){return h?new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"}function le(h){Z.push("/tabs/profile/".concat(h))}async function te(h){if(k.communityId)try{await w.toggleUserStatus(h.id,h.enabled===!1),h.enabled=h.enabled===!1,await(await Ne.create({message:"User ".concat(h.enabled?"enabled":"disabled"),duration:2e3,color:"success"})).present(),ve("refresh")}catch(v){console.error("Error toggling user status:",v),await(await Ne.create({message:"Failed to update user status",duration:2e3,color:"danger"})).present()}}async function J(h){if(k.communityId)try{const v=!h.isManager;await w.toggleManager(k.communityId,h.id,v),h.isManager=v,await(await Ne.create({message:"User ".concat(v?"added as":"removed from"," manager"),duration:2e3,color:"success"})).present(),ve("refresh")}catch(v){console.error("Error toggling manager:",v),await(await Ne.create({message:"Failed to update manager status",duration:2e3,color:"danger"})).present()}}async function V(){if(k.communityId)try{const h=await w.exportData(k.communityId,"users");w.downloadCSV(h,"users_".concat(k.communityId,"_").concat(Date.now(),".csv")),await(await Ne.create({message:"Users exported successfully",duration:2e3,color:"success"})).present()}catch(h){console.error("Error exporting users:",h),await(await Ne.create({message:"Failed to export users",duration:2e3,color:"danger"})).present()}}return Lt(()=>{B()}),(h,v)=>(a(),l("div",js,[t("div",Bs,[v[5]||(v[5]=t("h2",{class:"section-title"},"User Management",-1)),n(e(ue),{fill:"outline",size:"small",onClick:V},{default:i(()=>[n(e(D),{icon:e(wt),slot:"start"},null,8,["icon"]),v[4]||(v[4]=L(" Export CSV ",-1))]),_:1})]),t("div",Ws,[n(e(xe),{modelValue:x.value,"onUpdate:modelValue":v[0]||(v[0]=M=>x.value=M),placeholder:"Search by name or email...",debounce:300,onIonInput:X},null,8,["modelValue"]),t("div",qs,[n(e(Re),null,{default:i(()=>[n(e(Oe),null,{default:i(()=>[...v[6]||(v[6]=[L("Sort By",-1)])]),_:1}),n(e(Ct),{modelValue:j.value,"onUpdate:modelValue":v[1]||(v[1]=M=>j.value=M),onIonChange:G},{default:i(()=>[n(e(Ae),{value:"name"},{default:i(()=>[...v[7]||(v[7]=[L("Name",-1)])]),_:1}),n(e(Ae),{value:"email"},{default:i(()=>[...v[8]||(v[8]=[L("Email",-1)])]),_:1}),n(e(Ae),{value:"joinDate"},{default:i(()=>[...v[9]||(v[9]=[L("Join Date",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(e(Re),null,{default:i(()=>[n(e(Oe),null,{default:i(()=>[...v[10]||(v[10]=[L("Filter",-1)])]),_:1}),n(e(Ct),{modelValue:U.value,"onUpdate:modelValue":v[2]||(v[2]=M=>U.value=M),onIonChange:G},{default:i(()=>[n(e(Ae),{value:"all"},{default:i(()=>[...v[11]||(v[11]=[L("All Users",-1)])]),_:1}),n(e(Ae),{value:"managers"},{default:i(()=>[...v[12]||(v[12]=[L("Managers Only",-1)])]),_:1}),n(e(Ae),{value:"enabled"},{default:i(()=>[...v[13]||(v[13]=[L("Enabled Only",-1)])]),_:1}),n(e(Ae),{value:"disabled"},{default:i(()=>[...v[14]||(v[14]=[L("Disabled Only",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),t("div",zs,[o.value?(a(),l("div",Ys,[n(e(Pe)),v[15]||(v[15]=t("p",null,"Loading users...",-1))])):E.value.length===0?(a(),l("div",Js,[...v[16]||(v[16]=[t("p",null,"No users found",-1)])])):(a(),l("div",Hs,[v[18]||(v[18]=Cs('<div class="table-header" data-v-9626e3d5><div class="col-name" data-v-9626e3d5>Name</div><div class="col-email" data-v-9626e3d5>Email</div><div class="col-join-date" data-v-9626e3d5>Join Date</div><div class="col-status" data-v-9626e3d5>Status</div><div class="col-role" data-v-9626e3d5>Role</div><div class="col-actions" data-v-9626e3d5>Actions</div></div>',1)),(a(!0),l(Ie,null,De(E.value,M=>(a(),l("div",{key:M.id,class:"table-row",onClick:fe=>le(M.id)},[t("div",Gs,[t("div",Qs,[M.profilePicture?(a(),l("img",{key:0,src:M.profilePicture,alt:M.fullName,class:"user-avatar"},null,8,Zs)):(a(),l("div",Xs,u(z(M.fullName)),1)),t("span",null,u(M.fullName),1)])]),t("div",en,u(M.email),1),t("div",tn,u(H(M.joinDate)),1),t("div",sn,[n(e(Xt),{color:M.enabled!==!1?"success":"danger",size:"small"},{default:i(()=>[L(u(M.enabled!==!1?"Enabled":"Disabled"),1)]),_:2},1032,["color"])]),t("div",nn,[M.isManager?(a(),de(e(Xt),{key:0,color:"primary",size:"small"},{default:i(()=>[...v[17]||(v[17]=[L(" Manager ",-1)])]),_:1})):(a(),l("span",an,"Member"))]),t("div",{class:"col-actions",onClick:v[3]||(v[3]=Gt(()=>{},["stop"]))},[n(e(ue),{fill:"clear",size:"small",onClick:Gt(fe=>te(M),["stop"])},{default:i(()=>[n(e(D),{icon:M.enabled!==!1?e(Is):e(_s)},null,8,["icon"])]),_:2},1032,["onClick"]),n(e(ue),{fill:"clear",size:"small",onClick:Gt(fe=>J(M),["stop"])},{default:i(()=>[n(e(D),{icon:M.isManager?e($s):e(Ss)},null,8,["icon"])]),_:2},1032,["onClick"])])],8,Ks))),128))]))])]))}}),on=Xe(ln,[["__scopeId","data-v-9626e3d5"]]),rn={class:"data-upload-section"},un={class:"upload-cards"},cn={class:"upload-card"},dn={class:"card-header"},mn={class:"file-input-container"},vn={key:0,class:"file-name"},fn={class:"upload-card"},pn={class:"card-header"},gn={class:"file-input-container"},yn={key:0,class:"file-name"},hn={class:"upload-card"},_n={class:"card-header"},bn={class:"file-input-container"},kn={key:0,class:"file-name"},Cn=Ze({__name:"DataUploadSection",props:{communityId:{}},setup(Me){const P=Me,k=y(null),ve=y(null),Z=y(null),o=y(null),S=y(null),x=y(null),j=y(!1);function U(){var J;(J=k.value)==null||J.click()}function E(){var J;(J=ve.value)==null||J.click()}function B(){var J;(J=Z.value)==null||J.click()}function X(J){var h;const V=J.target;o.value=((h=V.files)==null?void 0:h[0])||null}function G(J){var h;const V=J.target;S.value=((h=V.files)==null?void 0:h[0])||null}function z(J){var h;const V=J.target;x.value=((h=V.files)==null?void 0:h[0])||null}async function H(){if(!(!P.communityId||!o.value)){j.value=!0;try{await w.uploadDriverData(P.communityId,o.value),await(await Ne.create({message:"Driver data uploaded successfully",duration:2e3,color:"success"})).present(),o.value=null,k.value&&(k.value.value="")}catch(J){console.error("Error uploading driver data:",J),await(await Ne.create({message:"Failed to upload driver data",duration:2e3,color:"danger"})).present()}finally{j.value=!1}}}async function le(){if(!(!P.communityId||!S.value)){j.value=!0;try{await w.uploadReportsToData(P.communityId,S.value),await(await Ne.create({message:"Reports to data uploaded successfully",duration:2e3,color:"success"})).present(),S.value=null,ve.value&&(ve.value.value="")}catch(J){console.error("Error uploading reports to data:",J),await(await Ne.create({message:"Failed to upload reports to data",duration:2e3,color:"danger"})).present()}finally{j.value=!1}}}async function te(){if(!(!P.communityId||!x.value)){j.value=!0;try{await w.uploadMappedPairings(P.communityId,x.value),await(await Ne.create({message:"Mapped pairings uploaded successfully",duration:2e3,color:"success"})).present(),x.value=null,Z.value&&(Z.value.value="")}catch(J){console.error("Error uploading pairings:",J),await(await Ne.create({message:"Failed to upload mapped pairings",duration:2e3,color:"danger"})).present()}finally{j.value=!1}}}return(J,V)=>(a(),l("div",rn,[V[9]||(V[9]=t("h2",{class:"section-title"},"Data Upload & Management",-1)),V[10]||(V[10]=t("p",{class:"section-description"},"Upload CSV files to manage community data",-1)),t("div",un,[t("div",cn,[t("div",dn,[n(e(D),{icon:e(Ds),class:"card-icon"},null,8,["icon"]),V[0]||(V[0]=t("h3",{class:"card-title"},"Driver Data",-1))]),V[2]||(V[2]=t("p",{class:"card-description"},"Upload CSV file with driver data",-1)),t("div",mn,[t("input",{ref_key:"driverFileInput",ref:k,type:"file",accept:".csv",onChange:X,style:{display:"none"}},null,544),n(e(ue),{fill:"outline",onClick:U},{default:i(()=>[n(e(D),{icon:e(Qt),slot:"start"},null,8,["icon"]),V[1]||(V[1]=L(" Choose CSV File ",-1))]),_:1}),o.value?(a(),l("div",vn,u(o.value.name),1)):Y("",!0)]),n(e(ue),{expand:"block",onClick:H,disabled:!o.value||j.value},{default:i(()=>[L(u(j.value?"Uploading...":"Upload Driver Data"),1)]),_:1},8,["disabled"])]),t("div",fn,[t("div",pn,[n(e(D),{icon:e(Ge),class:"card-icon"},null,8,["icon"]),V[3]||(V[3]=t("h3",{class:"card-title"},"Reports To Data",-1))]),V[5]||(V[5]=t("p",{class:"card-description"},"Upload CSV with user reports-to-manager data",-1)),t("div",gn,[t("input",{ref_key:"reportsToFileInput",ref:ve,type:"file",accept:".csv",onChange:G,style:{display:"none"}},null,544),n(e(ue),{fill:"outline",onClick:E},{default:i(()=>[n(e(D),{icon:e(Qt),slot:"start"},null,8,["icon"]),V[4]||(V[4]=L(" Choose CSV File ",-1))]),_:1}),S.value?(a(),l("div",yn,u(S.value.name),1)):Y("",!0)]),n(e(ue),{expand:"block",onClick:le,disabled:!S.value||j.value},{default:i(()=>[L(u(j.value?"Uploading...":"Upload Reports To Data"),1)]),_:1},8,["disabled"])]),t("div",hn,[t("div",_n,[n(e(D),{icon:e(qt),class:"card-icon"},null,8,["icon"]),V[6]||(V[6]=t("h3",{class:"card-title"},"Mapped Pairings",-1))]),V[8]||(V[8]=t("p",{class:"card-description"},"Upload CSV with user email pairings for groups (up to 6 users per group)",-1)),t("div",bn,[t("input",{ref_key:"pairingsFileInput",ref:Z,type:"file",accept:".csv",onChange:z,style:{display:"none"}},null,544),n(e(ue),{fill:"outline",onClick:B},{default:i(()=>[n(e(D),{icon:e(Qt),slot:"start"},null,8,["icon"]),V[7]||(V[7]=L(" Choose CSV File ",-1))]),_:1}),x.value?(a(),l("div",kn,u(x.value.name),1)):Y("",!0)]),n(e(ue),{expand:"block",onClick:te,disabled:!x.value||j.value},{default:i(()=>[L(u(j.value?"Uploading...":"Upload Mapped Pairings"),1)]),_:1},8,["disabled"])])])]))}}),In=Xe(Cn,[["__scopeId","data-v-2962b52f"]]),$n={class:"analytics-dashboard-section"},Sn={class:"section-header"},Dn={class:"dashboard-selector"},Mn={class:"dashboard-selector-content"},Un={class:"dashboard-group"},Tn={class:"dashboard-checkboxes"},Nn={key:0,class:"dashboard-group"},Pn={class:"dashboard-checkboxes"},wn={key:0,class:"loading-state"},Ln={key:1,class:"dashboards-grid"},An={class:"dashboard-header"},On={class:"dashboard-title"},En={key:0,class:"loading-mini"},Fn={key:1,class:"dashboard-chart"},Vn=["onClick"],xn={class:"chart-bar-container"},Rn={class:"chart-label"},jn={class:"chart-value"},Bn={key:2,class:"no-data"},Wn={class:"user-stats-table-section"},qn={class:"section-header secondary"},zn={class:"user-table-actions"},Yn={class:"user-table-controls"},Jn={class:"control-field"},Hn={class:"control-field"},Kn={class:"control-field search"},Gn={class:"control-field"},Qn=["value"],Zn={class:"control-summary"},Xn={class:"user-table-wrapper"},ea={key:0,class:"loading-state"},ta={key:1,class:"no-data"},sa={key:2,class:"table-scroll"},na={class:"user-table"},aa=["onClick"],la={key:0},oa={class:"pagination-row"},ia=["disabled"],ra={class:"pager-status"},ua=["disabled"],ca={key:0,class:"loading-state"},da={key:1,class:"no-users"},ma={key:2,class:"users-list"},va=["onClick"],fa={class:"user-avatar"},pa=["src","alt"],ga={key:1,class:"avatar-placeholder"},ya={class:"user-info"},ha={class:"user-name"},_a={class:"user-email"},ba=Ze({__name:"AnalyticsDashboardSection",props:{communityId:{}},setup(Me){const P=Me,k=zt(),ve=y(!1),Z=y(!1),o=y([]),S=y([]),x=y(new Map),j=y(!1),U=y(""),E=y([]),B=y(!1),X=y(null),G=y([]),z=y([]),H=y(0),le=y(!1),te=y(""),J=y("homepageViews"),V=y("desc"),h=y(1),v=y(25),M=y(N()),fe=y($e()),be=[{name:"Name",prop:"name",isVisible:!0},{name:"Trova Opens",prop:"homepageViews",isVisible:!0},{name:"Intros Led To Convos",prop:"introsLedToConvos",isVisible:!0},{name:"Profile Score",prop:"profileCompletionScore",isVisible:!0,isPercent:!0},{name:"City",prop:"city",isVisible:!0},{name:"State",prop:"state",isVisible:!0},{name:"Country",prop:"country",isVisible:!0}],_e=K(()=>(z.value&&z.value.length>0?z.value:be).filter(c=>c.isVisible!==!1)),$=K(()=>{if(!te.value)return G.value;const r=te.value.toLowerCase();return G.value.filter(c=>["name","email","city","state","country"].some(p=>(c[p]||"").toString().toLowerCase().includes(r)))}),I=K(()=>{const r=[...$.value],c=J.value,p=V.value==="asc"?1:-1;return r.sort((A,se)=>{const oe=A==null?void 0:A[c],he=se==null?void 0:se[c];return oe===he?0:typeof oe=="number"&&typeof he=="number"?(oe-he)*p:(oe==null?void 0:oe.toString().localeCompare(he==null?void 0:he.toString()))*p}),r}),d=K(()=>{const r=(h.value-1)*v.value;return I.value.slice(r,r+v.value)}),f=K(()=>{const r=I.value.length;if(r===0)return"Showing 0";const c=(h.value-1)*v.value+1,p=Math.min(r,c+v.value-1);return"Showing ".concat(c,"-").concat(p," of ").concat(H.value||r)});function N(){const r=new Date,c=r.getFullYear(),p=String(r.getMonth()+1).padStart(2,"0");return"".concat(c,"-").concat(p,"-").concat("01")}function $e(){const r=new Date,c=r.getFullYear(),p=String(r.getMonth()+1).padStart(2,"0"),A=String(r.getDate()).padStart(2,"0");return"".concat(c,"-").concat(p,"-").concat(A)}async function ke(){var r;if(P.communityId){le.value=!0;try{const c=M.value?new Date(M.value).toISOString():void 0,p=fe.value?new Date(fe.value+"T23:59:59").toISOString():void 0,A=await w.getSlackUserStats(P.communityId,c,p);G.value=A.rows||[];const se=["spotlights","spotlightscreated","spotlights_created","mentormentee","mentormenteematches","mentor_mentee","mentor_mentee_matches","mentor/mentee","mentor/mentee matches","generalactions","general_actions","profileactions","profile_actions"];z.value=(A.columns||[]).filter(oe=>{const he=(oe.name||"").toLowerCase().replace(/[_\s\/]/g,""),m=(oe.prop||"").toLowerCase().replace(/[_\s\/]/g,"");return!se.some(s=>he.includes(s)||m.includes(s))}),H.value=A.totalUserCount||((r=A.rows)==null?void 0:r.length)||0,h.value=1}catch(c){console.error("[AnalyticsDashboardSection] Error loading user table data:",c),G.value=[],z.value=[],H.value=0}finally{le.value=!1}}}function Ee(){h.value=1}function we(r){J.value===r?V.value=V.value==="asc"?"desc":"asc":(J.value=r,V.value="desc"),h.value=1}function ze(r){const c=Math.max(1,Math.ceil(I.value.length/v.value)),p=h.value+r;p<1||p>c||(h.value=p)}function St(r){v.value=r,h.value=1}function Dt(r,c){const p=r[c.prop];return p==null?"":c.isPercent&&typeof p=="number"?"".concat(p.toFixed(1),"%"):typeof p=="number"?p.toString():String(p)}async function Mt(){if(!P.communityId||I.value.length===0){await(await Ne.create({message:"No data available to export",duration:2e3,color:"warning"})).present();return}try{const r=_e.value.map(oe=>oe.name).join(","),c=I.value.map(oe=>_e.value.map(he=>{const m=oe[he.prop];if(m==null)return"";if(he.isPercent&&typeof m=="number")return"".concat(m.toFixed(1),"%");const s=String(m);return s.includes(",")||s.includes('"')||s.includes("\n")?'"'.concat(s.replace(/"/g,'""'),'"'):s}).join(",")),p=[r,...c].join("\n"),A=new Blob([p],{type:"text/csv"});w.downloadCSV(A,"user_actions_".concat(P.communityId,"_").concat(Date.now(),".csv")),await(await Ne.create({message:"User table exported successfully",duration:2e3,color:"success"})).present()}catch(r){console.error("Error exporting user table:",r),await(await Ne.create({message:"Failed to export user table",duration:2e3,color:"danger"})).present()}}const W=y({}),Te=y({}),Le=y(new Set),He=y(new Set),Ye=y(!0),lt=["interests","activities","businessTopics","skills","mentors","mentees"],re=["intention","movies","music","occupation","organization","university","location"];function Q(){if(!P.communityId)return;const r="admin_dashboards_".concat(P.communityId),c=localStorage.getItem(r);if(c)try{const se=JSON.parse(c),oe=se.filter(he=>!re.includes(he));oe.length!==se.length?(o.value=oe,Ke()):o.value=oe}catch(se){o.value=[...lt]}else o.value=[...lt];const p="admin_dashboards_collapsed_".concat(P.communityId),A=localStorage.getItem(p);A!==null?Ye.value=JSON.parse(A):Ye.value=!0}function Se(){if(Ye.value=!Ye.value,P.communityId){const r="admin_dashboards_collapsed_".concat(P.communityId);localStorage.setItem(r,JSON.stringify(Ye.value))}}function Ke(){if(!P.communityId)return;const r="admin_dashboards_".concat(P.communityId);localStorage.setItem(r,JSON.stringify(o.value))}async function tt(){if(P.communityId){ve.value=!0,Z.value=!1;try{const r=[];r.push(st()),r.push(nt()),r.push(Ot()),r.push(pt()),r.push(Et()),r.push(gt()),await Promise.all(r),Z.value=!0}catch(r){console.error("Error loading dashboard data:",r)}finally{ve.value=!1}}}async function st(){if(P.communityId){Le.value.add("interests");try{const[r,c]=await Promise.all([w.getAttributeChartData(P.communityId,"interest",!0,!0),w.getAttributeChartData(P.communityId,"interest",!1,!0)]);w.verifyConsolidatedData(r,"interests"),W.value.interests=r,Te.value.interests=c}catch(r){console.error("Error loading interests:",r),W.value.interests=[],Te.value.interests=[]}finally{Le.value.delete("interests")}}}async function nt(){if(P.communityId){Le.value.add("activities");try{const[r,c]=await Promise.all([w.getAttributeChartData(P.communityId,"activity",!0,!0),w.getAttributeChartData(P.communityId,"activity",!1,!0)]);w.verifyConsolidatedData(r,"activities"),W.value.activities=r,Te.value.activities=c}catch(r){console.error("Error loading activities:",r),W.value.activities=[],Te.value.activities=[]}finally{Le.value.delete("activities")}}}async function Ot(){if(P.communityId){Le.value.add("businessTopics");try{const[r,c]=await Promise.all([w.getBusinessTopicsChartData(P.communityId,!0,!0),w.getBusinessTopicsChartData(P.communityId,!1,!0)]);w.verifyConsolidatedData(r,"businessTopics"),W.value.businessTopics=r,Te.value.businessTopics=c}catch(r){console.error("Error loading business topics:",r),W.value.businessTopics=[],Te.value.businessTopics=[]}finally{Le.value.delete("businessTopics")}}}async function pt(){if(P.communityId){Le.value.add("skills");try{const[r,c]=await Promise.all([w.getSkillsChartData(P.communityId,"general",!0,!0),w.getSkillsChartData(P.communityId,"general",!1,!0)]);w.verifyConsolidatedData(r,"skills"),W.value.skills=r,Te.value.skills=c}catch(r){console.error("Error loading skills:",r),W.value.skills=[],Te.value.skills=[]}finally{Le.value.delete("skills")}}}async function Et(){if(P.communityId){Le.value.add("mentors");try{const[r,c]=await Promise.all([w.getSkillsChartData(P.communityId,"mentor",!0,!0),w.getSkillsChartData(P.communityId,"mentor",!1,!0)]);w.verifyConsolidatedData(r,"mentors"),W.value.mentors=r,Te.value.mentors=c}catch(r){console.error("Error loading mentors:",r),W.value.mentors=[],Te.value.mentors=[]}finally{Le.value.delete("mentors")}}}async function gt(){if(P.communityId){Le.value.add("mentees");try{const[r,c]=await Promise.all([w.getSkillsChartData(P.communityId,"mentee",!0,!0),w.getSkillsChartData(P.communityId,"mentee",!1,!0)]);w.verifyConsolidatedData(r,"mentees"),W.value.mentees=r,Te.value.mentees=c}catch(r){console.error("Error loading mentees:",r),W.value.mentees=[],Te.value.mentees=[]}finally{Le.value.delete("mentees")}}}async function Ft(){if(P.communityId)try{const r=await w.getCustomFieldsForCharts(P.communityId);S.value=r||[],ot()}catch(r){console.error("Error loading custom fields:",r),S.value=[]}}function ot(){if(!P.communityId)return;const r=[],c=[];o.value.forEach(A=>{if(A.startsWith("custom-custom-")){const se=A.replace("custom-custom-","custom-");r.push(A),o.value.includes(se)||c.push(se)}}),r.length>0&&(console.log("[AnalyticsDashboard] Fixing ".concat(r.length," bad custom field keys:"),r),r.forEach(A=>{const se=o.value.indexOf(A);se>-1&&o.value.splice(se,1)}),c.forEach(A=>{o.value.includes(A)||o.value.push(A)}),Ke()),o.value.filter(A=>A.startsWith("custom-")&&!A.startsWith("custom-custom-")).map(A=>{const se=A.replace(/^custom-custom-/,"custom-").replace(/^custom-/,""),oe=parseInt(se,10);return isNaN(oe)?null:oe}).filter(A=>A!==null).forEach(A=>{const se="custom-".concat(A),oe=W.value[se]&&W.value[se].length>0,he=He.value.has(A);!oe&&!he&&Vt(A)})}async function Vt(r){if(P.communityId){He.value.add(r);try{const[c,p]=await Promise.all([w.getCustomFieldChartData(P.communityId,r,!0,!0),w.getCustomFieldChartData(P.communityId,r,!1,!0)]),A=m=>Array.isArray(m)?m:m&&Array.isArray(m.results)?m.results:m&&Array.isArray(m.data)?m.data:(console.warn("[AnalyticsDashboard] Unexpected response format for custom field ".concat(r,":"),m),[]),se=A(c),oe=A(p),he=typeof c=="object"&&!Array.isArray(c)&&((c==null?void 0:c.fieldName)||(c==null?void 0:c.customFieldName))||typeof p=="object"&&!Array.isArray(p)&&((p==null?void 0:p.fieldName)||(p==null?void 0:p.customFieldName));if(he&&typeof he=="string"){const m=new Map(x.value);m.set(r,he),x.value=m,console.log("[AnalyticsDashboard] Custom field ".concat(r," fieldName stored:"),he),console.log("[AnalyticsDashboard] customFieldNames Map now has:",Array.from(x.value.entries()))}else console.warn("[AnalyticsDashboard] Could not extract fieldName for custom field ".concat(r," from responses:"),{consolidatedResponse:c,rawResponse:p});w.verifyConsolidatedData(se,"custom-field-".concat(r)),W.value["custom-".concat(r)]=se,Te.value["custom-".concat(r)]=oe}catch(c){console.error("Error loading custom field ".concat(r,":"),c),W.value["custom-".concat(r)]=[],Te.value["custom-".concat(r)]=[]}finally{He.value.delete(r)}}}function yt(r){const c=o.value.indexOf(r);c>-1?o.value.splice(c,1):(o.value.push(r),!W.value[r]&&!Le.value.has(r)&&Ut(r)),Ke()}function ht(r){if(typeof r.id=="number")return r.id;if(typeof r.customFieldId=="number")return r.customFieldId;if(typeof r.id=="string")if(r.id.startsWith("custom-")){const c=parseInt(r.id.replace("custom-",""),10);return isNaN(c)?null:c}else{const c=parseInt(r.id,10);return isNaN(c)?null:c}return null}function it(r){const c=ht(r);return!c||c<=0?"custom-invalid-".concat(r.id):"custom-".concat(c)}function Yt(r){const c=ht(r);if(!c||c<=0){console.warn("[AnalyticsDashboard] Could not extract customFieldId from field:",r);return}const p="custom-".concat(c);yt(p),ot()}async function Ut(r){const c={interests:st,activities:nt,businessTopics:Ot,skills:pt,mentors:Et,mentees:gt};if(c[r])await c[r]();else if(r.startsWith("custom-")){const p=parseInt(r.replace("custom-",""),10);!isNaN(p)&&p>0&&await Vt(p)}}function rt(r){var p;const c=W.value[r];if(r.startsWith("custom-")){const A=parseInt(r.replace(/^custom-custom-/,"custom-").replace(/^custom-/,""),10);isNaN(A)||(!c||c.length===0)&&console.log("[AnalyticsDashboard] getDashboardData('".concat(r,"') returning empty - data exists:"),!!W.value[r],"length:",(p=W.value[r])==null?void 0:p.length)}return c||[]}function xt(r){const c=W.value[r],p=c!==void 0,A=Le.value.has(r)||r.startsWith("custom-")&&He.value.has(parseInt(r.replace(/^custom-custom-/,"custom-").replace(/^custom-/,""),10));return r.startsWith("custom-")&&p&&!A&&Array.isArray(c)&&c.length===0?"No users have this datapoint":"No data available"}function mt(r){if(r.startsWith("custom-")){const c=r.replace(/^custom-custom-/,"custom-").replace(/^custom-/,""),p=parseInt(c,10);if(isNaN(p)||p<=0)return console.warn("[AnalyticsDashboard] Invalid custom field ID in dashboard: ".concat(r," (cleaned: ").concat(c,")")),"Custom Field";const A=x.value.get(p);if(A)return console.log("[AnalyticsDashboard] getDashboardTitle('".concat(r,"') using chartFieldName: ").concat(A)),A;const se=S.value.find(oe=>oe.id===p);return se!=null&&se.name?(console.log("[AnalyticsDashboard] getDashboardTitle('".concat(r,"') using field.name: ").concat(se.name)),se.name):se!=null&&se.label?(console.log("[AnalyticsDashboard] getDashboardTitle('".concat(r,"') using field.label: ").concat(se.label)),se.label):"Custom Field ".concat(p)}return at(r)}function at(r){return r.replace(/([A-Z])/g," $1").replace(/^./,c=>c.toUpperCase()).trim()}function Jt(r){const c=rt(r);return!c||c.length===0?1:Math.max(...c.map(p=>p.value))}function Rt(r){if(r.startsWith("custom-")){const c=parseInt(r.replace("custom-",""),10);return isNaN(c)||c<=0?!1:He.value.has(c)}return Le.value.has(r)}function jt(r,c){const p=["Name","Count"],A=r.map(se=>[se.name,se.value.toString()]);return[p,...A].map(se=>se.join(",")).join("\n")}async function Tt(r){if(P.communityId)try{const c=Te.value[r]||W.value[r]||[];if(c.length===0){await(await Ne.create({message:"No data available to export",duration:2e3,color:"warning"})).present();return}const p=jt(c,r),A=new Blob([p],{type:"text/csv"});w.downloadCSV(A,"".concat(r,"_").concat(P.communityId,"_").concat(Date.now(),".csv")),await(await Ne.create({message:"Dashboard exported successfully",duration:2e3,color:"success"})).present()}catch(c){console.error("Error exporting dashboard:",c),await(await Ne.create({message:"Failed to export dashboard",duration:2e3,color:"danger"})).present()}}async function ut(){if(P.communityId)try{const r=[];if(o.value.forEach(oe=>{const he=Te.value[oe]||W.value[oe]||[];he.length>0&&r.push({dashboard:oe,data:he})}),r.length===0){await(await Ne.create({message:"No data available to export",duration:2e3,color:"warning"})).present();return}const c=[];r.forEach(({dashboard:oe,data:he})=>{c.push("\n=== ".concat(mt(oe)," ===")),c.push("Name,Count"),he.forEach(m=>{c.push("".concat(m.name,",").concat(m.value))})});const p=c.join("\n"),A=new Blob([p],{type:"text/csv"});w.downloadCSV(A,"insights_".concat(P.communityId,"_").concat(Date.now(),".csv")),await(await Ne.create({message:"All dashboards exported successfully",duration:2e3,color:"success"})).present()}catch(r){console.error("Error exporting dashboards:",r),await(await Ne.create({message:"Failed to export dashboards",duration:2e3,color:"danger"})).present()}}Lt(async()=>{P.communityId&&(Q(),await tt(),await Ft(),ot(),ke())}),Ve(()=>P.communityId,(r,c)=>{r&&r!==c&&(W.value={},Te.value={},S.value=[],x.value.clear(),o.value=[],Le.value.clear(),He.value.clear(),Z.value=!1,G.value=[],z.value=[],H.value=0,Q(),tt(),Ft(),ke())},{immediate:!1}),Ve(()=>o.value,()=>{ot()},{deep:!0});async function Ht(r,c){if(P.communityId){X.value={dashboard:r,value:c},U.value="".concat(mt(r),": ").concat(c),j.value=!0,B.value=!0,E.value=[];try{let p=[];if(r==="interests")p=await w.getUsersByAttribute(P.communityId,"interest",c,!0);else if(r==="activities")p=await w.getUsersByAttribute(P.communityId,"activity",c,!0);else if(r==="businessTopics")p=await w.getUsersByBusinessTopic(P.communityId,c,!0);else if(r==="skills")p=await w.getUsersBySkill(P.communityId,"general",c,!0);else if(r==="mentors")p=await w.getUsersBySkill(P.communityId,"mentor",c,!0);else if(r==="mentees")p=await w.getUsersBySkill(P.communityId,"mentee",c,!0);else if(r.startsWith("custom-")){const s=parseInt(r.replace("custom-",""),10);!isNaN(s)&&s>0?p=await w.getUsersByCustomField(P.communityId,s,c,!0):console.warn('[AnalyticsDashboard] Invalid customFieldId extracted from dashboard: "'.concat(r,'"'))}const se=rt(r).find(s=>{const T=C=>(C==null?"":String(C)).trim().toLowerCase();return T(s.name||s.label||s.valueName||s.value_name)===T(c)}),oe=(se==null?void 0:se.value)||0,he=(p==null?void 0:p.length)||0;if(!p||p.length===0||oe>0&&he<oe){he>0&&he<oe&&console.warn("[AnalyticsDashboard] Count mismatch: expected ".concat(oe," users but got ").concat(he,", using fallback"));const s=Te.value[r]||[],T=g=>(g==null?"":String(g)).trim().toLowerCase(),C=T(c),_=g=>{var ae,q,ee,ce,ge,Fe,b,Ce,R;return(R=(Ce=(b=(Fe=(ge=(ce=(ee=(q=(ae=g==null?void 0:g.name)!=null?ae:g==null?void 0:g.label)!=null?q:g==null?void 0:g.valueName)!=null?ee:g==null?void 0:g.value_name)!=null?ce:g==null?void 0:g.attribute)!=null?ge:g==null?void 0:g.attributeName)!=null?Fe:g==null?void 0:g.attribute_name)!=null?b:g==null?void 0:g.skill)!=null?Ce:g==null?void 0:g.topic)!=null?R:""},F=r==="location",ne=s.filter(g=>{const ae=T(_(g));return ae?F?ae.includes(C):ae===C:!1}),me=g=>{const ae=[g==null?void 0:g.userId,g==null?void 0:g.user_id,g==null?void 0:g.profileId,g==null?void 0:g.profile_id,g==null?void 0:g.memberId,g==null?void 0:g.member_id,g==null?void 0:g.id,g==null?void 0:g.slackUserId,g==null?void 0:g.slack_user_id];for(const q of ae){const ee=typeof q=="string"?parseInt(q,10):q;if(typeof ee=="number"&&Number.isFinite(ee)&&ee>0)return ee}if(g!=null&&g.user){const q=[g.user.id,g.user.userId,g.user.user_id,g.user.memberId,g.user.member_id];for(const ee of q){const ce=typeof ee=="string"?parseInt(ee,10):ee;if(typeof ce=="number"&&Number.isFinite(ce)&&ce>0)return ce}}if(g!=null&&g.profile){const q=[g.profile.userId,g.profile.user_id,g.profile.id,g.profile.memberId,g.profile.member_id];for(const ee of q){const ce=typeof ee=="string"?parseInt(ee,10):ee;if(typeof ce=="number"&&Number.isFinite(ce)&&ce>0)return ce}}if(g!=null&&g.member){const q=[g.member.userId,g.member.user_id,g.member.id,g.member.memberId,g.member.member_id];for(const ee of q){const ce=typeof ee=="string"?parseInt(ee,10):ee;if(typeof ce=="number"&&Number.isFinite(ce)&&ce>0)return ce}}if(Array.isArray(g==null?void 0:g.users))for(const q of g.users){const ee=[q==null?void 0:q.id,q==null?void 0:q.userId,q==null?void 0:q.user_id,q==null?void 0:q.memberId,q==null?void 0:q.member_id];for(const ce of ee){const ge=typeof ce=="string"?parseInt(ce,10):ce;if(typeof ge=="number"&&Number.isFinite(ge)&&ge>0)return ge}}if(g!=null&&g.join_user_business_topic){const q=[g.join_user_business_topic.userId,g.join_user_business_topic.user_id,g.join_user_business_topic.memberId,g.join_user_business_topic.member_id];for(const ee of q){const ce=typeof ee=="string"?parseInt(ee,10):ee;if(typeof ce=="number"&&Number.isFinite(ce)&&ce>0)return ce}}if(g!=null&&g.join_user_skill){const q=[g.join_user_skill.userId,g.join_user_skill.user_id,g.join_user_skill.memberId,g.join_user_skill.member_id];for(const ee of q){const ce=typeof ee=="string"?parseInt(ee,10):ee;if(typeof ce=="number"&&Number.isFinite(ce)&&ce>0)return ce}}return null},pe=new Set;for(const g of ne){const ae=me(g);ae&&pe.add(ae)}if(pe.size>0){const g=await hs.getProfilesForUserAndCommunity(P.communityId),ae=new Map;for(const q of g){const ee=(q==null?void 0:q.userId)||(q==null?void 0:q.id);typeof ee=="number"&&ae.set(ee,q)}p=Array.from(pe).map(q=>ae.get(q)).filter(Boolean).map(q=>{var ee;return{id:q.userId||q.id,fname:q.fname,lname:q.lname,fullName:q.fullName||"".concat(q.fname||""," ").concat(q.lname||"").trim(),email:q.email||"",profilePicture:q.profilePicture,enabled:(ee=q.enabled)!=null?ee:!0}})}else if(console.warn("[AnalyticsDashboard] ⚠️ No user IDs found in raw dashboard data for ".concat(r,': "').concat(c,'"')),r==="businessTopics"||r==="mentors"||r==="mentees"||r==="interests"||r==="activities")try{let g=[];r==="businessTopics"?g=await w.getBusinessTopicsChartData(P.communityId,!1,!0):r==="mentors"?g=await w.getSkillsChartData(P.communityId,"mentor",!1,!0):r==="mentees"?g=await w.getSkillsChartData(P.communityId,"mentee",!1,!0):r==="interests"?g=await w.getAttributeChartData(P.communityId,"interest",!1,!0):r==="activities"&&(g=await w.getAttributeChartData(P.communityId,"activity",!1,!0));const ae=b=>(b==null?"":String(b)).trim().toLowerCase(),q=ae(c),ee=b=>{var Ce,R,ie,ye,et,Nt,Pt;return(Pt=(Nt=(et=(ye=(ie=(R=(Ce=b==null?void 0:b.name)!=null?Ce:b==null?void 0:b.label)!=null?R:b==null?void 0:b.valueName)!=null?ie:b==null?void 0:b.value_name)!=null?ye:b==null?void 0:b.attribute)!=null?et:b==null?void 0:b.skill)!=null?Nt:b==null?void 0:b.topic)!=null?Pt:""},ce=g.filter(b=>{const Ce=ae(ee(b));return Ce?Ce===q:!1}),ge=new Set,Fe=b=>{const Ce=[b==null?void 0:b.userId,b==null?void 0:b.user_id,b==null?void 0:b.memberId,b==null?void 0:b.member_id,b==null?void 0:b.profileId,b==null?void 0:b.profile_id,b==null?void 0:b.id,b==null?void 0:b.slackUserId,b==null?void 0:b.slack_user_id];for(const R of Ce){const ie=typeof R=="string"?parseInt(R,10):R;if(typeof ie=="number"&&Number.isFinite(ie)&&ie>0)return ie}if(b!=null&&b.user){const R=[b.user.id,b.user.userId,b.user.user_id,b.user.memberId,b.user.member_id];for(const ie of R){const ye=typeof ie=="string"?parseInt(ie,10):ie;if(typeof ye=="number"&&Number.isFinite(ye)&&ye>0)return ye}}if(b!=null&&b.profile){const R=[b.profile.userId,b.profile.user_id,b.profile.id,b.profile.memberId,b.profile.member_id];for(const ie of R){const ye=typeof ie=="string"?parseInt(ie,10):ie;if(typeof ye=="number"&&Number.isFinite(ye)&&ye>0)return ye}}if(b!=null&&b.member){const R=[b.member.userId,b.member.user_id,b.member.id,b.member.memberId,b.member.member_id];for(const ie of R){const ye=typeof ie=="string"?parseInt(ie,10):ie;if(typeof ye=="number"&&Number.isFinite(ye)&&ye>0)return ye}}if(Array.isArray(b==null?void 0:b.users))for(const R of b.users){const ie=[R==null?void 0:R.id,R==null?void 0:R.userId,R==null?void 0:R.user_id,R==null?void 0:R.memberId,R==null?void 0:R.member_id];for(const ye of ie){const et=typeof ye=="string"?parseInt(ye,10):ye;if(typeof et=="number"&&Number.isFinite(et)&&et>0)return et}}if(b!=null&&b.join_user_business_topic){const R=[b.join_user_business_topic.userId,b.join_user_business_topic.user_id,b.join_user_business_topic.memberId,b.join_user_business_topic.member_id];for(const ie of R){const ye=typeof ie=="string"?parseInt(ie,10):ie;if(typeof ye=="number"&&Number.isFinite(ye)&&ye>0)return ye}}if(b!=null&&b.join_user_skill){const R=[b.join_user_skill.userId,b.join_user_skill.user_id,b.join_user_skill.memberId,b.join_user_skill.member_id];for(const ie of R){const ye=typeof ie=="string"?parseInt(ie,10):ie;if(typeof ye=="number"&&Number.isFinite(ye)&&ye>0)return ye}}return null};for(const b of ce){const Ce=Fe(b);Ce?ge.add(Ce):console.log("[AnalyticsDashboard] ⚠️ Matched row but no user ID found:",{keys:Object.keys(b),hasUser:!!(b!=null&&b.user),hasProfile:!!(b!=null&&b.profile),hasMember:!!(b!=null&&b.member),hasUsers:Array.isArray(b==null?void 0:b.users),stringified:JSON.stringify(b).substring(0,500)})}if(ge.size>0){const b=await hs.getProfilesForUserAndCommunity(P.communityId),Ce=new Map;for(const R of b){const ie=(R==null?void 0:R.userId)||(R==null?void 0:R.id);typeof ie=="number"&&Ce.set(ie,R)}p=Array.from(ge).map(R=>Ce.get(R)).filter(Boolean).map(R=>{var ie;return{id:R.userId||R.id,fname:R.fname,lname:R.lname,fullName:R.fullName||"".concat(R.fname||""," ").concat(R.lname||"").trim(),email:R.email||"",profilePicture:R.profilePicture,enabled:(ie=R.enabled)!=null?ie:!0}}),console.log("[AnalyticsDashboard] ✅ Fresh unconsolidated endpoint recovered ".concat(p.length," users for ").concat(r,': "').concat(c,'"'))}}catch(g){console.error("[AnalyticsDashboard] Error fetching fresh unconsolidated data for ".concat(r,":"),g)}}E.value=p}catch(p){console.error("[AnalyticsDashboard] Error loading users for ".concat(r,': "').concat(c,'":'),p),E.value=[]}finally{B.value=!1}}}function _t(){j.value=!1,E.value=[],X.value=null,B.value=!1}function Kt(r){k.push("/tabs/profile/".concat(r)),_t()}return(r,c)=>(a(),l(Ie,null,[t("div",$n,[t("div",Sn,[c[7]||(c[7]=t("h2",{class:"section-title"},"Insights & Analytics Dashboard",-1)),n(e(ue),{fill:"outline",size:"small",onClick:ut},{default:i(()=>[n(e(D),{icon:e(wt),slot:"start"},null,8,["icon"]),c[6]||(c[6]=L(" Export All CSV ",-1))]),_:1})]),t("div",Dn,[t("div",{class:"dashboard-selector-header",onClick:Se},[c[8]||(c[8]=t("h3",{class:"subsection-title"},"Available Dashboards",-1)),n(e(D),{icon:Ye.value?e(Ms):e(Us),class:"collapse-icon"},null,8,["icon"])]),Bt(t("div",Mn,[t("div",Un,[c[9]||(c[9]=t("h4",{class:"group-title"},"Default Dashboards",-1)),t("div",Tn,[(a(),l(Ie,null,De(lt,p=>t("div",{key:p,class:"dashboard-checkbox-item"},[n(e(fs),{checked:o.value.includes(p),onIonChange:A=>yt(p)},null,8,["checked","onIonChange"]),n(e(Oe),null,{default:i(()=>[L(u(at(p)),1)]),_:2},1024)])),64))])]),S.value.length>0?(a(),l("div",Nn,[c[10]||(c[10]=t("h4",{class:"group-title"},"Custom Field Dashboards",-1)),t("div",Pn,[(a(!0),l(Ie,null,De(S.value,p=>(a(),l("div",{key:p.id,class:"dashboard-checkbox-item"},[n(e(fs),{checked:o.value.includes(it(p)),onIonChange:A=>Yt(p)},null,8,["checked","onIonChange"]),n(e(Oe),null,{default:i(()=>[L(u(p.name||p.label||"Custom Field ".concat(p.id)),1)]),_:2},1024)]))),128))])])):Y("",!0)],512),[[Ts,!Ye.value]])]),ve.value&&!Z.value?(a(),l("div",wn,[n(e(Pe)),c[11]||(c[11]=t("p",null,"Loading dashboards...",-1))])):(a(),l("div",Ln,[(a(!0),l(Ie,null,De(o.value,p=>(a(),l("div",{key:p,class:"dashboard-card"},[t("div",An,[t("h3",On,u(mt(p)),1),n(e(ue),{fill:"clear",size:"small",onClick:A=>Tt(p)},{default:i(()=>[n(e(D),{icon:e(wt)},null,8,["icon"])]),_:1},8,["onClick"])]),Rt(p)?(a(),l("div",En,[n(e(Pe),{name:"dots"})])):rt(p)&&rt(p).length>0?(a(),l("div",Fn,[t("div",{class:dt(["chart-items-container",{"chart-scrollable":rt(p).length>10}])},[(a(!0),l(Ie,null,De(rt(p),A=>(a(),l("div",{key:A.name,class:"chart-item",onClick:se=>Ht(p,A.name)},[t("div",xn,[t("div",{class:"chart-bar",style:Ps({width:"".concat(A.value/Jt(p)*100,"%")})},null,4)]),t("div",Rn,u(A.name),1),t("div",jn,u(A.value),1)],8,Vn))),128))],2)])):(a(),l("div",Bn,u(xt(p)),1))]))),128))])),t("div",Wn,[t("div",qn,[c[14]||(c[14]=t("h3",{class:"section-title-small"},"User Actions Table",-1)),t("div",zn,[n(e(ue),{fill:"clear",size:"small",onClick:ke},{default:i(()=>[n(e(D),{icon:e(Ns),slot:"start"},null,8,["icon"]),c[12]||(c[12]=L(" Refresh ",-1))]),_:1}),n(e(ue),{fill:"outline",size:"small",onClick:Mt},{default:i(()=>[n(e(D),{icon:e(wt),slot:"start"},null,8,["icon"]),c[13]||(c[13]=L(" Download CSV ",-1))]),_:1})])]),t("div",Yn,[t("div",Jn,[c[15]||(c[15]=t("label",null,"Start Date",-1)),Bt(t("input",{type:"date","onUpdate:modelValue":c[0]||(c[0]=p=>M.value=p),onChange:ke},null,544),[[Zt,M.value]])]),t("div",Hn,[c[16]||(c[16]=t("label",null,"End Date",-1)),Bt(t("input",{type:"date","onUpdate:modelValue":c[1]||(c[1]=p=>fe.value=p),onChange:ke},null,544),[[Zt,fe.value]])]),t("div",Kn,[Bt(t("input",{type:"search",placeholder:"Search name, email, city, state, country","onUpdate:modelValue":c[2]||(c[2]=p=>te.value=p),onInput:Ee},null,544),[[Zt,te.value]])]),t("div",Gn,[c[18]||(c[18]=t("label",null,"Page size",-1)),t("select",{value:v.value,onChange:c[3]||(c[3]=p=>St(parseInt(p.target.value)))},[...c[17]||(c[17]=[t("option",{value:10},"10",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1)])],40,Qn)]),t("div",Zn,u(f.value),1)]),t("div",Xn,[le.value?(a(),l("div",ea,[n(e(Pe)),c[19]||(c[19]=t("p",null,"Loading users...",-1))])):d.value.length===0?(a(),l("div",ta," No user data for this range. ")):(a(),l("div",sa,[t("table",na,[t("thead",null,[t("tr",null,[(a(!0),l(Ie,null,De(_e.value,p=>(a(),l("th",{key:p.prop,onClick:A=>we(p.prop),class:dt({sortable:!0,active:J.value===p.prop})},[L(u(p.name)+" ",1),J.value===p.prop?(a(),l("span",la,u(V.value==="asc"?"▲":"▼"),1)):Y("",!0)],10,aa))),128))])]),t("tbody",null,[(a(!0),l(Ie,null,De(d.value,p=>(a(),l("tr",{key:p.email||p.name},[(a(!0),l(Ie,null,De(_e.value,A=>(a(),l("td",{key:A.prop},u(Dt(p,A)),1))),128))]))),128))])])])),t("div",oa,[t("button",{class:"pager",disabled:h.value===1,onClick:c[4]||(c[4]=p=>ze(-1))},"Prev",8,ia),t("span",ra,u(f.value),1),t("button",{class:"pager",disabled:h.value>=Math.max(1,Math.ceil(I.value.length/v.value)),onClick:c[5]||(c[5]=p=>ze(1))}," Next ",8,ua)])])])]),n(e(Je),{"is-open":j.value,onDidDismiss:_t,onWillDismiss:_t,"backdrop-dismiss":!0},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[n(e(We),null,{default:i(()=>[L(u(U.value),1)]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{onClick:_t,fill:"clear"},{default:i(()=>[n(e(D),{icon:e(kt)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{class:"user-modal-content"},{default:i(()=>[B.value?(a(),l("div",ca,[n(e(Pe)),c[20]||(c[20]=t("p",null,"Loading users...",-1))])):E.value.length===0?(a(),l("div",da,[n(e(D),{icon:e(Ge),class:"no-users-icon"},null,8,["icon"]),c[21]||(c[21]=t("p",null,"No users found",-1)),c[22]||(c[22]=t("p",{class:"no-users-hint"},"This feature requires backend support or user profile data to be available.",-1))])):(a(),l("div",ma,[(a(!0),l(Ie,null,De(E.value,p=>(a(),l("div",{key:p.id,class:"user-item",onClick:A=>Kt(p.id)},[t("div",fa,[p.profilePicture?(a(),l("img",{key:0,src:p.profilePicture,alt:p.fullName},null,8,pa)):(a(),l("div",ga,u(p.fullName.charAt(0).toUpperCase()),1))]),t("div",ya,[t("div",ha,u(p.fullName),1),t("div",_a,u(p.email),1)]),n(e(D),{icon:e(ws),class:"chevron-icon"},null,8,["icon"])],8,va))),128))]))]),_:1})]),_:1},8,["is-open"])],64))}}),ka=Xe(ba,[["__scopeId","data-v-feae6a48"]]),Ca={class:"user-stats-section"},Ia={class:"section-header"},$a={class:"header-actions"},Sa={class:"time-period-wrapper"},Da={key:0,class:"loading-state"},Ma={key:1,class:"dashboard-content"},Ua={class:"primary-metrics-section"},Ta={class:"primary-metrics-grid"},Na={class:"metric-icon"},Pa={class:"metric-content"},wa={class:"metric-value"},La={key:0},Aa={key:1},Oa={class:"metric-icon"},Ea={class:"metric-content"},Fa={class:"metric-value"},Va={class:"metric-icon"},xa={class:"metric-content"},Ra={class:"metric-value"},ja={key:0,class:"engagement-metrics-section"},Ba={class:"engagement-metrics-grid"},Wa={class:"metric-icon-small"},qa={class:"metric-content-small"},za={class:"metric-value-small"},Ya={key:1,class:"engagement-metric-card"},Ja={class:"metric-icon-small"},Ha={class:"metric-content-small"},Ka={class:"metric-value-small"},Ga={class:"metric-icon-small"},Qa={class:"metric-content-small"},Za={class:"metric-value-small"},Xa={class:"metric-icon-small"},el={class:"metric-content-small"},tl={class:"metric-value-small"},sl={key:1,class:"engagement-metrics-section"},nl={class:"engagement-metrics-grid"},al={class:"metric-icon-small"},ll={class:"metric-content-small"},ol={class:"metric-value-small"},il={key:0},rl={key:1},ul={key:2},cl={class:"metric-icon-small"},dl={class:"metric-content-small"},ml={class:"metric-value-small"},vl={key:0},fl={key:1},pl={key:2},gl={class:"metric-icon-small"},yl={class:"metric-content-small"},hl={class:"metric-value-small"},_l={key:0},bl={key:1},kl={key:2},Cl={key:2,class:"engagement-metrics-section"},Il={class:"engagement-metrics-grid"},$l={class:"metric-icon-small"},Sl={class:"metric-content-small"},Dl={class:"metric-value-small"},Ml={class:"metric-icon-small"},Ul={class:"metric-content-small"},Tl={class:"metric-value-small"},Nl={class:"metric-icon-small"},Pl={class:"metric-content-small"},wl={class:"metric-value-small"},Ll={key:3,class:"legacy-stats-section"},Al={class:"legacy-stats-grid"},Ol={key:0,class:"stat-card"},El={class:"stat-value"},Fl={key:1,class:"stat-card"},Vl={class:"stat-value"},xl={key:2,class:"no-stats"},Rl={class:"profile-modal-controls"},jl={key:0,class:"loading-state"},Bl={key:1,class:"profiles-table"},Wl={class:"profiles-table-header"},ql={key:0,class:"sort-icon"},zl={key:0,class:"sort-icon"},Yl={class:"col-name name-cell"},Jl={key:0,class:"avatar"},Hl=["src","alt"],Kl={key:1,class:"avatar placeholder"},Gl={class:"name-meta"},Ql={class:"name-text"},Zl={key:0,class:"email-text"},Xl={class:"col-completion"},eo={key:2,class:"no-stats"},to={class:"profile-modal-controls"},so={key:0,class:"loading-state"},no={key:1,class:"profiles-table"},ao={class:"profiles-table-header"},lo={key:0,class:"sort-icon"},oo={key:0,class:"sort-icon"},io={class:"col-name name-cell"},ro={key:0,class:"avatar"},uo=["src","alt"],co={key:1,class:"avatar placeholder"},mo={class:"name-meta"},vo={class:"name-text"},fo={key:0,class:"email-text"},po={class:"col-completion"},go={key:2,class:"no-stats"},yo={key:0},ho={key:1},_o={class:"profile-modal-controls"},bo={key:0,class:"loading-state"},ko={key:1,class:"profiles-table onboarding-intros-table"},Co={class:"col-name name-cell"},Io={key:0,class:"avatar"},$o=["src","alt"],So={key:1,class:"avatar placeholder"},Do={class:"name-meta"},Mo={class:"name-text"},Uo={key:0,class:"email-text"},To={class:"col-completion onboarding-intro-date"},No={class:"intro-date"},Po={class:"intro-time"},wo={key:2,class:"no-stats"},Lo={key:0},Ao={key:1},Oo={class:"profile-modal-controls"},Eo={key:0,class:"loading-state"},Fo={key:1,class:"profiles-table conversations-started-table"},Vo={class:"profiles-table-header"},xo={key:0,class:"sort-icon"},Ro={key:0,class:"sort-icon"},jo={key:0,class:"sort-icon"},Bo={class:"col-name"},Wo={class:"name-text"},qo={class:"col-participants"},zo={class:"col-date onboarding-intro-date"},Yo={class:"intro-date"},Jo={class:"intro-time"},Ho={class:"col-messages"},Ko={key:2,class:"no-stats"},Go={key:0},Qo={key:1},Zo={class:"profile-modal-controls"},Xo={key:0,class:"loading-state"},ei={key:1,class:"profiles-table self-introduced-table"},ti={class:"profiles-table-header"},si={key:0,class:"sort-icon"},ni={key:0,class:"sort-icon"},ai={key:0,class:"sort-icon"},li={class:"col-name name-cell"},oi={key:0,class:"avatar"},ii=["src","alt"],ri={key:1,class:"avatar placeholder"},ui={class:"name-meta"},ci={class:"name-text"},di={key:0,class:"email-text"},mi={class:"col-date onboarding-intro-date"},vi={class:"intro-date"},fi={class:"intro-time"},pi={class:"col-channel"},gi={key:2,class:"no-stats"},yi={key:0},hi={key:1},_i=Ze({__name:"UserStatsSection",props:{communityId:{}},emits:["openMagicIntros","openChannelPairings","openMentorMenteeMatches","openConnections","openSkills","openMentorList"],setup(Me,{emit:P}){const k=Me,ve=P;zt();const Z=y(!1),o=y(null);y([]),y(!1);const S=y("12-months"),x=y(!1),j=y(!1),U=y([]),E=y(""),B=y("completion-desc"),X=y(!1),G=y(!1),z=y(null),H=y([]),le=y(""),te=y("opened-desc"),J=y(!1),V=y(!1),h=y(null),v=y([]),M=y(""),fe=y(!1),be=y(!1),_e=y(null),$=y([]),I=y(""),d=y("date-desc"),f=y(!1),N=y(!1),$e=y(null),ke=y([]),Ee=y(""),we=y("date-desc"),ze=K(()=>o.value?!!(o.value.profilesCreated||o.value.connectionsMade||o.value.trovaChatsStarted||o.value.totalMessagesSent||o.value.eventsCreated||o.value.eventsAttended||o.value.groupsCreated||o.value.groupsJoined||o.value.dailyActiveUsers||o.value.weeklyActiveUsers||o.value.profileCompletionRate||o.value.matchResponseRate||o.value.totalUsers||o.value.activeUsers||o.value.newUsersThisMonth):!1),St=K(()=>o.value?o.value.openedTrova!==void 0||o.value.profileScore!==void 0||o.value.spotlightsCreated!==void 0||o.value.recWallsGiven!==void 0||o.value.recWallsReceived!==void 0||o.value.userOnboardingIntros!==void 0&&o.value.userOnboardingIntros>0||o.value.selfIntroduced!==void 0:!1),Dt=K(()=>o.value?o.value.trovaMagicEngagements!==void 0||o.value.trovaMagicMatches!==void 0||o.value.channelPairingEngagements!==void 0||o.value.mentorMenteeEngagements!==void 0||o.value.mentorMenteeMatches!==void 0||o.value.channelPairingMatches!==void 0||o.value.channelPairingOnDemand!==void 0||o.value.channelPairingCadence!==void 0:!1),Mt=K(()=>o.value?o.value.totalSkills!==void 0||o.value.usersCanMentor!==void 0||o.value.usersWantMentor!==void 0:!1);K(()=>o.value?o.value.channelPairingGroups!==void 0||o.value.channelPairingUsers!==void 0:!1);function W(m,s=0){return m==null?"0":s>0?new Intl.NumberFormat("en-US",{minimumFractionDigits:s,maximumFractionDigits:s}).format(m):new Intl.NumberFormat("en-US").format(m)}function Te(m){return m==null?"N/A":"".concat(m.toFixed(1),"%")}function Le(m){return m>0?"trend-up":m<0?"trend-down":"trend-neutral"}async function He(){if(!k.communityId){U.value=[];return}j.value=!0,U.value=[];try{const m=await w.getSlackUserStats(k.communityId);let s=null;if(m.columns&&Array.isArray(m.columns)){const T=m.columns.find(C=>C.name==="Profile Score"||C.name==="Profile Completion"||C.prop==="profileCompletionScore"||C.prop==="profile_completion_percent"||C.prop==="profileCompletionPercent");T&&(s=T.prop||T.name)}if(!m.rows||m.rows.length===0){console.log("[UserStatsSection] No slack-user-stats rows, trying fallback to profile service");try{const{profileService:T}=await ns(()=>import("./profile.service-CDoO2DLV.js"),__vite__mapDeps([0,1,2])),C=await T.getProfilesForUserAndCommunity(k.communityId);U.value=C.map(_=>{const F=!!_.fname,ne=!!_.lname,me=!!_.bio,pe=!!(_.currentLat&&_.currentLong),g=!!(_.interests&&_.interests.length>0),ae=!!_.profilePicture,q=[F,ne,me,pe,g,ae].filter(Boolean).length,ee=Math.round(q/6*100);return{id:_.userId||_.id,name:"".concat(_.fname||""," ").concat(_.lname||"").trim()||"Unknown User",email:_.email,profilePicture:_.profilePicture,score:ee,completion:ee}});return}catch(T){console.error("[UserStatsSection] Fallback profile load failed:",T),U.value=[];return}}U.value=(m.rows||[]).map(T=>{var _,F,ne,me,pe,g,ae;let C=0;return s&&T[s]!==void 0?C=T[s]:C=(ae=(g=(pe=(me=(ne=(F=(_=T.profile_completion_percent)!=null?_:T.profileCompletionPercent)!=null?F:T.profile_completion_percent_proposed)!=null?ne:T.profileCompletionPercentProposed)!=null?me:T.profileCompletionScore)!=null?pe:T["Profile Completion"])!=null?g:T["Profile Score"])!=null?ae:0,typeof C=="number"&&!isNaN(C)?C>0&&C<=1&&(C=C*100):C=0,{id:T.userId||T.user_id||T.id,name:T.name||"Unknown User",email:T.email,profilePicture:T.profilePicture||T.profile_picture,score:C,completion:C}})}catch(m){console.error("[UserStatsSection] Failed to load profiles:",m),U.value=[]}finally{j.value=!1}}const Ye=K(()=>{const m=E.value.trim().toLowerCase();let s=U.value;m&&(s=s.filter(_=>_.name.toLowerCase().includes(m)));const T=B.value,C=[...s];return C.sort((_,F)=>{switch(T){case"completion-asc":return _.completion-F.completion;case"completion-desc":return F.completion-_.completion;case"name-desc":return F.name.localeCompare(_.name);case"name-asc":default:return _.name.localeCompare(F.name)}}),C});function lt(m){const s=B.value;m==="name"?B.value=s==="name-asc"?"name-desc":"name-asc":m==="completion"&&(B.value=s==="completion-desc"?"completion-asc":"completion-desc")}function re(m){const s=B.value;if(m==="name"){if(s==="name-asc")return"↑";if(s==="name-desc")return"↓"}else if(m==="completion"){if(s==="completion-asc")return"↑";if(s==="completion-desc")return"↓"}return null}function Q(){k.communityId&&(x.value=!0,U.value.length||He())}function Se(){x.value=!1}async function Ke(){if(k.communityId){G.value=!0,z.value=null;try{const{start:m,end:s}=A(S.value),T=await w.getSlackUserStats(k.communityId,m,s);if(T.error){z.value=T.error,H.value=[];return}if(!T||!T.rows||T.rows.length===0){H.value=[];return}let C=null;if(T.columns&&Array.isArray(T.columns)){const _=T.columns.find(F=>F.name==="Homepage Views"||F.name==="Trova Opens"||F.prop==="homepageViews"||F.prop==="openedTrova"||F.prop==="opened_trova");_&&(C=_.prop||_.name)}H.value=(T.rows||[]).map(_=>{var ne,me,pe,g,ae,q,ee;let F=0;return C&&_[C]!==void 0?F=_[C]:F=(ee=(q=(ae=(g=(pe=(me=(ne=_.homepageViews)!=null?ne:_.openedTrova)!=null?me:_.opened_trova)!=null?pe:_["Trova Opens"])!=null?g:_["Homepage Views"])!=null?ae:_.homepageViews)!=null?q:typeof _.homepageViews=="string"?parseInt(_.homepageViews):null)!=null?ee:0,typeof F=="string"&&(F=parseInt(F)||0),(typeof F!="number"||isNaN(F))&&(F=0),{id:_.userId||_.user_id||_.id||"user-".concat(_.name||"unknown"),name:_.name||"Unknown User",email:_.email,profilePicture:_.profilePicture||_.profile_picture,openedCount:F}}).filter(_=>_.openedCount>0)}catch(m){console.error("[UserStatsSection] Failed to load opened Trova users:",m),z.value=(m==null?void 0:m.message)||"Failed to load user data. Please try again later.",H.value=[]}finally{G.value=!1}}}const tt=K(()=>{const m=le.value.trim().toLowerCase();let s=H.value;m&&(s=s.filter(_=>{var F;return _.name.toLowerCase().includes(m)||((F=_.email)==null?void 0:F.toLowerCase().includes(m))}));const T=te.value,C=[...s];return C.sort((_,F)=>{switch(T){case"opened-asc":return _.openedCount-F.openedCount;case"opened-desc":return F.openedCount-_.openedCount;case"name-desc":return F.name.localeCompare(_.name);case"name-asc":default:return _.name.localeCompare(F.name)}}),C});function st(m){const s=te.value;m==="name"?te.value=s==="name-asc"?"name-desc":"name-asc":m==="opened"&&(te.value=s==="opened-desc"?"opened-asc":"opened-desc")}function nt(m){const s=te.value;if(m==="name"){if(s==="name-asc")return"↑";if(s==="name-desc")return"↓"}else if(m==="opened"){if(s==="opened-asc")return"↑";if(s==="opened-desc")return"↓"}return null}function Ot(){k.communityId&&(X.value=!0,H.value.length||Ke())}function pt(){X.value=!1}function Et(){k.communityId&&(J.value=!0,v.value.length||Jt())}function gt(){J.value=!1}function Ft(){k.communityId&&(fe.value=!0,Vt())}function ot(){fe.value=!1}async function Vt(){var m;if(k.communityId){be.value=!0,_e.value=null;try{let{start:s,end:T}=A(S.value);if(!s||!T){const _=new Date;s=new Date(_.getFullYear()-10,0,1).toISOString(),T=_.toISOString()}console.log("[UserStatsSection] Loading self-introduced users for community ".concat(k.communityId,", dates: ").concat(s," to ").concat(T));const C=await w.getSelfIntroducedUsers(k.communityId,s,T);if(C===null){_e.value="This feature requires backend support. The self-introduced/users endpoint may not be available or returned an error.",$.value=[];return}if(C.length===0){_e.value=null,$.value=[];return}if($.value=C,C.length>0&&o.value){const _=C.length;o.value.selfIntroduced!==_&&(console.log("[UserStatsSection] Updating selfIntroduced stat from ".concat(o.value.selfIntroduced," to ").concat(_," based on fetched users")),o.value.selfIntroduced=_)}}catch(s){console.error("[UserStatsSection] Failed to load self-introduced users:",s);const T=(s==null?void 0:s.status)||((m=s==null?void 0:s.response)==null?void 0:m.status);T===500?_e.value="Server error: The backend endpoint returned a 500 error. Please check backend logs or contact support.":T===400?_e.value="Invalid request: Please check date parameters.":_e.value=(s==null?void 0:s.message)||"Failed to load user data. Please try again later.",$.value=[]}finally{be.value=!1}}}function yt(m){if(!m)return"—";const s=new Date(m);return Number.isNaN(s.getTime())?"—":s.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"})}function ht(m){if(!m)return"—";const s=new Date(m);return Number.isNaN(s.getTime())?"—":s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function it(m){switch(m){case"magic_intro":return"Trova Magic";case"channel_pairing":return"Channel Pairing";case"mentor_match":return"Mentor Match";default:return m}}function Yt(){k.communityId&&(f.value=!0,rt())}function Ut(){f.value=!1}async function rt(){var m;if(k.communityId){N.value=!0,$e.value=null;try{const{start:s,end:T}=A(S.value);console.log("[UserStatsSection] Loading conversations started for community ".concat(k.communityId,", period: ").concat(S.value,", dates: ").concat(s||"all-time"," to ").concat(T||"all-time"));const C=await w.getConversationsStarted(k.communityId,s,T);if(C===null){$e.value="This feature requires backend support. The conversations-started endpoint may not be available or returned an error.",ke.value=[];return}if(!C.conversations||C.conversations.length===0){$e.value=null,ke.value=[];return}ke.value=C.conversations.map(_=>({conversationType:_.conversationType,channelId:_.channelId,createdAt:_.createdAt,messageCount:_.messageCount,participants:_.participants||"—"}))}catch(s){console.error("[UserStatsSection] Failed to load conversations started:",s);const T=(s==null?void 0:s.status)||((m=s==null?void 0:s.response)==null?void 0:m.status);T===500?$e.value="Server error: The backend endpoint returned a 500 error. Please check backend logs or contact support.":T===400?$e.value="Invalid request: Please check date parameters.":$e.value=(s==null?void 0:s.message)||"Failed to load conversation data. Please try again later.",ke.value=[]}finally{N.value=!1}}}const xt=K(()=>{const m=Ee.value.trim().toLowerCase();let s=ke.value;m&&(s=s.filter(_=>{const F=(_.participants||"").toLowerCase(),ne=(_.channelId||"").toLowerCase(),me=it(_.conversationType).toLowerCase();return F.includes(m)||ne.includes(m)||me.includes(m)}));const T=[...s],C=we.value;return T.sort((_,F)=>{if(C==="date-desc"){const ne=_.createdAt?new Date(_.createdAt).getTime():0;return(F.createdAt?new Date(F.createdAt).getTime():0)-ne}else if(C==="date-asc"){const ne=_.createdAt?new Date(_.createdAt).getTime():0,me=F.createdAt?new Date(F.createdAt).getTime():0;return ne-me}else if(C==="type-asc"){const ne=it(_.conversationType),me=it(F.conversationType);return ne.localeCompare(me)}else if(C==="type-desc"){const ne=it(_.conversationType);return it(F.conversationType).localeCompare(ne)}else{if(C==="messages-desc")return F.messageCount-_.messageCount;if(C==="messages-asc")return _.messageCount-F.messageCount}return 0}),T});function mt(m){const s=we.value;m==="type"?we.value=s==="type-asc"?"type-desc":"type-asc":m==="date"?we.value=s==="date-desc"?"date-asc":"date-desc":m==="messages"&&(we.value=s==="messages-desc"?"messages-asc":"messages-desc")}function at(m){const s=we.value;if(m==="type"){if(s==="type-asc")return"↑";if(s==="type-desc")return"↓"}else if(m==="date"){if(s==="date-asc")return"↑";if(s==="date-desc")return"↓"}else if(m==="messages"){if(s==="messages-asc")return"↑";if(s==="messages-desc")return"↓"}return null}async function Jt(){var m;if(k.communityId){V.value=!0,h.value=null;try{let{start:s,end:T}=A(S.value);if(!s||!T){const _=new Date;s=new Date(_.getFullYear()-10,0,1).toISOString(),T=_.toISOString()}console.log("[UserStatsSection] Loading onboarding intro users for community ".concat(k.communityId,", dates: ").concat(s," to ").concat(T));const C=await w.getWeeklyIntroductionsUsers(k.communityId,s,T);if(C===null){h.value="This feature requires backend support. The weekly-introductions/users endpoint may not be available or returned an error.",v.value=[];return}if(C.length===0){h.value=null,v.value=[];return}v.value=C.map(_=>({id:_.id,name:_.name||"Unknown User",email:_.email,profilePicture:_.profilePicture,introMessageSentAt:_.introMessageSentAt}))}catch(s){console.error("[UserStatsSection] Failed to load onboarding intro users:",s);const T=(s==null?void 0:s.status)||((m=s==null?void 0:s.response)==null?void 0:m.status);T===500?h.value="Server error: The backend endpoint returned a 500 error. Please check backend logs or contact support.":T===400?h.value="Invalid request: Please check date parameters.":h.value=(s==null?void 0:s.message)||"Failed to load user data. Please try again later.",v.value=[]}finally{V.value=!1}}}const Rt=K(()=>{const m=M.value.trim().toLowerCase();let s=v.value;m&&(s=s.filter(C=>{const _=(C.name||"").toLowerCase(),F=(C.email||"").toLowerCase();return _.includes(m)||F.includes(m)}));const T=[...s];return T.sort((C,_)=>{const F=C.introMessageSentAt?new Date(C.introMessageSentAt).getTime():0;return(_.introMessageSentAt?new Date(_.introMessageSentAt).getTime():0)-F}),T}),jt=K(()=>{const m=I.value.trim().toLowerCase();let s=$.value;m&&(s=s.filter(_=>{const F=(_.name||"").toLowerCase(),ne=(_.email||"").toLowerCase(),me=(_.channelName||_.channelId||""||"").toLowerCase();return F.includes(m)||ne.includes(m)||me.includes(m)}));const T=[...s],C=d.value;return T.sort((_,F)=>{if(C==="date-desc"){const ne=_.introducedAt?new Date(_.introducedAt).getTime():0;return(F.introducedAt?new Date(F.introducedAt).getTime():0)-ne}else if(C==="date-asc"){const ne=_.introducedAt?new Date(_.introducedAt).getTime():0,me=F.introducedAt?new Date(F.introducedAt).getTime():0;return ne-me}else{if(C==="name-asc")return _.name.localeCompare(F.name);if(C==="name-desc")return F.name.localeCompare(_.name);if(C==="channel-asc"){const ne=_.channelName||_.channelId||"Unknown Channel",me=F.channelName||F.channelId||"Unknown Channel";return ne.localeCompare(me)}else if(C==="channel-desc"){const ne=_.channelName||_.channelId||"Unknown Channel";return(F.channelName||F.channelId||"Unknown Channel").localeCompare(ne)}}return 0}),T});function Tt(m){const s=d.value;m==="name"?d.value=s==="name-asc"?"name-desc":"name-asc":m==="date"?d.value=s==="date-desc"?"date-asc":"date-desc":m==="channel"&&(d.value=s==="channel-asc"?"channel-desc":"channel-asc")}function ut(m){const s=d.value;if(m==="name"){if(s==="name-asc")return"↑";if(s==="name-desc")return"↓"}else if(m==="date"){if(s==="date-asc")return"↑";if(s==="date-desc")return"↓"}else if(m==="channel"){if(s==="channel-asc")return"↑";if(s==="channel-desc")return"↓"}return null}function Ht(){if(!k.communityId)return;const{start:m,end:s}=A(S.value);ve("openMagicIntros",m,s)}function _t(){if(!k.communityId)return;const{start:m,end:s}=A(S.value);ve("openChannelPairings",m,s)}function Kt(){if(!k.communityId)return;const{start:m,end:s}=A(S.value);ve("openMentorMenteeMatches",m,s)}function r(){if(!k.communityId)return;const{start:m,end:s}=A(S.value);ve("openConnections",m,s)}function c(){k.communityId&&ve("openSkills")}function p(m){k.communityId&&ve("openMentorList",m)}function A(m){if(m==="all-time")return{start:void 0,end:void 0};const s=new Date,T=new Date(Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),23,59,59,999));let C=12;switch(m){case"12-months":C=12;break;case"6-months":C=6;break;case"3-months":C=3;break;case"1-month":C=1;break;default:C=12}const _=s.getUTCFullYear(),F=s.getUTCMonth(),ne=s.getUTCDate();let me=_,pe=F-C;for(;pe<0;)pe+=12,me-=1;const g=new Date(Date.UTC(me,pe+1,0)).getUTCDate(),ae=Math.min(ne,g);return{start:new Date(Date.UTC(me,pe,ae,0,0,0,0)).toISOString(),end:T.toISOString()}}function se(){oe()}Lt(()=>{oe()}),Ve(()=>k.communityId,(m,s)=>{m&&m!==s&&(U.value=[],E.value="",oe(),x.value&&He())});async function oe(){if(k.communityId){Z.value=!0;try{const{start:m,end:s}=A(S.value),T=await w.getEngagementStats(k.communityId,m,s);T?o.value={...T}:o.value={totalUsers:0,activeUsers:0,newUsersThisMonth:0},Promise.allSettled([w.getUserActionsStats(k.communityId,m,s),w.getSkillsStats(k.communityId),w.getChannelPairingStats(k.communityId,m,s),w.getConversationsStarted(k.communityId,m,s),w.getActiveUserStats(k.communityId,m,s),w.getWeeklyIntroductionsStats(k.communityId),w.getSelfIntroducedStats(k.communityId,m,s)]).then(([C,_,F,ne,me,pe,g])=>{var ce;o.value||(o.value={});const ae={...o.value},q=["trovaMagicEngagements","channelPairingEngagements","mentorMenteeEngagements","trovaMagicMatches","channelPairingMatches","mentorMenteeMatches","mentorMenteeUniquePairs"],ee=(ge,Fe,b=[])=>{Object.keys(ge).forEach(Ce=>{if(b.includes(Ce))return;const R=ge[Ce],ie=Fe[Ce];R!=null&&(Fe[Ce]=R)})};if(C.status==="fulfilled"&&C.value&&ee(C.value,ae,q),_.status==="fulfilled"&&_.value&&ee(_.value,ae),F.status==="fulfilled"&&F.value&&ee(F.value,ae),ne.status==="fulfilled"&&ne.value){const ge=ne.value.totalMessages||0,Fe=ne.value.totalConversations||0,b=((ce=ne.value.conversations)==null?void 0:ce.length)||0;if(console.log("[UserStatsSection] Conversations started stats:",{totalMessages:ge,totalConversations:Fe,conversationsCount:b,period:S.value,startDate:m,endDate:s}),ne.value.conversations&&ne.value.conversations.length>0){const Ce=ne.value.conversations.reduce((R,ie)=>R+(ie.messageCount||0),0);Ce!==ge?console.warn("[UserStatsSection] ⚠️ Mismatch: sum of individual message counts (".concat(Ce,") != totalMessages (").concat(ge,")")):console.log("[UserStatsSection] ✅ Verified: sum of message counts (".concat(Ce,") matches totalMessages (").concat(ge,")"))}ae.trovaChatsStarted=ge}else ne.status==="rejected"&&(console.warn("[UserStatsSection] Conversations started endpoint failed, will try fallback method"),ae.trovaChatsStarted=0,k.communityId!==null&&w.getMessagesFromMatches(k.communityId,m,s).then(ge=>{ge&&o.value&&(o.value.trovaChatsStarted=ge.totalMessagesSent||0)}).catch(ge=>{console.warn("[UserStatsSection] Fallback method also failed:",ge)}));me.status==="fulfilled"&&me.value&&ee(me.value,ae),pe.status==="fulfilled"&&(pe.value?ee(pe.value,ae):ae.userOnboardingIntros=0),g.status==="fulfilled"?g.value?(console.log("[UserStatsSection] Self-introduced stats received:",g.value),ee(g.value,ae),console.log("[UserStatsSection] Updated stats after merge:",ae.selfIntroduced),ae.selfIntroduced!==void 0&&ae.selfIntroduced!==null&&k.communityId!==null&&m&&s&&w.getSelfIntroducedUsers(k.communityId,m,s).then(ge=>{if(ge&&ge.length>0&&o.value){const Fe=ge.length;o.value.selfIntroduced!==Fe&&(console.log("[UserStatsSection] Updating selfIntroduced stat from ".concat(o.value.selfIntroduced," to ").concat(Fe," based on fetched users")),o.value.selfIntroduced=Fe)}}).catch(ge=>{console.warn("[UserStatsSection] Failed to verify self-introduced count with users endpoint:",ge)})):(console.warn("[UserStatsSection] Self-introduced stats endpoint returned null"),ae.selfIntroduced=0):g.status==="rejected"&&console.error("[UserStatsSection] Self-introduced stats fetch rejected:",g.reason),o.value=ae}).catch(C=>{console.warn("[UserStatsSection] Error loading additional metrics:",C)})}catch(m){console.error("Error loading stats:",m),o.value=null}finally{Z.value=!1}}}async function he(){var m;if(!(!k.communityId||!o.value))try{const{start:s,end:T}=A(S.value);try{const pe=await w.exportData(k.communityId,"stats",s,T);w.downloadCSV(pe,"roi_stats_".concat(k.communityId,"_").concat(Date.now(),".csv")),await(await Ne.create({message:"Statistics exported successfully",duration:2e3,color:"success"})).present();return}catch(pe){if((pe==null?void 0:pe.status)===404||((m=pe==null?void 0:pe.response)==null?void 0:m.status)===404)console.log("[UserStatsSection] Backend export not available, creating client-side CSV");else throw pe}const C=[];C.push("ROI Engagement Dashboard Statistics");const _=S.value==="all-time"?"All Time":S.value.replace("-"," ").replace(/\b\w/g,pe=>pe.toUpperCase());C.push("Time Period: ".concat(_)),s&&T&&C.push("Date Range: ".concat(new Date(s).toLocaleDateString()," - ").concat(new Date(T).toLocaleDateString())),C.push(""),C.push("PRIMARY METRICS"),C.push("Metric,Value"),C.push("Profiles Created,".concat(W(o.value.profilesCreated||o.value.totalUsers||0))),C.push("Introductions Created,".concat(W(o.value.connectionsMade||0))),C.push("Messages Exchanged,".concat(W(o.value.trovaChatsStarted||0))),C.push(""),C.push("ENGAGEMENT METRICS"),C.push("Metric,Value"),C.push("Total Messages Sent,".concat(W(o.value.totalMessagesSent||0))),C.push("Events Created,".concat(W(o.value.eventsCreated||0))),C.push("Events Attended,".concat(W(o.value.eventsAttended||0))),C.push("Groups Created,".concat(W(o.value.groupsCreated||0))),C.push("Groups Joined,".concat(W(o.value.groupsJoined||0))),C.push("Daily Active Users,".concat(W(o.value.dailyActiveUsers||0))),C.push("Weekly Active Users,".concat(W(o.value.weeklyActiveUsers||0))),C.push("Profile Completion Rate,".concat(Te(o.value.profileCompletionRate))),o.value.userOnboardingIntros!==void 0&&o.value.userOnboardingIntros>0&&C.push("Automated Onboarding Introductions,".concat(W(o.value.userOnboardingIntros))),C.push("Match Response Rate,".concat(Te(o.value.matchResponseRate))),C.push(""),(o.value.activeUsers||o.value.newUsersThisMonth)&&(C.push("ADDITIONAL STATISTICS"),C.push("Metric,Value"),o.value.activeUsers&&C.push("Active Users,".concat(W(o.value.activeUsers))),o.value.newUsersThisMonth&&C.push("New Users This Month,".concat(W(o.value.newUsersThisMonth))));const F=C.join("\n"),ne=new Blob([F],{type:"text/csv"});w.downloadCSV(ne,"roi_stats_".concat(k.communityId,"_").concat(Date.now(),".csv")),await(await Ne.create({message:"Statistics exported successfully",duration:2e3,color:"success"})).present()}catch(s){console.error("Error exporting stats:",s),await(await Ne.create({message:"Failed to export statistics",duration:2e3,color:"danger"})).present()}}return(m,s)=>{var T,C,_,F,ne,me,pe,g,ae,q,ee,ce,ge,Fe,b,Ce,R,ie,ye,et,Nt,Pt,ls,os,is,rs,us,cs,ds,ms,vs;return a(),l("div",Ca,[t("div",Ia,[s[27]||(s[27]=t("h2",{class:"section-title"},"Engagement Dashboard",-1)),t("div",$a,[t("div",Sa,[n(e(Oe),{class:"time-period-label-inline"},{default:i(()=>[...s[20]||(s[20]=[L("Time Period",-1)])]),_:1}),n(e(Ct),{modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=O=>S.value=O),onIonChange:se,class:"time-period-select-inline"},{default:i(()=>[n(e(Ae),{value:"all-time"},{default:i(()=>[...s[21]||(s[21]=[L("All Time",-1)])]),_:1}),n(e(Ae),{value:"12-months"},{default:i(()=>[...s[22]||(s[22]=[L("Past 12 Months",-1)])]),_:1}),n(e(Ae),{value:"6-months"},{default:i(()=>[...s[23]||(s[23]=[L("Past 6 Months",-1)])]),_:1}),n(e(Ae),{value:"3-months"},{default:i(()=>[...s[24]||(s[24]=[L("Past 3 Months",-1)])]),_:1}),n(e(Ae),{value:"1-month"},{default:i(()=>[...s[25]||(s[25]=[L("Past Month",-1)])]),_:1})]),_:1},8,["modelValue"])]),n(e(ue),{fill:"outline",size:"small",onClick:he},{default:i(()=>[n(e(D),{icon:e(wt),slot:"start"},null,8,["icon"]),s[26]||(s[26]=L(" Export CSV ",-1))]),_:1})])]),Z.value?(a(),l("div",Da,[n(e(Pe)),s[28]||(s[28]=t("p",null,"Loading engagement statistics...",-1))])):o.value||ze.value?(a(),l("div",Ma,[t("div",Ua,[s[32]||(s[32]=t("h3",{class:"section-subtitle"},"Primary Metrics",-1)),t("div",Ta,[t("div",{class:"primary-metric-card clickable",onClick:Q},[t("div",Na,[n(e(D),{icon:e(_s)},null,8,["icon"])]),t("div",Pa,[t("div",wa,[((T=o.value)==null?void 0:T.profileCompletionCompleted)!==void 0&&((C=o.value)==null?void 0:C.profileCompletionTotal)!==void 0?(a(),l("span",La,u(o.value.profileCompletionCompleted)+"/"+u(o.value.profileCompletionTotal),1)):(a(),l("span",Aa,u(Te((_=o.value)==null?void 0:_.profileCompletionRate)),1))]),s[29]||(s[29]=t("div",{class:"metric-label"},"Profile Completion (Completed / Eligible)",-1))])]),t("div",{class:"primary-metric-card clickable",onClick:r},[t("div",Oa,[n(e(D),{icon:e(Ge)},null,8,["icon"])]),t("div",Ea,[t("div",Fa,u(W(((F=o.value)==null?void 0:F.connectionsMade)||0)),1),s[30]||(s[30]=t("div",{class:"metric-label"},"Introductions Created",-1)),(ne=o.value)!=null&&ne.connectionsMadeTrend?(a(),l("div",{key:0,class:dt(["metric-trend",Le(o.value.connectionsMadeTrend)])},[n(e(D),{icon:o.value.connectionsMadeTrend>0?e(ps):e(gs)},null,8,["icon"]),t("span",null,u(Math.abs(o.value.connectionsMadeTrend).toFixed(1))+"%",1)],2)):Y("",!0)])]),t("div",{class:"primary-metric-card primary-metric-card-highlight clickable",onClick:Yt},[t("div",Va,[n(e(D),{icon:e(as)},null,8,["icon"])]),t("div",xa,[t("div",Ra,u(W(((me=o.value)==null?void 0:me.trovaChatsStarted)||0)),1),s[31]||(s[31]=t("div",{class:"metric-label"},"Messages Exchanged",-1)),(pe=o.value)!=null&&pe.trovaChatsStartedTrend?(a(),l("div",{key:0,class:dt(["metric-trend",Le(o.value.trovaChatsStartedTrend)])},[n(e(D),{icon:o.value.trovaChatsStartedTrend>0?e(ps):e(gs)},null,8,["icon"]),t("span",null,u(Math.abs(o.value.trovaChatsStartedTrend).toFixed(1))+"%",1)],2)):Y("",!0)])])])]),St.value?(a(),l("div",ja,[s[37]||(s[37]=t("h3",{class:"section-subtitle"},"General Actions",-1)),t("div",Ba,[((g=o.value)==null?void 0:g.openedTrova)!==void 0?(a(),l("div",{key:0,class:"engagement-metric-card clickable",onClick:Ot},[t("div",Wa,[n(e(D),{icon:e(Ls)},null,8,["icon"])]),t("div",qa,[t("div",za,u(W(o.value.openedTrova)),1),s[33]||(s[33]=t("div",{class:"metric-label-small"},"Trova Opens",-1))])])):Y("",!0),((ae=o.value)==null?void 0:ae.profileScore)!==void 0?(a(),l("div",Ya,[t("div",Ja,[n(e(D),{icon:e(ys)},null,8,["icon"])]),t("div",Ha,[t("div",Ka,u(W(o.value.profileScore,1)),1),s[34]||(s[34]=t("div",{class:"metric-label-small"},"Avg Profile Score",-1))])])):Y("",!0),((q=o.value)==null?void 0:q.userOnboardingIntros)!==void 0&&o.value.userOnboardingIntros>0?(a(),l("div",{key:2,class:"engagement-metric-card clickable",onClick:Et},[t("div",Ga,[n(e(D),{icon:e(Ge)},null,8,["icon"])]),t("div",Qa,[t("div",Za,u(W(o.value.userOnboardingIntros)),1),s[35]||(s[35]=t("div",{class:"metric-label-small"},"Automated Onboarding Introductions",-1))])])):Y("",!0),((ee=o.value)==null?void 0:ee.selfIntroduced)!==void 0?(a(),l("div",{key:3,class:"engagement-metric-card clickable",onClick:Ft},[t("div",Xa,[n(e(D),{icon:e(ys)},null,8,["icon"])]),t("div",el,[t("div",tl,u(W(o.value.selfIntroduced)),1),s[36]||(s[36]=t("div",{class:"metric-label-small"},"Self-Introductions Posted",-1))])])):Y("",!0)])])):Y("",!0),Dt.value?(a(),l("div",sl,[s[41]||(s[41]=t("h3",{class:"section-subtitle"},"Engagement by Feature",-1)),t("div",nl,[((ce=o.value)==null?void 0:ce.trovaMagicEngagements)!==void 0||((ge=o.value)==null?void 0:ge.trovaMagicMatches)!==void 0?(a(),l("div",{key:0,class:"engagement-metric-card clickable",onClick:Ht},[t("div",al,[n(e(D),{icon:e(es)},null,8,["icon"])]),t("div",ll,[t("div",ol,[((Fe=o.value)==null?void 0:Fe.trovaMagicEngagements)!==void 0&&((b=o.value)==null?void 0:b.trovaMagicMatches)!==void 0?(a(),l("span",il,u(W(o.value.trovaMagicEngagements||0))+"/"+u(W(o.value.trovaMagicMatches)),1)):((Ce=o.value)==null?void 0:Ce.trovaMagicMatches)!==void 0?(a(),l("span",rl,u(W(o.value.trovaMagicEngagements||0))+"/"+u(W(o.value.trovaMagicMatches)),1)):(a(),l("span",ul,u(W(o.value.trovaMagicEngagements||0)),1))]),s[38]||(s[38]=t("div",{class:"metric-label-small"},"Magic Intros (Engaged / Total)",-1))])])):Y("",!0),((R=o.value)==null?void 0:R.channelPairingEngagements)!==void 0||((ie=o.value)==null?void 0:ie.channelPairingMatches)!==void 0?(a(),l("div",{key:1,class:"engagement-metric-card clickable",onClick:_t},[t("div",cl,[n(e(D),{icon:e(qt)},null,8,["icon"])]),t("div",dl,[t("div",ml,[((ye=o.value)==null?void 0:ye.channelPairingEngagements)!==void 0&&((et=o.value)==null?void 0:et.channelPairingMatches)!==void 0?(a(),l("span",vl,u(W(o.value.channelPairingEngagements||0))+"/"+u(W(o.value.channelPairingMatches)),1)):((Nt=o.value)==null?void 0:Nt.channelPairingMatches)!==void 0?(a(),l("span",fl,u(W(o.value.channelPairingEngagements||0))+"/"+u(W(o.value.channelPairingMatches)),1)):(a(),l("span",pl,u(W(o.value.channelPairingEngagements||0)),1))]),s[39]||(s[39]=t("div",{class:"metric-label-small"},"Channel Pairings (Engaged / Total)",-1))])])):Y("",!0),((Pt=o.value)==null?void 0:Pt.mentorMenteeEngagements)!==void 0||((ls=o.value)==null?void 0:ls.mentorMenteeMatches)!==void 0?(a(),l("div",{key:2,class:"engagement-metric-card clickable",onClick:Kt},[t("div",gl,[n(e(D),{icon:e(ct)},null,8,["icon"])]),t("div",yl,[t("div",hl,[((os=o.value)==null?void 0:os.mentorMenteeMatches)!==void 0&&((is=o.value)==null?void 0:is.mentorMenteeUniquePairs)!==void 0?(a(),l("span",_l,u(W(o.value.mentorMenteeUniquePairs))+"/"+u(W(o.value.mentorMenteeMatches)),1)):((rs=o.value)==null?void 0:rs.mentorMenteeMatches)!==void 0?(a(),l("span",bl,u(W(o.value.mentorMenteeMatches)),1)):(a(),l("span",kl,"0"))]),s[40]||(s[40]=t("div",{class:"metric-label-small"},"Mentor Matches (Unique / Total)",-1))])])):Y("",!0)])])):Y("",!0),Mt.value?(a(),l("div",Cl,[s[45]||(s[45]=t("h3",{class:"section-subtitle"},"Skills",-1)),t("div",Il,[((us=o.value)==null?void 0:us.totalSkills)!==void 0?(a(),l("div",{key:0,class:"engagement-metric-card clickable",onClick:c},[t("div",$l,[n(e(D),{icon:e(ts)},null,8,["icon"])]),t("div",Sl,[t("div",Dl,u(W(o.value.totalSkills)),1),s[42]||(s[42]=t("div",{class:"metric-label-small"},"Skills Added to Profiles",-1))])])):Y("",!0),((cs=o.value)==null?void 0:cs.usersCanMentor)!==void 0?(a(),l("div",{key:1,class:"engagement-metric-card clickable",onClick:s[1]||(s[1]=O=>p("can"))},[t("div",Ml,[n(e(D),{icon:e(ct)},null,8,["icon"])]),t("div",Ul,[t("div",Tl,u(W(o.value.usersCanMentor)),1),s[43]||(s[43]=t("div",{class:"metric-label-small"},"Users Available to Mentor",-1))])])):Y("",!0),((ds=o.value)==null?void 0:ds.usersWantMentor)!==void 0?(a(),l("div",{key:2,class:"engagement-metric-card clickable",onClick:s[2]||(s[2]=O=>p("want"))},[t("div",Nl,[n(e(D),{icon:e(ss)},null,8,["icon"])]),t("div",Pl,[t("div",wl,u(W(o.value.usersWantMentor)),1),s[44]||(s[44]=t("div",{class:"metric-label-small"},"Users Seeking Mentorship",-1))])])):Y("",!0)])])):Y("",!0),(ms=o.value)!=null&&ms.activeUsers||(vs=o.value)!=null&&vs.newUsersThisMonth?(a(),l("div",Ll,[s[48]||(s[48]=t("h3",{class:"section-subtitle"},"Additional Statistics",-1)),t("div",Al,[o.value.activeUsers?(a(),l("div",Ol,[t("div",El,u(W(o.value.activeUsers)),1),s[46]||(s[46]=t("div",{class:"stat-label"},"Active Users",-1))])):Y("",!0),o.value.newUsersThisMonth?(a(),l("div",Fl,[t("div",Vl,u(W(o.value.newUsersThisMonth)),1),s[47]||(s[47]=t("div",{class:"stat-label"},"New This Month",-1))])):Y("",!0)])])):Y("",!0)])):(a(),l("div",xl,[n(e(D),{icon:e(bt),class:"no-stats-icon"},null,8,["icon"]),s[49]||(s[49]=t("p",null,"Statistics not available",-1)),s[50]||(s[50]=t("p",{class:"no-stats-hint"},"This feature requires backend support. The stats endpoint is not currently available.",-1))])),n(e(Je),{"is-open":x.value,onDidDismiss:Se,onWillDismiss:Se,"backdrop-dismiss":!0},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[n(e(We),null,{default:i(()=>[...s[51]||(s[51]=[L("Profiles",-1)])]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:Se},{default:i(()=>[n(e(D),{icon:e(kt)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{class:"profile-modal-content"},{default:i(()=>[t("div",Rl,[n(e(xe),{modelValue:E.value,"onUpdate:modelValue":s[3]||(s[3]=O=>E.value=O),placeholder:"Search by name",inputmode:"search"},null,8,["modelValue"]),n(e(Ct),{modelValue:B.value,"onUpdate:modelValue":s[4]||(s[4]=O=>B.value=O),interface:"popover",placeholder:"Sort by"},{default:i(()=>[n(e(Ae),{value:"completion-desc"},{default:i(()=>[...s[52]||(s[52]=[L("Completion (High → Low)",-1)])]),_:1}),n(e(Ae),{value:"completion-asc"},{default:i(()=>[...s[53]||(s[53]=[L("Completion (Low → High)",-1)])]),_:1}),n(e(Ae),{value:"name-asc"},{default:i(()=>[...s[54]||(s[54]=[L("Name (A → Z)",-1)])]),_:1}),n(e(Ae),{value:"name-desc"},{default:i(()=>[...s[55]||(s[55]=[L("Name (Z → A)",-1)])]),_:1})]),_:1},8,["modelValue"])]),j.value?(a(),l("div",jl,[n(e(Pe)),s[56]||(s[56]=t("p",null,"Loading profiles...",-1))])):Ye.value.length?(a(),l("div",Bl,[t("div",Wl,[t("div",{class:"col-name sortable",onClick:s[5]||(s[5]=O=>lt("name"))},[s[57]||(s[57]=L(" User ",-1)),re("name")?(a(),l("span",ql,u(re("name")),1)):Y("",!0)]),t("div",{class:"col-completion sortable",onClick:s[6]||(s[6]=O=>lt("completion"))},[s[58]||(s[58]=L(" Completion ",-1)),re("completion")?(a(),l("span",zl,u(re("completion")),1)):Y("",!0)])]),(a(!0),l(Ie,null,De(Ye.value,O=>(a(),l("div",{key:O.id,class:"profiles-table-row"},[t("div",Yl,[O.profilePicture?(a(),l("div",Jl,[t("img",{src:O.profilePicture,alt:O.name},null,8,Hl)])):(a(),l("div",Kl,u(O.name.charAt(0).toUpperCase()),1)),t("div",Gl,[t("div",Ql,u(O.name),1),O.email?(a(),l("div",Zl,u(O.email),1)):Y("",!0)])]),t("div",Xl,u(O.completion.toFixed(0))+"%",1)]))),128))])):(a(),l("div",eo,[n(e(D),{icon:e(bt),class:"no-stats-icon"},null,8,["icon"]),s[59]||(s[59]=t("p",null,"No profiles found",-1))]))]),_:1})]),_:1},8,["is-open"]),n(e(Je),{"is-open":X.value,onDidDismiss:pt,onWillDismiss:pt,"backdrop-dismiss":!0},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[n(e(We),null,{default:i(()=>[...s[60]||(s[60]=[L("Trova Opens",-1)])]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:pt},{default:i(()=>[n(e(D),{icon:e(kt)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{class:"profile-modal-content"},{default:i(()=>[t("div",to,[n(e(xe),{modelValue:le.value,"onUpdate:modelValue":s[7]||(s[7]=O=>le.value=O),placeholder:"Search by name or email",inputmode:"search"},null,8,["modelValue"]),n(e(Ct),{modelValue:te.value,"onUpdate:modelValue":s[8]||(s[8]=O=>te.value=O),interface:"popover",placeholder:"Sort by"},{default:i(()=>[n(e(Ae),{value:"opened-desc"},{default:i(()=>[...s[61]||(s[61]=[L("Opened (High → Low)",-1)])]),_:1}),n(e(Ae),{value:"opened-asc"},{default:i(()=>[...s[62]||(s[62]=[L("Opened (Low → High)",-1)])]),_:1}),n(e(Ae),{value:"name-asc"},{default:i(()=>[...s[63]||(s[63]=[L("Name (A → Z)",-1)])]),_:1}),n(e(Ae),{value:"name-desc"},{default:i(()=>[...s[64]||(s[64]=[L("Name (Z → A)",-1)])]),_:1})]),_:1},8,["modelValue"])]),G.value?(a(),l("div",so,[n(e(Pe)),s[65]||(s[65]=t("p",null,"Loading users...",-1))])):tt.value.length?(a(),l("div",no,[t("div",ao,[t("div",{class:"col-name sortable",onClick:s[9]||(s[9]=O=>st("name"))},[s[66]||(s[66]=L(" User ",-1)),nt("name")?(a(),l("span",lo,u(nt("name")),1)):Y("",!0)]),t("div",{class:"col-completion sortable",onClick:s[10]||(s[10]=O=>st("opened"))},[s[67]||(s[67]=L(" Times Opened ",-1)),nt("opened")?(a(),l("span",oo,u(nt("opened")),1)):Y("",!0)])]),(a(!0),l(Ie,null,De(tt.value,O=>(a(),l("div",{key:O.id,class:"profiles-table-row"},[t("div",io,[O.profilePicture?(a(),l("div",ro,[t("img",{src:O.profilePicture,alt:O.name},null,8,uo)])):(a(),l("div",co,u(O.name.charAt(0).toUpperCase()),1)),t("div",mo,[t("div",vo,u(O.name),1),O.email?(a(),l("div",fo,u(O.email),1)):Y("",!0)])]),t("div",po,u(W(O.openedCount)),1)]))),128))])):(a(),l("div",go,[n(e(D),{icon:e(bt),class:"no-stats-icon"},null,8,["icon"]),z.value?(a(),l("p",yo,u(z.value),1)):(a(),l("p",ho,"No users found"))]))]),_:1})]),_:1},8,["is-open"]),n(e(Je),{"is-open":J.value,onDidDismiss:gt,onWillDismiss:gt,"backdrop-dismiss":!0},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[n(e(We),null,{default:i(()=>[...s[68]||(s[68]=[L("Automated Onboarding Introductions",-1)])]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:gt},{default:i(()=>[n(e(D),{icon:e(kt)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{class:"profile-modal-content"},{default:i(()=>[t("div",_o,[n(e(xe),{modelValue:M.value,"onUpdate:modelValue":s[11]||(s[11]=O=>M.value=O),placeholder:"Search by name or email",inputmode:"search"},null,8,["modelValue"])]),V.value?(a(),l("div",bo,[n(e(Pe)),s[69]||(s[69]=t("p",null,"Loading users...",-1))])):Rt.value.length?(a(),l("div",ko,[s[70]||(s[70]=t("div",{class:"profiles-table-header"},[t("div",{class:"col-name"},"User"),t("div",{class:"col-completion onboarding-intro-date"},"Most Recent Intro")],-1)),(a(!0),l(Ie,null,De(Rt.value,O=>(a(),l("div",{key:O.id,class:"profiles-table-row"},[t("div",Co,[O.profilePicture?(a(),l("div",Io,[t("img",{src:O.profilePicture,alt:O.name},null,8,$o)])):(a(),l("div",So,u(O.name.charAt(0).toUpperCase()),1)),t("div",Do,[t("div",Mo,u(O.name),1),O.email?(a(),l("div",Uo,u(O.email),1)):Y("",!0)])]),t("div",To,[t("div",No,u(yt(O.introMessageSentAt)),1),t("div",Po,u(ht(O.introMessageSentAt)),1)])]))),128))])):(a(),l("div",wo,[n(e(D),{icon:e(bt),class:"no-stats-icon"},null,8,["icon"]),h.value?(a(),l("p",Lo,u(h.value),1)):(a(),l("p",Ao,"No users found"))]))]),_:1})]),_:1},8,["is-open"]),n(e(Je),{"is-open":f.value,onDidDismiss:Ut,onWillDismiss:Ut,"backdrop-dismiss":!0},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[n(e(We),null,{default:i(()=>[...s[71]||(s[71]=[L("Messages Exchanged by Match Type",-1)])]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:Ut},{default:i(()=>[n(e(D),{icon:e(kt)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{class:"profile-modal-content"},{default:i(()=>[t("div",Oo,[n(e(xe),{modelValue:Ee.value,"onUpdate:modelValue":s[12]||(s[12]=O=>Ee.value=O),placeholder:"Search by participants or channel ID",inputmode:"search"},null,8,["modelValue"])]),N.value?(a(),l("div",Eo,[n(e(Pe)),s[72]||(s[72]=t("p",null,"Loading conversations...",-1))])):xt.value.length?(a(),l("div",Fo,[t("div",Vo,[t("div",{class:"col-name sortable",onClick:s[13]||(s[13]=O=>mt("type"))},[s[73]||(s[73]=L(" Match Type ",-1)),at("type")?(a(),l("span",xo,u(at("type")),1)):Y("",!0)]),s[76]||(s[76]=t("div",{class:"col-participants"},"Participants",-1)),t("div",{class:"col-date sortable",onClick:s[14]||(s[14]=O=>mt("date"))},[s[74]||(s[74]=L(" Date ",-1)),at("date")?(a(),l("span",Ro,u(at("date")),1)):Y("",!0)]),t("div",{class:"col-messages sortable",onClick:s[15]||(s[15]=O=>mt("messages"))},[s[75]||(s[75]=L(" Messages ",-1)),at("messages")?(a(),l("span",jo,u(at("messages")),1)):Y("",!0)])]),(a(!0),l(Ie,null,De(xt.value,O=>(a(),l("div",{key:O.channelId,class:"profiles-table-row"},[t("div",Bo,[t("div",Wo,u(it(O.conversationType)),1)]),t("div",qo,u(O.participants||"—"),1),t("div",zo,[t("div",Yo,u(yt(O.createdAt)),1),t("div",Jo,u(ht(O.createdAt)),1)]),t("div",Ho,u(W(O.messageCount)),1)]))),128))])):(a(),l("div",Ko,[n(e(D),{icon:e(bt),class:"no-stats-icon"},null,8,["icon"]),$e.value?(a(),l("p",Go,u($e.value),1)):(a(),l("p",Qo,"No conversations found"))]))]),_:1})]),_:1},8,["is-open"]),n(e(Je),{"is-open":fe.value,onDidDismiss:ot,onWillDismiss:ot,"backdrop-dismiss":!0},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[n(e(We),null,{default:i(()=>[...s[77]||(s[77]=[L("Self-Introductions Posted",-1)])]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:ot},{default:i(()=>[n(e(D),{icon:e(kt)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{class:"profile-modal-content"},{default:i(()=>[t("div",Zo,[n(e(xe),{modelValue:I.value,"onUpdate:modelValue":s[16]||(s[16]=O=>I.value=O),placeholder:"Search by name or email",inputmode:"search"},null,8,["modelValue"])]),be.value?(a(),l("div",Xo,[n(e(Pe)),s[78]||(s[78]=t("p",null,"Loading users...",-1))])):jt.value.length?(a(),l("div",ei,[t("div",ti,[t("div",{class:"col-name sortable",onClick:s[17]||(s[17]=O=>Tt("name"))},[s[79]||(s[79]=L(" User ",-1)),ut("name")?(a(),l("span",si,u(ut("name")),1)):Y("",!0)]),t("div",{class:"col-date sortable",onClick:s[18]||(s[18]=O=>Tt("date"))},[s[80]||(s[80]=L(" Introduced At ",-1)),ut("date")?(a(),l("span",ni,u(ut("date")),1)):Y("",!0)]),t("div",{class:"col-channel sortable",onClick:s[19]||(s[19]=O=>Tt("channel"))},[s[81]||(s[81]=L(" Channel ",-1)),ut("channel")?(a(),l("span",ai,u(ut("channel")),1)):Y("",!0)])]),(a(!0),l(Ie,null,De(jt.value,O=>(a(),l("div",{key:O.id,class:"profiles-table-row"},[t("div",li,[O.profilePicture?(a(),l("div",oi,[t("img",{src:O.profilePicture,alt:O.name},null,8,ii)])):(a(),l("div",ri,u(O.name.charAt(0).toUpperCase()),1)),t("div",ui,[t("div",ci,u(O.name),1),O.email?(a(),l("div",di,u(O.email),1)):Y("",!0)])]),t("div",mi,[t("div",vi,u(yt(O.introducedAt)),1),t("div",fi,u(ht(O.introducedAt)),1)]),t("div",pi,u(O.channelName||O.channelId||"Unknown Channel"),1)]))),128))])):(a(),l("div",gi,[n(e(D),{icon:e(bt),class:"no-stats-icon"},null,8,["icon"]),_e.value?(a(),l("p",yi,u(_e.value),1)):(a(),l("p",hi,"No users found"))]))]),_:1})]),_:1},8,["is-open"])])}}}),bi=Xe(_i,[["__scopeId","data-v-ef2fb31c"]]),ki={key:0},Ci={key:0,class:"loading-state"},Ii={key:1,class:"pairings-container"},$i={class:"header-section"},Si={class:"stats-summary"},Di={class:"stat-item"},Mi={class:"stat-value"},Ui={class:"stat-item"},Ti={class:"stat-value engaged"},Ni={class:"stat-item"},Pi={class:"stat-value"},wi={class:"search-container"},Li={key:0,class:"no-results"},Ai={key:0},Oi={key:1},Ei={key:2},Fi={key:3},Vi={key:4},xi={key:5},Ri={key:0},ji={key:1},Bi={class:"score-value"},Wi={key:2,class:"engaged-badge"},qi={key:2,class:"empty-state"},zi={key:1},Yi={key:0,class:"loading-state"},Ji={key:1,class:"magic-intros-list"},Hi=["title"],Ki=["title"],Gi=["title"],Qi={key:2,class:"empty-state"},Zi=Ze({__name:"MagicIntrosPage",props:{isOpen:{type:Boolean},communityId:{},startDate:{},endDate:{}},emits:["didDismiss"],setup(Me,{emit:P}){const k=Me,ve=P,Z=y(!1),o=y([]),S=K(()=>k.communityId),x=K(()=>k.startDate),j=K(()=>k.endDate),U=y(""),E=y(!1),B=y([]),X=y(""),G=K(()=>B.value.filter(d=>d.isEngaged).length);K(()=>B.value.length===0?0:G.value/B.value.length*100);const z=K(()=>{if(!X.value.trim())return B.value;const d=X.value.toLowerCase().trim();return B.value.filter(f=>{const N=be(f.user||{}).toLowerCase(),$e=be(f.matchedUser||{}).toLowerCase(),ke=(f.reasons||[]).join(" ").toLowerCase();return N.includes(d)||$e.includes(d)||ke.includes(d)})}),H=K(()=>z.value.filter(d=>d.isEngaged).length),le=K(()=>z.value.length===0?0:H.value/z.value.length*100),te=K(()=>{if(!U.value)return"Magic Intro Pairings";const[d,f,N]=U.value.split("-").map(Number);return new Date(Date.UTC(d,f-1,N)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}),J=K(()=>{if(x.value)try{const d=new Date(x.value);return isNaN(d.getTime())?x.value:d.toISOString()}catch(d){return x.value}}),V=K(()=>{if(j.value)try{const d=new Date(j.value);return isNaN(d.getTime())?j.value:d.toISOString()}catch(d){return j.value}});Ve(()=>k.isOpen,d=>{d&&S.value&&h()},{immediate:!0}),Ve(()=>k.communityId,d=>{k.isOpen&&d&&h()});async function h(){if(S.value){Z.value=!0;try{console.log("[MagicIntrosPage] Loading magic intros with:",{communityId:S.value,startDate:J.value,endDate:V.value});const d=await w.getMagicIntrosByDate(S.value,J.value,V.value);console.log("[MagicIntrosPage] Received magic intros:",d),console.log("[MagicIntrosPage] Sample intro:",d[0]),d.forEach((f,N)=>{var $e,ke,Ee;console.log("[MagicIntrosPage] Intro ".concat(N,":"),{date:f.date,dateDisplay:f.dateDisplay,totalPairings:f.totalPairings,engagedPairings:f.engagedPairings,engagementRate:f.engagementRate,formattedTotal:$(($e=f.totalPairings)!=null?$e:0),formattedEngaged:$((ke=f.engagedPairings)!=null?ke:0),formattedRate:I((Ee=f.engagementRate)!=null?Ee:0)})}),o.value=d.map(f=>({date:f.date,dateDisplay:f.dateDisplay,totalPairings:typeof f.totalPairings=="number"?f.totalPairings:0,engagedPairings:typeof f.engagedPairings=="number"?f.engagedPairings:0,engagementRate:typeof f.engagementRate=="number"?f.engagementRate:0})),console.log("[MagicIntrosPage] Set magicIntros.value:",o.value),console.log("[MagicIntrosPage] First item after mapping:",o.value[0])}catch(d){console.error("Error loading magic intros:",d),o.value=[]}finally{Z.value=!1}}}function v(d){S.value&&(U.value=d,M())}async function M(){if(!(!S.value||!U.value)){E.value=!0;try{const d=await w.getMagicIntroPairings(S.value,U.value,J.value,V.value);B.value=d}catch(d){console.error("Error loading pairings:",d),B.value=[]}finally{E.value=!1}}}function fe(){U.value="",B.value=[],X.value=""}function be(d){return d?d.fullName?d.fullName:d.fname&&d.lname?"".concat(d.fname," ").concat(d.lname):d.fname?d.fname:"Unknown":"Unknown"}function _e(){U.value="",B.value=[],X.value="",ve("didDismiss")}function $(d){return d==null||typeof d!="number"||isNaN(d)?"0":d.toLocaleString()}function I(d){return d==null||typeof d!="number"||isNaN(d)?"0%":"".concat(d.toFixed(1),"%")}return(d,f)=>(a(),de(e(Je),{"is-open":Me.isOpen,onDidDismiss:_e,onWillDismiss:_e,"backdrop-dismiss":!0,id:"magic-intros-list-modal"},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[U.value?(a(),de(e(Ue),{key:0,slot:"start"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:fe},{default:i(()=>[n(e(D),{icon:e(It)},null,8,["icon"])]),_:1})]),_:1})):Y("",!0),n(e(We),null,{default:i(()=>[L(u(U.value?"Magic Intro Pairings":"Magic Intros"),1)]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:_e},{default:i(()=>[n(e(D),{icon:e($t)},null,8,["icon"])]),_:1})]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:f[0]||(f[0]=N=>U.value?M():h())},{default:i(()=>[n(e(D),{icon:e(ft)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{fullscreen:!0,class:"magic-intros-content"},{default:i(()=>[U.value?(a(),l("div",ki,[E.value?(a(),l("div",Ci,[n(e(Pe)),f[2]||(f[2]=t("p",null,"Loading pairings...",-1))])):B.value.length>0?(a(),l("div",Ii,[t("div",$i,[t("h2",null,u(te.value),1),t("div",Si,[t("div",Di,[f[3]||(f[3]=t("span",{class:"stat-label"},"Total Pairings:",-1)),t("span",Mi,u($(z.value.length)),1)]),t("div",Ui,[f[4]||(f[4]=t("span",{class:"stat-label"},"Engaged:",-1)),t("span",Ti,u($(H.value)),1)]),t("div",Ni,[f[5]||(f[5]=t("span",{class:"stat-label"},"Engagement Rate:",-1)),t("span",Pi,u(I(le.value)),1)])])]),t("div",wi,[n(e(xe),{modelValue:X.value,"onUpdate:modelValue":f[1]||(f[1]=N=>X.value=N),placeholder:"Search by user names or match reasons...",debounce:300,class:"pairings-searchbar"},null,8,["modelValue"])]),X.value&&z.value.length===0?(a(),l("div",Li,[t("p",null,'No pairings found matching "'+u(X.value)+'"',1)])):(a(),de(e(Qe),{key:1,class:"pairings-list"},{default:i(()=>[(a(!0),l(Ie,null,De(z.value,(N,$e)=>(a(),de(e(Re),{key:N.id||$e,class:dt(["pairing-item",{engaged:N.isEngaged}])},{default:i(()=>[n(e(D),{icon:N.isEngaged?e(bs):e(vt),slot:"start",class:dt(N.isEngaged?"icon-engaged":"icon-default")},null,8,["icon","class"]),n(e(Oe),null,{default:i(()=>{var ke,Ee,we,ze;return[t("h2",null,[(ke=N.user)!=null&&ke.fullName||(Ee=N.user)!=null&&Ee.fname?(a(),l("span",Ai,u(be(N.user)),1)):N.userId?(a(),l("span",Oi," User "+u(N.userId),1)):(a(),l("span",Ei,"Unknown User")),f[6]||(f[6]=t("span",{class:"separator"},"↔",-1)),(we=N.matchedUser)!=null&&we.fullName||(ze=N.matchedUser)!=null&&ze.fname?(a(),l("span",Fi,u(be(N.matchedUser)),1)):N.matchedUserId?(a(),l("span",Vi," User "+u(N.matchedUserId),1)):(a(),l("span",xi,"Unknown User"))]),N.reasons&&N.reasons.length>0?(a(),l("p",Ri,[f[7]||(f[7]=t("span",{class:"reasons-label"},"Match reasons:",-1)),L(" "+u(N.reasons.join(", ")),1)])):Y("",!0),N.score!==void 0?(a(),l("p",ji,[f[8]||(f[8]=t("span",{class:"score-label"},"Score:",-1)),t("span",Bi,u(N.score.toFixed(2)),1)])):Y("",!0),N.isEngaged?(a(),l("p",Wi,[n(e(D),{icon:e(as)},null,8,["icon"]),f[9]||(f[9]=L(" Conversation started ",-1))])):Y("",!0)]}),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}))])):(a(),l("div",qi,[n(e(D),{icon:e(Ge),class:"empty-icon"},null,8,["icon"]),f[10]||(f[10]=t("h2",null,"No Pairings Found",-1)),f[11]||(f[11]=t("p",null,"No pairings were found for this magic intro date.",-1))]))])):(a(),l("div",zi,[Z.value?(a(),l("div",Yi,[n(e(Pe)),f[12]||(f[12]=t("p",null,"Loading magic intros...",-1))])):o.value.length>0?(a(),l("div",Ji,[f[18]||(f[18]=t("div",{class:"list-header"},[t("h2",null,"Magic Intros by Date"),t("p",{class:"subtitle"},"Click on a date to view all pairings")],-1)),n(e(Qe),null,{default:i(()=>[(a(!0),l(Ie,null,De(o.value,N=>(a(),de(e(Re),{key:N.date,button:"",onClick:$e=>v(N.date),class:"magic-intro-item"},{default:i(()=>[n(e(D),{icon:e(es),slot:"start",class:"magic-icon"},null,8,["icon"]),n(e(Oe),null,{default:i(()=>[t("h2",null,u(N.dateDisplay),1),t("p",null,[f[13]||(f[13]=t("span",{class:"stat-label"},"Total Pairings:",-1)),t("span",{class:"stat-value",title:"Raw: ".concat(N.totalPairings)},u($(N.totalPairings)||"0"),9,Hi),f[14]||(f[14]=t("span",{class:"stat-separator"},"•",-1)),f[15]||(f[15]=t("span",{class:"stat-label"},"Engaged:",-1)),t("span",{class:"stat-value engaged",title:"Raw: ".concat(N.engagedPairings)},u($(N.engagedPairings)||"0"),9,Ki),f[16]||(f[16]=t("span",{class:"stat-separator"},"•",-1)),f[17]||(f[17]=t("span",{class:"stat-label"},"Engagement Rate:",-1)),t("span",{class:"stat-value",title:"Raw: ".concat(N.engagementRate)},u(I(N.engagementRate)||"0%"),9,Gi)])]),_:2},1024),n(e(D),{icon:e(At),slot:"end"},null,8,["icon"])]),_:2},1032,["onClick"]))),128))]),_:1})])):(a(),l("div",Qi,[n(e(D),{icon:e(es),class:"empty-icon"},null,8,["icon"]),f[19]||(f[19]=t("h2",null,"No Magic Intros Found",-1)),f[20]||(f[20]=t("p",null,"No Trova Magic intros were found for the selected time period.",-1))]))]))]),_:1})]),_:1},8,["is-open"]))}}),Xi=Xe(Zi,[["__scopeId","data-v-579d9f04"]]),er={key:0},tr={key:0,class:"loading-state"},sr={key:1,class:"users-list"},nr={class:"list-header"},ar={class:"subtitle"},lr={class:"search-container"},or={key:0,class:"no-results"},ir=["src","alt"],rr={key:0},ur={key:1,class:"user-skills"},cr={key:2,class:"empty-state"},dr={key:0},mr={key:1},vr={key:1},fr={key:0,class:"loading-state"},pr={key:1,class:"skills-list"},gr={class:"stat-value"},yr={key:2,class:"empty-state"},hr=Ze({__name:"SkillsListPage",props:{isOpen:{type:Boolean},communityId:{}},emits:["didDismiss"],setup(Me,{emit:P}){const k=Me,ve=P,Z=y(!1),o=y([]),S=y(""),x=y(!1),j=y([]),U=y(""),E=K(()=>{if(!S.value)return 0;const h=o.value.find(v=>v.name===S.value);return(h==null?void 0:h.value)||0}),B=K(()=>k.communityId);Ve(()=>k.isOpen,h=>{h&&B.value&&(le(),S.value="",j.value=[])},{immediate:!0}),Ve(()=>k.communityId,h=>{k.isOpen&&h&&le()});function X(h){return new Intl.NumberFormat("en-US").format(h)}function G(h){return h.fullName?h.fullName:h.fname&&h.lname?"".concat(h.fname," ").concat(h.lname):h.fname?h.fname:"User ".concat(h.id)}const z=K(()=>{if(!U.value.trim())return j.value;const h=U.value.toLowerCase().trim();return j.value.filter(v=>{var $;const M=G(v).toLowerCase(),fe=(v.jobTitle||"").toLowerCase(),be=(v.currentEmployer||"").toLowerCase(),_e=(($=S.value)==null?void 0:$.toLowerCase())==="other"?(v.skillsDisplay||(Array.isArray(v.skills)?v.skills.join(", "):v.skills)||"").toLowerCase():"";return M.includes(h)||fe.includes(h)||be.includes(h)||_e.includes(h)})});function H(h){B.value&&(S.value=h,te())}async function le(){if(B.value){Z.value=!0;try{let h=await w.getSkillsChartData(B.value,"all",!1,!0);if(h.length===0||h.some(v=>{var M;return((M=v.name)==null?void 0:M.toLowerCase())==="other"})){const v=await w.getSkillsChartData(B.value,"all",!0,!0);v.some(fe=>{var be;return((be=fe.name)==null?void 0:be.toLowerCase())==="other"})?(console.log('[SkillsListPage] Expanding "Other" category to show all individual skills'),h=await w.getAllIndividualSkills(B.value)):h=v}o.value=h.filter(v=>{var M;return((M=v.name)==null?void 0:M.toLowerCase())!=="other"}).map(v=>({name:v.name,value:v.value||0})).sort((v,M)=>M.value-v.value)}catch(h){console.error("Error loading skills:",h),o.value=[]}finally{Z.value=!1}}}async function te(){if(!(!B.value||!S.value)){x.value=!0;try{const h=await w.getUsersBySkill(B.value,"general",S.value,!0);j.value=h,h.length===0&&console.warn('[SkillsListPage] No users found for skill "'.concat(S.value,'"'))}catch(h){console.error("Error loading users:",h),j.value=[]}finally{x.value=!1}}}function J(){S.value="",j.value=[],U.value=""}function V(){S.value="",j.value=[],U.value="",ve("didDismiss")}return(h,v)=>(a(),de(e(Je),{"is-open":Me.isOpen,onDidDismiss:V,onWillDismiss:V,"backdrop-dismiss":!0,id:"skills-list-modal"},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[S.value?(a(),de(e(Ue),{key:0,slot:"start"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:J},{default:i(()=>[n(e(D),{icon:e(It)},null,8,["icon"])]),_:1})]),_:1})):Y("",!0),n(e(We),null,{default:i(()=>[L(u(S.value?S.value:"Skills"),1)]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:V},{default:i(()=>[n(e(D),{icon:e($t)},null,8,["icon"])]),_:1})]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:v[0]||(v[0]=M=>S.value?te():le())},{default:i(()=>[n(e(D),{icon:e(ft)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{fullscreen:!0,class:"skills-content"},{default:i(()=>[S.value?(a(),l("div",er,[x.value?(a(),l("div",tr,[n(e(Pe)),v[2]||(v[2]=t("p",null,"Loading users...",-1))])):j.value.length>0?(a(),l("div",sr,[t("div",nr,[t("h2",null,'Users with "'+u(S.value)+'"',1),t("p",ar,u(X(z.value.length))+" user"+u(z.value.length!==1?"s":"")+u(U.value?" (filtered from ".concat(j.value.length,")"):""),1)]),t("div",lr,[n(e(xe),{modelValue:U.value,"onUpdate:modelValue":v[1]||(v[1]=M=>U.value=M),placeholder:"Search by name, job title, or skills...",debounce:300,class:"user-searchbar"},null,8,["modelValue"])]),U.value&&z.value.length===0?(a(),l("div",or,[t("p",null,'No users found matching "'+u(U.value)+'"',1)])):(a(),de(e(Qe),{key:1},{default:i(()=>[(a(!0),l(Ie,null,De(z.value,M=>(a(),de(e(Re),{key:M.id,class:"user-item"},{default:i(()=>[M.profilePicture?(a(),de(e(ks),{key:0,slot:"start"},{default:i(()=>[t("img",{src:M.profilePicture,alt:G(M)},null,8,ir)]),_:2},1024)):(a(),de(e(D),{key:1,icon:e(vt),slot:"start",class:"avatar-icon"},null,8,["icon"])),n(e(Oe),null,{default:i(()=>{var fe;return[t("h2",null,u(G(M)),1),M.jobTitle||M.currentEmployer?(a(),l("p",rr,u([M.jobTitle,M.currentEmployer].filter(Boolean).join(" at ")),1)):Y("",!0),((fe=S.value)==null?void 0:fe.toLowerCase())==="other"&&(M.skillsDisplay||M.skills)?(a(),l("p",ur,[v[3]||(v[3]=t("span",{class:"skills-label"},"Skills:",-1)),L(" "+u(M.skillsDisplay||(Array.isArray(M.skills)?M.skills.join(", "):M.skills)),1)])):Y("",!0)]}),_:2},1024)]),_:2},1024))),128))]),_:1}))])):(a(),l("div",cr,[n(e(D),{icon:e(Ge),class:"empty-icon"},null,8,["icon"]),v[4]||(v[4]=t("h2",null,"User List Unavailable",-1)),E.value>0?(a(),l("p",dr," Expected "+u(X(E.value))+" user"+u(E.value!==1?"s":"")+" with this skill, but the backend endpoint is not yet implemented. ",1)):(a(),l("p",mr," The backend endpoint for retrieving users by skill is not yet implemented. ")),v[5]||(v[5]=t("p",{class:"empty-hint"}," This feature requires backend support to display the user list. ",-1))]))])):(a(),l("div",vr,[Z.value?(a(),l("div",fr,[n(e(Pe)),v[6]||(v[6]=t("p",null,"Loading skills...",-1))])):o.value.length>0?(a(),l("div",pr,[v[8]||(v[8]=t("div",{class:"list-header"},[t("h2",null,"All Skills"),t("p",{class:"subtitle"},"Click on a skill to view users who have it")],-1)),n(e(Qe),null,{default:i(()=>[(a(!0),l(Ie,null,De(o.value,M=>(a(),de(e(Re),{key:M.name,button:"",onClick:fe=>H(M.name),class:"skill-item"},{default:i(()=>[n(e(D),{icon:e(ts),slot:"start",class:"skill-icon"},null,8,["icon"]),n(e(Oe),null,{default:i(()=>[t("h2",null,u(M.name),1),t("p",null,[v[7]||(v[7]=t("span",{class:"stat-label"},"Users:",-1)),t("span",gr,u(X(M.value||0)),1)])]),_:2},1024),n(e(D),{icon:e(At),slot:"end"},null,8,["icon"])]),_:2},1032,["onClick"]))),128))]),_:1})])):(a(),l("div",yr,[n(e(D),{icon:e(ts),class:"empty-icon"},null,8,["icon"]),v[9]||(v[9]=t("h2",null,"No Skills Found",-1)),v[10]||(v[10]=t("p",null,"No skills were found for this community.",-1))]))]))]),_:1})]),_:1},8,["is-open"]))}}),_r=Xe(hr,[["__scopeId","data-v-e72e9bf4"]]),br={key:0,class:"loading-state"},kr={key:1,class:"users-list"},Cr={class:"list-header"},Ir={class:"subtitle"},$r={key:0},Sr={key:1},Dr={key:2},Mr={key:3,class:"count-warning"},Ur={class:"search-container"},Tr={key:0,class:"no-results"},Nr=["src","alt"],Pr={key:0},wr={key:1,class:"user-skills"},Lr={key:2,class:"empty-state"},Ar={key:0},Or={key:1},Er=Ze({__name:"MentorListPage",props:{isOpen:{type:Boolean},communityId:{},mentorType:{}},emits:["didDismiss"],setup(Me,{emit:P}){const k=Me,ve=P,Z=y(!0),o=y([]),S=y(""),x=y(0),j=K(()=>k.mentorType==="can"?"Can Mentor":"Want Mentor"),U=K(()=>{if(!S.value.trim())return o.value;const H=S.value.toLowerCase().trim();return o.value.filter(le=>{const te=B(le).toLowerCase(),J=(le.jobTitle||"").toLowerCase(),V=(le.currentEmployer||"").toLowerCase(),v=X(le).join(" ").toLowerCase();return te.includes(H)||J.includes(H)||V.includes(H)||v.includes(H)})});function E(H){return new Intl.NumberFormat("en-US").format(H)}function B(H){return H.fullName?H.fullName:H.fname&&H.lname?"".concat(H.fname," ").concat(H.lname):H.fname?H.fname:"User ".concat(H.id)}function X(H){const le=k.mentorType==="can"?H.mentorSkills:H.menteeSkills;return Array.isArray(le)?le:[]}function G(){ve("didDismiss")}async function z(){if(k.communityId){Z.value=!0;try{const[H,le]=await Promise.all([w.getMentorMenteeUsers(k.communityId,k.mentorType),w.getMentorMenteeStats(k.communityId).catch(()=>null)]);o.value=H,le?x.value=k.mentorType==="can"?le.usersCanMentor||0:le.usersWantMentor||0:x.value=H.length}catch(H){console.error("Error loading users:",H),o.value=[],x.value=0}finally{Z.value=!1}}}return Ve(()=>k.isOpen,H=>{H&&(S.value="",z())}),Ve(()=>k.mentorType,()=>{k.isOpen&&z()}),Ve(()=>k.communityId,()=>{k.isOpen&&z()}),Lt(()=>{k.isOpen&&z()}),(H,le)=>(a(),de(e(Je),{"is-open":Me.isOpen,onDidDismiss:G,onWillDismiss:G,"backdrop-dismiss":!0,id:"mentor-list-modal"},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[n(e(We),null,{default:i(()=>[L(u(j.value),1)]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:G},{default:i(()=>[n(e(D),{icon:e($t)},null,8,["icon"])]),_:1})]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:z},{default:i(()=>[n(e(D),{icon:e(ft)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{fullscreen:!0,class:"mentor-list-content"},{default:i(()=>[Z.value?(a(),l("div",br,[n(e(Pe)),t("p",null,"Loading "+u(k.mentorType==="can"?"mentors":"mentees")+"...",1)])):o.value.length>0||x.value>0?(a(),l("div",kr,[t("div",Cr,[t("h2",null,u(j.value),1),t("p",Ir,[x.value>0?(a(),l("span",$r,u(E(x.value))+" user"+u(x.value!==1?"s":""),1)):(a(),l("span",Sr,u(E(U.value.length))+" user"+u(U.value.length!==1?"s":""),1)),S.value&&U.value.length!==x.value?(a(),l("span",Dr," ("+u(E(U.value.length))+" shown)",1)):x.value>0&&U.value.length<x.value?(a(),l("span",Mr," ("+u(E(U.value.length))+" with profile data)",1)):Y("",!0)])]),t("div",Ur,[n(e(xe),{modelValue:S.value,"onUpdate:modelValue":le[0]||(le[0]=te=>S.value=te),placeholder:"Search by name, job title, or skills...",debounce:300,class:"user-searchbar"},null,8,["modelValue"])]),S.value&&U.value.length===0?(a(),l("div",Tr,[t("p",null,'No users found matching "'+u(S.value)+'"',1)])):(a(),de(e(Qe),{key:1},{default:i(()=>[(a(!0),l(Ie,null,De(U.value,te=>(a(),de(e(Re),{key:te.id,class:"user-item"},{default:i(()=>[te.profilePicture?(a(),de(e(ks),{key:0,slot:"start"},{default:i(()=>[t("img",{src:te.profilePicture,alt:B(te)},null,8,Nr)]),_:2},1024)):(a(),de(e(D),{key:1,icon:k.mentorType==="can"?e(ct):e(ss),slot:"start",class:"avatar-icon"},null,8,["icon"])),n(e(Oe),null,{default:i(()=>[t("h2",null,u(B(te)),1),te.jobTitle||te.currentEmployer?(a(),l("p",Pr,u([te.jobTitle,te.currentEmployer].filter(Boolean).join(" at ")),1)):Y("",!0),X(te).length>0?(a(),l("div",wr,[(a(!0),l(Ie,null,De(X(te),J=>(a(),de(e(Xt),{key:J,size:"small",class:"skill-chip"},{default:i(()=>[L(u(J),1)]),_:2},1024))),128))])):Y("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1}))])):(a(),l("div",Lr,[n(e(D),{icon:k.mentorType==="can"?e(ct):e(ss),class:"empty-icon"},null,8,["icon"]),t("h2",null,"No "+u(k.mentorType==="can"?"Mentors":"Mentees")+" Found",1),x.value>0?(a(),l("p",Ar," The backend reports "+u(x.value)+" "+u(k.mentorType==="can"?"mentor":"mentee")+u(x.value!==1?"s":"")+", but no profile data is available to display them. ",1)):(a(),l("p",Or," No users "+u(k.mentorType==="can"?"who can mentor":"who want to be mentored")+" were found. ",1))]))]),_:1})]),_:1},8,["is-open"]))}}),Fr=Xe(Er,[["__scopeId","data-v-b03142b4"]]),Vr={key:0},xr={key:0,class:"loading-state"},Rr={key:1,class:"pairings-container"},jr={class:"header-section"},Br={class:"stats-summary"},Wr={class:"stat-item"},qr={class:"stat-value"},zr={class:"stat-item"},Yr={class:"stat-value engaged"},Jr={class:"stat-item"},Hr={class:"stat-value"},Kr={class:"search-container"},Gr={key:0,class:"no-results"},Qr={key:0},Zr={key:1},Xr={key:2},eu={key:3},tu={key:4},su={key:5},nu={key:0},au={key:1},lu={class:"score-value"},ou={key:2,class:"engaged-badge"},iu={key:2,class:"empty-state"},ru={key:1},uu={key:0,class:"loading-state"},cu={key:1,class:"channel-pairings-list"},du={key:0},mu=["title"],vu=["title"],fu=["title"],pu={key:2,class:"empty-state"},gu=Ze({__name:"ChannelPairingsPage",props:{isOpen:{type:Boolean},communityId:{},startDate:{},endDate:{}},emits:["didDismiss"],setup(Me,{emit:P}){const k=Me,ve=P,Z=y(!1),o=y([]),S=K(()=>k.communityId),x=K(()=>k.startDate),j=K(()=>k.endDate),U=y(""),E=y(!1),B=y([]),X=y(""),G=K(()=>B.value.filter(d=>d.isEngaged).length);K(()=>B.value.length===0?0:G.value/B.value.length*100);const z=K(()=>{if(!X.value.trim())return B.value;const d=X.value.toLowerCase().trim();return B.value.filter(f=>{const N=be(f.user||{}).toLowerCase(),$e=be(f.matchedUser||{}).toLowerCase(),ke=(f.reasons||[]).join(" ").toLowerCase();return N.includes(d)||$e.includes(d)||ke.includes(d)})}),H=K(()=>z.value.filter(d=>d.isEngaged).length),le=K(()=>z.value.length===0?0:H.value/z.value.length*100),te=K(()=>{if(!U.value)return"Channel Pairing Pairings";const[d,f,N]=U.value.split("-").map(Number),ke=new Date(Date.UTC(d,f-1,N)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),Ee=new Set;if(B.value.forEach(we=>{we.channelName&&Ee.add(we.channelName)}),Ee.size===1){const we=Array.from(Ee)[0];return"".concat(we," - ").concat(ke)}return ke}),J=K(()=>{if(x.value)try{const d=new Date(x.value);return isNaN(d.getTime())?x.value:d.toISOString()}catch(d){return x.value}}),V=K(()=>{if(j.value)try{const d=new Date(j.value);return isNaN(d.getTime())?j.value:d.toISOString()}catch(d){return j.value}});Ve(()=>k.isOpen,d=>{d&&S.value&&h()},{immediate:!0}),Ve(()=>k.communityId,d=>{k.isOpen&&d&&h()});async function h(){if(S.value){Z.value=!0;try{console.log("[ChannelPairingsPage] Loading channel pairings with:",{communityId:S.value,startDate:J.value,endDate:V.value});const d=await w.getChannelPairingsByDate(S.value,J.value,V.value);console.log("[ChannelPairingsPage] Received channel pairings:",d),o.value=d.map(f=>({date:f.date,dateDisplay:f.dateDisplay,channelName:f.channelName||null,totalPairings:typeof f.totalPairings=="number"?f.totalPairings:0,engagedPairings:typeof f.engagedPairings=="number"?f.engagedPairings:0,engagementRate:typeof f.engagementRate=="number"?f.engagementRate:0}))}catch(d){console.error("Error loading channel pairings:",d),o.value=[]}finally{Z.value=!1}}}function v(d){S.value&&(U.value=d,M())}async function M(){if(!(!S.value||!U.value)){E.value=!0;try{const d=await w.getChannelPairingPairings(S.value,U.value,J.value,V.value);B.value=d}catch(d){console.error("Error loading pairings:",d),B.value=[]}finally{E.value=!1}}}function fe(){U.value="",B.value=[],X.value=""}function be(d){return d?d.fullName?d.fullName:d.fname&&d.lname?"".concat(d.fname," ").concat(d.lname):d.fname?d.fname:"Unknown":"Unknown"}function _e(){U.value="",B.value=[],X.value="",ve("didDismiss")}function $(d){return d==null||typeof d!="number"||isNaN(d)?"0":d.toLocaleString()}function I(d){return d==null||typeof d!="number"||isNaN(d)?"0%":"".concat(d.toFixed(1),"%")}return(d,f)=>(a(),de(e(Je),{"is-open":Me.isOpen,onDidDismiss:_e,onWillDismiss:_e,"backdrop-dismiss":!0,id:"channel-pairings-list-modal"},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[U.value?(a(),de(e(Ue),{key:0,slot:"start"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:fe},{default:i(()=>[n(e(D),{icon:e(It)},null,8,["icon"])]),_:1})]),_:1})):Y("",!0),n(e(We),null,{default:i(()=>[L(u(U.value?"Channel Pairing Pairings":"Channel Pairings"),1)]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:_e},{default:i(()=>[n(e(D),{icon:e($t)},null,8,["icon"])]),_:1})]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:f[0]||(f[0]=N=>U.value?M():h())},{default:i(()=>[n(e(D),{icon:e(ft)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{fullscreen:!0,class:"channel-pairings-content"},{default:i(()=>[U.value?(a(),l("div",Vr,[E.value?(a(),l("div",xr,[n(e(Pe)),f[2]||(f[2]=t("p",null,"Loading pairings...",-1))])):B.value.length>0?(a(),l("div",Rr,[t("div",jr,[t("h2",null,u(te.value),1),t("div",Br,[t("div",Wr,[f[3]||(f[3]=t("span",{class:"stat-label"},"Total Pairings:",-1)),t("span",qr,u($(z.value.length)),1)]),t("div",zr,[f[4]||(f[4]=t("span",{class:"stat-label"},"Engaged:",-1)),t("span",Yr,u($(H.value)),1)]),t("div",Jr,[f[5]||(f[5]=t("span",{class:"stat-label"},"Engagement Rate:",-1)),t("span",Hr,u(I(le.value)),1)])])]),t("div",Kr,[n(e(xe),{modelValue:X.value,"onUpdate:modelValue":f[1]||(f[1]=N=>X.value=N),placeholder:"Search by user names or match reasons...",debounce:300,class:"pairings-searchbar"},null,8,["modelValue"])]),X.value&&z.value.length===0?(a(),l("div",Gr,[t("p",null,'No pairings found matching "'+u(X.value)+'"',1)])):(a(),de(e(Qe),{key:1,class:"pairings-list"},{default:i(()=>[(a(!0),l(Ie,null,De(z.value,(N,$e)=>(a(),de(e(Re),{key:N.id||$e,class:dt(["pairing-item",{engaged:N.isEngaged}])},{default:i(()=>[n(e(D),{icon:N.isEngaged?e(bs):e(vt),slot:"start",class:dt(N.isEngaged?"icon-engaged":"icon-default")},null,8,["icon","class"]),n(e(Oe),null,{default:i(()=>{var ke,Ee,we,ze;return[t("h2",null,[(ke=N.user)!=null&&ke.fullName||(Ee=N.user)!=null&&Ee.fname?(a(),l("span",Qr,u(be(N.user)),1)):N.userId?(a(),l("span",Zr," User "+u(N.userId),1)):(a(),l("span",Xr,"Unknown User")),f[6]||(f[6]=t("span",{class:"separator"},"↔",-1)),(we=N.matchedUser)!=null&&we.fullName||(ze=N.matchedUser)!=null&&ze.fname?(a(),l("span",eu,u(be(N.matchedUser)),1)):N.matchedUserId?(a(),l("span",tu," User "+u(N.matchedUserId),1)):(a(),l("span",su,"Unknown User"))]),N.reasons&&N.reasons.length>0?(a(),l("p",nu,[f[7]||(f[7]=t("span",{class:"reasons-label"},"Match reasons:",-1)),L(" "+u(N.reasons.join(", ")),1)])):Y("",!0),N.score!==void 0?(a(),l("p",au,[f[8]||(f[8]=t("span",{class:"score-label"},"Score:",-1)),t("span",lu,u(N.score.toFixed(2)),1)])):Y("",!0),N.isEngaged?(a(),l("p",ou,[n(e(D),{icon:e(as)},null,8,["icon"]),f[9]||(f[9]=L(" Conversation started ",-1))])):Y("",!0)]}),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}))])):(a(),l("div",iu,[n(e(D),{icon:e(Ge),class:"empty-icon"},null,8,["icon"]),f[10]||(f[10]=t("h2",null,"No Pairings Found",-1)),f[11]||(f[11]=t("p",null,"No pairings were found for this channel pairing date.",-1))]))])):(a(),l("div",ru,[Z.value?(a(),l("div",uu,[n(e(Pe)),f[12]||(f[12]=t("p",null,"Loading channel pairings...",-1))])):o.value.length>0?(a(),l("div",cu,[f[18]||(f[18]=t("div",{class:"list-header"},[t("h2",null,"Channel Pairings by Date"),t("p",{class:"subtitle"},"Click on a date to view all pairings")],-1)),n(e(Qe),null,{default:i(()=>[(a(!0),l(Ie,null,De(o.value,N=>(a(),de(e(Re),{key:N.date,button:"",onClick:$e=>v(N.date),class:"channel-pairing-item"},{default:i(()=>[n(e(D),{icon:e(qt),slot:"start",class:"channel-icon"},null,8,["icon"]),n(e(Oe),null,{default:i(()=>[t("h2",null,[N.channelName?(a(),l("span",du,u(N.channelName)+" - ",1)):Y("",!0),L(u(N.dateDisplay),1)]),t("p",null,[f[13]||(f[13]=t("span",{class:"stat-label"},"Total Pairings:",-1)),t("span",{class:"stat-value",title:"Raw: ".concat(N.totalPairings)},u($(N.totalPairings)||"0"),9,mu),f[14]||(f[14]=t("span",{class:"stat-separator"},"•",-1)),f[15]||(f[15]=t("span",{class:"stat-label"},"Engaged:",-1)),t("span",{class:"stat-value engaged",title:"Raw: ".concat(N.engagedPairings)},u($(N.engagedPairings)||"0"),9,vu),f[16]||(f[16]=t("span",{class:"stat-separator"},"•",-1)),f[17]||(f[17]=t("span",{class:"stat-label"},"Engagement Rate:",-1)),t("span",{class:"stat-value",title:"Raw: ".concat(N.engagementRate)},u(I(N.engagementRate)||"0%"),9,fu)])]),_:2},1024),n(e(D),{icon:e(At),slot:"end"},null,8,["icon"])]),_:2},1032,["onClick"]))),128))]),_:1})])):(a(),l("div",pu,[n(e(D),{icon:e(qt),class:"empty-icon"},null,8,["icon"]),f[19]||(f[19]=t("h2",null,"No Channel Pairings Found",-1)),f[20]||(f[20]=t("p",null,"No channel pairings were found for the selected time period.",-1))]))]))]),_:1})]),_:1},8,["is-open"]))}}),yu=Xe(gu,[["__scopeId","data-v-01142676"]]),hu={key:0},_u={key:0,class:"loading-state"},bu={key:1,class:"matches-container"},ku={class:"header-section"},Cu={class:"stats-summary"},Iu={class:"stat-item"},$u={class:"stat-value"},Su={class:"search-container"},Du={key:0,class:"no-results"},Mu={class:"stat-value"},Uu={class:"role-info"},Tu={key:0,class:"role-badge mentor-badge"},Nu={key:1,class:"role-badge mentee-badge"},Pu={key:2,class:"role-badge mentee-badge"},wu={key:3,class:"role-badge mentor-badge"},Lu={key:2,class:"empty-state"},Au={key:1},Ou={key:0,class:"loading-state"},Eu={key:1,class:"users-list"},Fu={class:"search-container"},Vu={key:0,class:"no-results"},xu={class:"stat-value"},Ru={key:2,class:"empty-state"},ju={key:0,class:"error-message"},Bu={key:1},Wu=Ze({__name:"MentorMenteeMatchesPage",props:{isOpen:{type:Boolean},communityId:{},startDate:{},endDate:{}},emits:["didDismiss"],setup(Me,{emit:P}){const k=Me,ve=P,Z=y(!1),o=y(!1),S=y([]),x=K(()=>k.communityId),j=K(()=>k.startDate),U=K(()=>k.endDate),E=y(null),B=y(""),X=y(!1),G=y([]),z=y(""),H=K(()=>{if(!z.value.trim())return S.value;const $=z.value.toLowerCase().trim();return S.value.filter(I=>I.userName.toLowerCase().includes($))}),le=K(()=>{if(!z.value.trim())return G.value;const $=z.value.toLowerCase().trim();return G.value.filter(I=>I.matchedUserName.toLowerCase().includes($))}),te=K(()=>{if(j.value)try{const $=new Date(j.value);return isNaN($.getTime())?j.value:$.toISOString()}catch($){return j.value}}),J=K(()=>{if(U.value)try{const $=new Date(U.value);return isNaN($.getTime())?U.value:$.toISOString()}catch($){return U.value}});Ve(()=>k.isOpen,$=>{$&&x.value&&(E.value?h():V())},{immediate:!0}),Ve(()=>k.communityId,$=>{k.isOpen&&$&&(E.value?h():V())});async function V(){if(x.value){Z.value=!0,o.value=!1,E.value=null,B.value="";try{console.log("[MentorMenteeMatchesPage] Loading users with mentor/mentee matches:",{communityId:x.value,startDate:te.value,endDate:J.value});const $=await w.getMentorMenteeUsersWithMatches(x.value,te.value,J.value);console.log("[MentorMenteeMatchesPage] Received users:",$),S.value=$}catch($){console.error("Error loading users:",$),S.value=[]}finally{Z.value=!1}}}async function h(){if(!(!x.value||!E.value)){X.value=!0;try{const $=await w.getMentorMenteeMatchesForUser(x.value,E.value,te.value,J.value);G.value=$,z.value=""}catch($){console.error("Error loading user matches:",$),G.value=[]}finally{X.value=!1}}}function v($,I){E.value=$,B.value=I,z.value="",h()}function M(){E.value=null,B.value="",G.value=[],z.value=""}function fe(){E.value=null,B.value="",G.value=[],z.value="",ve("didDismiss")}function be($){return $==null||typeof $!="number"||isNaN($)?"0":$.toLocaleString()}function _e($){if(!$)return"Unknown date";try{const I=new Date($);return isNaN(I.getTime())?"Invalid date":I.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(I){return"Invalid date"}}return($,I)=>(a(),de(e(Je),{"is-open":Me.isOpen,onDidDismiss:fe,onWillDismiss:fe,"backdrop-dismiss":!0,id:"mentor-mentee-matches-list-modal"},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[E.value?(a(),de(e(Ue),{key:0,slot:"start"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:M},{default:i(()=>[n(e(D),{icon:e(It)},null,8,["icon"])]),_:1})]),_:1})):Y("",!0),n(e(We),null,{default:i(()=>[L(u((E.value,"Mentor/Mentee Matches")),1)]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:fe},{default:i(()=>[n(e(D),{icon:e($t)},null,8,["icon"])]),_:1})]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:I[0]||(I[0]=d=>E.value?h():V())},{default:i(()=>[n(e(D),{icon:e(ft)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{fullscreen:!0,class:"mentor-mentee-matches-content"},{default:i(()=>[E.value?(a(),l("div",hu,[X.value?(a(),l("div",_u,[n(e(Pe)),I[3]||(I[3]=t("p",null,"Loading matches...",-1))])):G.value.length>0?(a(),l("div",bu,[t("div",ku,[t("h2",null,u(B.value),1),t("div",Cu,[t("div",Iu,[I[4]||(I[4]=t("span",{class:"stat-label"},"Total Matches:",-1)),t("span",$u,u(be(G.value.length)),1)])])]),t("div",Su,[n(e(xe),{modelValue:z.value,"onUpdate:modelValue":I[1]||(I[1]=d=>z.value=d),placeholder:"Search by matched user names...",debounce:300,class:"matches-searchbar"},null,8,["modelValue"])]),z.value&&le.value.length===0?(a(),l("div",Du,[t("p",null,'No matches found matching "'+u(z.value)+'"',1)])):(a(),de(e(Qe),{key:1,class:"matches-list"},{default:i(()=>[(a(!0),l(Ie,null,De(le.value,(d,f)=>(a(),de(e(Re),{key:d.id||f,class:"match-item"},{default:i(()=>[n(e(D),{icon:e(vt),slot:"start",class:"icon-default"},null,8,["icon"]),n(e(Oe),null,{default:i(()=>[t("h2",null,[t("span",null,u(d.matchedUserName),1)]),t("p",null,[I[5]||(I[5]=t("span",{class:"stat-label"},"Matched:",-1)),t("span",Mu,u(_e(d.createdAt)),1)]),t("p",Uu,[d.userWasMentor?(a(),l("span",Tu,[n(e(D),{icon:e(ct)},null,8,["icon"]),I[6]||(I[6]=L(" You were ",-1)),I[7]||(I[7]=t("strong",null,"Mentor",-1))])):Y("",!0),d.userWasMentee?(a(),l("span",Nu,[n(e(D),{icon:e(vt)},null,8,["icon"]),I[8]||(I[8]=L(" You were ",-1)),I[9]||(I[9]=t("strong",null,"Mentee",-1))])):Y("",!0),I[12]||(I[12]=t("span",{class:"role-separator"},"→",-1)),d.userWasMentor?(a(),l("span",Pu,[n(e(D),{icon:e(vt)},null,8,["icon"]),L(" "+u(d.matchedUserName)+" was ",1),I[10]||(I[10]=t("strong",null,"Mentee",-1))])):Y("",!0),d.userWasMentee?(a(),l("span",wu,[n(e(D),{icon:e(ct)},null,8,["icon"]),L(" "+u(d.matchedUserName)+" was ",1),I[11]||(I[11]=t("strong",null,"Mentor",-1))])):Y("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1}))])):(a(),l("div",Lu,[n(e(D),{icon:e(Ge),class:"empty-icon"},null,8,["icon"]),I[13]||(I[13]=t("h2",null,"No Matches Found",-1)),I[14]||(I[14]=t("p",null,"No mentor/mentee matches were found for this user.",-1))]))])):(a(),l("div",Au,[Z.value?(a(),l("div",Ou,[n(e(Pe)),I[15]||(I[15]=t("p",null,"Loading mentor/mentee matches...",-1))])):S.value.length>0?(a(),l("div",Eu,[I[17]||(I[17]=t("div",{class:"list-header"},[t("h2",null,"Users with Mentor/Mentee Matches"),t("p",{class:"subtitle"},"Click on a user to view their matches")],-1)),t("div",Fu,[n(e(xe),{modelValue:z.value,"onUpdate:modelValue":I[2]||(I[2]=d=>z.value=d),placeholder:"Search by user name...",debounce:300,class:"users-searchbar"},null,8,["modelValue"])]),z.value&&H.value.length===0?(a(),l("div",Vu,[t("p",null,'No users found matching "'+u(z.value)+'"',1)])):(a(),de(e(Qe),{key:1},{default:i(()=>[(a(!0),l(Ie,null,De(H.value,d=>(a(),de(e(Re),{key:d.userId,button:"",onClick:f=>v(d.userId,d.userName),class:"user-item"},{default:i(()=>[n(e(D),{icon:e(ct),slot:"start",class:"user-icon"},null,8,["icon"]),n(e(Oe),null,{default:i(()=>[t("h2",null,u(d.userName),1),t("p",null,[I[16]||(I[16]=t("span",{class:"stat-label"},"Matches:",-1)),t("span",xu,u(be(d.matchCount)),1)])]),_:2},1024),n(e(D),{icon:e(At),slot:"end"},null,8,["icon"])]),_:2},1032,["onClick"]))),128))]),_:1}))])):(a(),l("div",Ru,[n(e(D),{icon:e(ct),class:"empty-icon"},null,8,["icon"]),I[19]||(I[19]=t("h2",null,"No Mentor/Mentee Matches Found",-1)),o.value?(a(),l("p",ju,[...I[18]||(I[18]=[t("strong",null,"No Matches Found:",-1),L(" No mentor/mentee matches were found for the selected time period. This could mean: (1) No matches exist in the date range, (2) The matches are outside the selected date range, or (3) There may be a data filtering issue. Check the console for more details. ",-1)])])):(a(),l("p",Bu,"No mentor/mentee matches were found for the selected time period."))]))]))]),_:1})]),_:1},8,["is-open"]))}}),qu=Xe(Wu,[["__scopeId","data-v-a6dec1ce"]]),zu={key:0},Yu={key:0,class:"loading-state"},Ju={key:1,class:"connections-container"},Hu={class:"header-section"},Ku={class:"stats-summary"},Gu={class:"stat-item"},Qu={class:"stat-value"},Zu={class:"search-container"},Xu={key:0,class:"no-results"},ec={class:"stat-value"},tc={key:0,class:"match-type"},sc={class:"stat-value"},nc={key:2,class:"empty-state"},ac={key:1},lc={key:0,class:"loading-state"},oc={key:1,class:"users-list"},ic={class:"search-container"},rc={key:0,class:"no-results"},uc={class:"stat-value"},cc={key:2,class:"empty-state"},dc=Ze({__name:"ConnectionsPage",props:{isOpen:{type:Boolean},communityId:{},startDate:{},endDate:{}},emits:["didDismiss"],setup(Me,{emit:P}){const k=Me,ve=P,Z=y(!1),o=y([]),S=K(()=>k.communityId),x=K(()=>k.startDate),j=K(()=>k.endDate),U=y(null),E=y(""),B=y(!1),X=y([]),G=y(""),z=K(()=>{if(!G.value.trim())return o.value;const $=G.value.toLowerCase().trim();return o.value.filter(I=>I.userName.toLowerCase().includes($))}),H=K(()=>{if(!G.value.trim())return X.value;const $=G.value.toLowerCase().trim();return X.value.filter(I=>I.connectedUserName.toLowerCase().includes($))}),le=K(()=>{if(x.value)try{const $=new Date(x.value);return isNaN($.getTime())?x.value:$.toISOString()}catch($){return x.value}}),te=K(()=>{if(j.value)try{const $=new Date(j.value);return isNaN($.getTime())?j.value:$.toISOString()}catch($){return j.value}});Ve(()=>k.isOpen,$=>{$&&S.value&&(U.value?V():J())},{immediate:!0}),Ve(()=>k.communityId,$=>{k.isOpen&&$&&(U.value?V():J())});async function J(){if(S.value){Z.value=!0,U.value=null,E.value="";try{console.log("[ConnectionsPage] Loading users with connections:",{communityId:S.value,startDate:le.value,endDate:te.value});const $=await w.getUsersWithConnections(S.value,le.value,te.value);console.log("[ConnectionsPage] Received users:",$),o.value=$}catch($){console.error("Error loading users:",$),o.value=[]}finally{Z.value=!1}}}async function V(){if(!(!S.value||!U.value)){B.value=!0;try{const $=await w.getConnectionsForUser(S.value,U.value,le.value,te.value);X.value=$,G.value=""}catch($){console.error("Error loading user connections:",$),X.value=[]}finally{B.value=!1}}}function h($,I){U.value=$,E.value=I,G.value="",V()}function v(){U.value=null,E.value="",X.value=[],G.value=""}function M(){U.value=null,E.value="",X.value=[],G.value="",ve("didDismiss")}function fe($){return $==null||typeof $!="number"||isNaN($)?"0":$.toLocaleString()}function be($){if(!$)return"Unknown date";try{const I=new Date($);return isNaN(I.getTime())?"Invalid date":I.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(I){return"Invalid date"}}function _e($){return $?$.split(/[-_]/).map(I=>I.charAt(0).toUpperCase()+I.slice(1).toLowerCase()).join(" "):"Unknown"}return($,I)=>(a(),de(e(Je),{"is-open":Me.isOpen,onDidDismiss:M,onWillDismiss:M,"backdrop-dismiss":!0,id:"connections-list-modal"},{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[U.value?(a(),de(e(Ue),{key:0,slot:"start"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:v},{default:i(()=>[n(e(D),{icon:e(It)},null,8,["icon"])]),_:1})]),_:1})):Y("",!0),n(e(We),null,{default:i(()=>[L(u(U.value?"".concat(E.value,"'s Connections"):"Introductions Created"),1)]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:M},{default:i(()=>[n(e(D),{icon:e($t)},null,8,["icon"])]),_:1})]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{fill:"clear",onClick:I[0]||(I[0]=d=>U.value?V():J())},{default:i(()=>[n(e(D),{icon:e(ft)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{fullscreen:!0,class:"connections-content"},{default:i(()=>[U.value?(a(),l("div",zu,[B.value?(a(),l("div",Yu,[n(e(Pe)),I[3]||(I[3]=t("p",null,"Loading connections...",-1))])):X.value.length>0?(a(),l("div",Ju,[t("div",Hu,[t("h2",null,u(E.value),1),t("div",Ku,[t("div",Gu,[I[4]||(I[4]=t("span",{class:"stat-label"},"Total Connections:",-1)),t("span",Qu,u(fe(X.value.length)),1)])])]),t("div",Zu,[n(e(xe),{modelValue:G.value,"onUpdate:modelValue":I[1]||(I[1]=d=>G.value=d),placeholder:"Search by connected user names...",debounce:300,class:"connections-searchbar"},null,8,["modelValue"])]),G.value&&H.value.length===0?(a(),l("div",Xu,[t("p",null,'No connections found matching "'+u(G.value)+'"',1)])):(a(),de(e(Qe),{key:1,class:"connections-list"},{default:i(()=>[(a(!0),l(Ie,null,De(H.value,(d,f)=>(a(),de(e(Re),{key:d.id||f,class:"connection-item"},{default:i(()=>[n(e(D),{icon:e(vt),slot:"start",class:"icon-default"},null,8,["icon"]),n(e(Oe),null,{default:i(()=>[t("h2",null,u(d.connectedUserName),1),t("p",null,[I[5]||(I[5]=t("span",{class:"stat-label"},"Connected:",-1)),t("span",ec,u(be(d.createdAt)),1)]),d.matchType?(a(),l("p",tc,[I[6]||(I[6]=t("span",{class:"stat-label"},"Type:",-1)),t("span",sc,u(_e(d.matchType)),1)])):Y("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1}))])):(a(),l("div",nc,[n(e(D),{icon:e(Ge),class:"empty-icon"},null,8,["icon"]),I[7]||(I[7]=t("h2",null,"No Connections Found",-1)),I[8]||(I[8]=t("p",null,"No connections were found for this user.",-1))]))])):(a(),l("div",ac,[Z.value?(a(),l("div",lc,[n(e(Pe)),I[9]||(I[9]=t("p",null,"Loading connections...",-1))])):o.value.length>0?(a(),l("div",oc,[I[11]||(I[11]=t("div",{class:"list-header"},[t("h2",null,"Users with Connections"),t("p",{class:"subtitle"},"Click on a user to view their connections")],-1)),t("div",ic,[n(e(xe),{modelValue:G.value,"onUpdate:modelValue":I[2]||(I[2]=d=>G.value=d),placeholder:"Search by user name...",debounce:300,class:"users-searchbar"},null,8,["modelValue"])]),G.value&&z.value.length===0?(a(),l("div",rc,[t("p",null,'No users found matching "'+u(G.value)+'"',1)])):(a(),de(e(Qe),{key:1},{default:i(()=>[(a(!0),l(Ie,null,De(z.value,d=>(a(),de(e(Re),{key:d.userId,button:"",onClick:f=>h(d.userId,d.userName),class:"user-item"},{default:i(()=>[n(e(D),{icon:e(Ge),slot:"start",class:"user-icon"},null,8,["icon"]),n(e(Oe),null,{default:i(()=>[t("h2",null,u(d.userName),1),t("p",null,[I[10]||(I[10]=t("span",{class:"stat-label"},"Connections:",-1)),t("span",uc,u(fe(d.connectionCount)),1)])]),_:2},1024),n(e(D),{icon:e(At),slot:"end"},null,8,["icon"])]),_:2},1032,["onClick"]))),128))]),_:1}))])):(a(),l("div",cc,[n(e(D),{icon:e(Ge),class:"empty-icon"},null,8,["icon"]),I[12]||(I[12]=t("h2",null,"No Connections Found",-1)),I[13]||(I[13]=t("p",null,"No connections were found for the selected time period.",-1))]))]))]),_:1})]),_:1},8,["is-open"]))}}),mc=Xe(dc,[["__scopeId","data-v-635d2dd4"]]),vc={key:0,class:"access-denied"},fc={key:1,class:"loading-container"},pc={key:2,class:"admin-console-container"},gc={key:0,class:"community-selector-section"},yc={key:0,style:{"font-weight":"bold",color:"#3880ff"}},hc={key:1},_c={class:"tab-content"},bc={key:0,class:"tab-panel"},kc={key:1,class:"tab-panel"},Cc={key:2,class:"tab-panel"},Ic={key:3,class:"tab-panel"},$c=Ze({__name:"AdminConsolePage",setup(Me){const P=zt(),k=Es(),ve=As(),Z=Os(),o=y(!0),S=y(!1),x=y(!1),j=y("stats"),U=y([]),E=y(null),B=y(!1),X=y(void 0),G=y(void 0),z=y(!1),H=y(!1),le=y("can"),te=y(!1),J=y(void 0),V=y(void 0),h=y(!1),v=y(void 0),M=y(void 0),fe=y(!1),be=y(void 0),_e=y(void 0);K(()=>E.value?E.value:Z.currentCommunityId?Z.currentCommunityId:$());function $(){const re=k.query;if(re.communityId){const Se=Number(re.communityId);if(!isNaN(Se))return console.log("[AdminConsole] Using communityId from query params:",Se),Se}const Q=Fs.getCurrentValidation();if(Q!=null&&Q.communityId)return console.log("[AdminConsole] Using communityId from validated Slack session:",Q.communityId),Q.communityId;if(k.params.communityId){const Se=Number(k.params.communityId);if(!isNaN(Se))return console.log("[AdminConsole] Using communityId from route params:",Se),Se}return Z.currentCommunityId?(console.log("[AdminConsole] Using communityId from store:",Z.currentCommunityId),Z.currentCommunityId):(console.warn("[AdminConsole] No communityId found in query params, session, route params, or store"),null)}async function I(){var Q;if(!((Q=ve.user)!=null&&Q.id)){S.value=!1,o.value=!1;return}x.value=w.isSuperAdmin(ve.user.id);const re=$();if(x.value){S.value=!0,await d(),re?E.value=re:U.value.length>0&&(E.value=U.value[0].id),o.value=!1;return}if(!re){S.value=!1,o.value=!1;return}try{let Se=Z.getCommunityById(re);if(!Se){const{communityService:Ke}=await ns(()=>import("./index-CkJ7yJ3n.js").then(tt=>tt.bY),__vite__mapDeps([1,2]));Se=await Ke.getCommunityById(re)}if(S.value=await w.isManager(re,ve.user.id,Se||void 0),S.value){E.value=re;const Ke=Z.getCommunityById(re);if(Ke)Z.setCurrentCommunity(Ke),console.log("[AdminConsole] Set community in store:",re,Ke.name);else{const{communityService:tt}=await ns(()=>import("./index-CkJ7yJ3n.js").then(nt=>nt.bY),__vite__mapDeps([1,2])),st=await tt.getCommunityById(re);st&&(Z.setCurrentCommunity(st),console.log("[AdminConsole] Loaded and set community in store:",re,st.name))}await d()}else setTimeout(()=>{P.push("/tabs/home")},2e3)}catch(Se){console.error("Error checking manager access:",Se),S.value=!1,setTimeout(()=>{P.push("/tabs/home")},2e3)}finally{o.value=!1}}async function d(){var re;if((re=ve.user)!=null&&re.id){if(x.value){try{const Q=await w.getAllCommunitiesForSuperAdmin(ve.user.id);U.value=Q,console.log("[AdminConsole] Loaded all communities for super admin:",Q.length),!E.value&&Q.length>0&&(E.value=Q[0].id,Z.setCurrentCommunity(Q[0]))}catch(Q){console.error("Failed to load all communities for super admin:",Q),Z.currentCommunity&&(U.value=[Z.currentCommunity])}return}Z.currentCommunity&&(U.value=[Z.currentCommunity])}}function f(){P.back()}function N(){}function $e(){if(E.value){const re=U.value.find(Q=>Q.id===E.value);re&&(Z.setCurrentCommunity(re),console.log("[AdminConsole] Switched to community:",re.id,re.name))}}async function ke(){o.value=!0,await I(),o.value=!1}function Ee(re,Q){X.value=re,G.value=Q,B.value=!0}function we(){B.value=!1,X.value=void 0,G.value=void 0}function ze(){z.value=!0}function St(){z.value=!1}function Dt(re){le.value=re,H.value=!0}function Mt(){H.value=!1}function W(re,Q){J.value=re,V.value=Q,te.value=!0}function Te(){te.value=!1,J.value=void 0,V.value=void 0}function Le(re,Q){v.value=re,M.value=Q,h.value=!0}function He(){h.value=!1,v.value=void 0,M.value=void 0}function Ye(re,Q){be.value=re,_e.value=Q,fe.value=!0}function lt(){fe.value=!1,be.value=void 0,_e.value=void 0}return Lt(()=>{I()}),(re,Q)=>(a(),de(e(Vs),null,{default:i(()=>[n(e(je),null,{default:i(()=>[n(e(Be),null,{default:i(()=>[n(e(Ue),{slot:"start"},{default:i(()=>[n(e(ue),{onClick:f},{default:i(()=>[n(e(D),{icon:e(It)},null,8,["icon"])]),_:1})]),_:1}),n(e(We),null,{default:i(()=>[...Q[2]||(Q[2]=[L("Admin Console",-1)])]),_:1}),n(e(Ue),{slot:"end"},{default:i(()=>[n(e(ue),{onClick:ke},{default:i(()=>[n(e(D),{icon:e(ft)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(e(qe),{fullscreen:!0,class:"admin-console-content"},{default:i(()=>[!o.value&&!S.value?(a(),l("div",vc,[n(e(D),{icon:e(xs),class:"lock-icon"},null,8,["icon"]),Q[4]||(Q[4]=t("h2",null,"Access Denied",-1)),Q[5]||(Q[5]=t("p",null,"You must be a community leader or manager to access the admin console.",-1)),Q[6]||(Q[6]=t("p",{class:"redirect-message"},"Redirecting you back...",-1)),n(e(ue),{onClick:f},{default:i(()=>[...Q[3]||(Q[3]=[L("Go Back Now",-1)])]),_:1})])):o.value?(a(),l("div",fc,[n(e(Pe)),Q[7]||(Q[7]=t("p",null,"Loading admin console...",-1))])):(a(),l("div",pc,[U.value.length>1||x.value?(a(),l("div",gc,[n(e(Re),null,{default:i(()=>[n(e(Oe),null,{default:i(()=>[x.value?(a(),l("span",yc," Super Admin: Select Community ")):(a(),l("span",hc,"Select Community"))]),_:1}),n(e(Ct),{modelValue:E.value,"onUpdate:modelValue":Q[0]||(Q[0]=Se=>E.value=Se),onIonChange:$e},{default:i(()=>[(a(!0),l(Ie,null,De(U.value,Se=>(a(),de(e(Ae),{key:Se.id,value:Se.id},{default:i(()=>[L(u(Se.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):Y("",!0),n(e(Rs),{modelValue:j.value,"onUpdate:modelValue":Q[1]||(Q[1]=Se=>j.value=Se),onIonChange:N},{default:i(()=>[n(e(Wt),{value:"stats"},{default:i(()=>[n(e(Oe),null,{default:i(()=>[...Q[8]||(Q[8]=[L("Stats",-1)])]),_:1})]),_:1}),n(e(Wt),{value:"analytics"},{default:i(()=>[n(e(Oe),null,{default:i(()=>[...Q[9]||(Q[9]=[L("Analytics",-1)])]),_:1})]),_:1}),n(e(Wt),{value:"data"},{default:i(()=>[n(e(Oe),null,{default:i(()=>[...Q[10]||(Q[10]=[L("Upload Data",-1)])]),_:1})]),_:1}),n(e(Wt),{value:"users"},{default:i(()=>[n(e(Oe),null,{default:i(()=>[...Q[11]||(Q[11]=[L("Users",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t("div",_c,[j.value==="stats"?(a(),l("div",bc,[n(bi,{"community-id":E.value,onOpenMagicIntros:Ee,onOpenChannelPairings:W,onOpenMentorMenteeMatches:Le,onOpenConnections:Ye,onOpenSkills:ze,onOpenMentorList:Dt},null,8,["community-id"])])):Y("",!0),j.value==="analytics"?(a(),l("div",kc,[n(ka,{"community-id":E.value},null,8,["community-id"])])):Y("",!0),j.value==="data"?(a(),l("div",Cc,[n(In,{"community-id":E.value},null,8,["community-id"])])):Y("",!0),j.value==="users"?(a(),l("div",Ic,[n(on,{"community-id":E.value,onRefresh:ke},null,8,["community-id"])])):Y("",!0)])]))]),_:1}),n(Xi,{"is-open":B.value,"community-id":E.value,"start-date":X.value,"end-date":G.value,onDidDismiss:we},null,8,["is-open","community-id","start-date","end-date"]),n(_r,{"is-open":z.value,"community-id":E.value,onDidDismiss:St},null,8,["is-open","community-id"]),E.value?(a(),de(Fr,{key:0,"is-open":H.value,"community-id":E.value,"mentor-type":le.value,onDidDismiss:Mt},null,8,["is-open","community-id","mentor-type"])):Y("",!0),n(yu,{"is-open":te.value,"community-id":E.value,"start-date":J.value,"end-date":V.value,onDidDismiss:Te},null,8,["is-open","community-id","start-date","end-date"]),n(qu,{"is-open":h.value,"community-id":E.value,"start-date":v.value,"end-date":M.value,onDidDismiss:He},null,8,["is-open","community-id","start-date","end-date"]),n(mc,{"is-open":fe.value,"community-id":E.value,"start-date":be.value,"end-date":_e.value,onDidDismiss:lt},null,8,["is-open","community-id","start-date","end-date"])]),_:1}))}}),Uc=Xe($c,[["__scopeId","data-v-ede2b30e"]]);export{Uc as default};
