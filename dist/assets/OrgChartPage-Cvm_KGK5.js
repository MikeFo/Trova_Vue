import{y as $e,z as xe,b6 as Ne,T as Re,F as re,r,a2 as K,a4 as se,Y as u,ap as Ce,O as f,b7 as Me,aU as Se,R as i,a0 as ce,G as we,ag as b,a8 as P,N as L,L as $,a6 as oe,b8 as Le,b9 as Ae,af as ye,aa as pe,ab as ke,ba as qe,bb as Oe,W as G,v as De,a1 as Fe,a3 as Ye,I as Xe,J as Q,M as _e,a$ as W,aj as Ve,b0 as Be,H as Ee,ak as He,al as We,am as ze,az as Qe,bc as Ge,aA as Je,Z as je,bd as Ze,X as Ke,Q as et}from"./index-CkJ7yJ3n.js";class tt{async createSecretCode(A,q){try{const{firestore:d}=$e();if(!d)throw new Error("Firestore not available");const a=xe(d,"tempCodes/server/userCodes"),g=await Ne(a,{createdAt:Re.now(),communityId:A,slackUserId:q});return console.log("[OrgChartAuthService] Created Firebase document with ID:",g.id),g.id}catch(d){throw console.error("[OrgChartAuthService] Failed to create secret code:",d),d}}}const at=new tt,st=.2,ot=1,lt=.1,nt=re({__name:"OrgChartContainer",props:{scale:{},translateX:{},translateY:{}},emits:["update:scale","update:translateX","update:translateY","center-on-node"],setup(l,{expose:A,emit:q}){const d=l,a=q;A({centerOnNode:E,centerOnRoot:ie});const g=r(d.scale||1),k=r(d.translateX||0),v=r(d.translateY||0),T=r(!1),D=r(0),I=r(0),c=r(0),y=r(0),X=r(0),V=r(1),B=r(!1),ee=K(()=>({transform:"matrix(".concat(g.value,", 0, 0, ").concat(g.value,", ").concat(k.value,", ").concat(v.value,")")}));function z(s){const S=Math.max(st,Math.min(ot,s));g.value=S,a("update:scale",S)}function O(s,S){k.value=s,v.value=S,a("update:translateX",s),a("update:translateY",S)}function _(s){s.button===0&&(T.value=!0,D.value=s.clientX,I.value=s.clientY,c.value=k.value,y.value=v.value)}function F(s){if(!T.value)return;const S=s.clientX-D.value,x=s.clientY-I.value;O(c.value+S,y.value+x)}function R(){T.value=!1}function U(){T.value=!1}function Y(s){const S=lt,x=g.value+(s.deltaY>0?-S:S);z(x)}function J(s){if(s.length<2)return 0;const S=s[0].clientX-s[1].clientX,x=s[0].clientY-s[1].clientY;return Math.sqrt(S*S+x*x)}function te(s){s.touches.length===2?(B.value=!0,X.value=J(s.touches),V.value=g.value):s.touches.length===1&&(T.value=!0,D.value=s.touches[0].clientX,I.value=s.touches[0].clientY,c.value=k.value,y.value=v.value)}function le(s){if(B.value&&s.touches.length===2){const x=J(s.touches)/X.value,H=V.value*x;z(H)}else if(T.value&&s.touches.length===1){const S=s.touches[0].clientX-D.value,x=s.touches[0].clientY-I.value;O(c.value+S,y.value+x)}}function j(){T.value=!1,B.value=!1}se(()=>d.scale,s=>{s!==void 0&&s!==g.value&&(g.value=s)}),se(()=>d.translateX,s=>{s!==void 0&&s!==k.value&&(k.value=s)}),se(()=>d.translateY,s=>{s!==void 0&&s!==v.value&&(v.value=s)});function E(s){if(!s)return;const S=document.querySelector(".orgchart-container");if(!S)return;const x=S.getBoundingClientRect(),H=s.getBoundingClientRect(),ae=S.querySelector(".orgchart");if(!ae)return;ae.getBoundingClientRect();const ne=x.width/2,ue=x.height/2,de=H.left-x.left+H.width/2,he=H.top-x.top+H.height/2,ge=ne-de,ve=ue-he,fe=k.value+ge/g.value,me=v.value+ve/g.value;O(fe,me)}function ie(){setTimeout(()=>{const s=document.querySelector(".org-node-wrapper");s?E(s):O(0,0)},150)}return(s,S)=>(i(),u("div",{class:"orgchart-container",onMousedown:_,onMousemove:F,onMouseup:R,onMouseleave:U,onWheel:Ce(Y,["prevent"]),onTouchstart:te,onTouchmove:le,onTouchend:j},[f("div",{class:"orgchart",style:Se(ee.value)},[Me(s.$slots,"default",{},void 0)],4)],32))}}),rt=ce(nt,[["__scopeId","data-v-a857bc53"]]),ct=["data-slack-id","data-node-id"],it={class:"org-node-header"},ut={class:"org-node-avatar"},dt=["src","alt"],ht={key:1,class:"org-node-avatar-placeholder"},gt=["aria-label"],vt={class:"org-node-content"},ft={class:"org-node-name"},mt={key:0,class:"org-node-title"},pt={key:1,class:"org-node-field"},kt={key:2,class:"org-node-field"},Ct={key:3,class:"org-node-field"},It={key:4,class:"org-node-field"},yt=re({__name:"OrgChartNode",props:{datasource:{},displayFlags:{},groupScale:{},isSelected:{type:Boolean},isHighlighted:{type:Boolean},highlightedSlackId:{}},emits:["node-click","select-node"],setup(l,{expose:A,emit:q}){const d=r(null);A({nodeElement:d});const a=l,g=q,k=K(()=>a.groupScale||3),v=r(!1),T=r([]),D=r(null),I=r(a.isHighlighted?a.datasource.slackId:null),c=K(()=>a.datasource.children&&a.datasource.children.length>0),y=K(()=>a.displayFlags),X=K(()=>{if(!a.datasource.children||a.datasource.children.length===0)return[];const O=[],_=a.datasource.children;for(let F=0;F<_.length;F+=k.value)O.push(_.slice(F,F+k.value));return O});function V(){c.value&&(v.value&&T.value.length>0&&a.datasource.children&&(a.datasource.children=[...T.value],T.value=[]),v.value=!v.value)}function B(){g("node-click",a.datasource),g("select-node",a.datasource.id)}function ee(O){g("node-click",O)}function z(O){D.value=O,g("select-node",O)}return we(()=>{var _,F,R;console.log("[OrgChartNode] Mounted with datasource:",{name:a.datasource.name,id:a.datasource.id,childrenCount:((_=a.datasource.children)==null?void 0:_.length)||0,expandedChildrenSlackIds:a.datasource.expandedChildrenSlackIds}),a.datasource.children&&a.datasource.children.length>0&&(T.value=[...a.datasource.children]);const O=a.highlightedSlackId&&((F=a.datasource.children)==null?void 0:F.some(U=>U.slackId===a.highlightedSlackId));if(a.isHighlighted||O)console.log("[OrgChartNode] Node is highlighted or has highlighted child, showing all children"),O&&T.value.length>0&&(a.datasource.children=[...T.value],console.log("[OrgChartNode] Restored all children to show siblings")),v.value=!1;else if(a.datasource.expandedChildrenSlackIds&&a.datasource.expandedChildrenSlackIds.length>0){if(a.datasource.children&&a.datasource.children.length>0){const U=a.datasource.children.filter(Y=>a.datasource.expandedChildrenSlackIds.includes(Y.slackId));console.log("[OrgChartNode] Filtered children:",{total:a.datasource.children.length,filtered:U.length}),U.length>0&&U.length<a.datasource.children.length&&(a.datasource.children=U),v.value=!1}}else a.datasource.children&&a.datasource.children.length>0&&(console.log("[OrgChartNode] No expandedChildrenSlackIds, expanding by default"),v.value=!1);console.log("[OrgChartNode] Final state:",{isCollapsed:v.value,hasChildren:c.value,childrenCount:((R=a.datasource.children)==null?void 0:R.length)||0})}),se(()=>a.isHighlighted,O=>{O&&(I.value=a.datasource.slackId)}),(O,_)=>{const F=qe("OrgChartNode",!0);return i(),u("div",{class:"org-node-wrapper","data-slack-id":l.datasource.slackId,"data-node-id":l.datasource.id,ref_key:"nodeWrapper",ref:d},[f("div",{class:ye(["org-node",{"org-node-selected":l.isSelected,"org-node-highlighted":l.isHighlighted}]),onClick:B},[f("div",it,[f("div",ut,[l.datasource.profilePicture?(i(),u("img",{key:0,src:l.datasource.profilePicture,alt:l.datasource.name},null,8,dt)):(i(),u("div",ht,P(l.datasource.name.charAt(0).toUpperCase()),1))]),c.value?(i(),u("button",{key:0,class:"org-node-toggle",onClick:Ce(V,["stop"]),"aria-label":v.value?"Expand":"Collapse"},[L($(oe),{icon:v.value?$(Le):$(Ae)},null,8,["icon"])],8,gt)):b("",!0)]),f("div",vt,[f("div",ft,P(l.datasource.name),1),l.datasource.title&&y.value.showTitle?(i(),u("div",mt,P(l.datasource.title),1)):b("",!0),l.datasource.department&&y.value.showDepartment?(i(),u("div",pt,P(l.datasource.department),1)):b("",!0),l.datasource.location&&y.value.showLocation?(i(),u("div",kt,P(l.datasource.location),1)):b("",!0),l.datasource.role&&y.value.showRole?(i(),u("div",Ct,P(l.datasource.role),1)):b("",!0),l.datasource.team&&y.value.showTeam?(i(),u("div",It,P(l.datasource.team),1)):b("",!0)])],2),c.value?(i(),u("div",{key:0,class:ye(["org-node-children",{"org-node-collapsed":v.value}])},[(i(!0),u(pe,null,ke(X.value,(R,U)=>(i(),u("div",{key:"group-".concat(U),class:"org-group"},[(i(!0),u(pe,null,ke(R,Y=>(i(),u("div",{key:Y.id||Y.slackId,class:"org-node-child"},[L(F,{datasource:Y,"display-flags":y.value,"group-scale":k.value,"is-selected":D.value===Y.id,"is-highlighted":I.value===Y.slackId,"highlighted-slack-id":I.value||a.highlightedSlackId,onNodeClick:ee,onSelectNode:z},null,8,["datasource","display-flags","group-scale","is-selected","is-highlighted","highlighted-slack-id"])]))),128))]))),128))],2)):b("",!0)],8,ct)}}}),St=ce(yt,[["__scopeId","data-v-b4c018b6"]]),wt={class:"org-user-popup-header"},Ot=["src","alt"],Pt={key:1,class:"org-user-popup-avatar-placeholder"},bt={class:"org-user-popup-name"},Tt={class:"org-user-popup-content"},Ut={key:0,class:"org-user-popup-field"},$t=["href"],xt={key:1,class:"org-user-popup-field"},Nt={key:2,class:"org-user-popup-field"},Rt={key:3,class:"org-user-popup-field"},Mt={key:4,class:"org-user-popup-field"},Lt={key:5,class:"org-user-popup-field"},At=re({__name:"OrgChartUserPopup",props:{isOpen:{type:Boolean},user:{},position:{}},emits:["close"],setup(l,{emit:A}){const q=l,d=A,a=K(()=>q.position?{position:"fixed",left:"".concat(q.position.x,"px"),top:"".concat(q.position.y,"px"),transform:"translate(-50%, -50%)"}:{});function g(){d("close")}function k(){g()}function v(){const I=q.user;if(!(I!=null&&I.slackId))return;const c="slack://user?team=".concat(D(),"&id=").concat(I.slackId);window.location.href=c,setTimeout(()=>{const y="https://app.slack.com/client/".concat(D(),"/user/").concat(I.slackId);window.open(y,"_blank")},1e3)}function T(){const I=q.user;if(!(I!=null&&I.slackId))return;const c="slack://channel?team=".concat(D(),"&id=").concat(I.slackId);window.location.href=c,setTimeout(()=>{const y="https://app.slack.com/client/".concat(D(),"/im/").concat(I.slackId);window.open(y,"_blank")},1e3)}function D(){return new URLSearchParams(window.location.search).get("slackTeamId")||""}return(I,c)=>l.isOpen&&l.user?(i(),u("div",{key:0,class:"org-user-popup-overlay",onClick:k},[f("div",{class:"org-user-popup",onClick:c[0]||(c[0]=Ce(()=>{},["stop"])),style:Se(a.value)},[f("button",{class:"org-user-popup-close",onClick:g},[L($(oe),{icon:$(Oe)},null,8,["icon"])]),f("div",wt,[l.user.profilePicture?(i(),u("img",{key:0,src:l.user.profilePicture,alt:l.user.name,class:"org-user-popup-avatar"},null,8,Ot)):(i(),u("div",Pt,P(l.user.name.charAt(0).toUpperCase()),1)),f("h3",bt,P(l.user.name),1)]),f("div",Tt,[l.user.email?(i(),u("div",Ut,[c[1]||(c[1]=f("strong",null,"Email:",-1)),f("a",{href:"mailto:".concat(l.user.email),class:"org-user-popup-link"},P(l.user.email),9,$t)])):b("",!0),l.user.department?(i(),u("div",xt,[c[2]||(c[2]=f("strong",null,"Department:",-1)),G(" "+P(l.user.department),1)])):b("",!0),l.user.location?(i(),u("div",Nt,[c[3]||(c[3]=f("strong",null,"Location:",-1)),G(" "+P(l.user.location),1)])):b("",!0),l.user.role?(i(),u("div",Rt,[c[4]||(c[4]=f("strong",null,"Role:",-1)),G(" "+P(l.user.role),1)])):b("",!0),l.user.team?(i(),u("div",Mt,[c[5]||(c[5]=f("strong",null,"Team:",-1)),G(" "+P(l.user.team),1)])):b("",!0),l.user.title?(i(),u("div",Lt,[c[6]||(c[6]=f("strong",null,"Title:",-1)),G(" "+P(l.user.title),1)])):b("",!0)]),f("div",{class:"org-user-popup-actions"},[f("button",{class:"org-user-popup-button",onClick:v}," View Trova Profile in Slack "),f("button",{class:"org-user-popup-button",onClick:T}," Message in Slack ")])],4)])):b("",!0)}}),qt=ce(At,[["__scopeId","data-v-2cb8ba1d"]]),Dt={class:"org-chart-search-container"},Ft={class:"org-chart-search-wrapper"},Yt={key:0,class:"search-results-dropdown"},Xt=["onClick"],_t=["src","alt"],Vt={key:1,class:"search-result-avatar-placeholder"},Bt={class:"search-result-info"},Et={class:"search-result-name"},Ht={class:"search-result-meta"},Wt={key:0},zt={key:1},Qt={key:0,class:"org-chart-loading"},Gt={key:1,class:"org-chart-error"},Jt={key:2,class:"org-chart-wrapper"},jt={key:3,class:"org-chart-empty"},Zt=re({__name:"OrgChartPage",setup(l){const A=Ye(),q=Ee(),d=De(),a=Fe(),g=r(null),k=r(""),v=r(null),T=r(""),D=r(""),I=r(3),c=r(""),y=r(!0),X=r(null),V=r(null),B=r([]),ee=r([]),z=r({showTitle:!0,showLocation:!0,showRole:!0,showDepartment:!0,showTeam:!0}),O=r(1),_=r(0),F=r(0),R=r(""),U=r([]),Y=r(null),J=r(!1),te=r(null),le=r(void 0),j=r(null),E=r(null);function ie(){var t,n,m,p,w,C;const e=A.query;if(g.value=e.communityId?Number(e.communityId):a.currentCommunityId||null,k.value=e.slackUserId||((t=d.user)==null?void 0:t.slackId)||((n=d.user)==null?void 0:n.slackUserId)||"",c.value=e.s||"",!g.value||!k.value||!c.value){const h=W.getCurrentValidation();h&&(g.value||(g.value=h.communityId,console.log("[OrgChartPage] Using communityId from validated session:",h.communityId)),k.value||(k.value=h.slackUserId,console.log("[OrgChartPage] Using slackUserId from validated session:",h.slackUserId)),c.value||(c.value=h.secretId,console.log("[OrgChartPage] Using secretId from validated session")))}v.value=e.otherSlackUserId||null,T.value=e.communityName||a.currentCommunityName||"",D.value=e.slackTeamId||"",I.value=e.scale?Number(e.scale):3;const o=d.isAuthenticated&&((m=d.user)==null?void 0:m.id);return o&&!k.value&&((p=d.user)!=null&&p.id)&&(k.value=String(d.user.id),console.log("[OrgChartPage] Authenticated user without Slack ID, using user ID as fallback:",k.value)),console.log("[OrgChartPage] Extracted query params:",{communityId:g.value,slackUserId:k.value,otherSlackUserId:v.value,secretId:c.value,hasQueryParams:Object.keys(e).length>0,queryParams:e,isFullyAuthenticated:o}),console.log("[OrgChartPage] Raw route.query:",JSON.stringify(A.query,null,2)),g.value?!o&&!k.value?(X.value="Missing required parameters: slackUserId",console.error("[OrgChartPage] Missing required parameters (not authenticated):",{communityId:g.value,slackUserId:k.value,secretId:c.value,queryParams:e,userSlackId:(C=d.user)==null?void 0:C.slackId,currentCommunityId:a.currentCommunityId,hasValidatedSession:!!W.getCurrentValidation()}),y.value=!1,!1):!0:(X.value="Missing required parameters: communityId",console.error("[OrgChartPage] Missing required parameters:",{communityId:g.value,slackUserId:k.value,secretId:c.value,queryParams:e,userSlackId:(w=d.user)==null?void 0:w.slackId,currentCommunityId:a.currentCommunityId,hasValidatedSession:!!W.getCurrentValidation(),isFullyAuthenticated:o}),y.value=!1,!1)}async function s(){await(await Be.create({header:"Session Expired",message:"For security purposes, your session has expired after 60 seconds. Would you like to sign in to continue, or go back to Slack to create a new session?",buttons:[{text:"Go Back to Slack",role:"cancel",handler:()=>{window.history.back()}},{text:"Sign In",handler:()=>{q.push("/login")}}]})).present()}async function S(e=!0){var t,n,m,p;if(!ie())return;y.value=!0,X.value=null;const o=d.isAuthenticated&&((t=d.user)==null?void 0:t.id);if(!o&&W.isSlackLinkUser()&&W.isSessionExpired()){y.value=!1,await s();return}try{console.log("[OrgChartPage] Creating Firebase document for keyDocRefId...");const w=await at.createSecretCode(g.value,k.value);console.log("[OrgChartPage] Created keyDocRefId:",w);const C=c.value||"";let h="";o?(console.log("[OrgChartPage] User is fully authenticated, not sending secretId"),h=""):C?W.isSecretIdValidated(C)?(console.log("[OrgChartPage] SecretId already validated for this session, not sending in request"),h=""):(console.log("[OrgChartPage] Using secretId from Slack URL (s parameter):",C),h=C):W.hasValidatedSession()?(console.log("[OrgChartPage] No secretId in URL but session is validated, not sending secretId"),h=""):(console.log("[OrgChartPage] No secretId in URL (direct access, not from Slack)"),h="");const N={communityId:g.value,slackUserId:k.value,otherSlackUserId:v.value,keyDocRefId:w,searchStrings:[],isInitialPageLoad:e,s:h};console.log("[OrgChartPage] Making API call with:",N),console.log("[OrgChartPage] Full API request body:",JSON.stringify(N,null,2));const M=await Ve.getOrgDataForCommunity(g.value,k.value,v.value,w,[],e,h);console.log("[OrgChartPage] API response received:",M),await Ue(M),x(M)}catch(w){console.error("[OrgChartPage] Failed to load org chart:",w);const C=w.message||((m=(n=w.response)==null?void 0:n.data)==null?void 0:m.message)||"";((w.status||((p=w.response)==null?void 0:p.status))===401||C.toLowerCase().includes("expired")||C.toLowerCase().includes("invalid")||C.toLowerCase().includes("secret"))&&W.isSlackLinkUser()?(y.value=!1,await s()):(X.value=C||"Failed to load org chart. Authentication may have expired.",y.value=!1)}}function x(e){var o,t,n,m,p,w,C;console.log("[OrgChartPage] Received org chart response:",e),console.log("[OrgChartPage] Root node:",e.dataSource),console.log("[OrgChartPage] Root node children:",((t=(o=e.dataSource)==null?void 0:o.children)==null?void 0:t.length)||0),B.value=e.users||[],ee.value=e.slackIdsInChain||[],z.value={showTitle:(n=e.showTitle)!=null?n:!0,showLocation:(m=e.showLocation)!=null?m:!0,showRole:(p=e.showRole)!=null?p:!0,showDepartment:(w=e.showDepartment)!=null?w:!0,showTeam:(C=e.showTeam)!=null?C:!0},v.value?(V.value=H(e.dataSource,v.value),console.log("[OrgChartPage] Restructured tree for user:",v.value)):V.value=e.dataSource,y.value=!1,console.log("[OrgChartPage] Org chart data set, loading complete"),setTimeout(()=>{v.value?(ne(v.value),j.value=v.value):ae()},200)}function H(e,o){function t(h){return{...h,children:h.children?h.children.map(t):void 0,originalChildren:h.originalChildren?h.originalChildren.map(t):void 0}}const n=t(e);function m(h,N){if(h.slackId===N)return h;if(h.children)for(const M of h.children){const Z=m(M,N);if(Z)return Z}return null}const p=m(n,o);if(!p)return console.warn("[OrgChartPage] Target user not found in tree, returning original structure"),n;function w(h,N,M=null){if(h.slackId===N)return M;if(h.children)for(const Z of h.children){const Ie=w(Z,N,h);if(Ie!==null)return Ie}return null}const C=w(n,o);return C?(C.expandedChildrenSlackIds&&(console.log("[OrgChartPage] Clearing expandedChildrenSlackIds on parent to show all siblings"),delete C.expandedChildrenSlackIds),C.originalChildren&&C.originalChildren.length>0&&(C.children=C.originalChildren.map(t),console.log("[OrgChartPage] Restored",C.children.length,"siblings (teammates) for",C.name)),p.expandedChildrenSlackIds&&delete p.expandedChildrenSlackIds,p.originalChildren&&p.originalChildren.length>0&&(p.children=p.originalChildren.map(t),console.log("[OrgChartPage] Restored",p.children.length,"direct reports for",p.name)),n):(console.log("[OrgChartPage] Target user is root, showing all direct reports"),p.expandedChildrenSlackIds&&delete p.expandedChildrenSlackIds,p.originalChildren&&p.originalChildren.length>0&&(p.children=p.originalChildren.map(t)),n)}function ae(){E.value&&E.value.centerOnRoot()}function ne(e){setTimeout(()=>{const o=document.querySelector('[data-slack-id="'.concat(e,'"]'));o&&E.value?(E.value.centerOnNode(o),console.log("[OrgChartPage] Centered on user:",e)):(console.warn("[OrgChartPage] User node not found, centering on root"),ae())},300)}function ue(){Y.value&&clearTimeout(Y.value),Y.value=window.setTimeout(()=>{R.value.length>=3?he():U.value=[]},200)}function de(){R.value="",U.value=[]}async function he(){const e=R.value.trim();if(e.length<3){U.value=[];return}const o=e.split(" ").filter(n=>n.length>0);let t=[];for(const n of o){const m=await ge(n.toLowerCase());t.length===0?t=m:t=ve(t,m)}U.value=t.sort((n,m)=>m.matchedOn.length-n.matchedOn.length)}async function ge(e){var t,n,m,p,w,C,h;const o=[];for(const N of B.value){const M=[];((t=N.name)!=null&&t.toLowerCase().includes(e)||(n=N.fname)!=null&&n.toLowerCase().includes(e)||(m=N.lname)!=null&&m.toLowerCase().includes(e))&&M.push("name"),(p=N.department)!=null&&p.toLowerCase().includes(e)&&M.push("department"),(w=N.team)!=null&&w.toLowerCase().includes(e)&&M.push("team"),(C=N.role)!=null&&C.toLowerCase().includes(e)&&M.push("role"),((h=N.email)==null?void 0:h.toLowerCase())===e&&M.push("email"),M.length>0&&o.push({user:N,matchedOn:M})}return o}function ve(e,o){const t=new Map;for(const m of e)t.set(m.user.id,{...m});const n=[];for(const m of o){const p=t.get(m.user.id);if(p){const w=[...new Set([...p.matchedOn,...m.matchedOn])];n.push({user:m.user,matchedOn:w})}}return n}function fe(e){q.replace({query:{...A.query,otherSlackUserId:e.slackId}}),j.value=e.slackId,v.value=e.slackId,R.value="",U.value=[],ne(e.slackId)}function me(e){const o=B.value.find(t=>t.slackId===e.slackId||t.id===e.id);o&&(te.value=o,le.value={x:window.innerWidth/2,y:window.innerHeight/2},J.value=!0)}function Pe(e){}function be(){J.value=!1,te.value=null}function Te(){S(!0)}async function Ue(e){const o=new Map;for(const n of e.users||[])n.profilePicture&&n.slackId&&o.set(n.slackId,n.profilePicture);function t(n){if(n.slackId&&o.has(n.slackId)&&!n.profilePicture&&(n.profilePicture=o.get(n.slackId)),n.children)for(const m of n.children)t(m)}t(e.dataSource)}return we(async()=>{var e,o,t;if(!d.isAuthenticated){console.log("[OrgChartPage] Waiting for authentication...");let n=0;for(;!d.isAuthenticated&&n<20;)await new Promise(m=>setTimeout(m,100)),n++}console.log("[OrgChartPage] Route query params:",A.query),console.log("[OrgChartPage] Auth state:",{isAuthenticated:d.isAuthenticated,userId:(e=d.user)==null?void 0:e.id,slackId:(o=d.user)==null?void 0:o.slackId,slackUserId:(t=d.user)==null?void 0:t.slackUserId,communityId:a.currentCommunityId}),S(!0)}),se(()=>A.query,()=>{A.path==="/tabs/org-chart"&&S(!1)},{deep:!0}),(e,o)=>(i(),Xe($(_e),null,{default:Q(()=>[L($(ze),null,{default:Q(()=>[L($(He),null,{default:Q(()=>[L($(We),null,{default:Q(()=>[G(P(T.value||"Org Chart"),1)]),_:1})]),_:1})]),_:1}),L($(et),{fullscreen:!0,class:"org-chart-page-content"},{default:Q(()=>[f("div",Dt,[f("div",Ft,[L($(oe),{icon:$(Ge),class:"search-icon"},null,8,["icon"]),Qe(f("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>R.value=t),onInput:ue,type:"text",class:"org-chart-search-input",placeholder:"Search by name, department, team or role"},null,544),[[Je,R.value]]),R.value?(i(),u("button",{key:0,onClick:de,class:"search-clear-button"},[L($(oe),{icon:$(Oe)},null,8,["icon"])])):b("",!0)]),U.value.length>0&&R.value.length>=3?(i(),u("div",Yt,[(i(!0),u(pe,null,ke(U.value,t=>(i(),u("div",{key:t.user.id,class:"search-result-item",onClick:n=>fe(t.user)},[t.user.profilePicture?(i(),u("img",{key:0,src:t.user.profilePicture,alt:t.user.name,class:"search-result-avatar"},null,8,_t)):(i(),u("div",Vt,P(t.user.name.charAt(0).toUpperCase()),1)),f("div",Bt,[f("div",Et,P(t.user.name),1),f("div",Ht,[t.user.department?(i(),u("span",Wt,P(t.user.department),1)):b("",!0),t.user.role?(i(),u("span",zt,P(t.user.role),1)):b("",!0)])])],8,Xt))),128))])):b("",!0)]),y.value?(i(),u("div",Qt,[L($(je)),o[4]||(o[4]=f("p",null,"Loading org chart...",-1))])):X.value?(i(),u("div",Gt,[L($(oe),{icon:$(Ze),class:"error-icon"},null,8,["icon"]),o[6]||(o[6]=f("h3",null,"Authentication Expired",-1)),f("p",null,P(X.value),1),L($(Ke),{onClick:Te},{default:Q(()=>[...o[5]||(o[5]=[G("Retry",-1)])]),_:1})])):b("",!0),V.value?(i(),u("div",Jt,[L(rt,{ref_key:"chartContainerRef",ref:E,scale:O.value,"translate-x":_.value,"translate-y":F.value,"onUpdate:scale":o[1]||(o[1]=t=>O.value=t),"onUpdate:translateX":o[2]||(o[2]=t=>_.value=t),"onUpdate:translateY":o[3]||(o[3]=t=>F.value=t)},{default:Q(()=>[L(St,{datasource:V.value,"display-flags":z.value,"group-scale":I.value,"is-highlighted":j.value===V.value.slackId,"highlighted-slack-id":j.value,onNodeClick:me,onSelectNode:Pe},null,8,["datasource","display-flags","group-scale","is-highlighted","highlighted-slack-id"])]),_:1},8,["scale","translate-x","translate-y"])])):!y.value&&!X.value?(i(),u("div",jt,[...o[7]||(o[7]=[f("p",null,"Org chart will appear here once data is loaded.",-1),f("p",{class:"org-chart-empty-note"},"Note: During testing, the API endpoint may not be available.",-1)])])):b("",!0),L(qt,{"is-open":J.value,user:te.value,position:le.value,onClose:be},null,8,["is-open","user","position"])]),_:1})]),_:1}))}}),ea=ce(Zt,[["__scopeId","data-v-b3a3fe87"]]);export{ea as default};
