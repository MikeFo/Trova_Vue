import{F as J,Y as a,ag as y,aa as T,ab as R,O as o,R as t,N as n,L as e,aN as j,a6 as k,a8 as $,W as G,aE as H,a0 as Q,v as K,r as S,a2 as x,ah as X,I as A,X as D,J as c,af as oe,aV as te,aW as se,aJ as ae,aK as ne,aS as re,aC as le,a5 as ie,aZ as ue,aU as ce,a1 as de,G as ve,M as ge,a3 as me,Z as z,aB as pe,b2 as fe,b3 as W,b4 as B,ae as V,Q as he,H as ye}from"./index-CkJ7yJ3n.js";import{u as _e,c as P,C as Y}from"./ChatThread-CMJ0NHdj.js";import{groupService as U}from"./group.service-CH2Rgjsj.js";import{eventService as be}from"./event.service-D7cjacjh.js";const ke={class:"member-list-container"},Ce=["onClick"],Ie={class:"member-avatar-wrapper"},$e=["src","alt"],we={key:1,class:"member-avatar-placeholder"},Ge={class:"member-info"},Pe={class:"member-name"},De={key:0,class:"member-location"},Le={key:1,class:"shared-interests"},Se={class:"interests-tags"},Ne={key:0,class:"empty-members"},Ee=J({__name:"MemberList",props:{members:{},currentUserId:{}},emits:["member-click"],setup(i){return(M,v)=>(t(),a("div",ke,[(t(!0),a(T,null,R(i.members,p=>(t(),a("div",{key:p.id,class:"member-item",onClick:w=>M.$emit("member-click",p)},[o("div",Ie,[p.profilePicture?(t(),a("img",{key:0,src:p.profilePicture,alt:p.fullName,class:"member-avatar"},null,8,$e)):(t(),a("div",we,[n(e(k),{icon:e(j)},null,8,["icon"])]))]),o("div",Ge,[o("h3",Pe,$(p.fullName||"Unknown"),1),p.currentLocation?(t(),a("p",De,[n(e(k),{icon:e(H)},null,8,["icon"]),G(" "+$(p.currentLocation),1)])):y("",!0),p.commonInterests&&p.commonInterests.length>0?(t(),a("div",Le,[v[0]||(v[0]=o("p",{class:"shared-label"},"You share:",-1)),o("div",Se,[(t(!0),a(T,null,R(p.commonInterests,w=>(t(),a("span",{key:w,class:"interest-tag"},$(w),1))),128))])])):y("",!0)])],8,Ce))),128)),i.members.length===0?(t(),a("div",Ne,[...v[1]||(v[1]=[o("p",null,"No members found",-1)])])):y("",!0)]))}}),Fe=Q(Ee,[["__scopeId","data-v-6a84823d"]]),Be={class:"group-details-sidebar"},Ve={class:"group-header-section"},Me={class:"group-logo-large"},Oe=["src","alt"],Ae={key:1,class:"group-logo-placeholder"},xe={class:"group-title-section"},Ue={class:"group-title-row"},Te={class:"group-name"},Re={class:"group-actions-row"},qe={key:0,class:"private-indicator"},ze={key:0,class:"leader-section"},Je={class:"leader-info"},Qe=["src","alt"],We={key:1,class:"leader-avatar-placeholder"},Ye={class:"leader-details"},Ze={class:"leader-name"},je={class:"member-count-section"},He={class:"member-count-header"},Ke={key:0,class:"member-avatars-preview"},Xe=["src","alt"],eo={key:0,class:"extra-members-preview"},oo={key:1,class:"about-section"},to={class:"about-text"},so={key:2,class:"tags-section"},ao={class:"tags-list"},no={class:"actions-section"},ro={class:"member-search-section"},lo={class:"search-actions"},io={class:"members-list-section"},uo=J({__name:"GroupDetailsSidebar",props:{group:{},members:{default:()=>[]}},emits:["share","leave"],setup(i,{emit:M}){const v=i,p=K(),w=S(""),f=x(()=>{var _;return(_=p.user)==null?void 0:_.id}),N=x(()=>v.group.userFollows===!0),g=x(()=>v.group.isAdmin===!0||v.group.leaderId===f.value),O=x(()=>{if(!w.value.trim())return v.members||v.group.users||[];const _=w.value.toLowerCase();return(v.members||v.group.users||[]).filter(h=>{var l,r,u;const F=((l=h.fullName)==null?void 0:l.toLowerCase())||"",b=((r=h.currentLocation)==null?void 0:r.toLowerCase())||"",s=((u=h.interests)==null?void 0:u.map(m=>{var L;return((L=m.name)==null?void 0:L.toLowerCase())||""}).join(" "))||"";return F.includes(_)||b.includes(_)||s.includes(_)})});function E(){return(v.group.users||[]).slice(0,5)}function C(){const _=v.group.users||[];return Math.max(0,_.length-5)}function I(){v.group.isFavorite=!v.group.isFavorite}function q(){console.log("Edit group:",v.group.id)}return(_,d)=>(t(),a("div",Be,[o("div",Ve,[o("div",Me,[i.group.logo||i.group.logoSmall?(t(),a("img",{key:0,src:i.group.logo||i.group.logoSmall,alt:i.group.name,class:"group-logo-image"},null,8,Oe)):(t(),a("div",Ae,[n(e(k),{icon:e(X)},null,8,["icon"])]))]),o("div",xe,[o("div",Ue,[o("h1",Te,$(i.group.name),1),o("div",Re,[n(e(D),{fill:"clear",class:"favorite-button",onClick:I},{default:c(()=>[n(e(k),{icon:i.group.isFavorite?e(te):e(se),class:oe({"favorite-active":i.group.isFavorite})},null,8,["icon","class"])]),_:1}),g.value?(t(),A(e(D),{key:0,fill:"clear",class:"edit-button",onClick:q},{default:c(()=>[n(e(k),{icon:e(ae)},null,8,["icon"])]),_:1})):y("",!0)])]),i.group.isPrivate?(t(),a("div",qe,[n(e(k),{icon:e(ne)},null,8,["icon"]),d[3]||(d[3]=o("span",null,"Private Group",-1))])):y("",!0)])]),i.group.leader?(t(),a("div",ze,[o("div",Je,[i.group.leader.profilePicture?(t(),a("img",{key:0,src:i.group.leader.profilePicture,alt:i.group.leader.fullName,class:"leader-avatar"},null,8,Qe)):(t(),a("div",We,[n(e(k),{icon:e(j)},null,8,["icon"])])),o("div",Ye,[o("h3",Ze,$(i.group.leader.fullName),1),d[4]||(d[4]=o("p",{class:"leader-label"},"Group Leader",-1))])])])):y("",!0),o("div",je,[o("div",He,[o("h3",null,$((i.group.memberCount||0)+1)+" Members",1)]),i.group.users&&i.group.users.length>0?(t(),a("div",Ke,[(t(!0),a(T,null,R(E(),(h,F)=>(t(),a("img",{key:h.id,src:h.profilePicture||"/assets/images/default-pro-pic.svg",alt:h.fullName,class:"member-avatar-preview",style:ce({zIndex:E().length-F})},null,12,Xe))),128)),C()>0?(t(),a("span",eo," +"+$(C()),1)):y("",!0)])):y("",!0)]),i.group.bio?(t(),a("div",oo,[d[5]||(d[5]=o("h3",{class:"section-title"},"About",-1)),o("p",to,$(i.group.bio),1)])):y("",!0),i.group.tags&&i.group.tags.length>0?(t(),a("div",so,[d[6]||(d[6]=o("h3",{class:"section-title"},"Tags",-1)),o("div",ao,[(t(!0),a(T,null,R(i.group.tags,h=>(t(),a("span",{key:h,class:"tag-pill"},$(h),1))),128))])])):y("",!0),o("div",no,[N.value?(t(),A(e(D),{key:0,fill:"clear",class:"leave-button",onClick:d[0]||(d[0]=h=>_.$emit("leave"))},{default:c(()=>[n(e(k),{icon:e(re),slot:"start"},null,8,["icon"]),d[7]||(d[7]=G(" Leave Group ",-1))]),_:1})):y("",!0),n(e(D),{fill:"solid",class:"share-button",onClick:d[1]||(d[1]=h=>_.$emit("share"))},{default:c(()=>[n(e(k),{icon:e(le),slot:"start"},null,8,["icon"]),d[8]||(d[8]=G(" Share ",-1))]),_:1})]),o("div",ro,[n(e(ie),{modelValue:w.value,"onUpdate:modelValue":d[2]||(d[2]=h=>w.value=h),placeholder:"Location, interest, etc",class:"member-search",debounce:300},null,8,["modelValue"]),o("div",lo,[n(e(D),{fill:"clear",class:"filter-button"},{default:c(()=>[n(e(k),{icon:e(ue)},null,8,["icon"])]),_:1}),n(e(D),{fill:"clear",class:"location-button"},{default:c(()=>[n(e(k),{icon:e(H)},null,8,["icon"])]),_:1})])]),o("div",io,[n(Fe,{members:O.value,"current-user-id":f.value},null,8,["members","current-user-id"])])]))}}),Z=Q(uo,[["__scopeId","data-v-fccdc93c"]]),co={key:0,class:"loading-container"},vo={key:1,class:"group-detail-container"},go={class:"mobile-layout"},mo={class:"group-header-mobile"},po={class:"group-name-mobile"},fo={class:"group-image-section"},ho=["src","alt"],yo={key:1,class:"group-header-placeholder"},_o={class:"tab-content"},bo={key:0,class:"feed-tab"},ko={key:1,class:"no-conversation"},Co={key:2,class:"no-conversation"},Io={key:1,class:"events-tab"},$o={class:"group-events"},wo={key:0,class:"no-events"},Go={key:1,class:"events-list"},Po={key:2,class:"details-tab"},Do={class:"desktop-layout"},Lo={class:"desktop-content"},So={class:"sidebar"},No={class:"main-content"},Eo={class:"tab-content-desktop"},Fo={key:0,class:"feed-tab"},Bo={key:1,class:"no-conversation"},Vo={key:2,class:"no-conversation"},Mo={key:1,class:"events-tab"},Oo={class:"group-events"},Ao={key:0,class:"no-events"},xo={key:1,class:"events-list"},Uo={key:2,class:"details-tab"},To={class:"details-content"},Ro={key:2,class:"error-state"},qo=J({__name:"GroupDetailPage",setup(i){const M=ye(),v=me(),p=K(),w=de(),f=_e(),N=S(!0),g=S(null),O=S([]),E=S([]),C=S("feed"),I=S(null);async function q(){var s;const b=v.params.id;if(!b){N.value=!1;return}N.value=!0;try{const l=await U.getGroup(b);if(l){g.value=l,l.users&&(O.value=l.users);try{if(console.log("[GroupDetailPage] Loading conversation for group:",l.id),l.convoId){console.log("[GroupDetailPage] Group has convoId, loading directly:",l.convoId);const r=await P.getConversationById(l.convoId);if(r){const u=await P.getMessagesForConversation(r.conversationId);r.messages=u,f.conversations.set(r.conversationId,r),I.value=r;try{f.setActiveConversation(r.conversationId)}catch(m){console.warn("[GroupDetailPage] Error setting active conversation:",m),f.activeConversation=r}console.log("[GroupDetailPage] Conversation loaded with",u.length,"messages")}else{console.log("[GroupDetailPage] Conversation not found by ID, trying parentId query...");const u=await P.getFirebaseConversationsByGroupId(l.id,"groups");if(u.length>0){const m=u[0];console.log("[GroupDetailPage] Found group conversation by parentId:",m.conversationId);const L=await P.getMessagesForConversation(m.conversationId);m.messages=L,f.conversations.set(m.conversationId,m),I.value=m;try{f.setActiveConversation(m.conversationId)}catch(ee){console.warn("[GroupDetailPage] Error setting active conversation:",ee),f.activeConversation=m}console.log("[GroupDetailPage] Conversation loaded with",L.length,"messages")}else console.log("[GroupDetailPage] No conversation found, trying to get or create..."),await _(l)}}else{console.log("[GroupDetailPage] No convoId, trying parentId query...");const r=await P.getFirebaseConversationsByGroupId(l.id,"groups");if(r.length>0){const u=r[0];console.log("[GroupDetailPage] Found group conversation by parentId:",u.conversationId);const m=await P.getMessagesForConversation(u.conversationId);u.messages=m,f.conversations.set(u.conversationId,u),I.value=u;try{f.setActiveConversation(u.conversationId)}catch(L){console.warn("[GroupDetailPage] Error setting active conversation:",L),f.activeConversation=u}console.log("[GroupDetailPage] Conversation loaded with",m.length,"messages")}else console.log("[GroupDetailPage] No conversation found, trying to get or create..."),await _(l)}}catch(r){console.error("[GroupDetailPage] Error loading conversation:",r)}if((s=p.user)!=null&&s.id)try{const r=w.currentCommunityId||1,u=await be.getEvents(r,p.user.id);E.value=u.filter(m=>m.groupId===l.id)}catch(r){console.error("Error loading group events:",r)}}}catch(l){console.error("[GroupDetailPage] Error loading group:",l)}finally{N.value=!1}}async function _(b){try{console.log("[GroupDetailPage] No conversation found, trying to get or create...");const s=await U.getOrCreateConvo(b.id);if(console.log("[GroupDetailPage] getOrCreateConvo result:",s),s.conversationId){await new Promise(r=>setTimeout(r,500));let l=null;for(let r=0;r<3;r++){const u=await P.getFirebaseConversationsByGroupId(b.id,"groups");if(u.length>0){l=u[0];break}console.log("[GroupDetailPage] Retry ".concat(r+1,"/3 loading conversation...")),await new Promise(m=>setTimeout(m,1e3))}if(l){const r=await P.getMessagesForConversation(l.conversationId);l.messages=r,f.conversations.set(l.conversationId,l),I.value=l;try{f.setActiveConversation(l.conversationId)}catch(u){console.warn("[GroupDetailPage] Error setting active conversation:",u),f.activeConversation=l}console.log("[GroupDetailPage] Created and loaded new conversation with",r.length,"messages")}else{console.log("[GroupDetailPage] Trying to load by conversationId directly...");const r=await P.getConversationById(s.conversationId);if(r){f.conversations.set(r.conversationId,r),I.value=r;try{f.setActiveConversation(r.conversationId)}catch(u){console.warn("[GroupDetailPage] Error setting active conversation:",u),f.activeConversation=r}console.log("[GroupDetailPage] Loaded conversation directly by ID")}else console.warn("[GroupDetailPage] Conversation not found after all attempts")}}else console.warn("[GroupDetailPage] No conversationId in getOrCreateConvo result")}catch(s){console.error("[GroupDetailPage] Error creating/loading conversation:",s)}}function d(){M.push("/tabs/groups")}async function h(){if(g.value)try{const b=await U.shareGroup(g.value.id);console.log("Share URL:",b.shareUrl)}catch(b){console.error("Error sharing group:",b)}}async function F(){var b;if(!(!g.value||!((b=p.user)!=null&&b.id))&&confirm("Are you sure you want to leave this group?"))try{await U.leaveGroup(p.user.id,g.value.id),M.push("/tabs/groups")}catch(s){console.error("Error leaving group:",s)}}return ve(()=>{q()}),(b,s)=>(t(),A(e(ge),null,{default:c(()=>[n(e(he),{fullscreen:!0,class:"group-detail-content"},{default:c(()=>[N.value?(t(),a("div",co,[n(e(z)),s[2]||(s[2]=o("p",null,"Loading group...",-1))])):g.value?(t(),a("div",vo,[o("div",go,[o("div",mo,[n(e(D),{fill:"clear",onClick:d,class:"back-button"},{default:c(()=>[n(e(k),{icon:e(pe)},null,8,["icon"])]),_:1}),o("h1",po,$(g.value.name),1),n(e(D),{fill:"clear",class:"more-button"},{default:c(()=>[n(e(k),{icon:e(fe)},null,8,["icon"])]),_:1})]),o("div",fo,[g.value.logo||g.value.logoSmall?(t(),a("img",{key:0,src:g.value.logo||g.value.logoSmall,alt:g.value.name,class:"group-header-image"},null,8,ho)):(t(),a("div",yo,[n(e(k),{icon:e(X)},null,8,["icon"])]))]),n(e(W),{modelValue:C.value,"onUpdate:modelValue":s[0]||(s[0]=l=>C.value=l),class:"detail-tabs"},{default:c(()=>[n(e(B),{value:"feed"},{default:c(()=>[n(e(V),null,{default:c(()=>[...s[3]||(s[3]=[G("Feed",-1)])]),_:1})]),_:1}),n(e(B),{value:"events"},{default:c(()=>[n(e(V),null,{default:c(()=>[...s[4]||(s[4]=[G("Events",-1)])]),_:1})]),_:1}),n(e(B),{value:"details"},{default:c(()=>[n(e(V),null,{default:c(()=>[...s[5]||(s[5]=[G("Details",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",_o,[C.value==="feed"?(t(),a("div",bo,[I.value?(t(),A(Y,{key:0,conversation:I.value,onBack:d},null,8,["conversation"])):g.value.convoId?(t(),a("div",ko,[n(e(z)),s[6]||(s[6]=o("p",null,"Loading conversation...",-1))])):(t(),a("div",Co,[...s[7]||(s[7]=[o("p",null,"No conversation available",-1)])]))])):y("",!0),C.value==="events"?(t(),a("div",Io,[o("div",$o,[E.value.length===0?(t(),a("p",wo," No events scheduled for this group ")):(t(),a("div",Go))])])):y("",!0),C.value==="details"?(t(),a("div",Po,[n(Z,{group:g.value,members:O.value,onShare:h,onLeave:F},null,8,["group","members"])])):y("",!0)])]),o("div",Do,[o("div",Lo,[o("div",So,[n(Z,{group:g.value,members:O.value,onShare:h,onLeave:F},null,8,["group","members"])]),o("div",No,[n(e(W),{modelValue:C.value,"onUpdate:modelValue":s[1]||(s[1]=l=>C.value=l),class:"detail-tabs-desktop"},{default:c(()=>[n(e(B),{value:"feed"},{default:c(()=>[n(e(V),null,{default:c(()=>[...s[8]||(s[8]=[G("Feed",-1)])]),_:1})]),_:1}),n(e(B),{value:"events"},{default:c(()=>[n(e(V),null,{default:c(()=>[...s[9]||(s[9]=[G("Events",-1)])]),_:1})]),_:1}),n(e(B),{value:"details"},{default:c(()=>[n(e(V),null,{default:c(()=>[...s[10]||(s[10]=[G("Details",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",Eo,[C.value==="feed"?(t(),a("div",Fo,[I.value?(t(),A(Y,{key:0,conversation:I.value,onBack:d},null,8,["conversation"])):g.value.convoId?(t(),a("div",Bo,[n(e(z)),s[11]||(s[11]=o("p",null,"Loading conversation...",-1))])):(t(),a("div",Vo,[...s[12]||(s[12]=[o("p",null,"No conversation available",-1)])]))])):y("",!0),C.value==="events"?(t(),a("div",Mo,[o("div",Oo,[E.value.length===0?(t(),a("p",Ao," No events scheduled for this group ")):(t(),a("div",xo))])])):y("",!0),C.value==="details"?(t(),a("div",Uo,[o("div",To,[s[13]||(s[13]=o("h2",null,"Group Information",-1)),o("p",null,$(g.value.bio),1)])])):y("",!0)])])])])])):(t(),a("div",Ro,[s[15]||(s[15]=o("p",null,"Group not found",-1)),n(e(D),{onClick:d},{default:c(()=>[...s[14]||(s[14]=[G("Go Back",-1)])]),_:1})]))]),_:1})]),_:1}))}}),Yo=Q(qo,[["__scopeId","data-v-404eb475"]]);export{Yo as default};
