import{x as a}from"./index-CkJ7yJ3n.js";class w{async getGroups(o,r){var t,n,e,s,u,i,l,g,d,v,h,y;try{return await a.get("/groups?communityId=".concat(o,"&userId=").concat(r))||[]}catch(c){const f=((e=(n=(t=c.response)==null?void 0:t.data)==null?void 0:n.error)==null?void 0:e.message)||((u=(s=c.response)==null?void 0:s.data)==null?void 0:u.message)||c.message;if(console.error("[GroupService] Failed to fetch groups:",f),console.error("[GroupService] Error details:",(i=c.response)==null?void 0:i.data),c.status===500||((l=c.response)==null?void 0:l.status)===500){console.log("[GroupService] Main endpoint returned 500, trying alternative endpoint...");try{const p=await a.get("/communities/".concat(o,"/groups"));return console.log("[GroupService] Successfully fetched groups via alternative endpoint"),p||[]}catch(p){const G=((v=(d=(g=p.response)==null?void 0:g.data)==null?void 0:d.error)==null?void 0:v.message)||((y=(h=p.response)==null?void 0:h.data)==null?void 0:y.message)||p.message;return console.error("[GroupService] Alternative endpoint also failed:",G),[]}}return[]}}async getGroup(o){try{return await a.get("/groups/".concat(o))}catch(r){return console.error("Failed to fetch group:",r),null}}async getGroupsByUser(o){try{return await a.get("/groups/user/".concat(o))||[]}catch(r){return console.error("Failed to fetch user groups:",r),[]}}async joinGroup(o,r){var t,n;try{console.log("[GroupService] Joining group:",r,"for user:",o);try{const e=await a.post("/groups/".concat(r,"/assign"),{userId:o});return console.log("[GroupService] Successfully joined group (via /assign):",r),e}catch(e){if(e.status===404||((t=e.response)==null?void 0:t.status)===404){console.log("[GroupService] /assign endpoint not found, trying /join endpoint...");try{const s=await a.post("/groups/join",{userId:o,groupId:r});return console.log("[GroupService] Successfully joined group (via /join):",r),s}catch(s){if(s.status===404||((n=s.response)==null?void 0:n.status)===404){console.log("[GroupService] /join endpoint not found, trying /groups/:id/join...");const u=await a.post("/groups/".concat(r,"/join"),{userId:o});return console.log("[GroupService] Successfully joined group (via /groups/:id/join):",r),u}throw s}}throw e}}catch(e){throw console.error("[GroupService] Failed to join group:",e),e}}async leaveGroup(o,r){try{await a.post("/groups/leave",{userId:o,groupId:r})}catch(t){throw console.error("Failed to leave group:",t),t}}async createGroup(o){try{return await a.post("/groups/new",o)}catch(r){throw console.error("Failed to create group:",r),r}}async updateGroup(o,r){try{const t={...r,id:o};return await a.patch("/groups/edit",t)}catch(t){throw console.error("Failed to update group:",t),t}}async getOrCreateConvo(o){try{const r=await a.post("/groups/get-or-create-convo-id",{groupId:o});return{conversationId:r.conversationId||r.convoId||""}}catch(r){throw console.error("Failed to get/create group conversation:",r),r}}async shareGroup(o){try{return await a.post("/groups/".concat(o,"/share"))}catch(r){throw console.error("Failed to share group:",r),r}}async getStarredGroups(o,r){var t,n;try{let e="/groups/user/".concat(o,"/starred");return r!=null&&(e+="?communityId=".concat(r)),await a.get(e)||[]}catch(e){if(e.status===404||((t=e.response)==null?void 0:t.status)===404)try{let u=(await this.getGroupsByUser(o)).filter(i=>i.isFavorite===!0);return r!=null&&(u=u.filter(i=>i.communityId===r)),u}catch(s){return s.status===404||((n=s.response)==null?void 0:n.status)===404?[]:(console.error("Fallback method failed:",s),[])}return console.error("Failed to fetch starred groups:",e),[]}}}const F=new w;export{w as GroupService,F as groupService};
