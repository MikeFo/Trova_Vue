import{F as ie,v as re,a1 as ue,y as de,r as p,a2 as Y,G as ce,I as ve,J as l,L as a,M as me,a3 as fe,$ as y,H as pe,N as s,ak as ge,aq as W,X as F,a6 as z,ar as he,al as Se,W as d,a8 as w,am as we,O as i,ap as Te,Y as I,ag as O,ae as m,ac as E,U as G,at as De,as as ye,az as j,aA as J,au as Ie,av as Q,Q as _e,aw as be,ax as Ee,ay as ke,R as T,a0 as Ce}from"./index-CkJ7yJ3n.js";import{eventService as L}from"./event.service-D7cjacjh.js";const Pe={class:"create-event-container"},Ve={class:"form-section"},Fe={key:0,class:"error-message"},Oe={key:1,class:"error-message"},He={class:"form-section"},Ne={class:"photo-upload-container"},xe={key:0,class:"photo-preview"},Le=["src"],Re={class:"form-section"},Ue={class:"form-item-wrapper"},$e=["min"],qe={class:"form-item-wrapper"},Be=["min"],Me={key:0,class:"error-message"},Ae={class:"form-section"},Ye={key:0,class:"error-message"},We={class:"form-section"},ze={class:"form-actions"},Ge=ie({__name:"CreateEventPage",setup(je){const H=pe(),k=fe(),R=re(),X=ue(),{storage:U}=de(),g=p(!1),C=p(null),h=p(!1);function K(){if(k.query.date)try{const e=new Date(k.query.date);if(!isNaN(e.getTime()))return e.setHours(e.getHours()+1,0,0,0),e}catch(e){console.warn("Invalid date in query params:",e)}const o=new Date;return o.setHours(o.getHours()+1,0,0,0),o}const N=K(),P=new Date(N);P.setHours(P.getHours()+1);const t=p({name:"",description:"",startTime:N.toISOString(),endTime:P.toISOString(),location:"",photo:null,photoFile:null,isPrivate:!1}),V=p(null),u=p({name:"",description:"",startTime:"",location:""});function D(o){if(!o)return"";const e=new Date(o),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),v=String(e.getHours()).padStart(2,"0"),_=String(e.getMinutes()).padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(c,"T").concat(v,":").concat(_)}function $(o){return o?new Date(o).toISOString():""}const S=p(D(N.toISOString())),f=p(D(P.toISOString())),q=Y(()=>D(new Date().toISOString()));function Z(){if(t.value.startTime=$(S.value),!f.value||f.value<S.value){const o=new Date(S.value),e=new Date(o);e.setHours(e.getHours()+1),f.value=D(e.toISOString()),t.value.endTime=e.toISOString()}}function ee(){t.value.endTime=f.value?$(f.value):""}const B=Y(()=>t.value.name.trim().length>0&&t.value.startTime.length>0);function te(){H.back()}function ae(){var o;(o=V.value)==null||o.click()}function oe(o){var r;const e=o==null?void 0:o.target,n=(r=e==null?void 0:e.files)==null?void 0:r[0];if(n){t.value.photoFile=n;const c=new FileReader;c.onload=v=>{var _;t.value.photo=(_=v.target)==null?void 0:_.result},c.readAsDataURL(n)}}function se(){t.value.photo=null,t.value.photoFile=null,V.value&&(V.value.value="")}function ne(){u.value={name:"",description:"",startTime:"",location:""};let o=!0;if(t.value.name.trim()?t.value.name.length>100&&(u.value.name="Event name must be 100 characters or less",o=!1):(u.value.name="Event name is required",o=!1),t.value.description&&t.value.description.length>1e3&&(u.value.description="Description must be 1000 characters or less",o=!1),t.value.startTime?new Date(t.value.startTime)<new Date&&(u.value.startTime="Start time must be in the future",o=!1):(u.value.startTime="Start date and time are required",o=!1),t.value.endTime){const e=new Date(t.value.startTime);new Date(t.value.endTime)<=e&&(u.value.startTime="End time must be after start time",o=!1)}return t.value.location&&t.value.location.length>200&&(u.value.location="Location must be 200 characters or less",o=!1),o}async function x(){var o,e;if(ne()){if(!((o=R.user)!=null&&o.id)){await(await y.create({message:"You must be logged in to create an event",duration:2e3,color:"danger"})).present();return}h.value=!0;try{const n=X.currentCommunityId;if(!n){await(await y.create({message:"You must be part of a community to create an event. Please select a community first.",duration:4e3,color:"warning"})).present(),h.value=!1;return}let r;if(t.value.photoFile&&U)try{const b=R.user.id,M="event_".concat(b,"_").concat(Date.now()),A=be(U,"images/".concat(M));await Ee(A,t.value.photoFile),r=await ke(A)}catch(b){console.error("Error uploading photo:",b),await(await y.create({message:b.message||"Failed to upload photo. Creating event without photo.",duration:3e3,color:"warning"})).present()}else t.value.photo&&!t.value.photoFile&&(r=t.value.photo);const c={name:t.value.name.trim(),description:t.value.description.trim()||void 0,startTime:new Date(t.value.startTime).toISOString(),endTime:t.value.endTime?new Date(t.value.endTime).toISOString():void 0,location:t.value.location.trim()||void 0,photo:r,communityId:n,isPrivate:t.value.isPrivate};let v;g.value&&C.value?v=await L.updateEvent(C.value,c):v=await L.createEvent(c),await(await y.create({message:g.value?"Event updated successfully!":"Event created successfully!",duration:2e3,color:"success"})).present(),H.push("/tabs/events")}catch(n){console.error("Error saving event:",n);let r=g.value?"Failed to update event. Please try again.":"Failed to create event. Please try again.";if(n.message&&n.message!=="{}"&&n.message!=="Request failed")r=n.message;else if((e=n.response)!=null&&e.data){const v=n.response.data;v.message&&v.message!=="{}"?r=v.message:v.error&&(r=v.error)}await(await y.create({message:r,duration:4e3,color:"danger"})).present()}finally{h.value=!1}}}async function le(){const o=k.params.id;if(o&&typeof o=="string"&&!isNaN(Number(o))&&k.path.includes("/edit")){g.value=!0,C.value=Number(o);try{const e=await L.getEvent(C.value);if(e){const n=new Date(e.startTime);let r=e.endTime?new Date(e.endTime).toISOString():"";if(!r){const c=new Date(n);c.setHours(c.getHours()+1),r=c.toISOString()}t.value={name:e.name,description:e.description||"",startTime:n.toISOString(),endTime:r,location:e.location||"",photo:e.photo||null,photoFile:null,isPrivate:e.isPrivate},S.value=D(t.value.startTime),f.value=D(t.value.endTime)}}catch(e){console.error("Error loading event:",e),await(await y.create({message:"Failed to load event",duration:2e3,color:"danger"})).present(),H.back()}}}return ce(()=>{le()}),(o,e)=>(T(),ve(a(me),null,{default:l(()=>[s(a(we),null,{default:l(()=>[s(a(ge),null,{default:l(()=>[s(a(W),{slot:"start"},{default:l(()=>[s(a(F),{onClick:te},{default:l(()=>[s(a(z),{icon:a(he)},null,8,["icon"])]),_:1})]),_:1}),s(a(Se),null,{default:l(()=>[d(w(g.value?"Edit Event":"Create Event"),1)]),_:1}),s(a(W),{slot:"end"},{default:l(()=>[s(a(F),{onClick:x,disabled:!B.value||h.value},{default:l(()=>[d(w(h.value?"Saving...":g.value?"Save":"Create"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),s(a(_e),{fullscreen:!0,class:"create-event-content"},{default:l(()=>[i("div",Pe,[i("form",{onSubmit:Te(x,["prevent"])},[i("div",Ve,[s(a(m),{class:"section-label"},{default:l(()=>[...e[6]||(e[6]=[d("Event Information",-1)])]),_:1}),s(a(E),{class:"form-item",lines:"full"},{default:l(()=>[s(a(m),{position:"stacked"},{default:l(()=>[...e[7]||(e[7]=[d("Event Name",-1)])]),_:1}),s(a(G),{modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.name=n),placeholder:"What's your event called?",maxlength:100,required:""},null,8,["modelValue"])]),_:1}),u.value.name?(T(),I("div",Fe,w(u.value.name),1)):O("",!0),s(a(E),{class:"form-item",lines:"full"},{default:l(()=>[s(a(m),{position:"stacked"},{default:l(()=>[...e[8]||(e[8]=[d("Description",-1)])]),_:1}),s(a(De),{modelValue:t.value.description,"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.description=n),placeholder:"Tell people what your event is about",maxlength:1e3,rows:5},null,8,["modelValue"])]),_:1}),u.value.description?(T(),I("div",Oe,w(u.value.description),1)):O("",!0)]),i("div",He,[s(a(m),{class:"section-label"},{default:l(()=>[...e[9]||(e[9]=[d("Event Photo",-1)])]),_:1}),i("div",Ne,[t.value.photo?(T(),I("div",xe,[i("img",{src:t.value.photo,alt:"Event photo"},null,8,Le),s(a(F),{fill:"clear",size:"small",onClick:se,class:"remove-photo"},{default:l(()=>[...e[10]||(e[10]=[d(" Remove ",-1)])]),_:1})])):(T(),I("div",{key:1,class:"photo-placeholder",onClick:ae},[s(a(z),{icon:a(ye)},null,8,["icon"]),e[11]||(e[11]=i("p",null,"Tap to add photo",-1))])),i("input",{ref_key:"fileInput",ref:V,type:"file",accept:"image/*",onChange:oe,style:{display:"none"}},null,544)])]),i("div",Re,[s(a(m),{class:"section-label"},{default:l(()=>[...e[12]||(e[12]=[d("Date & Time",-1)])]),_:1}),i("div",Ue,[s(a(m),{class:"form-label"},{default:l(()=>[...e[13]||(e[13]=[d("Start Date & Time",-1)])]),_:1}),j(i("input",{type:"datetime-local","onUpdate:modelValue":e[2]||(e[2]=n=>S.value=n),min:q.value,class:"datetime-input",required:"",onChange:Z},null,40,$e),[[J,S.value]])]),i("div",qe,[s(a(m),{class:"form-label"},{default:l(()=>[...e[14]||(e[14]=[d("End Date & Time (Optional)",-1)])]),_:1}),j(i("input",{type:"datetime-local","onUpdate:modelValue":e[3]||(e[3]=n=>f.value=n),min:S.value||q.value,class:"datetime-input",onChange:ee},null,40,Be),[[J,f.value]])]),u.value.startTime?(T(),I("div",Me,w(u.value.startTime),1)):O("",!0)]),i("div",Ae,[s(a(m),{class:"section-label"},{default:l(()=>[...e[15]||(e[15]=[d("Location",-1)])]),_:1}),s(a(E),{class:"form-item",lines:"full"},{default:l(()=>[s(a(m),{position:"stacked"},{default:l(()=>[...e[16]||(e[16]=[d("Event Location",-1)])]),_:1}),s(a(G),{modelValue:t.value.location,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.location=n),placeholder:"Where is your event?",maxlength:200},null,8,["modelValue"])]),_:1}),u.value.location?(T(),I("div",Ye,w(u.value.location),1)):O("",!0)]),i("div",We,[s(a(m),{class:"section-label"},{default:l(()=>[...e[17]||(e[17]=[d("Privacy",-1)])]),_:1}),s(a(Ie),{modelValue:t.value.isPrivate,"onUpdate:modelValue":e[5]||(e[5]=n=>t.value.isPrivate=n)},{default:l(()=>[s(a(E),{lines:"none"},{default:l(()=>[s(a(Q),{slot:"start",value:!1}),s(a(m),null,{default:l(()=>[...e[18]||(e[18]=[i("h3",null,"Public",-1),i("p",null,"Anyone can see and join this event",-1)])]),_:1})]),_:1}),s(a(E),{lines:"none"},{default:l(()=>[s(a(Q),{slot:"start",value:!0}),s(a(m),null,{default:l(()=>[...e[19]||(e[19]=[i("h3",null,"Private",-1),i("p",null,"Only invited members can see this event",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",ze,[s(a(F),{expand:"block",onClick:x,disabled:!B.value||h.value,class:"submit-button"},{default:l(()=>[d(w(h.value?"Saving...":g.value?"Save Changes":"Create Event"),1)]),_:1},8,["disabled"])])],32)])]),_:1})]),_:1}))}}),Xe=Ce(Ge,[["__scopeId","data-v-4e3e9185"]]);export{Xe as default};
