import{x as R,F as Y,v as q,a1 as G,r as g,a2 as J,a4 as W,G as X,I as Z,J as N,L as i,M as j,N as u,O as n,Y as a,ag as h,af as k,Z as B,a6 as p,an as E,aa as $,ab as I,a8 as m,a5 as K,Q as ee,H as se,R as o,aN as F,X as A,ap as H,W as te,aE as oe,aP as ae,a0 as ne}from"./index-CkJ7yJ3n.js";import{profileService as le}from"./profile.service-CDoO2DLV.js";class ie{async getMatches(){try{return await R.get("/matches")||[]}catch(C){return console.error("[MatchService] Failed to fetch matches:",C),[]}}}const re=new ie,ce={class:"discover-container"},ue={key:0,class:"mobile-toggle-container"},de={class:"desktop-layout"},me={key:0,class:"loading-container"},ve={key:1,class:"empty-state"},he={class:"empty-icon"},fe={key:2,class:"matches-list"},ge=["onClick"],ye=["src","alt"],_e={key:1,class:"match-avatar-placeholder"},pe={class:"match-info"},be={class:"match-name"},ke={key:0,class:"match-bio"},Ce={key:1,class:"match-reasons"},we={class:"section-header"},Ne={class:"section-title"},$e={class:"search-container"},Ie={key:0,class:"loading-container"},Le={key:1,class:"empty-state"},Pe={class:"empty-icon"},Me={class:"empty-description"},Se={key:2,class:"members-list"},Ue=["onClick"],De=["src","alt"],Ve={key:1,class:"member-avatar-placeholder"},xe={class:"member-info"},ze={class:"member-name"},Be={key:0,class:"member-bio"},Ee={key:1,class:"member-interests"},Fe={key:0,class:"more-interests"},Ae={key:2,class:"member-location"},He=Y({__name:"DiscoverPage",setup(O){const C=se();q();const D=G(),f=g(!0),v=g(!0),L=g(!1),P=g(!1),y=g(""),M=g([]),S=g([]),V=J(()=>{if(!y.value.trim())return S.value;const t=y.value.toLowerCase(),s=[];for(const e of S.value){let l=0,r=!1;if("".concat(e.fname," ").concat(e.lname).toLowerCase().includes(t)?(l+=100,r=!0):(e.fname.toLowerCase().includes(t)||e.lname.toLowerCase().includes(t))&&(l+=80,r=!0),e.interests){const c=e.interests.filter(d=>d.toLowerCase().includes(t));c.length>0&&(l+=c.length*10,r=!0)}if(e.locations){const c=e.locations.filter(d=>{var _;return d.primaryName.toLowerCase().includes(t)||((_=d.secondaryName)==null?void 0:_.toLowerCase().includes(t))});c.length>0&&(l+=c.length*5,r=!0)}if(e.education){const c=e.education.filter(d=>d.toLowerCase().includes(t));c.length>0&&(l+=c.length*5,r=!0)}if(e.organizations){const c=e.organizations.filter(d=>d.toLowerCase().includes(t));c.length>0&&(l+=c.length*5,r=!0)}e.bio&&e.bio.toLowerCase().includes(t)&&(l+=3,r=!0),r&&s.push({profile:e,score:l})}return s.sort((e,l)=>{if(l.score!==e.score)return l.score-e.score;const r="".concat(e.profile.fname," ").concat(e.profile.lname).toLowerCase(),b="".concat(l.profile.fname," ").concat(l.profile.lname).toLowerCase();return r.localeCompare(b)}),s.map(e=>e.profile)});async function x(){if(f.value){L.value=!0;try{const t=await re.getMatches();M.value=t,console.log("[DiscoverPage] Loaded matches:",t.length)}catch(t){console.error("[DiscoverPage] Error loading matches:",t)}finally{L.value=!1}}}async function z(){const t=D.currentCommunityId;if(!t){console.warn("[DiscoverPage] No community selected");return}P.value=!0;try{const s=await le.getProfilesForUserAndCommunity(t);S.value=s,console.log("[DiscoverPage] Loaded profiles:",s.length)}catch(s){console.error("[DiscoverPage] Error loading profiles:",s)}finally{P.value=!1}}function T(t){y.value=t.target.value||""}function U(t){C.push("/tabs/profile/".concat(t))}async function Q(t){var s;console.log("[DiscoverPage] Say Hi to:",((s=t.matchedUser)==null?void 0:s.fullName)||t.matchedUserId)}return W(()=>D.currentCommunityId,t=>{t&&(z(),x())}),X(()=>{z(),x()}),(t,s)=>(o(),Z(i(j),null,{default:N(()=>[u(i(ee),{fullscreen:!0,class:"discover-content"},{default:N(()=>[n("div",ce,[f.value?(o(),a("div",ue,[n("div",{class:k(["toggle-background",{right:!v.value}])},null,2),n("div",{class:k(["toggle-button",{active:v.value}]),onClick:s[0]||(s[0]=e=>v.value=!0)}," Intros ",2),n("div",{class:k(["toggle-button",{active:!v.value}]),onClick:s[1]||(s[1]=e=>v.value=!1)}," All Members ",2)])):h("",!0),n("div",de,[f.value?(o(),a("div",{key:0,class:k(["intros-section",{"mobile-visible":v.value,"mobile-hidden":!v.value}])},[s[7]||(s[7]=n("h2",{class:"section-title"},"Intros",-1)),L.value?(o(),a("div",me,[u(i(B)),s[3]||(s[3]=n("p",null,"Loading matches...",-1))])):M.value.length===0?(o(),a("div",ve,[n("div",he,[u(i(p),{icon:i(E)},null,8,["icon"])]),s[4]||(s[4]=n("h3",{class:"empty-title"},"No matches yet",-1)),s[5]||(s[5]=n("p",{class:"empty-description"}," Complete your profile to get personalized recommendations! ",-1))])):(o(),a("div",fe,[(o(!0),a($,null,I(M.value,e=>{var l,r,b,c,d;return o(),a("div",{key:e.id,class:"match-card",onClick:_=>{var w;return U(((w=e.matchedUser)==null?void 0:w.id)||e.matchedUserId)}},[(l=e.matchedUser)!=null&&l.profilePicture?(o(),a("img",{key:0,src:e.matchedUser.profilePicture,alt:e.matchedUser.fullName||"".concat(e.matchedUser.fname," ").concat(e.matchedUser.lname),class:"match-avatar"},null,8,ye)):(o(),a("div",_e,[u(i(p),{icon:i(F)},null,8,["icon"])])),n("div",pe,[n("h4",be,m(((r=e.matchedUser)==null?void 0:r.fullName)||"".concat((b=e.matchedUser)==null?void 0:b.fname," ").concat((c=e.matchedUser)==null?void 0:c.lname)),1),(d=e.matchedUser)!=null&&d.bio?(o(),a("p",ke,m(e.matchedUser.bio),1)):h("",!0),e.reasons&&e.reasons.length>0?(o(),a("div",Ce,[(o(!0),a($,null,I(e.reasons.slice(0,3),(_,w)=>(o(),a("span",{key:w,class:"match-reason-tag"},m(_),1))),128))])):h("",!0)]),u(i(A),{fill:"outline",size:"small",class:"say-hi-button",onClick:H(_=>Q(e),["stop"])},{default:N(()=>[...s[6]||(s[6]=[te(" Say Hi ",-1)])]),_:1},8,["onClick"])],8,ge)}),128))]))],2)):h("",!0),n("div",{class:k(["all-members-section",{"full-width":!f.value,"mobile-visible":!v.value||!f.value,"mobile-hidden":v.value&&f.value}])},[n("div",we,[n("h2",Ne,m(f.value?"All Members":"Discover Your Community"),1)]),n("div",$e,[u(i(K),{modelValue:y.value,"onUpdate:modelValue":s[2]||(s[2]=e=>y.value=e),placeholder:"Search by name, interest, location...",class:"members-search",debounce:100,onIonInput:T},null,8,["modelValue"])]),P.value?(o(),a("div",Ie,[u(i(B)),s[8]||(s[8]=n("p",null,"Loading members...",-1))])):V.value.length===0?(o(),a("div",Le,[n("div",Pe,[u(i(p),{icon:i(E)},null,8,["icon"])]),s[9]||(s[9]=n("h3",{class:"empty-title"},"No members found",-1)),n("p",Me,m(y.value?"Try a different search term":"No members in this community yet"),1)])):(o(),a("div",Se,[(o(!0),a($,null,I(V.value,e=>(o(),a("div",{key:e.id,class:"member-card",onClick:l=>U(e.userId)},[e.profilePicture?(o(),a("img",{key:0,src:e.profilePicture,alt:e.fullName||"".concat(e.fname," ").concat(e.lname),class:"member-avatar"},null,8,De)):(o(),a("div",Ve,[u(i(p),{icon:i(F)},null,8,["icon"])])),n("div",xe,[n("h4",ze,m(e.fullName||"".concat(e.fname," ").concat(e.lname)),1),e.bio?(o(),a("p",Be,m(e.bio),1)):h("",!0),e.interests&&e.interests.length>0?(o(),a("div",Ee,[(o(!0),a($,null,I(e.interests.slice(0,3),(l,r)=>(o(),a("span",{key:r,class:"interest-tag"},m(l),1))),128)),e.interests.length>3?(o(),a("span",Fe," +"+m(e.interests.length-3),1)):h("",!0)])):h("",!0),e.locations&&e.locations.length>0?(o(),a("div",Ae,[u(i(p),{icon:i(oe)},null,8,["icon"]),n("span",null,m(e.locations[0].primaryName),1)])):h("",!0)]),u(i(A),{fill:"clear",size:"small",class:"view-profile-button",onClick:H(l=>U(e.userId),["stop"])},{default:N(()=>[u(i(p),{icon:i(ae)},null,8,["icon"])]),_:1},8,["onClick"])],8,Ue))),128))]))],2)])])]),_:1})]),_:1}))}}),Qe=ne(He,[["__scopeId","data-v-e8107c99"]]);export{Qe as default};
