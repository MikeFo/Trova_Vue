import{F as X,a2 as z,Y as i,aa as Y,ab as q,R as n,ag as p,O as l,N as c,L as a,ah as te,a6 as C,a8 as k,aT as oe,aU as ae,ap as W,af as ne,aV as ie,aW as le,J as b,W as Z,X as J,aX as re,a0 as K,v as ue,a1 as ce,r as P,a4 as de,G as ge,aY as fe,I as me,M as ve,$ as F,a5 as pe,ao as he,aZ as H,an as _e,Z as ye,Q as we,H as ke,a3 as Ge}from"./index-CkJ7yJ3n.js";import{groupService as Q}from"./group.service-CH2Rgjsj.js";const Ce={class:"group-list"},be=["onClick"],Me={key:0,class:"notification-badge"},$e={class:"group-image"},Ie=["src","alt"],Pe={key:1,class:"group-logo-placeholder"},Fe={class:"group-info"},Le={class:"group-header"},Se={class:"group-name"},je={key:0,class:"lock-icon"},Te={key:0,class:"group-message"},Je={key:0,class:"message-author"},Ne={class:"message-text"},Ae={class:"message-time"},Ve={key:1,class:"group-bio"},Be={class:"group-meta"},De={key:0,class:"member-avatars"},Ee=["src","alt"],Re={key:0,class:"extra-members"},xe={key:1,class:"member-count"},ze={class:"group-actions"},Oe=["onClick"],Ue={key:1,class:"join-button-wrapper"},Ye={key:2,class:"side-icons"},qe=X({__name:"GroupList",props:{groups:{},isJoined:{type:Boolean,default:!1},groupMessages:{default:()=>[]}},emits:["click","join","favorite"],setup(M,{emit:N}){const V=M,G=N;function A(t){t.isFavorite=!t.isFavorite,G("favorite",t)}function y(t){return!t.users||t.users.length===0?[]:t.users.slice(0,3)}function h(t){return!t.users||t.users.length<=3?0:t.users.length-3}const m=z(()=>V.groups);function d(t){return t.lastMessage||null}function $(t){return t.lastMessageAuthor||null}function B(t){return t.lastMessageTime?D(t.lastMessageTime):""}function D(t){const g=new Date(t),v=new Date().getTime()-g.getTime(),w=Math.floor(v/6e4),L=Math.floor(v/36e5),S=Math.floor(v/864e5),I=Math.floor(S/7);if(w<1)return"Just now";if(w<60)return"".concat(w,"m");if(L<24)return"".concat(L,"h");if(S<7)return"".concat(S,"d");if(I<52)return"".concat(I,"w");const R=Math.floor(I/52);return"".concat(R,"y")}function E(t,g){return t.length<=g?t:t.substring(0,g)+"..."}return(t,g)=>(n(),i("div",Ce,[(n(!0),i(Y,null,q(m.value,s=>(n(),i("div",{key:s.id,class:"group-item",onClick:v=>t.$emit("click",s)},[s.hasNotification?(n(),i("div",Me)):p("",!0),l("div",$e,[s.logoSmall||s.logo?(n(),i("img",{key:0,src:s.logoSmall||s.logo,alt:s.name,class:"group-logo"},null,8,Ie)):(n(),i("div",Pe,[c(a(C),{icon:a(te)},null,8,["icon"])]))]),l("div",Fe,[l("div",Le,[l("h3",Se,k(s.name),1),s.isPrivate?(n(),i("div",je,[c(a(C),{icon:a(oe)},null,8,["icon"])])):p("",!0)]),M.isJoined&&d(s)?(n(),i("div",Te,[$(s)?(n(),i("span",Je,[l("strong",null,k($(s)),1),g[0]||(g[0]=l("span",{class:"message-separator"}," â€¢ ",-1))])):p("",!0),l("span",Ne,k(d(s)),1),l("span",Ae,k(B(s)),1)])):(n(),i("div",Ve,k(E(s.bio||"No description",100)),1)),l("div",Be,[s.users&&s.users.length>0?(n(),i("div",De,[(n(!0),i(Y,null,q(y(s),(v,w)=>(n(),i("img",{key:v.id,src:v.profilePicture||"/assets/images/default-pro-pic.svg",alt:v.fullName,class:"member-avatar",style:ae({zIndex:y(s).length-w})},null,12,Ee))),128)),h(s)>0?(n(),i("span",Re," +"+k(h(s)),1)):p("",!0)])):(n(),i("span",xe,k((s.memberCount||0)+1)+" member"+k((s.memberCount||0)!==0?"s":""),1))])]),l("div",ze,[M.isJoined?(n(),i("div",{key:0,class:"favorite-icon",onClick:W(v=>A(s),["stop"])},[c(a(C),{icon:s.isFavorite?a(ie):a(le),class:ne({"favorite-active":s.isFavorite})},null,8,["icon","class"])],8,Oe)):p("",!0),!M.isJoined&&!s.isPrivate?(n(),i("div",Ue,[c(a(J),{fill:"outline",size:"small",class:"join-button",onClick:W(v=>t.$emit("join",s),["stop"])},{default:b(()=>[...g[1]||(g[1]=[Z(" Join ",-1)])]),_:1},8,["onClick"])])):p("",!0),M.isJoined?(n(),i("div",Ye,[c(a(C),{icon:a(re),class:"chevron-icon"},null,8,["icon"])])):p("",!0)])],8,be))),128))]))}}),x=K(qe,[["__scopeId","data-v-69cc8416"]]),We={class:"groups-container"},He={class:"search-container"},Qe={key:0,class:"section"},Xe={key:1,class:"section"},Ze={class:"section-header"},Ke={key:2,class:"section"},es={class:"section-header"},ss={class:"section-title"},ts={key:3,class:"empty-state"},os={class:"empty-icon"},as={key:4,class:"loading-container"},ns=X({__name:"GroupsPage",setup(M){const N=ke(),V=Ge(),G=ue(),A=ce(),y=P(!1),h=P(""),m=P([]),d=P([]),$=P([]),B=P([]),D=z(()=>{if(!h.value.trim())return m.value;const o=h.value.toLowerCase();return m.value.filter(e=>{var r;return e.name.toLowerCase().includes(o)||((r=e.bio)==null?void 0:r.toLowerCase().includes(o))})}),E=z(()=>{if(!h.value.trim())return d.value;const o=h.value.toLowerCase();return d.value.filter(e=>{var r;return e.name.toLowerCase().includes(o)||((r=e.bio)==null?void 0:r.toLowerCase().includes(o))})});function t(){return A.currentCommunityId}async function g(){var o,e,r,j;if(!((o=G.user)!=null&&o.id)){console.warn("[GroupsPage] No user ID found, cannot load groups");return}y.value=!0;try{const u=t();if(console.log("[GroupsPage] Loading groups for communityId:",u,"userId:",G.user.id),!u){console.warn("[GroupsPage] No community selected"),await(await F.create({message:"Please select a community to view groups.",duration:3e3,color:"warning"})).present(),m.value=[],d.value=[],y.value=!1;return}console.log("[GroupsPage] Calling groupService.getGroups...");const f=await Q.getGroups(u,G.user.id);if(console.log("[GroupsPage] Received groups:",(f==null?void 0:f.length)||0,f),!f||f.length===0){console.warn("[GroupsPage] No groups returned from API"),m.value=[],d.value=[],y.value=!1;return}const T=f.filter(_=>_.isActive!==!1);console.log("[GroupsPage] Active groups:",T.length);const O=G.user.id;T.forEach(_=>{var U;const ee=((U=_.members)==null?void 0:U.some(se=>se.id===O))||_.leaderId===O;_.userFollows=ee}),m.value=T.filter(_=>_.userFollows===!0),d.value=T.filter(_=>_.userFollows===!1),console.log("[GroupsPage] My groups:",m.value.length,"All groups:",d.value.length)}catch(u){console.error("[GroupsPage] Error loading groups:",u),console.error("[GroupsPage] Error details:",{message:u.message,response:(e=u.response)==null?void 0:e.data,status:(r=u.response)==null?void 0:r.status}),(j=u.message)!=null&&j.includes("Community not found")?await(await F.create({message:"Unable to load groups. Please ensure you are part of a community.",duration:3e3,color:"warning"})).present():await(await F.create({message:u.message||"Failed to load groups. Please try again.",duration:3e3,color:"danger"})).present(),m.value=[],d.value=[]}finally{y.value=!1}}function s(o){h.value=o.target.value||""}function v(o){N.push(o)}function w(o){N.push("/tabs/groups/".concat(o.id))}async function L(o){var e,r,j;if(!((e=G.user)!=null&&e.id)){await(await F.create({message:"You must be logged in to join a group",duration:2e3,color:"danger"})).present();return}try{await Q.joinGroup(G.user.id,o.id),await(await F.create({message:"Successfully joined ".concat(o.name,"!"),duration:2e3,color:"success"})).present(),d.value=d.value.filter(f=>f.id!==o.id),o.userFollows=!0,m.value.push(o),await g()}catch(u){console.error("[GroupsPage] Error joining group:",u);let f="Failed to join group. Please try again.";u.message&&u.message!=="Request failed"?f=u.message:(j=(r=u.response)==null?void 0:r.data)!=null&&j.message&&(f=u.response.data.message),await(await F.create({message:f,duration:3e3,color:"danger"})).present()}}function S(o){console.log("Toggle favorite for group:",o.id,o.isFavorite)}function I(o,e){console.log("Show filter menu for",e)}de(()=>A.currentCommunityId,o=>{o&&V.path==="/tabs/groups"?g():o||(m.value=[],d.value=[])}),ge(()=>{g()}),fe((o,e)=>{(e.path.includes("/groups/new")||e.path.includes("/groups/")&&!e.path.includes("/groups/new"))&&g()});function R(){g()}return(o,e)=>(n(),me(a(ve),{onIonViewDidEnter:R},{default:b(()=>[c(a(we),{fullscreen:!0,class:"groups-content"},{default:b(()=>[l("div",We,[l("div",He,[c(a(pe),{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=r=>h.value=r),placeholder:"Find Groups",class:"groups-search",debounce:300,onIonInput:s},null,8,["modelValue"]),c(a(J),{fill:"clear",class:"create-button-inline",onClick:e[1]||(e[1]=r=>v("/tabs/groups/new"))},{default:b(()=>[c(a(C),{icon:a(he)},null,8,["icon"])]),_:1})]),$.value.length>0?(n(),i("div",Qe,[e[5]||(e[5]=l("div",{class:"section-header"},[l("h2",{class:"section-title"},"Suggested Groups")],-1)),c(x,{groups:$.value,"is-joined":!1,onJoin:L,onClick:w},null,8,["groups"])])):p("",!0),m.value.length>0?(n(),i("div",Xe,[l("div",Ze,[e[6]||(e[6]=l("h2",{class:"section-title"},"My Groups",-1)),c(a(J),{fill:"clear",size:"small",class:"filter-button",onClick:e[2]||(e[2]=r=>I(r,"mine"))},{default:b(()=>[c(a(C),{icon:a(H)},null,8,["icon"])]),_:1})]),c(x,{groups:D.value,"is-joined":!0,"group-messages":B.value,onClick:w,onFavorite:S},null,8,["groups","group-messages"])])):p("",!0),d.value.length>0?(n(),i("div",Ke,[l("div",es,[l("h2",ss,k(m.value.length>0?"All Groups":"Groups"),1),c(a(J),{fill:"clear",size:"small",class:"filter-button",onClick:e[3]||(e[3]=r=>I(r,"all"))},{default:b(()=>[c(a(C),{icon:a(H)},null,8,["icon"])]),_:1})]),c(x,{groups:E.value,"is-joined":!1,onJoin:L,onClick:w},null,8,["groups"])])):p("",!0),!y.value&&m.value.length===0&&d.value.length===0&&$.value.length===0?(n(),i("div",ts,[l("div",os,[c(a(C),{icon:a(_e)},null,8,["icon"])]),e[8]||(e[8]=l("h3",{class:"empty-title"},"Let's get your first group created!",-1)),c(a(J),{fill:"outline",class:"empty-action-button",onClick:e[4]||(e[4]=r=>v("/tabs/groups/new"))},{default:b(()=>[...e[7]||(e[7]=[Z(" Add Groups ",-1)])]),_:1})])):p("",!0),y.value?(n(),i("div",as,[c(a(ye)),e[9]||(e[9]=l("p",null,"Loading groups...",-1))])):p("",!0)])]),_:1})]),_:1}))}}),rs=K(ns,[["__scopeId","data-v-f16b822b"]]);export{rs as default};
