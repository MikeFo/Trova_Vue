import{F as H,r as V,a2 as A,Y as d,O as i,N as v,L as a,X as w,J as y,a6 as S,b5 as J,a8 as p,aX as K,aa as U,ab as z,R as l,af as Z,ag as T,aU as ee,ap as L,ao as X,a0 as W,a5 as te,aD as ne,W as G,aK as se,aE as ae,an as oe,I as Y,aH as ie,aI as re,aC as le,v as ce,a1 as ue,a4 as de,G as ve,M as he,Z as me,Q as fe,H as _e}from"./index-CkJ7yJ3n.js";import{eventService as P}from"./event.service-D7cjacjh.js";const ge={class:"calendar-grid-container"},pe={class:"calendar-header"},ye={class:"month-year"},De={class:"day-headers"},Se={class:"calendar-grid"},ke=["onClick"],Ce={class:"day-number"},we={key:0,class:"day-events"},Te=["title"],Ee=["onClick"],$e=H({__name:"CalendarGrid",props:{selectedDate:{default:()=>new Date},events:{default:()=>[]}},emits:["day-selected","create-event","view-events"],setup(B,{emit:b}){const m=B,D=b,h=V(new Date(m.selectedDate)),g=V(m.selectedDate||null),k=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],I=A(()=>h.value.toLocaleDateString("en-US",{month:"long",year:"numeric"})),M=A(()=>{const n=h.value.getFullYear(),C=h.value.getMonth(),O=new Date(n,C,1).getDay(),q=new Date(n,C+1,0).getDate(),Q=new Date(n,C,0).getDate(),F=[],x=new Date;x.setHours(0,0,0,0);for(let f=O-1;f>=0;f--){const _=new Date(n,C-1,Q-f);isNaN(_.getTime())||F.push({day:Q-f,date:_,isCurrentMonth:!1,isToday:_.getTime()===x.getTime(),events:E(_)})}for(let f=1;f<=q;f++){const _=new Date(n,C,f);isNaN(_.getTime())||F.push({day:f,date:_,isCurrentMonth:!0,isToday:_.getTime()===x.getTime(),events:E(_)})}const j=42-F.length;for(let f=1;f<=j;f++){const _=new Date(n,C+1,f);isNaN(_.getTime())||F.push({day:f,date:_,isCurrentMonth:!1,isToday:_.getTime()===x.getTime(),events:E(_)})}return F});function E(n){if(!m.events||m.events.length===0)return[];if(!n||isNaN(n.getTime()))return[];const C=n.toISOString().split("T")[0];return m.events.filter(u=>{if(!u.startTime)return!1;const O=new Date(u.startTime);return isNaN(O.getTime())?!1:O.toISOString().split("T")[0]===C})}function R(n){return n.slice(0,2)}function N(n){return"var(--color-primary)"}function o(n){return!n||!g.value?!1:n.toDateString()===g.value.toDateString()}function s(n){n.date&&(g.value&&n.date.toDateString()===g.value.toDateString()?(g.value=null,D("day-selected",n.date)):(g.value=n.date,D("day-selected",n.date)))}function c(n){n&&D("create-event",n)}function t(n){!n.date||!n.events||D("view-events",n.date,n.events)}function e(){h.value=new Date(h.value.getFullYear(),h.value.getMonth()-1,1)}function r(){h.value=new Date(h.value.getFullYear(),h.value.getMonth()+1,1)}return(n,C)=>(l(),d("div",ge,[i("div",pe,[v(a(w),{fill:"clear",onClick:e,class:"nav-button"},{default:y(()=>[v(a(S),{icon:a(J)},null,8,["icon"])]),_:1}),i("h2",ye,p(I.value),1),v(a(w),{fill:"clear",onClick:r,class:"nav-button"},{default:y(()=>[v(a(S),{icon:a(K)},null,8,["icon"])]),_:1})]),i("div",De,[(l(),d(U,null,z(k,u=>i("div",{key:u,class:"day-header"},p(u),1)),64))]),i("div",Se,[(l(!0),d(U,null,z(M.value,(u,O)=>(l(),d("div",{key:O,class:Z(["calendar-day",{"other-month":!u.isCurrentMonth,selected:u.date&&o(u.date),"has-events":u.events&&u.events.length>0,today:u.isToday}]),onClick:$=>s(u)},[i("div",Ce,p(u.day),1),u.events&&u.events.length>0?(l(),d("div",we,[(l(!0),d(U,null,z(R(u.events),($,q)=>(l(),d("div",{key:$.id,class:"event-dot",style:ee({backgroundColor:N()}),title:$.name},null,12,Te))),128)),u.events.length>2?(l(),d("div",{key:0,class:"more-events",onClick:L($=>t(u),["stop"])}," See all "+p(u.events.length)+" events ",9,Ee)):T("",!0)])):T("",!0),v(a(w),{fill:"clear",class:"create-event-button",onClick:L($=>c(u.date),["stop"])},{default:y(()=>[v(a(S),{icon:a(X)},null,8,["icon"])]),_:1},8,["onClick"])],10,ke))),128))])]))}}),be=W($e,[["__scopeId","data-v-28412cbf"]]),Ie={class:"events-list-container"},Me={class:"events-header"},Ne={key:0,class:"events-groups"},Oe={class:"group-date"},Le={class:"events-in-group"},Ve=["onClick"],Re={key:0,class:"event-photo-thumbnail"},Fe=["src","alt"],Pe={class:"event-card-content-wrapper"},Ue={class:"event-time"},ze={class:"time-display"},Be={key:0,class:"time-end"},xe={class:"event-content"},Ae={class:"event-header"},Ge={class:"event-name"},Ye={key:0,class:"lock-icon"},He={key:1,class:"notification-badge"},We={key:0,class:"event-description"},qe={class:"event-meta"},Qe={key:0,class:"event-location"},Xe={class:"event-attendees"},je={class:"event-actions"},Je={class:"action-buttons"},Ke={key:1,class:"empty-state"},Ze={class:"empty-icon"},et=H({__name:"EventsList",props:{events:{default:()=>[]},selectedDate:{default:void 0}},emits:["event-click","rsvp","cancel-rsvp","create-event","search","share-event","save-event"],setup(B,{emit:b}){const m=B,D=b,h=V(""),g=A(()=>{let o=m.events;if(m.selectedDate){const s=m.selectedDate.toISOString().split("T")[0];o=o.filter(c=>new Date(c.startTime).toISOString().split("T")[0]===s)}if(h.value.trim()){const s=h.value.toLowerCase();o=o.filter(c=>{var t,e;return c.name.toLowerCase().includes(s)||((t=c.description)==null?void 0:t.toLowerCase().includes(s))||((e=c.location)==null?void 0:e.toLowerCase().includes(s))})}return o}),k=A(()=>{const o={};return g.value.forEach(s=>{const t=new Date(s.startTime).toISOString().split("T")[0];o[t]||(o[t]=[]),o[t].push(s)}),Object.keys(o).sort().map(s=>({date:s,events:o[s].sort((c,t)=>new Date(c.startTime).getTime()-new Date(t.startTime).getTime())}))});function I(o){const s=new Date(o),c=new Date;c.setHours(0,0,0,0);const t=new Date(c);return t.setDate(t.getDate()+1),s.toDateString()===c.toDateString()?"Today":s.toDateString()===t.toDateString()?"Tomorrow":s.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}function M(o){return new Date(o).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function E(o,s){return o.length<=s?o:o.substring(0,s)+"..."}function R(o){h.value=o.target.value||"",D("search",h.value)}function N(){D("create-event")}return(o,s)=>(l(),d("div",Ie,[i("div",Me,[v(a(te),{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=c=>h.value=c),placeholder:"Search events",class:"events-search",debounce:300,onIonInput:R},null,8,["modelValue"]),v(a(w),{fill:"solid",class:"create-event-button",onClick:N},{default:y(()=>[v(a(S),{icon:a(X)},null,8,["icon"])]),_:1})]),k.value.length>0?(l(),d("div",Ne,[(l(!0),d(U,null,z(k.value,c=>(l(),d("div",{key:c.date,class:"event-group"},[i("h3",Oe,p(I(c.date)),1),i("div",Le,[(l(!0),d(U,null,z(c.events,t=>(l(),d("div",{key:t.id,class:"event-card",onClick:e=>o.$emit("event-click",t)},[t.photo?(l(),d("div",Re,[i("img",{src:t.photo,alt:t.name},null,8,Fe)])):T("",!0),i("div",Pe,[i("div",Ue,[i("div",ze,p(M(t.startTime)),1),t.endTime?(l(),d("div",Be," - "+p(M(t.endTime)),1)):T("",!0)]),i("div",xe,[i("div",Ae,[i("h4",Ge,p(t.name),1),t.isPrivate?(l(),d("div",Ye,[v(a(S),{icon:a(se)},null,8,["icon"])])):T("",!0),t.hasNotification?(l(),d("div",He)):T("",!0)]),t.description?(l(),d("div",We,p(E(t.description,100)),1)):T("",!0),i("div",qe,[t.location?(l(),d("div",Qe,[v(a(S),{icon:a(ae)},null,8,["icon"]),i("span",null,p(t.location),1)])):T("",!0),i("div",Xe,[v(a(S),{icon:a(oe)},null,8,["icon"]),i("span",null,p(t.attendeeCount||0)+" going",1)])])]),i("div",je,[i("div",Je,[v(a(w),{fill:"clear",size:"small",class:"icon-button",onClick:L(e=>o.$emit("save-event",t),["stop"]),color:t.userSaved?"primary":"medium"},{default:y(()=>[v(a(S),{icon:t.userSaved?a(ie):a(re)},null,8,["icon"])]),_:2},1032,["onClick","color"]),v(a(w),{fill:"clear",size:"small",class:"icon-button",onClick:L(e=>o.$emit("share-event",t),["stop"])},{default:y(()=>[v(a(S),{icon:a(le)},null,8,["icon"])]),_:1},8,["onClick"])]),t.userAttending?(l(),Y(a(w),{key:1,fill:"clear",size:"small",class:"cancel-rsvp-button",onClick:L(e=>o.$emit("cancel-rsvp",t),["stop"])},{default:y(()=>[...s[2]||(s[2]=[G(" Going ",-1)])]),_:1},8,["onClick"])):(l(),Y(a(w),{key:0,fill:"outline",size:"small",class:"rsvp-button",onClick:L(e=>o.$emit("rsvp",t),["stop"])},{default:y(()=>[...s[1]||(s[1]=[G(" RSVP ",-1)])]),_:1},8,["onClick"]))])])],8,Ve))),128))])]))),128))])):(l(),d("div",Ke,[i("div",Ze,[v(a(S),{icon:a(ne)},null,8,["icon"])]),s[4]||(s[4]=i("h3",{class:"empty-title"},"Create an event, big or small!",-1)),v(a(w),{fill:"outline",class:"empty-action-button",onClick:N},{default:y(()=>[...s[3]||(s[3]=[G(" Create Event ",-1)])]),_:1})]))]))}}),tt=W(et,[["__scopeId","data-v-b3b3849f"]]),nt={class:"events-container"},st={class:"events-main-layout"},at={class:"calendar-section"},ot={class:"events-list-section"},it={key:0,class:"loading-container"},rt=H({__name:"EventsPage",setup(B){const b=_e(),m=ce(),D=ue(),h=V(!1),g=V([]),k=V(void 0);async function I(){var e;if((e=m.user)!=null&&e.id){h.value=!0;try{const r=D.currentCommunityId;if(!r){console.warn("No community selected"),g.value=[];return}const n=await P.getEvents(r,m.user.id);g.value=n}catch(r){console.error("Error loading events:",r)}finally{h.value=!1}}}function M(e){k.value=e}function E(e){const r=e?{date:e.toISOString()}:{};b.push({name:"create-event",query:r})}function R(e,r){k.value=e}function N(e){b.push("/tabs/events/".concat(e.id))}async function o(e){var r;if((r=m.user)!=null&&r.id)try{await P.rsvpToEvent(e.id,m.user.id),e.userAttending=!0,e.attendeeCount=(e.attendeeCount||0)+1}catch(n){console.error("Error RSVPing to event:",n)}}async function s(e){var r;if((r=m.user)!=null&&r.id)try{await P.cancelRsvp(e.id,m.user.id),e.userAttending=!1,e.attendeeCount=Math.max(0,(e.attendeeCount||1)-1)}catch(n){console.error("Error canceling RSVP:",n)}}async function c(e){try{const r=await P.shareEvent(e.id);navigator.share?await navigator.share({title:e.name,text:e.description||"Check out this event: ".concat(e.name),url:r}):(await navigator.clipboard.writeText(r),console.log("Event URL copied to clipboard:",r))}catch(r){console.error("Error sharing event:",r)}}async function t(e){var r;if((r=m.user)!=null&&r.id)try{await P.toggleSaveEvent(e.id,m.user.id),e.userSaved=!e.userSaved}catch(n){console.error("Error saving event:",n)}}return de(()=>D.currentCommunityId,()=>{I()}),ve(()=>{I()}),(e,r)=>(l(),Y(a(he),null,{default:y(()=>[v(a(fe),{fullscreen:!0,class:"events-content"},{default:y(()=>[i("div",nt,[r[1]||(r[1]=i("div",{class:"events-header"},[i("h1",{class:"page-title"},"Events")],-1)),i("div",st,[i("div",at,[v(be,{"selected-date":k.value,events:g.value,onDaySelected:M,onCreateEvent:E,onViewEvents:R},null,8,["selected-date","events"])]),i("div",ot,[v(tt,{events:g.value,"selected-date":k.value,onEventClick:N,onRsvp:o,onCancelRsvp:s,onCreateEvent:E,onShareEvent:c,onSaveEvent:t},null,8,["events","selected-date"])])]),h.value?(l(),d("div",it,[v(a(me)),r[0]||(r[0]=i("p",null,"Loading events...",-1))])):T("",!0)])]),_:1})]),_:1}))}}),dt=W(rt,[["__scopeId","data-v-0dd76265"]]);export{dt as default};
