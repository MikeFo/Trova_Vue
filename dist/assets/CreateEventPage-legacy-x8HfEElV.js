!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,a,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function l(e,r,o,i){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return t(c,"_invoke",function(e,t,r){var o,i,l,s=0,c=r||[],d=!1,v={p:0,n:0,v:n,a:p,f:p.bind(n,4),d:function(e,t){return o=e,i=0,l=n,v.n=t,u}};function p(e,t){for(i=e,l=t,a=0;!d&&s&&!r&&a<c.length;a++){var r,o=c[a],p=v.p,f=o[2];e>3?(r=f===t)&&(l=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=n):o[0]<=p&&((r=e<2&&p<o[1])?(i=0,v.v=t,v.n=o[1]):p<f&&(r=e<3||o[0]>t||t>f)&&(o[4]=e,o[5]=t,v.n=f,i=0))}if(r||e>1)return u;throw d=!0,t}return function(r,c,f){if(s>1)throw TypeError("Generator is already running");for(d&&1===c&&p(c,f),i=c,l=f;(a=i<2?n:l)||!d;){o||(i?i<3?(i>1&&(v.n=-1),p(i,l)):v.n=l:v.v=l);try{if(s=2,o){if(i||(r="next"),a=o[r]){if(!(a=a.call(o,l)))throw TypeError("iterator result is not an object");if(!a.done)return a;l=a.value,i<2&&(i=0)}else 1===i&&(a=o.return)&&a.call(o),i<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),i=1);o=n}else if((a=(d=v.n<0)?l:e.call(t,v))!==u)break}catch(a){o=n,i=1,l=a}finally{s=1}}return{value:a,done:d}}}(e,o,i),!0),c}var u={};function s(){}function c(){}function d(){}a=Object.getPrototypeOf;var v=[][o]?a(a([][o]())):(t(a={},o,function(){return this}),a),p=d.prototype=s.prototype=Object.create(v);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=d,t(p,"constructor",d),t(d,"constructor",c),c.displayName="GeneratorFunction",t(d,i,"GeneratorFunction"),t(p),t(p,i,"Generator"),t(p,o,function(){return this}),t(p,"toString",function(){return"[object Generator]"}),(e=function(){return{w:l,m:f}})()}function t(e,n,a,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,a,r){function i(n,a){t(e,n,function(e){return this._invoke(n,a,e)})}n?o?o(e,n,{value:a,enumerable:!r,configurable:!r,writable:!r}):e[n]=a:(i("next",0),i("throw",1),i("return",2))},t(e,n,a,r)}function n(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function r(e,t,n,a,r,o,i){try{var l=e[o](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(a,o){var i=e.apply(t,n);function l(e){r(i,a,o,l,u,"next",e)}function u(e){r(i,a,o,l,u,"throw",e)}l(void 0)})}}System.register(["./index-legacy-D3_iwoP0.js","./event.service-legacy-CMLG_2ZP.js"],function(t,a){"use strict";var r,i,l,u,s,c,d,v,p,f,m,g,h,b,y,x,w,S,T,k,_,E,O,D,I,P,C,j,F,V,H,z,A,q,N,U,G,L,R,Y,M,W,$,J;return{setters:[function(e){r=e.F,i=e.v,l=e.a1,u=e.y,s=e.r,c=e.a2,d=e.G,v=e.I,p=e.J,f=e.L,m=e.M,g=e.a3,h=e.$,b=e.H,y=e.N,x=e.ak,w=e.aq,S=e.X,T=e.a6,k=e.ar,_=e.al,E=e.W,O=e.a8,D=e.am,I=e.O,P=e.ap,C=e.Y,j=e.ag,F=e.ae,V=e.ac,H=e.U,z=e.at,A=e.as,q=e.az,N=e.aA,U=e.au,G=e.av,L=e.Q,R=e.aw,Y=e.ax,M=e.ay,W=e.R,$=e.a0},function(e){J=e.eventService}],execute:function(){var a=document.createElement("style");a.textContent=".create-event-content[data-v-4e3e9185]{--background: #f8fafc}.create-event-container[data-v-4e3e9185]{padding:16px;max-width:600px;margin:0 auto}.form-section[data-v-4e3e9185]{background:#fff;border-radius:16px;padding:24px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,.04)}.section-label[data-v-4e3e9185]{font-size:18px;font-weight:600;color:#1a1a1a;margin-bottom:16px;display:block}.form-item[data-v-4e3e9185]{--padding-start: 0;--padding-end: 0;--inner-padding-end: 0;margin-bottom:16px}.form-item-wrapper[data-v-4e3e9185]{margin-bottom:20px;display:flex;flex-direction:column;gap:8px}.form-label[data-v-4e3e9185]{font-size:14px;font-weight:500;color:#374151;margin-bottom:4px}.error-message[data-v-4e3e9185]{color:#ef4444;font-size:14px;margin-top:-12px;margin-bottom:12px;padding-left:16px}.datetime-input[data-v-4e3e9185]{width:100%;padding:12px 48px 12px 12px;border:1px solid #e5e7eb;border-radius:8px;font-size:16px;font-family:inherit;background:#fff;color:#1a1a1a;transition:border-color .2s;box-sizing:border-box;min-height:48px}.datetime-input[data-v-4e3e9185]:focus{outline:none;border-color:var(--color-primary)}.datetime-input[data-v-4e3e9185]:disabled{background:#f9fafb;color:#6b7280;cursor:not-allowed}.photo-upload-container[data-v-4e3e9185]{display:flex;justify-content:center;align-items:center;margin:16px 0}.photo-preview[data-v-4e3e9185]{position:relative;width:200px;height:200px;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px rgba(0,0,0,.1)}.photo-preview img[data-v-4e3e9185]{width:100%;height:100%;object-fit:cover}.remove-photo[data-v-4e3e9185]{position:absolute;bottom:8px;right:8px}.photo-placeholder[data-v-4e3e9185]{width:200px;height:200px;border-radius:12px;border:3px dashed #d1d5db;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;color:#6b7280;background:#f9fafb}.photo-placeholder[data-v-4e3e9185]:hover{border-color:var(--color-primary);background:#f0fdf4}.photo-placeholder ion-icon[data-v-4e3e9185]{font-size:48px;margin-bottom:8px}.photo-placeholder p[data-v-4e3e9185]{font-size:14px;margin:0}.form-actions[data-v-4e3e9185]{margin-top:24px;padding:0 8px}.submit-button[data-v-4e3e9185]{--border-radius: 12px;--padding-top: 16px;--padding-bottom: 16px;height:52px;font-weight:600;font-size:16px;text-transform:none;--background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);--color: #ffffff;box-shadow:0 4px 12px rgba(52,168,83,.3);transition:all .2s ease}.submit-button[data-v-4e3e9185]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 16px rgba(52,168,83,.4)}.submit-button[data-v-4e3e9185]:disabled{--background: #e5e7eb;--color: #94a3b8;box-shadow:none;opacity:.6}@media (min-width: 768px){.create-event-container[data-v-4e3e9185]{padding:24px}.form-section[data-v-4e3e9185]{padding:32px}}\n",document.head.appendChild(a);var Q={class:"create-event-container"},X={class:"form-section"},B={key:0,class:"error-message"},K={key:1,class:"error-message"},Z={class:"form-section"},ee={class:"photo-upload-container"},te={key:0,class:"photo-preview"},ne=["src"],ae={class:"form-section"},re={class:"form-item-wrapper"},oe=["min"],ie={class:"form-item-wrapper"},le=["min"],ue={key:0,class:"error-message"},se={class:"form-section"},ce={key:0,class:"error-message"},de={class:"form-section"},ve={class:"form-actions"},pe=r({__name:"CreateEventPage",setup:function(t){var a=b(),r=g(),$=i(),pe=l(),fe=u().storage,me=s(!1),ge=s(null),he=s(!1);var be=function(){if(r.query.date)try{var e=new Date(r.query.date);if(!isNaN(e.getTime()))return e.setHours(e.getHours()+1,0,0,0),e}catch(n){console.warn("Invalid date in query params:",n)}var t=new Date;return t.setHours(t.getHours()+1,0,0,0),t}(),ye=new Date(be);ye.setHours(ye.getHours()+1);var xe=s({name:"",description:"",startTime:be.toISOString(),endTime:ye.toISOString(),location:"",photo:null,photoFile:null,isPrivate:!1}),we=s(null),Se=s({name:"",description:"",startTime:"",location:""});function Te(e){if(!e)return"";var t=new Date(e),n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r,"T").concat(o,":").concat(i)}function ke(e){return e?new Date(e).toISOString():""}var _e=s(Te(be.toISOString())),Ee=s(Te(ye.toISOString())),Oe=c(function(){return Te((new Date).toISOString())});function De(){if(xe.value.startTime=ke(_e.value),!Ee.value||Ee.value<_e.value){var e=new Date(_e.value),t=new Date(e);t.setHours(t.getHours()+1),Ee.value=Te(t.toISOString()),xe.value.endTime=t.toISOString()}}function Ie(){xe.value.endTime=Ee.value?ke(Ee.value):""}var Pe=c(function(){return xe.value.name.trim().length>0&&xe.value.startTime.length>0});function Ce(){a.back()}function je(){var e;null===(e=we.value)||void 0===e||e.click()}function Fe(e){var t,n=null==e?void 0:e.target,a=null==n||null===(t=n.files)||void 0===t?void 0:t[0];if(a){xe.value.photoFile=a;var r=new FileReader;r.onload=function(e){var t;xe.value.photo=null===(t=e.target)||void 0===t?void 0:t.result},r.readAsDataURL(a)}}function Ve(){xe.value.photo=null,xe.value.photoFile=null,we.value&&(we.value.value="")}function He(){Se.value={name:"",description:"",startTime:"",location:""};var e=!0;(xe.value.name.trim()?xe.value.name.length>100&&(Se.value.name="Event name must be 100 characters or less",e=!1):(Se.value.name="Event name is required",e=!1),xe.value.description&&xe.value.description.length>1e3&&(Se.value.description="Description must be 1000 characters or less",e=!1),xe.value.startTime)?new Date(xe.value.startTime)<new Date&&(Se.value.startTime="Start time must be in the future",e=!1):(Se.value.startTime="Start date and time are required",e=!1);if(xe.value.endTime){var t=new Date(xe.value.startTime);new Date(xe.value.endTime)<=t&&(Se.value.startTime="End time must be after start time",e=!1)}return xe.value.location&&xe.value.location.length>200&&(Se.value.location="Location must be 200 characters or less",e=!1),e}function ze(){return Ae.apply(this,arguments)}function Ae(){return(Ae=o(e().m(function t(){var n,r,o,i,l,u,s,c,d,v,p,f,m,g,b,y,x;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(He()){e.n=1;break}return e.a(2);case 1:if(null!==(n=$.user)&&void 0!==n&&n.id){e.n=4;break}return e.n=2,h.create({message:"You must be logged in to create an event",duration:2e3,color:"danger"});case 2:return r=e.v,e.n=3,r.present();case 3:return e.a(2);case 4:if(he.value=!0,e.p=5,o=pe.currentCommunityId){e.n=8;break}return e.n=6,h.create({message:"You must be part of a community to create an event. Please select a community first.",duration:4e3,color:"warning"});case 6:return i=e.v,e.n=7,i.present();case 7:return he.value=!1,e.a(2);case 8:if(l=void 0,!xe.value.photoFile||!fe){e.n=15;break}return e.p=9,u=$.user.id,s="event_".concat(u,"_").concat(Date.now()),c=R(fe,"images/".concat(s)),e.n=10,Y(c,xe.value.photoFile);case 10:return e.n=11,M(c);case 11:l=e.v,e.n=14;break;case 12:return e.p=12,y=e.v,console.error("Error uploading photo:",y),e.n=13,h.create({message:y.message||"Failed to upload photo. Creating event without photo.",duration:3e3,color:"warning"});case 13:return d=e.v,e.n=14,d.present();case 14:e.n=16;break;case 15:xe.value.photo&&!xe.value.photoFile&&(l=xe.value.photo);case 16:if(v={name:xe.value.name.trim(),description:xe.value.description.trim()||void 0,startTime:new Date(xe.value.startTime).toISOString(),endTime:xe.value.endTime?new Date(xe.value.endTime).toISOString():void 0,location:xe.value.location.trim()||void 0,photo:l,communityId:o,isPrivate:xe.value.isPrivate},!me.value||!ge.value){e.n=18;break}return e.n=17,J.updateEvent(ge.value,v);case 17:e.v,e.n=20;break;case 18:return e.n=19,J.createEvent(v);case 19:e.v;case 20:return e.n=21,h.create({message:me.value?"Event updated successfully!":"Event created successfully!",duration:2e3,color:"success"});case 21:return p=e.v,e.n=22,p.present();case 22:a.push("/tabs/events"),e.n=25;break;case 23:return e.p=23,x=e.v,console.error("Error saving event:",x),m=me.value?"Failed to update event. Please try again.":"Failed to create event. Please try again.",x.message&&"{}"!==x.message&&"Request failed"!==x.message?m=x.message:null!==(f=x.response)&&void 0!==f&&f.data&&((g=x.response.data).message&&"{}"!==g.message?m=g.message:g.error&&(m=g.error)),e.n=24,h.create({message:m,duration:4e3,color:"danger"});case 24:return b=e.v,e.n=25,b.present();case 25:return e.p=25,he.value=!1,e.f(25);case 26:return e.a(2)}},t,null,[[9,12],[5,23,25,26]])}))).apply(this,arguments)}function qe(){return(qe=o(e().m(function t(){var n,o,i,l,u,s,c;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(n=r.params.id)||"string"!=typeof n||isNaN(Number(n))||!r.path.includes("/edit")){e.n=6;break}return me.value=!0,ge.value=Number(n),e.p=1,e.n=2,J.getEvent(ge.value);case 2:(o=e.v)&&(i=new Date(o.startTime),(l=o.endTime?new Date(o.endTime).toISOString():"")||((u=new Date(i)).setHours(u.getHours()+1),l=u.toISOString()),xe.value={name:o.name,description:o.description||"",startTime:i.toISOString(),endTime:l,location:o.location||"",photo:o.photo||null,photoFile:null,isPrivate:o.isPrivate},_e.value=Te(xe.value.startTime),Ee.value=Te(xe.value.endTime)),e.n=6;break;case 3:return e.p=3,c=e.v,console.error("Error loading event:",c),e.n=4,h.create({message:"Failed to load event",duration:2e3,color:"danger"});case 4:return s=e.v,e.n=5,s.present();case 5:a.back();case 6:return e.a(2)}},t,null,[[1,3]])}))).apply(this,arguments)}return d(function(){!function(){qe.apply(this,arguments)}()}),function(e,t){return W(),v(f(m),null,{default:p(function(){return[y(f(D),null,{default:p(function(){return[y(f(x),null,{default:p(function(){return[y(f(w),{slot:"start"},{default:p(function(){return[y(f(S),{onClick:Ce},{default:p(function(){return[y(f(T),{icon:f(k)},null,8,["icon"])]}),_:1})]}),_:1}),y(f(_),null,{default:p(function(){return[E(O(me.value?"Edit Event":"Create Event"),1)]}),_:1}),y(f(w),{slot:"end"},{default:p(function(){return[y(f(S),{onClick:ze,disabled:!Pe.value||he.value},{default:p(function(){return[E(O(he.value?"Saving...":me.value?"Save":"Create"),1)]}),_:1},8,["disabled"])]}),_:1})]}),_:1})]}),_:1}),y(f(L),{fullscreen:!0,class:"create-event-content"},{default:p(function(){return[I("div",Q,[I("form",{onSubmit:P(ze,["prevent"])},[I("div",X,[y(f(F),{class:"section-label"},{default:p(function(){return n(t[6]||(t[6]=[E("Event Information",-1)]))}),_:1}),y(f(V),{class:"form-item",lines:"full"},{default:p(function(){return[y(f(F),{position:"stacked"},{default:p(function(){return n(t[7]||(t[7]=[E("Event Name",-1)]))}),_:1}),y(f(H),{modelValue:xe.value.name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return xe.value.name=e}),placeholder:"What's your event called?",maxlength:100,required:""},null,8,["modelValue"])]}),_:1}),Se.value.name?(W(),C("div",B,O(Se.value.name),1)):j("",!0),y(f(V),{class:"form-item",lines:"full"},{default:p(function(){return[y(f(F),{position:"stacked"},{default:p(function(){return n(t[8]||(t[8]=[E("Description",-1)]))}),_:1}),y(f(z),{modelValue:xe.value.description,"onUpdate:modelValue":t[1]||(t[1]=function(e){return xe.value.description=e}),placeholder:"Tell people what your event is about",maxlength:1e3,rows:5},null,8,["modelValue"])]}),_:1}),Se.value.description?(W(),C("div",K,O(Se.value.description),1)):j("",!0)]),I("div",Z,[y(f(F),{class:"section-label"},{default:p(function(){return n(t[9]||(t[9]=[E("Event Photo",-1)]))}),_:1}),I("div",ee,[xe.value.photo?(W(),C("div",te,[I("img",{src:xe.value.photo,alt:"Event photo"},null,8,ne),y(f(S),{fill:"clear",size:"small",onClick:Ve,class:"remove-photo"},{default:p(function(){return n(t[10]||(t[10]=[E(" Remove ",-1)]))}),_:1})])):(W(),C("div",{key:1,class:"photo-placeholder",onClick:je},[y(f(T),{icon:f(A)},null,8,["icon"]),t[11]||(t[11]=I("p",null,"Tap to add photo",-1))])),I("input",{ref_key:"fileInput",ref:we,type:"file",accept:"image/*",onChange:Fe,style:{display:"none"}},null,544)])]),I("div",ae,[y(f(F),{class:"section-label"},{default:p(function(){return n(t[12]||(t[12]=[E("Date & Time",-1)]))}),_:1}),I("div",re,[y(f(F),{class:"form-label"},{default:p(function(){return n(t[13]||(t[13]=[E("Start Date & Time",-1)]))}),_:1}),q(I("input",{type:"datetime-local","onUpdate:modelValue":t[2]||(t[2]=function(e){return _e.value=e}),min:Oe.value,class:"datetime-input",required:"",onChange:De},null,40,oe),[[N,_e.value]])]),I("div",ie,[y(f(F),{class:"form-label"},{default:p(function(){return n(t[14]||(t[14]=[E("End Date & Time (Optional)",-1)]))}),_:1}),q(I("input",{type:"datetime-local","onUpdate:modelValue":t[3]||(t[3]=function(e){return Ee.value=e}),min:_e.value||Oe.value,class:"datetime-input",onChange:Ie},null,40,le),[[N,Ee.value]])]),Se.value.startTime?(W(),C("div",ue,O(Se.value.startTime),1)):j("",!0)]),I("div",se,[y(f(F),{class:"section-label"},{default:p(function(){return n(t[15]||(t[15]=[E("Location",-1)]))}),_:1}),y(f(V),{class:"form-item",lines:"full"},{default:p(function(){return[y(f(F),{position:"stacked"},{default:p(function(){return n(t[16]||(t[16]=[E("Event Location",-1)]))}),_:1}),y(f(H),{modelValue:xe.value.location,"onUpdate:modelValue":t[4]||(t[4]=function(e){return xe.value.location=e}),placeholder:"Where is your event?",maxlength:200},null,8,["modelValue"])]}),_:1}),Se.value.location?(W(),C("div",ce,O(Se.value.location),1)):j("",!0)]),I("div",de,[y(f(F),{class:"section-label"},{default:p(function(){return n(t[17]||(t[17]=[E("Privacy",-1)]))}),_:1}),y(f(U),{modelValue:xe.value.isPrivate,"onUpdate:modelValue":t[5]||(t[5]=function(e){return xe.value.isPrivate=e})},{default:p(function(){return[y(f(V),{lines:"none"},{default:p(function(){return[y(f(G),{slot:"start",value:!1}),y(f(F),null,{default:p(function(){return n(t[18]||(t[18]=[I("h3",null,"Public",-1),I("p",null,"Anyone can see and join this event",-1)]))}),_:1})]}),_:1}),y(f(V),{lines:"none"},{default:p(function(){return[y(f(G),{slot:"start",value:!0}),y(f(F),null,{default:p(function(){return n(t[19]||(t[19]=[I("h3",null,"Private",-1),I("p",null,"Only invited members can see this event",-1)]))}),_:1})]}),_:1})]}),_:1},8,["modelValue"])]),I("div",ve,[y(f(S),{expand:"block",onClick:ze,disabled:!Pe.value||he.value,class:"submit-button"},{default:p(function(){return[E(O(he.value?"Saving...":me.value?"Save Changes":"Create Event"),1)]}),_:1},8,["disabled"])])],32)])]}),_:1})]}),_:1})}}});t("default",$(pe,[["__scopeId","data-v-4e3e9185"]]))}}})}();
