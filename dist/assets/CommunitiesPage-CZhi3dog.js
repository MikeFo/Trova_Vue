const __vite__fileDeps=["assets/index-CkJ7yJ3n.js","assets/index-BoVDCu-3.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{F as R,a1 as U,v as A,r as b,G as H,I as T,J as f,L as o,M as Q,aj as p,$ as I,N as l,ak as W,al as X,W as P,am as q,O as s,Y as r,a5 as z,Z as G,aa as Y,ab as Z,ag as k,a6 as S,an as V,a8 as g,X as j,ao as K,Q as ee,H as te,R as i,ap as oe,_ as se,a0 as ae}from"./index-CkJ7yJ3n.js";const ne={class:"communities-container"},ie={class:"search-section"},le={key:0,class:"loading-state"},re={key:1,class:"communities-list"},ue={class:"community-card-content"},ce={class:"community-logo"},me=["src","alt"],de={key:1,class:"community-placeholder"},fe={class:"community-info"},ye={class:"community-name"},_e={key:0,class:"community-bio"},ge={key:1,class:"community-leader"},Ce={class:"leader-name"},ve={class:"community-action"},he={key:2,class:"empty-state"},pe={class:"empty-icon"},we={class:"empty-title"},be={class:"empty-description"},Ie=R({__name:"CommunitiesPage",setup(Pe){const x=te(),d=U(),B=A(),C=b([]),u=b(""),y=b(!1);let w=null;async function v(a){y.value=!0;try{console.log("[CommunitiesPage] Loading public communities...",a?'search: "'.concat(a,'"'):"");const e=await p.getPublicCommunities(a);console.log("[CommunitiesPage] Loaded communities:",e.length),C.value=e}catch(e){console.error("[CommunitiesPage] Error loading communities:",e),await(await I.create({message:e.message||"Failed to load communities. Please try again.",duration:3e3,color:"danger"})).present(),C.value=[]}finally{y.value=!1}}function F(a){const e=a.target.value||"";u.value=e,w&&clearTimeout(w),w=setTimeout(()=>{e.trim()?v(e.trim()):v()},500)}function $(){u.value="",v()}async function M(a){try{y.value=!0,await p.joinCommunity(a.id),await(await I.create({message:"Successfully joined ".concat(a.name,"!"),duration:2e3,color:"success"})).present();const{authService:t}=await se(()=>import("./index-CkJ7yJ3n.js").then(_=>_.bX),__vite__mapDeps([0,1]));await t.getUserProfile();let n=null;try{n=await p.getCommunityById(a.id),console.log("[CommunitiesPage] Fetched full community details:",n)}catch(_){console.warn("[CommunitiesPage] Could not fetch full community details, using provided community data"),n=a}window.dispatchEvent(new CustomEvent("communities-updated"));const N=async(_=0)=>{var L;const D=(_+1)*1e3;await new Promise(c=>setTimeout(c,D));const E=(L=B.user)==null?void 0:L.id;if(E)try{const c=await p.getUserCommunities(E,!0);let m=c.find(h=>h.id===a.id);if(!m&&n){const h=[...c,n];d.setCommunities(h),m=n}else m&&d.setCommunities(c);if(m)d.setCurrentCommunity(m);else{if(_<4)return N(_+1);d.setCommunities(c)}}catch(c){if(console.error("[CommunitiesPage] Error selecting new community:",c),n){const m=d.communities;m.find(J=>J.id===n.id)||(d.setCommunities([...m,n]),d.setCurrentCommunity(n),console.log("[CommunitiesPage] Manually added community to store after error"))}}};await N(),x.push("/tabs/home")}catch(e){console.error("[CommunitiesPage] Error joining community:",e),await(await I.create({message:e.message||"Failed to join community. Please try again.",duration:3e3,color:"danger"})).present()}finally{y.value=!1}}function O(){console.log("Create community")}return H(()=>{v()}),(a,e)=>(i(),T(o(Q),null,{default:f(()=>[l(o(q),null,{default:f(()=>[l(o(W),null,{default:f(()=>[l(o(X),null,{default:f(()=>[...e[1]||(e[1]=[P("Communities",-1)])]),_:1})]),_:1})]),_:1}),l(o(ee),{fullscreen:!0,class:"communities-content"},{default:f(()=>[s("div",ne,[s("div",ie,[l(o(z),{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),placeholder:"Search communities by name...",onIonInput:F,onIonClear:$,debounce:500,class:"search-bar"},null,8,["modelValue"])]),y.value?(i(),r("div",le,[l(o(G),{name:"crescent"}),e[2]||(e[2]=s("p",null,"Loading communities...",-1))])):C.value.length>0?(i(),r("div",re,[(i(!0),r(Y,null,Z(C.value,t=>(i(),r("div",{key:t.id,class:"community-card"},[s("div",ue,[s("div",ce,[t.logo?(i(),r("img",{key:0,src:t.logo,alt:t.name},null,8,me)):(i(),r("div",de,[l(o(S),{icon:o(V)},null,8,["icon"])]))]),s("div",fe,[s("h3",ye,g(t.name),1),t.bio?(i(),r("p",_e,g(t.bio),1)):k("",!0),t.leader?(i(),r("div",ge,[e[3]||(e[3]=s("span",{class:"leader-label"},"Leader:",-1)),s("span",Ce,g(t.leader.fname)+" "+g(t.leader.lname),1)])):k("",!0)]),s("div",ve,[l(o(j),{fill:"solid",size:"small",class:"join-button",onClick:oe(n=>M(t),["stop"]),disabled:y.value},{default:f(()=>[...e[4]||(e[4]=[P(" Join ",-1)])]),_:1},8,["onClick","disabled"])])])]))),128))])):(i(),r("div",he,[s("div",pe,[l(o(S),{icon:o(V)},null,8,["icon"])]),s("h3",we,g(u.value?"No communities found":"No communities yet"),1),s("p",be,g(u.value?'No communities found matching "'.concat(u.value,'". Try a different search term.'):"Join or create a community to get started!"),1),u.value?k("",!0):(i(),T(o(j),{key:0,fill:"solid",class:"empty-action-button",onClick:O},{default:f(()=>[l(o(S),{icon:o(K),slot:"start"},null,8,["icon"]),e[5]||(e[5]=P(" Create Community ",-1))]),_:1}))]))])]),_:1})]),_:1}))}}),Se=ae(Ie,[["__scopeId","data-v-be5a351c"]]);export{Se as default};
